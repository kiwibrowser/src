<html>
<a id='link' href="javascript:document.querySelector('embed').webkitRequestFullScreen()">go
fullscreen</a>
<p>
There should only be one ALERT. If there were two, the plugin was reloaded
during the transition to fullscreen.
</p>
<embed type="application/x-blink-test-plugin"></embed>

<script>
if (window.testRunner) {
    testRunner.waitUntilDone();
    testRunner.dumpAsText();

    var plugin = document.querySelector('embed');
    plugin.addEventListener('webkitfullscreenchange', function () {
        internals.updateLayoutIgnorePendingStylesheetsAndRunPostLayoutTasks();
        testRunner.notifyDone();
    })
    document.addEventListener('keydown', function () {
        plugin.webkitRequestFullScreen();
    })
    eventSender.keyDown('a')
}
</script>
</html>

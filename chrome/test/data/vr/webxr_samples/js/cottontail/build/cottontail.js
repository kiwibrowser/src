/*!
 * Copyright 2018 The Immersive Web Community Group
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(window,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=33)}([function(t,e,r){"use strict";r.r(e),r.d(e,"EPSILON",function(){return n}),r.d(e,"ARRAY_TYPE",function(){return i}),r.d(e,"RANDOM",function(){return o}),r.d(e,"setMatrixArrayType",function(){return a}),r.d(e,"toRadian",function(){return s}),r.d(e,"equals",function(){return c});const n=1e-6;let i="undefined"!=typeof Float32Array?Float32Array:Array;const o=Math.random;function a(t){i=t}const u=Math.PI/180;function s(t){return t*u}function c(t,e){return Math.abs(t-e)<=n*Math.max(1,Math.abs(t),Math.abs(e))}},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"fromValues",function(){return a}),r.d(e,"copy",function(){return u}),r.d(e,"set",function(){return s}),r.d(e,"add",function(){return c}),r.d(e,"subtract",function(){return f}),r.d(e,"multiply",function(){return l}),r.d(e,"divide",function(){return h}),r.d(e,"ceil",function(){return d}),r.d(e,"floor",function(){return v}),r.d(e,"min",function(){return _}),r.d(e,"max",function(){return m}),r.d(e,"round",function(){return p}),r.d(e,"scale",function(){return y}),r.d(e,"scaleAndAdd",function(){return b}),r.d(e,"distance",function(){return g}),r.d(e,"squaredDistance",function(){return M}),r.d(e,"length",function(){return x}),r.d(e,"squaredLength",function(){return T}),r.d(e,"negate",function(){return E}),r.d(e,"inverse",function(){return w}),r.d(e,"normalize",function(){return O}),r.d(e,"dot",function(){return P}),r.d(e,"lerp",function(){return R}),r.d(e,"random",function(){return S}),r.d(e,"transformMat4",function(){return A}),r.d(e,"transformQuat",function(){return N}),r.d(e,"str",function(){return C}),r.d(e,"exactEquals",function(){return I}),r.d(e,"equals",function(){return k}),r.d(e,"sub",function(){return L}),r.d(e,"mul",function(){return F}),r.d(e,"div",function(){return D}),r.d(e,"dist",function(){return B}),r.d(e,"sqrDist",function(){return j}),r.d(e,"len",function(){return U}),r.d(e,"sqrLen",function(){return V}),r.d(e,"forEach",function(){return Y});var n=r(0);function i(){let t=new n.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function o(t){let e=new n.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(t,e,r,i){let o=new n.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function c(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function f(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function l(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function h(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function d(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function v(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function _(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function m(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function p(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function y(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function b(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function g(t,e){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+n*n+i*i+o*o)}function M(t,e){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return r*r+n*n+i*i+o*o}function x(t){let e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)}function T(t){let e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function E(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function w(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function O(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=o*a),t}function P(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function R(t,e,r,n){let i=e[0],o=e[1],a=e[2],u=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t[3]=u+n*(r[3]-u),t}function S(t,e){return e=e||1,t[0]=n.RANDOM(),t[1]=n.RANDOM(),t[2]=n.RANDOM(),t[3]=n.RANDOM(),O(t,t),y(t,t,e),t}function A(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}function N(t,e,r){let n=e[0],i=e[1],o=e[2],a=r[0],u=r[1],s=r[2],c=r[3],f=c*n+u*o-s*i,l=c*i+s*n-a*o,h=c*o+a*i-u*n,d=-a*n-u*i-s*o;return t[0]=f*c+d*-a+l*-s-h*-u,t[1]=l*c+d*-u+h*-a-f*-s,t[2]=h*c+d*-s+f*-u-l*-a,t[3]=e[3],t}function C(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function I(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function k(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=e[0],s=e[1],c=e[2],f=e[3];return Math.abs(r-u)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-c)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-f)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))}const L=f,F=l,D=h,B=g,j=M,U=x,V=T,Y=function(){let t=i();return function(e,r,n,i,o,a){let u,s;for(r||(r=4),n||(n=0),s=i?Math.min(i*r+n,e.length):e.length,u=n;u<s;u+=r)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],t[3]=e[u+3],o(t,t,a),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];return e}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Node=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(32),o=r(6);var a=new Float32Array([0,0,0]),u=new Float32Array([0,0,0,1]),s=new Float32Array([1,1,1]),c=o.mat4.create(),f=o.vec3.create();e.Node=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=null,this.children=[],this.parent=null,this.visible=!0,this.selectable=!1,this._matrix=null,this._dirtyTRS=!1,this._translation=null,this._rotation=null,this._scale=null,this._dirtyWorldMatrix=!1,this._worldMatrix=null,this._activeFrameId=-1,this._hoverFrameId=-1,this._renderPrimitives=null,this._renderer=null,this._selectHandler=null}return n(t,[{key:"_setRenderer",value:function(t){if(this._renderer!=t&&(this._renderer&&this.clearRenderPrimitives(),this._renderer=t,t)){this.onRendererChanged(t);var e=!0,r=!1,n=void 0;try{for(var i,o=this.children[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value._setRenderer(t)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}}},{key:"onRendererChanged",value:function(t){}},{key:"clone",value:function(){var e=this,r=new t;return r.name=this.name,r.visible=this.visible,r._renderer=this._renderer,r._dirtyTRS=this._dirtyTRS,this._translation&&(r._translation=o.vec3.create(),o.vec3.copy(r._translation,this._translation)),this._rotation&&(r._rotation=o.quat.create(),o.quat.copy(r._rotation,this._rotation)),this._scale&&(r._scale=o.vec3.create(),o.vec3.copy(r._scale,this._scale)),!r._dirtyTRS&&this._matrix&&(r._matrix=o.mat4.create(),o.mat4.copy(r._matrix,this._matrix)),r._dirtyWorldMatrix=this._dirtyWorldMatrix,!r._dirtyWorldMatrix&&this._worldMatrix&&(r._worldMatrix=o.mat4.create(),o.mat4.copy(r._worldMatrix,this._worldMatrix)),this.waitForComplete().then(function(){if(e._renderPrimitives){var t=!0,n=!1,i=void 0;try{for(var o,a=e._renderPrimitives[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var u=o.value;r.addRenderPrimitive(u)}}catch(t){n=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}var s=!0,c=!1,f=void 0;try{for(var l,h=e.children[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var d=l.value;r.addNode(d.clone())}}catch(t){c=!0,f=t}finally{try{!s&&h.return&&h.return()}finally{if(c)throw f}}}),r}},{key:"markActive",value:function(t){if(this.visible&&this._renderPrimitives){this._activeFrameId=t;var e=!0,r=!1,n=void 0;try{for(var i,o=this._renderPrimitives[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.markActive(t)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}var a=!0,u=!1,s=void 0;try{for(var c,f=this.children[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var l=c.value;l.visible&&l.markActive(t)}}catch(t){u=!0,s=t}finally{try{!a&&f.return&&f.return()}finally{if(u)throw s}}}},{key:"addNode",value:function(t){t&&t.parent!=this&&(t.parent&&t.parent.removeNode(t),t.parent=this,this.children.push(t),this._renderer&&t._setRenderer(this._renderer))}},{key:"removeNode",value:function(t){var e=this.children.indexOf(t);e>-1&&(this.children.splice(e,1),t.parent=null)}},{key:"clearNodes",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=this.children[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){n.value.parent=null}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}this.children=[]}},{key:"setMatrixDirty",value:function(){if(!this._dirtyWorldMatrix){this._dirtyWorldMatrix=!0;var t=!0,e=!1,r=void 0;try{for(var n,i=this.children[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){n.value.setMatrixDirty()}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}}}},{key:"_updateLocalMatrix",value:function(){return this._matrix||(this._matrix=o.mat4.create()),this._dirtyTRS&&(this._dirtyTRS=!1,o.mat4.fromRotationTranslationScale(this._matrix,this._rotation||u,this._translation||a,this._scale||s)),this._matrix}},{key:"waitForComplete",value:function(){var t=this,e=[],r=!0,n=!1,i=void 0;try{for(var o,a=this.children[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value;e.push(u.waitForComplete())}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}if(this._renderPrimitives){var s=!0,c=!1,f=void 0;try{for(var l,h=this._renderPrimitives[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var d=l.value;e.push(d.waitForComplete())}}catch(t){c=!0,f=t}finally{try{!s&&h.return&&h.return()}finally{if(c)throw f}}}return Promise.all(e).then(function(){return t})}},{key:"addRenderPrimitive",value:function(t){this._renderPrimitives?this._renderPrimitives.push(t):this._renderPrimitives=[t],t._instances.push(this)}},{key:"removeRenderPrimitive",value:function(t){if(this._renderPrimitives){var e=this._renderPrimitives._instances.indexOf(t);e>-1&&(this._renderPrimitives._instances.splice(e,1),(e=t._instances.indexOf(this))>-1&&t._instances.splice(e,1),this._renderPrimitives.length||(this._renderPrimitives=null))}}},{key:"clearRenderPrimitives",value:function(){if(this._renderPrimitives){var t=!0,e=!1,r=void 0;try{for(var n,i=this._renderPrimitives[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=n.value,a=o._instances.indexOf(this);a>-1&&o._instances.splice(a,1)}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}this._renderPrimitives=null}}},{key:"_hitTestSelectableNode",value:function(t){if(this._renderPrimitives){var e=null,r=!0,n=!1,a=void 0;try{for(var u,s=this._renderPrimitives[Symbol.iterator]();!(r=(u=s.next()).done);r=!0){var f=u.value;if(f._min){e||(o.mat4.invert(c,this.worldMatrix),o.mat4.multiply(c,c,t),e=new i.Ray(c));var l=e.intersectsAABB(f._min,f._max);if(l)return o.vec3.transformMat4(l,l,this.worldMatrix),l}}}catch(t){n=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}}var h=!0,d=!1,v=void 0;try{for(var _,m=this.children[Symbol.iterator]();!(h=(_=m.next()).done);h=!0){var p=_.value._hitTestSelectableNode(t);if(p)return p}}catch(t){d=!0,v=t}finally{try{!h&&m.return&&m.return()}finally{if(d)throw v}}return null}},{key:"hitTest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e||(e=f,o.vec3.set(e,0,0,0),o.vec3.transformMat4(e,e,t)),this.selectable&&this.visible){var r=this._hitTestSelectableNode(t);return r?{node:this,intersection:r,distance:o.vec3.distance(e,r)}:null}var n=null,i=!0,a=!1,u=void 0;try{for(var s,c=this.children[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var l=s.value.hitTest(t,e);l&&(!n||n.distance>l.distance)&&(n=l)}}catch(t){a=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(a)throw u}}return n}},{key:"onSelect",value:function(t){this._selectHandler=t}},{key:"handleSelect",value:function(){this._selectHandler&&this._selectHandler()}},{key:"onHoverStart",value:function(){}},{key:"onHoverEnd",value:function(){}},{key:"_update",value:function(t,e){this.onUpdate(t,e);var r=!0,n=!1,i=void 0;try{for(var o,a=this.children[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){o.value._update(t,e)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"onUpdate",value:function(t,e){}},{key:"matrix",set:function(t){this._matrix=t,this.setMatrixDirty(),this._dirtyTRS=!1,this._translation=null,this._rotation=null,this._scale=null},get:function(){return this.setMatrixDirty(),this._updateLocalMatrix()}},{key:"worldMatrix",get:function(){return this._worldMatrix||(this._dirtyWorldMatrix=!0,this._worldMatrix=o.mat4.create()),(this._dirtyWorldMatrix||this._dirtyTRS)&&(this.parent?o.mat4.mul(this._worldMatrix,this.parent.worldMatrix,this._updateLocalMatrix()):o.mat4.copy(this._worldMatrix,this._updateLocalMatrix()),this._dirtyWorldMatrix=!1),this._worldMatrix}},{key:"translation",set:function(t){null!=t&&(this._dirtyTRS=!0,this.setMatrixDirty()),this._translation=t},get:function(){return this._dirtyTRS=!0,this.setMatrixDirty(),this._translation||(this._translation=o.vec3.clone(a)),this._translation}},{key:"rotation",set:function(t){null!=t&&(this._dirtyTRS=!0,this.setMatrixDirty()),this._rotation=t},get:function(){return this._dirtyTRS=!0,this.setMatrixDirty(),this._rotation||(this._rotation=o.quat.clone(u)),this._rotation}},{key:"scale",set:function(t){null!=t&&(this._dirtyTRS=!0,this.setMatrixDirty()),this._scale=t},get:function(){return this._dirtyTRS=!0,this.setMatrixDirty(),this._scale||(this._scale=o.vec3.clone(s)),this._scale}},{key:"renderPrimitives",get:function(){return this._renderPrimitives}},{key:"selectHandler",get:function(){return this._selectHandler}}]),t}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"length",function(){return a}),r.d(e,"fromValues",function(){return u}),r.d(e,"copy",function(){return s}),r.d(e,"set",function(){return c}),r.d(e,"add",function(){return f}),r.d(e,"subtract",function(){return l}),r.d(e,"multiply",function(){return h}),r.d(e,"divide",function(){return d}),r.d(e,"ceil",function(){return v}),r.d(e,"floor",function(){return _}),r.d(e,"min",function(){return m}),r.d(e,"max",function(){return p}),r.d(e,"round",function(){return y}),r.d(e,"scale",function(){return b}),r.d(e,"scaleAndAdd",function(){return g}),r.d(e,"distance",function(){return M}),r.d(e,"squaredDistance",function(){return x}),r.d(e,"squaredLength",function(){return T}),r.d(e,"negate",function(){return E}),r.d(e,"inverse",function(){return w}),r.d(e,"normalize",function(){return O}),r.d(e,"dot",function(){return P}),r.d(e,"cross",function(){return R}),r.d(e,"lerp",function(){return S}),r.d(e,"hermite",function(){return A}),r.d(e,"bezier",function(){return N}),r.d(e,"random",function(){return C}),r.d(e,"transformMat4",function(){return I}),r.d(e,"transformMat3",function(){return k}),r.d(e,"transformQuat",function(){return L}),r.d(e,"rotateX",function(){return F}),r.d(e,"rotateY",function(){return D}),r.d(e,"rotateZ",function(){return B}),r.d(e,"angle",function(){return j}),r.d(e,"str",function(){return U}),r.d(e,"exactEquals",function(){return V}),r.d(e,"equals",function(){return Y}),r.d(e,"sub",function(){return G}),r.d(e,"mul",function(){return H}),r.d(e,"div",function(){return q}),r.d(e,"dist",function(){return X}),r.d(e,"sqrDist",function(){return W}),r.d(e,"len",function(){return K}),r.d(e,"sqrLen",function(){return z}),r.d(e,"forEach",function(){return Q});var n=r(0);function i(){let t=new n.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t}function o(t){var e=new n.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(t){let e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function u(t,e,r){let i=new n.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=r,i}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function c(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function f(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function l(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function h(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function d(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function v(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function _(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function m(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function p(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function y(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function b(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function g(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function M(t,e){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)}function x(t,e){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function T(t){let e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function E(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function w(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function O(t,e){let r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function P(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function R(t,e,r){let n=e[0],i=e[1],o=e[2],a=r[0],u=r[1],s=r[2];return t[0]=i*s-o*u,t[1]=o*a-n*s,t[2]=n*u-i*a,t}function S(t,e,r,n){let i=e[0],o=e[1],a=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t}function A(t,e,r,n,i,o){let a=o*o,u=a*(2*o-3)+1,s=a*(o-2)+o,c=a*(o-1),f=a*(3-2*o);return t[0]=e[0]*u+r[0]*s+n[0]*c+i[0]*f,t[1]=e[1]*u+r[1]*s+n[1]*c+i[1]*f,t[2]=e[2]*u+r[2]*s+n[2]*c+i[2]*f,t}function N(t,e,r,n,i,o){let a=1-o,u=a*a,s=o*o,c=u*a,f=3*o*u,l=3*s*a,h=s*o;return t[0]=e[0]*c+r[0]*f+n[0]*l+i[0]*h,t[1]=e[1]*c+r[1]*f+n[1]*l+i[1]*h,t[2]=e[2]*c+r[2]*f+n[2]*l+i[2]*h,t}function C(t,e){e=e||1;let r=2*n.RANDOM()*Math.PI,i=2*n.RANDOM()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*o,t[1]=Math.sin(r)*o,t[2]=i*e,t}function I(t,e,r){let n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t}function k(t,e,r){let n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}function L(t,e,r){let n=r[0],i=r[1],o=r[2],a=r[3],u=e[0],s=e[1],c=e[2],f=i*c-o*s,l=o*u-n*c,h=n*s-i*u,d=i*h-o*l,v=o*f-n*h,_=n*l-i*f,m=2*a;return f*=m,l*=m,h*=m,d*=2,v*=2,_*=2,t[0]=u+f+d,t[1]=s+l+v,t[2]=c+h+_,t}function F(t,e,r,n){let i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function D(t,e,r,n){let i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function B(t,e,r,n){let i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function j(t,e){let r=u(t[0],t[1],t[2]),n=u(e[0],e[1],e[2]);O(r,r),O(n,n);let i=P(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}function U(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function V(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Y(t,e){let r=t[0],i=t[1],o=t[2],a=e[0],u=e[1],s=e[2];return Math.abs(r-a)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-s)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))}const G=l,H=h,q=d,X=M,W=x,K=a,z=T,Q=function(){let t=i();return function(e,r,n,i,o,a){let u,s;for(r||(r=3),n||(n=0),s=i?Math.min(i*r+n,e.length):e.length,u=n;u<s;u+=r)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],o(t,t,a),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2];return e}}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return u}),r.d(e,"identity",function(){return s}),r.d(e,"setAxisAngle",function(){return c}),r.d(e,"getAxisAngle",function(){return f}),r.d(e,"multiply",function(){return l}),r.d(e,"rotateX",function(){return h}),r.d(e,"rotateY",function(){return d}),r.d(e,"rotateZ",function(){return v}),r.d(e,"calculateW",function(){return _}),r.d(e,"slerp",function(){return m}),r.d(e,"invert",function(){return p}),r.d(e,"conjugate",function(){return y}),r.d(e,"fromMat3",function(){return b}),r.d(e,"fromEuler",function(){return g}),r.d(e,"str",function(){return M}),r.d(e,"clone",function(){return x}),r.d(e,"fromValues",function(){return T}),r.d(e,"copy",function(){return E}),r.d(e,"set",function(){return w}),r.d(e,"add",function(){return O}),r.d(e,"mul",function(){return P}),r.d(e,"scale",function(){return R}),r.d(e,"dot",function(){return S}),r.d(e,"lerp",function(){return A}),r.d(e,"length",function(){return N}),r.d(e,"len",function(){return C}),r.d(e,"squaredLength",function(){return I}),r.d(e,"sqrLen",function(){return k}),r.d(e,"normalize",function(){return L}),r.d(e,"exactEquals",function(){return F}),r.d(e,"equals",function(){return D}),r.d(e,"rotationTo",function(){return B}),r.d(e,"sqlerp",function(){return j}),r.d(e,"setAxes",function(){return U});var n=r(0),i=r(12),o=r(3),a=r(1);function u(){let t=new n.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function s(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function c(t,e,r){r*=.5;let n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function f(t,e){let r=2*Math.acos(e[3]),n=Math.sin(r/2);return 0!=n?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function l(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=r[0],s=r[1],c=r[2],f=r[3];return t[0]=n*f+a*u+i*c-o*s,t[1]=i*f+a*s+o*u-n*c,t[2]=o*f+a*c+n*s-i*u,t[3]=a*f-n*u-i*s-o*c,t}function h(t,e,r){r*=.5;let n=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(r),s=Math.cos(r);return t[0]=n*s+a*u,t[1]=i*s+o*u,t[2]=o*s-i*u,t[3]=a*s-n*u,t}function d(t,e,r){r*=.5;let n=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(r),s=Math.cos(r);return t[0]=n*s-o*u,t[1]=i*s+a*u,t[2]=o*s+n*u,t[3]=a*s-i*u,t}function v(t,e,r){r*=.5;let n=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(r),s=Math.cos(r);return t[0]=n*s+i*u,t[1]=i*s-n*u,t[2]=o*s+a*u,t[3]=a*s-o*u,t}function _(t,e){let r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t}function m(t,e,r,n){let i,o,a,u,s,c=e[0],f=e[1],l=e[2],h=e[3],d=r[0],v=r[1],_=r[2],m=r[3];return(o=c*d+f*v+l*_+h*m)<0&&(o=-o,d=-d,v=-v,_=-_,m=-m),1-o>1e-6?(i=Math.acos(o),a=Math.sin(i),u=Math.sin((1-n)*i)/a,s=Math.sin(n*i)/a):(u=1-n,s=n),t[0]=u*c+s*d,t[1]=u*f+s*v,t[2]=u*l+s*_,t[3]=u*h+s*m,t}function p(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o,u=a?1/a:0;return t[0]=-r*u,t[1]=-n*u,t[2]=-i*u,t[3]=o*u,t}function y(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function b(t,e){let r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);let i=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*i+i]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*i+o]-e[3*o+i])*r,t[i]=(e[3*i+n]+e[3*n+i])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t}function g(t,e,r,n){let i=.5*Math.PI/180;e*=i,r*=i,n*=i;let o=Math.sin(e),a=Math.cos(e),u=Math.sin(r),s=Math.cos(r),c=Math.sin(n),f=Math.cos(n);return t[0]=o*s*f-a*u*c,t[1]=a*u*f+o*s*c,t[2]=a*s*c-o*u*f,t[3]=a*s*f+o*u*c,t}function M(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const x=a.clone,T=a.fromValues,E=a.copy,w=a.set,O=a.add,P=l,R=a.scale,S=a.dot,A=a.lerp,N=a.length,C=N,I=a.squaredLength,k=I,L=a.normalize,F=a.exactEquals,D=a.equals,B=function(){let t=o.create(),e=o.fromValues(1,0,0),r=o.fromValues(0,1,0);return function(n,i,a){let u=o.dot(i,a);return u<-.999999?(o.cross(t,e,i),o.len(t)<1e-6&&o.cross(t,r,i),o.normalize(t,t),c(n,t,Math.PI),n):u>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(o.cross(t,i,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+u,L(n,n))}}(),j=function(){let t=u(),e=u();return function(r,n,i,o,a,u){return m(t,n,a,u),m(e,i,o,u),m(r,t,e,2*u*(1-u)),r}}(),U=function(){let t=i.create();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],L(e,b(e,t))}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.stateToBlendFunc=c;var o=WebGLRenderingContext,a=e.CAP={CULL_FACE:1,BLEND:2,DEPTH_TEST:4,STENCIL_TEST:8,COLOR_MASK:16,DEPTH_MASK:32,STENCIL_MASK:64},u=e.MAT_STATE={CAPS_RANGE:255,BLEND_SRC_SHIFT:8,BLEND_SRC_RANGE:3840,BLEND_DST_SHIFT:12,BLEND_DST_RANGE:61440,BLEND_FUNC_RANGE:65280,DEPTH_FUNC_SHIFT:16,DEPTH_FUNC_RANGE:983040},s=e.RENDER_ORDER={OPAQUE:0,SKY:1,TRANSPARENT:2,ADDITIVE:3,DEFAULT:4};function c(t,e,r){var n=(t&e)>>r;switch(n){case 0:case 1:return n;default:return n-2+o.SRC_COLOR}}var f=e.MaterialState=function(){function t(){i(this,t),this._state=a.CULL_FACE|a.DEPTH_TEST|a.COLOR_MASK|a.DEPTH_MASK,this.blendFuncSrc=o.SRC_ALPHA,this.blendFuncDst=o.ONE_MINUS_SRC_ALPHA,this.depthFunc=o.LESS}return n(t,[{key:"cullFace",get:function(){return!!(this._state&a.CULL_FACE)},set:function(t){t?this._state|=a.CULL_FACE:this._state&=~a.CULL_FACE}},{key:"blend",get:function(){return!!(this._state&a.BLEND)},set:function(t){t?this._state|=a.BLEND:this._state&=~a.BLEND}},{key:"depthTest",get:function(){return!!(this._state&a.DEPTH_TEST)},set:function(t){t?this._state|=a.DEPTH_TEST:this._state&=~a.DEPTH_TEST}},{key:"stencilTest",get:function(){return!!(this._state&a.STENCIL_TEST)},set:function(t){t?this._state|=a.STENCIL_TEST:this._state&=~a.STENCIL_TEST}},{key:"colorMask",get:function(){return!!(this._state&a.COLOR_MASK)},set:function(t){t?this._state|=a.COLOR_MASK:this._state&=~a.COLOR_MASK}},{key:"depthMask",get:function(){return!!(this._state&a.DEPTH_MASK)},set:function(t){t?this._state|=a.DEPTH_MASK:this._state&=~a.DEPTH_MASK}},{key:"depthFunc",get:function(){return((this._state&u.DEPTH_FUNC_RANGE)>>u.DEPTH_FUNC_SHIFT)+o.NEVER},set:function(t){t-=o.NEVER,this._state&=~u.DEPTH_FUNC_RANGE,this._state|=t<<u.DEPTH_FUNC_SHIFT}},{key:"stencilMask",get:function(){return!!(this._state&a.STENCIL_MASK)},set:function(t){t?this._state|=a.STENCIL_MASK:this._state&=~a.STENCIL_MASK}},{key:"blendFuncSrc",get:function(){return c(this._state,u.BLEND_SRC_RANGE,u.BLEND_SRC_SHIFT)},set:function(t){switch(t){case 0:case 1:break;default:t=t-o.SRC_COLOR+2}this._state&=~u.BLEND_SRC_RANGE,this._state|=t<<u.BLEND_SRC_SHIFT}},{key:"blendFuncDst",get:function(){return c(this._state,u.BLEND_DST_RANGE,u.BLEND_DST_SHIFT)},set:function(t){switch(t){case 0:case 1:break;default:t=t-o.SRC_COLOR+2}this._state&=~u.BLEND_DST_RANGE,this._state|=t<<u.BLEND_DST_SHIFT}}]),t}(),l=function(){function t(e){i(this,t),this._uniformName=e,this._texture=null}return n(t,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t}}]),t}(),h=function(){function t(e,r,n){i(this,t),this._uniformName=e,this._value=r,this._length=n,this._length||(r instanceof Array?this._length=r.length:this._length=1)}return n(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}();e.Material=function(){function t(){i(this,t),this.state=new f,this.renderOrder=s.DEFAULT,this._samplers=[],this._uniforms=[]}return n(t,[{key:"defineSampler",value:function(t){var e=new l(t);return this._samplers.push(e),e}},{key:"defineUniform",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new h(t,e,r);return this._uniforms.push(n),n}},{key:"getProgramDefines",value:function(t){return{}}},{key:"materialName",get:function(){return null}},{key:"vertexSource",get:function(){return null}},{key:"fragmentSource",get:function(){return null}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.vec4=e.vec3=e.vec2=e.quat2=e.quat=e.mat4=e.mat3=e.mat2d=e.mat2=e.glMatrix=void 0;var n=d(r(0)),i=d(r(31)),o=d(r(30)),a=d(r(12)),u=d(r(9)),s=d(r(4)),c=d(r(29)),f=d(r(28)),l=d(r(3)),h=d(r(1));function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}e.glMatrix=n,e.mat2=i,e.mat2d=o,e.mat3=a,e.mat4=u,e.quat=s,e.quat2=c,e.vec2=f,e.vec3=l,e.vec4=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Primitive=e.PrimitiveAttribute=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(6);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.PrimitiveAttribute=function t(e,r,n,i,a,u){o(this,t),this.name=e,this.buffer=r,this.componentCount=n||3,this.componentType=i||5126,this.stride=a||0,this.byteOffset=u||0,this.normalized=!1},e.Primitive=function(){function t(e,r,n){o(this,t),this.attributes=e||[],this.elementCount=r||0,this.mode=n||4,this.indexBuffer=null,this.indexByteOffset=0,this.indexType=0,this._min=null,this._max=null}return n(t,[{key:"setIndexBuffer",value:function(t,e,r){this.indexBuffer=t,this.indexByteOffset=e||0,this.indexType=r||5123}},{key:"setBounds",value:function(t,e){this._min=i.vec3.clone(t),this._max=i.vec3.clone(e)}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=WebGLRenderingContext,s=e.TextureSampler=function t(){a(this,t),this.minFilter=null,this.magFilter=null,this.wrapS=null,this.wrapT=null},c=e.Texture=function(){function t(){a(this,t),this.sampler=new s,this.mipmap=!0}return n(t,[{key:"format",get:function(){return u.RGBA}},{key:"width",get:function(){return 0}},{key:"height",get:function(){return 0}},{key:"textureKey",get:function(){return null}}]),t}(),f=e.ImageTexture=function(t){function e(t){a(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._img=t,r._imgBitmap=null,t.src&&t.complete?t.naturalWidth?r._promise=r._finishImage():r._promise=Promise.reject("Image provided had failed to load."):r._promise=new Promise(function(e,n){t.addEventListener("load",function(){return e(r._finishImage())}),t.addEventListener("error",n)}),r}return o(e,c),n(e,[{key:"_finishImage",value:function(){var t=this;return window.createImageBitmap?window.createImageBitmap(this._img).then(function(e){return t._imgBitmap=e,Promise.resolve(t)}):Promise.resolve(this)}},{key:"waitForComplete",value:function(){return this._promise}},{key:"format",get:function(){return u.RGBA}},{key:"width",get:function(){return this._img.width}},{key:"height",get:function(){return this._img.height}},{key:"textureKey",get:function(){return this._img.src}},{key:"source",get:function(){return this._imgBitmap||this._img}}]),e}(),l=(e.UrlTexture=function(t){function e(t){a(this,e);var r=new Image,n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return r.src=t,n}return o(e,f),e}(),e.BlobTexture=function(t){function e(t){a(this,e);var r=new Image,n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return r.src=window.URL.createObjectURL(t),n}return o(e,f),e}(),e.VideoTexture=function(t){function e(t){a(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._video=t,t.readyState>=2?r._promise=Promise.resolve(r):t.error?r._promise=Promise.reject(t.error):r._promise=new Promise(function(e,n){t.addEventListener("loadeddata",function(){return e(r)}),t.addEventListener("error",n)}),r}return o(e,c),n(e,[{key:"waitForComplete",value:function(){return this._promise}},{key:"format",get:function(){return u.RGBA}},{key:"width",get:function(){return this._video.videoWidth}},{key:"height",get:function(){return this._video.videoHeight}},{key:"textureKey",get:function(){return this._video.src}},{key:"source",get:function(){return this._video}}]),e}(),0),h=e.DataTexture=function(t){function e(t,r,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.RGBA,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u.UNSIGNED_BYTE;a(this,e);var c=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return c._data=t,c._width=r,c._height=n,c._format=o,c._type=s,c._key="DATA_"+l,l++,c}return o(e,c),n(e,[{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"textureKey",get:function(){return this._key}}]),e}();e.ColorTexture=function(t){function e(t,r,n,o){a(this,e);var u=new Uint8Array([255*t,255*r,255*n,255*o]),s=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,u,1,1));return s.mipmap=!1,s._key="COLOR_"+u[0]+"_"+u[1]+"_"+u[2]+"_"+u[3],s}return o(e,h),e}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"copy",function(){return a}),r.d(e,"fromValues",function(){return u}),r.d(e,"set",function(){return s}),r.d(e,"identity",function(){return c}),r.d(e,"transpose",function(){return f}),r.d(e,"invert",function(){return l}),r.d(e,"adjoint",function(){return h}),r.d(e,"determinant",function(){return d}),r.d(e,"multiply",function(){return v}),r.d(e,"translate",function(){return _}),r.d(e,"scale",function(){return m}),r.d(e,"rotate",function(){return p}),r.d(e,"rotateX",function(){return y}),r.d(e,"rotateY",function(){return b}),r.d(e,"rotateZ",function(){return g}),r.d(e,"fromTranslation",function(){return M}),r.d(e,"fromScaling",function(){return x}),r.d(e,"fromRotation",function(){return T}),r.d(e,"fromXRotation",function(){return E}),r.d(e,"fromYRotation",function(){return w}),r.d(e,"fromZRotation",function(){return O}),r.d(e,"fromRotationTranslation",function(){return P}),r.d(e,"fromQuat2",function(){return R}),r.d(e,"getTranslation",function(){return S}),r.d(e,"getScaling",function(){return A}),r.d(e,"getRotation",function(){return N}),r.d(e,"fromRotationTranslationScale",function(){return C}),r.d(e,"fromRotationTranslationScaleOrigin",function(){return I}),r.d(e,"fromQuat",function(){return k}),r.d(e,"frustum",function(){return L}),r.d(e,"perspective",function(){return F}),r.d(e,"perspectiveFromFieldOfView",function(){return D}),r.d(e,"ortho",function(){return B}),r.d(e,"lookAt",function(){return j}),r.d(e,"targetTo",function(){return U}),r.d(e,"str",function(){return V}),r.d(e,"frob",function(){return Y}),r.d(e,"add",function(){return G}),r.d(e,"subtract",function(){return H}),r.d(e,"multiplyScalar",function(){return q}),r.d(e,"multiplyScalarAndAdd",function(){return X}),r.d(e,"exactEquals",function(){return W}),r.d(e,"equals",function(){return K}),r.d(e,"mul",function(){return z}),r.d(e,"sub",function(){return Q});var n=r(0);function i(){let t=new n.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t){let e=new n.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function u(t,e,r,i,o,a,u,s,c,f,l,h,d,v,_,m){let p=new n.ARRAY_TYPE(16);return p[0]=t,p[1]=e,p[2]=r,p[3]=i,p[4]=o,p[5]=a,p[6]=u,p[7]=s,p[8]=c,p[9]=f,p[10]=l,p[11]=h,p[12]=d,p[13]=v,p[14]=_,p[15]=m,p}function s(t,e,r,n,i,o,a,u,s,c,f,l,h,d,v,_,m){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=u,t[7]=s,t[8]=c,t[9]=f,t[10]=l,t[11]=h,t[12]=d,t[13]=v,t[14]=_,t[15]=m,t}function c(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function f(t,e){if(t===e){let r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function l(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],f=e[8],l=e[9],h=e[10],d=e[11],v=e[12],_=e[13],m=e[14],p=e[15],y=r*u-n*a,b=r*s-i*a,g=r*c-o*a,M=n*s-i*u,x=n*c-o*u,T=i*c-o*s,E=f*_-l*v,w=f*m-h*v,O=f*p-d*v,P=l*m-h*_,R=l*p-d*_,S=h*p-d*m,A=y*S-b*R+g*P+M*O-x*w+T*E;return A?(A=1/A,t[0]=(u*S-s*R+c*P)*A,t[1]=(i*R-n*S-o*P)*A,t[2]=(_*T-m*x+p*M)*A,t[3]=(h*x-l*T-d*M)*A,t[4]=(s*O-a*S-c*w)*A,t[5]=(r*S-i*O+o*w)*A,t[6]=(m*g-v*T-p*b)*A,t[7]=(f*T-h*g+d*b)*A,t[8]=(a*R-u*O+c*E)*A,t[9]=(n*O-r*R-o*E)*A,t[10]=(v*x-_*g+p*y)*A,t[11]=(l*g-f*x-d*y)*A,t[12]=(u*w-a*P-s*E)*A,t[13]=(r*P-n*w+i*E)*A,t[14]=(_*b-v*M-m*y)*A,t[15]=(f*M-l*b+h*y)*A,t):null}function h(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],f=e[8],l=e[9],h=e[10],d=e[11],v=e[12],_=e[13],m=e[14],p=e[15];return t[0]=u*(h*p-d*m)-l*(s*p-c*m)+_*(s*d-c*h),t[1]=-(n*(h*p-d*m)-l*(i*p-o*m)+_*(i*d-o*h)),t[2]=n*(s*p-c*m)-u*(i*p-o*m)+_*(i*c-o*s),t[3]=-(n*(s*d-c*h)-u*(i*d-o*h)+l*(i*c-o*s)),t[4]=-(a*(h*p-d*m)-f*(s*p-c*m)+v*(s*d-c*h)),t[5]=r*(h*p-d*m)-f*(i*p-o*m)+v*(i*d-o*h),t[6]=-(r*(s*p-c*m)-a*(i*p-o*m)+v*(i*c-o*s)),t[7]=r*(s*d-c*h)-a*(i*d-o*h)+f*(i*c-o*s),t[8]=a*(l*p-d*_)-f*(u*p-c*_)+v*(u*d-c*l),t[9]=-(r*(l*p-d*_)-f*(n*p-o*_)+v*(n*d-o*l)),t[10]=r*(u*p-c*_)-a*(n*p-o*_)+v*(n*c-o*u),t[11]=-(r*(u*d-c*l)-a*(n*d-o*l)+f*(n*c-o*u)),t[12]=-(a*(l*m-h*_)-f*(u*m-s*_)+v*(u*h-s*l)),t[13]=r*(l*m-h*_)-f*(n*m-i*_)+v*(n*h-i*l),t[14]=-(r*(u*m-s*_)-a*(n*m-i*_)+v*(n*s-i*u)),t[15]=r*(u*h-s*l)-a*(n*h-i*l)+f*(n*s-i*u),t}function d(t){let e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],u=t[6],s=t[7],c=t[8],f=t[9],l=t[10],h=t[11],d=t[12],v=t[13],_=t[14],m=t[15];return(e*a-r*o)*(l*m-h*_)-(e*u-n*o)*(f*m-h*v)+(e*s-i*o)*(f*_-l*v)+(r*u-n*a)*(c*m-h*d)-(r*s-i*a)*(c*_-l*d)+(n*s-i*u)*(c*v-f*d)}function v(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=e[9],d=e[10],v=e[11],_=e[12],m=e[13],p=e[14],y=e[15],b=r[0],g=r[1],M=r[2],x=r[3];return t[0]=b*n+g*u+M*l+x*_,t[1]=b*i+g*s+M*h+x*m,t[2]=b*o+g*c+M*d+x*p,t[3]=b*a+g*f+M*v+x*y,b=r[4],g=r[5],M=r[6],x=r[7],t[4]=b*n+g*u+M*l+x*_,t[5]=b*i+g*s+M*h+x*m,t[6]=b*o+g*c+M*d+x*p,t[7]=b*a+g*f+M*v+x*y,b=r[8],g=r[9],M=r[10],x=r[11],t[8]=b*n+g*u+M*l+x*_,t[9]=b*i+g*s+M*h+x*m,t[10]=b*o+g*c+M*d+x*p,t[11]=b*a+g*f+M*v+x*y,b=r[12],g=r[13],M=r[14],x=r[15],t[12]=b*n+g*u+M*l+x*_,t[13]=b*i+g*s+M*h+x*m,t[14]=b*o+g*c+M*d+x*p,t[15]=b*a+g*f+M*v+x*y,t}function _(t,e,r){let n,i,o,a,u,s,c,f,l,h,d,v,_=r[0],m=r[1],p=r[2];return e===t?(t[12]=e[0]*_+e[4]*m+e[8]*p+e[12],t[13]=e[1]*_+e[5]*m+e[9]*p+e[13],t[14]=e[2]*_+e[6]*m+e[10]*p+e[14],t[15]=e[3]*_+e[7]*m+e[11]*p+e[15]):(n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=e[9],d=e[10],v=e[11],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=u,t[5]=s,t[6]=c,t[7]=f,t[8]=l,t[9]=h,t[10]=d,t[11]=v,t[12]=n*_+u*m+l*p+e[12],t[13]=i*_+s*m+h*p+e[13],t[14]=o*_+c*m+d*p+e[14],t[15]=a*_+f*m+v*p+e[15]),t}function m(t,e,r){let n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function p(t,e,r,i){let o,a,u,s,c,f,l,h,d,v,_,m,p,y,b,g,M,x,T,E,w,O,P,R,S=i[0],A=i[1],N=i[2],C=Math.sqrt(S*S+A*A+N*N);return Math.abs(C)<n.EPSILON?null:(S*=C=1/C,A*=C,N*=C,o=Math.sin(r),u=1-(a=Math.cos(r)),s=e[0],c=e[1],f=e[2],l=e[3],h=e[4],d=e[5],v=e[6],_=e[7],m=e[8],p=e[9],y=e[10],b=e[11],g=S*S*u+a,M=A*S*u+N*o,x=N*S*u-A*o,T=S*A*u-N*o,E=A*A*u+a,w=N*A*u+S*o,O=S*N*u+A*o,P=A*N*u-S*o,R=N*N*u+a,t[0]=s*g+h*M+m*x,t[1]=c*g+d*M+p*x,t[2]=f*g+v*M+y*x,t[3]=l*g+_*M+b*x,t[4]=s*T+h*E+m*w,t[5]=c*T+d*E+p*w,t[6]=f*T+v*E+y*w,t[7]=l*T+_*E+b*w,t[8]=s*O+h*P+m*R,t[9]=c*O+d*P+p*R,t[10]=f*O+v*P+y*R,t[11]=l*O+_*P+b*R,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function y(t,e,r){let n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],u=e[6],s=e[7],c=e[8],f=e[9],l=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*n,t[5]=a*i+f*n,t[6]=u*i+l*n,t[7]=s*i+h*n,t[8]=c*i-o*n,t[9]=f*i-a*n,t[10]=l*i-u*n,t[11]=h*i-s*n,t}function b(t,e,r){let n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],u=e[2],s=e[3],c=e[8],f=e[9],l=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*n,t[1]=a*i-f*n,t[2]=u*i-l*n,t[3]=s*i-h*n,t[8]=o*n+c*i,t[9]=a*n+f*i,t[10]=u*n+l*i,t[11]=s*n+h*i,t}function g(t,e,r){let n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],u=e[2],s=e[3],c=e[4],f=e[5],l=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*n,t[1]=a*i+f*n,t[2]=u*i+l*n,t[3]=s*i+h*n,t[4]=c*i-o*n,t[5]=f*i-a*n,t[6]=l*i-u*n,t[7]=h*i-s*n,t}function M(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function x(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e,r){let i,o,a,u=r[0],s=r[1],c=r[2],f=Math.sqrt(u*u+s*s+c*c);return Math.abs(f)<n.EPSILON?null:(u*=f=1/f,s*=f,c*=f,i=Math.sin(e),a=1-(o=Math.cos(e)),t[0]=u*u*a+o,t[1]=s*u*a+c*i,t[2]=c*u*a-s*i,t[3]=0,t[4]=u*s*a-c*i,t[5]=s*s*a+o,t[6]=c*s*a+u*i,t[7]=0,t[8]=u*c*a+s*i,t[9]=s*c*a-u*i,t[10]=c*c*a+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function E(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function w(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function O(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function P(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=n+n,s=i+i,c=o+o,f=n*u,l=n*s,h=n*c,d=i*s,v=i*c,_=o*c,m=a*u,p=a*s,y=a*c;return t[0]=1-(d+_),t[1]=l+y,t[2]=h-p,t[3]=0,t[4]=l-y,t[5]=1-(f+_),t[6]=v+m,t[7]=0,t[8]=h+p,t[9]=v-m,t[10]=1-(f+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function R(t,e){let r=new n.ARRAY_TYPE(3),i=-e[0],o=-e[1],a=-e[2],u=e[3],s=e[4],c=e[5],f=e[6],l=e[7],h=i*i+o*o+a*a+u*u;return h>0?(r[0]=2*(s*u+l*i+c*a-f*o)/h,r[1]=2*(c*u+l*o+f*i-s*a)/h,r[2]=2*(f*u+l*a+s*o-c*i)/h):(r[0]=2*(s*u+l*i+c*a-f*o),r[1]=2*(c*u+l*o+f*i-s*a),r[2]=2*(f*u+l*a+s*o-c*i)),P(t,e,r),t}function S(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function A(t,e){let r=e[0],n=e[1],i=e[2],o=e[4],a=e[5],u=e[6],s=e[8],c=e[9],f=e[10];return t[0]=Math.sqrt(r*r+n*n+i*i),t[1]=Math.sqrt(o*o+a*a+u*u),t[2]=Math.sqrt(s*s+c*c+f*f),t}function N(t,e){let r=e[0]+e[5]+e[10],n=0;return r>0?(n=2*Math.sqrt(r+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t}function C(t,e,r,n){let i=e[0],o=e[1],a=e[2],u=e[3],s=i+i,c=o+o,f=a+a,l=i*s,h=i*c,d=i*f,v=o*c,_=o*f,m=a*f,p=u*s,y=u*c,b=u*f,g=n[0],M=n[1],x=n[2];return t[0]=(1-(v+m))*g,t[1]=(h+b)*g,t[2]=(d-y)*g,t[3]=0,t[4]=(h-b)*M,t[5]=(1-(l+m))*M,t[6]=(_+p)*M,t[7]=0,t[8]=(d+y)*x,t[9]=(_-p)*x,t[10]=(1-(l+v))*x,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function I(t,e,r,n,i){let o=e[0],a=e[1],u=e[2],s=e[3],c=o+o,f=a+a,l=u+u,h=o*c,d=o*f,v=o*l,_=a*f,m=a*l,p=u*l,y=s*c,b=s*f,g=s*l,M=n[0],x=n[1],T=n[2],E=i[0],w=i[1],O=i[2],P=(1-(_+p))*M,R=(d+g)*M,S=(v-b)*M,A=(d-g)*x,N=(1-(h+p))*x,C=(m+y)*x,I=(v+b)*T,k=(m-y)*T,L=(1-(h+_))*T;return t[0]=P,t[1]=R,t[2]=S,t[3]=0,t[4]=A,t[5]=N,t[6]=C,t[7]=0,t[8]=I,t[9]=k,t[10]=L,t[11]=0,t[12]=r[0]+E-(P*E+A*w+I*O),t[13]=r[1]+w-(R*E+N*w+k*O),t[14]=r[2]+O-(S*E+C*w+L*O),t[15]=1,t}function k(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,u=n+n,s=i+i,c=r*a,f=n*a,l=n*u,h=i*a,d=i*u,v=i*s,_=o*a,m=o*u,p=o*s;return t[0]=1-l-v,t[1]=f+p,t[2]=h-m,t[3]=0,t[4]=f-p,t[5]=1-c-v,t[6]=d+_,t[7]=0,t[8]=h+m,t[9]=d-_,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L(t,e,r,n,i,o,a){let u=1/(r-e),s=1/(i-n),c=1/(o-a);return t[0]=2*o*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*s,t[6]=0,t[7]=0,t[8]=(r+e)*u,t[9]=(i+n)*s,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function F(t,e,r,n,i){let o=1/Math.tan(e/2),a=1/(n-i);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*a,t[15]=0,t}function D(t,e,r,n){let i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),u=Math.tan(e.rightDegrees*Math.PI/180),s=2/(a+u),c=2/(i+o);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-u)*s*.5,t[9]=(i-o)*c*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function B(t,e,r,n,i,o,a){let u=1/(e-r),s=1/(n-i),c=1/(o-a);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*u,t[13]=(i+n)*s,t[14]=(a+o)*c,t[15]=1,t}function j(t,e,r,i){let o,a,u,s,f,l,h,d,v,_,m=e[0],p=e[1],y=e[2],b=i[0],g=i[1],M=i[2],x=r[0],T=r[1],E=r[2];return Math.abs(m-x)<n.EPSILON&&Math.abs(p-T)<n.EPSILON&&Math.abs(y-E)<n.EPSILON?c(t):(h=m-x,d=p-T,v=y-E,o=g*(v*=_=1/Math.sqrt(h*h+d*d+v*v))-M*(d*=_),a=M*(h*=_)-b*v,u=b*d-g*h,(_=Math.sqrt(o*o+a*a+u*u))?(o*=_=1/_,a*=_,u*=_):(o=0,a=0,u=0),s=d*u-v*a,f=v*o-h*u,l=h*a-d*o,(_=Math.sqrt(s*s+f*f+l*l))?(s*=_=1/_,f*=_,l*=_):(s=0,f=0,l=0),t[0]=o,t[1]=s,t[2]=h,t[3]=0,t[4]=a,t[5]=f,t[6]=d,t[7]=0,t[8]=u,t[9]=l,t[10]=v,t[11]=0,t[12]=-(o*m+a*p+u*y),t[13]=-(s*m+f*p+l*y),t[14]=-(h*m+d*p+v*y),t[15]=1,t)}function U(t,e,r,n){let i=e[0],o=e[1],a=e[2],u=n[0],s=n[1],c=n[2],f=i-r[0],l=o-r[1],h=a-r[2],d=f*f+l*l+h*h;d>0&&(f*=d=1/Math.sqrt(d),l*=d,h*=d);let v=s*h-c*l,_=c*f-u*h,m=u*l-s*f;return(d=v*v+_*_+m*m)>0&&(v*=d=1/Math.sqrt(d),_*=d,m*=d),t[0]=v,t[1]=_,t[2]=m,t[3]=0,t[4]=l*m-h*_,t[5]=h*v-f*m,t[6]=f*_-l*v,t[7]=0,t[8]=f,t[9]=l,t[10]=h,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function V(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Y(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function G(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function H(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function q(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function X(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function W(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function K(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=t[8],h=t[9],d=t[10],v=t[11],_=t[12],m=t[13],p=t[14],y=t[15],b=e[0],g=e[1],M=e[2],x=e[3],T=e[4],E=e[5],w=e[6],O=e[7],P=e[8],R=e[9],S=e[10],A=e[11],N=e[12],C=e[13],I=e[14],k=e[15];return Math.abs(r-b)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-g)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(o-M)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-x)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(u-T)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(s-E)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(c-w)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(f-O)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(l-P)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(h-R)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(d-S)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(v-A)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(A))&&Math.abs(_-N)<=n.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(m-C)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(p-I)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(y-k)<=n.EPSILON*Math.max(1,Math.abs(y),Math.abs(k))}const z=v,Q=H},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GeometryBuilderBase=e.PrimitiveStream=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(7),o=r(6);function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=WebGLRenderingContext,s=o.vec3.create(),c=e.PrimitiveStream=function(){function t(e){a(this,t),this._vertices=[],this._indices=[],this._geometryStarted=!1,this._vertexOffset=0,this._vertexIndex=0,this._highIndex=0,this._flipWinding=!1,this._invertNormals=!1,this._transform=null,this._normalTransform=null,this._min=null,this._max=null}return n(t,[{key:"startGeometry",value:function(){if(this._geometryStarted)throw new Error("Attempted to start a new geometry before the previous one was ended.");this._geometryStarted=!0,this._vertexIndex=0,this._highIndex=0}},{key:"endGeometry",value:function(){if(!this._geometryStarted)throw new Error("Attempted to end a geometry before one was started.");if(this._highIndex>=this._vertexIndex)throw new Error("Geometry contains indices that are out of bounds.\n                       (Contains an index of "+this._highIndex+" when the vertex count is "+this._vertexIndex+")");this._geometryStarted=!1,this._vertexOffset+=this._vertexIndex}},{key:"pushVertex",value:function(t,e,r,n,i,a,u,c){if(!this._geometryStarted)throw new Error("Cannot push vertices before calling startGeometry().");return this._transform&&(s[0]=t,s[1]=e,s[2]=r,o.vec3.transformMat4(s,s,this._transform),t=s[0],e=s[1],r=s[2],s[0]=a,s[1]=u,s[2]=c,o.vec3.transformMat3(s,s,this._normalTransform),a=s[0],u=s[1],c=s[2]),this._invertNormals&&(a*=-1,u*=-1,c*=-1),this._vertices.push(t,e,r,n,i,a,u,c),this._min?(this._min[0]=Math.min(this._min[0],t),this._min[1]=Math.min(this._min[1],e),this._min[2]=Math.min(this._min[2],r),this._max[0]=Math.max(this._max[0],t),this._max[1]=Math.max(this._max[1],e),this._max[2]=Math.max(this._max[2],r)):(this._min=o.vec3.fromValues(t,e,r),this._max=o.vec3.fromValues(t,e,r)),this._vertexIndex++}},{key:"pushTriangle",value:function(t,e,r){if(!this._geometryStarted)throw new Error("Cannot push triangles before calling startGeometry().");this._highIndex=Math.max(this._highIndex,t,e,r),t+=this._vertexOffset,e+=this._vertexOffset,r+=this._vertexOffset,this._flipWinding?this._indices.push(r,e,t):this._indices.push(t,e,r)}},{key:"clear",value:function(){if(this._geometryStarted)throw new Error("Cannot clear before ending the current geometry.");this._vertices=[],this._indices=[],this._vertexOffset=0,this._min=null,this._max=null}},{key:"finishPrimitive",value:function(t){if(!this._vertexOffset)throw new Error("Attempted to call finishPrimitive() before creating any geometry.");var e=t.createRenderBuffer(u.ARRAY_BUFFER,new Float32Array(this._vertices)),r=t.createRenderBuffer(u.ELEMENT_ARRAY_BUFFER,new Uint16Array(this._indices)),n=[new i.PrimitiveAttribute("POSITION",e,3,u.FLOAT,32,0),new i.PrimitiveAttribute("TEXCOORD_0",e,2,u.FLOAT,32,12),new i.PrimitiveAttribute("NORMAL",e,3,u.FLOAT,32,20)],o=new i.Primitive(n,this._indices.length);return o.setIndexBuffer(r),o.setBounds(this._min,this._max),o}},{key:"flipWinding",set:function(t){if(this._geometryStarted)throw new Error("Cannot change flipWinding before ending the current geometry.");this._flipWinding=t},get:function(){this._flipWinding}},{key:"invertNormals",set:function(t){if(this._geometryStarted)throw new Error("Cannot change invertNormals before ending the current geometry.");this._invertNormals=t},get:function(){this._invertNormals}},{key:"transform",set:function(t){if(this._geometryStarted)throw new Error("Cannot change transform before ending the current geometry.");this._transform=t,this._transform&&(this._normalTransform||(this._normalTransform=o.mat3.create()),o.mat3.fromMat4(this._normalTransform,this._transform))},get:function(){this._transform}},{key:"nextVertexIndex",get:function(){return this._vertexIndex}}]),t}();e.GeometryBuilderBase=function(){function t(e){a(this,t),this._stream=e||new c}return n(t,[{key:"finishPrimitive",value:function(t){return this._stream.finishPrimitive(t)}},{key:"clear",value:function(){this._stream.clear()}},{key:"primitiveStream",set:function(t){this._stream=t},get:function(){return this._stream}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=e.RenderTexture=e.RenderView=e.ATTRIB_MASK=e.ATTRIB=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.createWebGLContext=p;var i=r(5),o=r(2),a=r(27),u=r(8),s=r(6);function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var f=e.ATTRIB={POSITION:1,NORMAL:2,TANGENT:3,TEXCOORD_0:4,TEXCOORD_1:5,COLOR_0:6},l=e.ATTRIB_MASK={POSITION:1,NORMAL:2,TANGENT:4,TEXCOORD_0:8,TEXCOORD_1:16,COLOR_0:32},h=WebGLRenderingContext,d=new Float32Array([-.1,-1,-.2]),v=new Float32Array([1,1,.9]),_=new RegExp("precision (lowp|mediump|highp) float;");function m(t){return 0==(t&t-1)}function p(t){t=t||{alpha:!1};var e=document.createElement("canvas"),r=t.webgl2?["webgl2"]:["webgl","experimental-webgl"],n=null,i=!0,o=!1,a=void 0;try{for(var u,s=r[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value;if(n=e.getContext(c,t))break}}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}if(!n){var f=t.webgl2?"WebGL 2":"WebGL";return console.error("This browser does not support "+f+"."),null}return n}e.RenderView=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"left";c(this,t),this.projectionMatrix=e,this.viewMatrix=r,this.viewport=n,this._eye=i,this._eyeIndex="left"==i?0:1}return n(t,[{key:"eye",get:function(){return this._eye},set:function(t){this._eye=t,this._eyeIndex="left"==t?0:1}},{key:"eyeIndex",get:function(){return this._eyeIndex}}]),t}();var y=function(){function t(e,r,n){var i=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;c(this,t),this._target=e,this._usage=r,this._length=o,n instanceof Promise?(this._buffer=null,this._promise=n.then(function(t){return i._buffer=t,i})):(this._buffer=n,this._promise=Promise.resolve(this))}return n(t,[{key:"waitForComplete",value:function(){return this._promise}}]),t}(),b=function t(e){c(this,t),this._attrib_index=f[e.name],this._componentCount=e.componentCount,this._componentType=e.componentType,this._stride=e.stride,this._byteOffset=e.byteOffset,this._normalized=e.normalized},g=function t(e){c(this,t),this._buffer=e,this._attributes=[]},M=function(){function t(e){c(this,t),this._activeFrameId=0,this._instances=[],this._material=null,this.setPrimitive(e)}return n(t,[{key:"setPrimitive",value:function(t){this._mode=t.mode,this._elementCount=t.elementCount,this._promise=null,this._vao=null,this._complete=!1,this._attributeBuffers=[],this._attributeMask=0;var e=!0,r=!1,n=void 0;try{for(var i,o=t.attributes[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._attributeMask|=l[a.name];var u=new b(a),c=!1,f=!0,h=!1,d=void 0;try{for(var v,_=this._attributeBuffers[Symbol.iterator]();!(f=(v=_.next()).done);f=!0){var m=v.value;if(m._buffer==a.buffer){m._attributes.push(u),c=!0;break}}}catch(t){h=!0,d=t}finally{try{!f&&_.return&&_.return()}finally{if(h)throw d}}if(!c){var p=new g(a.buffer);p._attributes.push(u),this._attributeBuffers.push(p)}}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}this._indexBuffer=null,this._indexByteOffset=0,this._indexType=0,t.indexBuffer&&(this._indexByteOffset=t.indexByteOffset,this._indexType=t.indexType,this._indexBuffer=t.indexBuffer),t._min?(this._min=s.vec3.clone(t._min),this._max=s.vec3.clone(t._max)):(this._min=null,this._max=null),null!=this._material&&this.waitForComplete()}},{key:"setRenderMaterial",value:function(t){this._material=t,this._promise=null,this._complete=!1,null!=this._material&&this.waitForComplete()}},{key:"markActive",value:function(t){if(this._complete&&this._activeFrameId!=t){if(this._material&&!this._material.markActive(t))return;this._activeFrameId=t}}},{key:"waitForComplete",value:function(){var t=this;if(!this._promise){if(!this._material)return Promise.reject("RenderPrimitive does not have a material");var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=this._attributeBuffers[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value;u._buffer._buffer||e.push(u._buffer._promise)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}this._indexBuffer&&!this._indexBuffer._buffer&&e.push(this._indexBuffer._promise),this._promise=Promise.all(e).then(function(){return t._complete=!0,t})}return this._promise}},{key:"samplers",get:function(){return this._material._samplerDictionary}},{key:"uniforms",get:function(){return this._material._uniform_dictionary}}]),t}(),x=e.RenderTexture=function(){function t(e){c(this,t),this._texture=e,this._complete=!1,this._activeFrameId=0,this._activeCallback=null}return n(t,[{key:"markActive",value:function(t){this._activeCallback&&this._activeFrameId!=t&&(this._activeFrameId=t,this._activeCallback(this))}}]),t}(),T=s.mat4.create();function E(t,e,r,n,i){var o=(i&r)-(n&r);o&&(o>0?t.enable(e):t.disable(e))}var w=function(){function t(e,r,n){c(this,t),this._renderer=e,this._uniformName=r._uniformName,this._renderTexture=e._getRenderTexture(r._texture),this._index=n}return n(t,[{key:"texture",set:function(t){this._renderTexture=this._renderer._getRenderTexture(t)}}]),t}(),O=function(){function t(e){c(this,t),this._uniformName=e._uniformName,this._uniform=null,this._length=e._length,e._value instanceof Array?this._value=new Float32Array(e._value):this._value=new Float32Array([e._value])}return n(t,[{key:"value",set:function(t){if(1==this._value.length)this._value[0]=t;else for(var e=0;e<this._value.length;++e)this._value[e]=t[e]}}]),t}(),P=function(){function t(e,r,n){c(this,t),this._program=n,this._state=r.state._state,this._activeFrameId=0,this._completeForActiveFrame=!1,this._samplerDictionary={},this._samplers=[];for(var o=0;o<r._samplers.length;++o){var a=new w(e,r._samplers[o],o);this._samplers.push(a),this._samplerDictionary[a._uniformName]=a}this._uniform_dictionary={},this._uniforms=[];var u=!0,s=!1,f=void 0;try{for(var l,h=r._uniforms[Symbol.iterator]();!(u=(l=h.next()).done);u=!0){var d=l.value,v=new O(d);this._uniforms.push(v),this._uniform_dictionary[v._uniformName]=v}}catch(t){s=!0,f=t}finally{try{!u&&h.return&&h.return()}finally{if(s)throw f}}this._firstBind=!0,this._renderOrder=r.renderOrder,this._renderOrder==i.RENDER_ORDER.DEFAULT&&(this._state&i.CAP.BLEND?this._renderOrder=i.RENDER_ORDER.TRANSPARENT:this._renderOrder=i.RENDER_ORDER.OPAQUE)}return n(t,[{key:"bind",value:function(t){if(this._firstBind){for(var e=0;e<this._samplers.length;){var r=this._samplers[e];this._program.uniform[r._uniformName]?++e:this._samplers.splice(e,1)}for(var n=0;n<this._uniforms.length;){var i=this._uniforms[n];i._uniform=this._program.uniform[i._uniformName],i._uniform?++n:this._uniforms.splice(n,1)}this._firstBind=!1}var o=!0,a=!1,u=void 0;try{for(var s,c=this._samplers[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var f=s.value;t.activeTexture(t.TEXTURE0+f._index),f._renderTexture&&f._renderTexture._complete?t.bindTexture(t.TEXTURE_2D,f._renderTexture._texture):t.bindTexture(t.TEXTURE_2D,null)}}catch(t){a=!0,u=t}finally{try{!o&&c.return&&c.return()}finally{if(a)throw u}}var l=!0,h=!1,d=void 0;try{for(var v,_=this._uniforms[Symbol.iterator]();!(l=(v=_.next()).done);l=!0){var m=v.value;switch(m._length){case 1:t.uniform1fv(m._uniform,m._value);break;case 2:t.uniform2fv(m._uniform,m._value);break;case 3:t.uniform3fv(m._uniform,m._value);break;case 4:t.uniform4fv(m._uniform,m._value)}}}catch(t){h=!0,d=t}finally{try{!l&&_.return&&_.return()}finally{if(h)throw d}}}},{key:"markActive",value:function(t){if(this._activeFrameId!=t){this._activeFrameId=t,this._completeForActiveFrame=!0;for(var e=0;e<this._samplers.length;++e){var r=this._samplers[e];if(r._renderTexture){if(!r._renderTexture._complete){this._completeForActiveFrame=!1;break}r._renderTexture.markActive(t)}}}return this._completeForActiveFrame}},{key:"_capsDiff",value:function(t){return t&i.MAT_STATE.CAPS_RANGE^this._state&i.MAT_STATE.CAPS_RANGE}},{key:"_blendDiff",value:function(t){return this._state&i.CAP.BLEND?t&i.MAT_STATE.BLEND_FUNC_RANGE^this._state&i.MAT_STATE.BLEND_FUNC_RANGE:0}},{key:"_depthFuncDiff",value:function(t){return this._state&i.CAP.DEPTH_TEST?t&i.MAT_STATE.DEPTH_FUNC_RANGE^this._state&i.MAT_STATE.DEPTH_FUNC_RANGE:0}},{key:"cullFace",get:function(){return!!(this._state&i.CAP.CULL_FACE)}},{key:"blend",get:function(){return!!(this._state&i.CAP.BLEND)}},{key:"depthTest",get:function(){return!!(this._state&i.CAP.DEPTH_TEST)}},{key:"stencilTest",get:function(){return!!(this._state&i.CAP.STENCIL_TEST)}},{key:"colorMask",get:function(){return!!(this._state&i.CAP.COLOR_MASK)}},{key:"depthMask",get:function(){return!!(this._state&i.CAP.DEPTH_MASK)}},{key:"stencilMask",get:function(){return!!(this._state&i.CAP.STENCIL_MASK)}},{key:"depthFunc",get:function(){return((this._state&i.MAT_STATE.DEPTH_FUNC_RANGE)>>i.MAT_STATE.DEPTH_FUNC_SHIFT)+h.NEVER}},{key:"blendFuncSrc",get:function(){return(0,i.stateToBlendFunc)(this._state,i.MAT_STATE.BLEND_SRC_RANGE,i.MAT_STATE.BLEND_SRC_SHIFT)}},{key:"blendFuncDst",get:function(){return(0,i.stateToBlendFunc)(this._state,i.MAT_STATE.BLEND_DST_RANGE,i.MAT_STATE.BLEND_DST_SHIFT)}}]),t}();e.Renderer=function(){function t(e){c(this,t),this._gl=e||p(),this._frameId=0,this._programCache={},this._textureCache={},this._renderPrimitives=Array(i.RENDER_ORDER.DEFAULT),this._cameraPositions=[],this._vaoExt=e.getExtension("OES_vertex_array_object");var r=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);this._defaultFragPrecision=r.precision>0?"highp":"mediump",this._depthMaskNeedsReset=!1,this._colorMaskNeedsReset=!1}return n(t,[{key:"createRenderBuffer",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.STATIC_DRAW,n=this._gl,i=n.createBuffer();if(e instanceof Promise){var o=new y(t,r,e.then(function(e){return n.bindBuffer(t,i),n.bufferData(t,e,r),o._length=e.byteLength,i}));return o}return n.bindBuffer(t,i),n.bufferData(t,e,r),new y(t,r,i,e.byteLength)}},{key:"updateRenderBuffer",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(t._buffer){var i=this._gl;i.bindBuffer(t._target,t._buffer),0==n&&t._length==e.byteLength?i.bufferData(t._target,e,t._usage):i.bufferSubData(t._target,n,e)}else t.waitForComplete().then(function(t){r.updateRenderBuffer(t,e,n)})}},{key:"createRenderPrimitive",value:function(t,e){var r=new M(t),n=this._getMaterialProgram(e,r),i=new P(this,e,n);return r.setRenderMaterial(i),this._renderPrimitives[i._renderOrder]||(this._renderPrimitives[i._renderOrder]=[]),this._renderPrimitives[i._renderOrder].push(r),r}},{key:"createMesh",value:function(t,e){var r=new o.Node;return r.addRenderPrimitive(this.createRenderPrimitive(t,e)),r}},{key:"drawViews",value:function(t,e){if(e){var r=this._gl;if(this._frameId++,e.markActive(this._frameId),1==t.length&&t[0].viewport){var n=t[0].viewport;this._gl.viewport(n.x,n.y,n.width,n.height)}for(var i=0;i<t.length;++i){s.mat4.invert(T,t[i].viewMatrix),this._cameraPositions.length<=i&&this._cameraPositions.push(s.vec3.create());var o=this._cameraPositions[i];s.vec3.set(o,0,0,0),s.vec3.transformMat4(o,o,T)}var a=!0,u=!1,c=void 0;try{for(var f,l=this._renderPrimitives[Symbol.iterator]();!(a=(f=l.next()).done);a=!0){var h=f.value;h&&h.length&&this._drawRenderPrimitiveSet(t,h)}}catch(t){u=!0,c=t}finally{try{!a&&l.return&&l.return()}finally{if(u)throw c}}this._vaoExt&&this._vaoExt.bindVertexArrayOES(null),this._depthMaskNeedsReset&&r.depthMask(!0),this._colorMaskNeedsReset&&r.colorMask(!0,!0,!0,!0)}}},{key:"_drawRenderPrimitiveSet",value:function(t,e){var r=this._gl,n=null,i=null,o=0,a=!0,u=!1,s=void 0;try{for(var c,f=e[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var l=c.value;if(l._activeFrameId==this._frameId){n!=l._material._program&&((n=l._material._program).use(),n.uniform.LIGHT_DIRECTION&&r.uniform3fv(n.uniform.LIGHT_DIRECTION,d),n.uniform.LIGHT_COLOR&&r.uniform3fv(n.uniform.LIGHT_COLOR,v),1==t.length&&(r.uniformMatrix4fv(n.uniform.PROJECTION_MATRIX,!1,t[0].projectionMatrix),r.uniformMatrix4fv(n.uniform.VIEW_MATRIX,!1,t[0].viewMatrix),r.uniform3fv(n.uniform.CAMERA_POSITION,this._cameraPositions[0]),r.uniform1i(n.uniform.EYE_INDEX,t[0].eyeIndex))),i!=l._material&&(this._bindMaterialState(l._material,i),l._material.bind(r,n,i),i=l._material),this._vaoExt?l._vao?this._vaoExt.bindVertexArrayOES(l._vao):(l._vao=this._vaoExt.createVertexArrayOES(),this._vaoExt.bindVertexArrayOES(l._vao),this._bindPrimitive(l)):(this._bindPrimitive(l,o),o=l._attributeMask);for(var h=0;h<t.length;++h){var _=t[h];if(t.length>1){if(_.viewport){var m=_.viewport;r.viewport(m.x,m.y,m.width,m.height)}r.uniformMatrix4fv(n.uniform.PROJECTION_MATRIX,!1,_.projectionMatrix),r.uniformMatrix4fv(n.uniform.VIEW_MATRIX,!1,_.viewMatrix),r.uniform3fv(n.uniform.CAMERA_POSITION,this._cameraPositions[h]),r.uniform1i(n.uniform.EYE_INDEX,_.eyeIndex)}var p=!0,y=!1,b=void 0;try{for(var g,M=l._instances[Symbol.iterator]();!(p=(g=M.next()).done);p=!0){var x=g.value;x._activeFrameId==this._frameId&&(r.uniformMatrix4fv(n.uniform.MODEL_MATRIX,!1,x.worldMatrix),l._indexBuffer?r.drawElements(l._mode,l._elementCount,l._indexType,l._indexByteOffset):r.drawArrays(l._mode,0,l._elementCount))}}catch(t){y=!0,b=t}finally{try{!p&&M.return&&M.return()}finally{if(y)throw b}}}}}}catch(t){u=!0,s=t}finally{try{!a&&f.return&&f.return()}finally{if(u)throw s}}}},{key:"_getRenderTexture",value:function(t){var e=this;if(!t)return null;var r=t.textureKey;if(!r)throw new Error("Texure does not have a valid key");if(r in this._textureCache)return this._textureCache[r];var n=this._gl,i=n.createTexture(),o=new x(i);return this._textureCache[r]=o,t instanceof u.DataTexture?(n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,t.format,t.width,t.height,0,t.format,t._type,t._data),this._setSamplerParameters(t),o._complete=!0):t.waitForComplete().then(function(){n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,t.format,t.format,n.UNSIGNED_BYTE,t.source),e._setSamplerParameters(t),o._complete=!0,t instanceof u.VideoTexture&&t._video.addEventListener("playing",function(){o._activeCallback=function(){t._video.paused||t._video.waiting||(n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,t.format,t.format,n.UNSIGNED_BYTE,t.source))}})}),o}},{key:"_setSamplerParameters",value:function(t){var e=this._gl,r=t.sampler,n=m(t.width)&&m(t.height),i=n&&t.mipmap;i&&e.generateMipmap(e.TEXTURE_2D);var o=r.minFilter||(i?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),a=r.wrapS||(n?e.REPEAT:e.CLAMP_TO_EDGE),u=r.wrapT||(n?e.REPEAT:e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r.magFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,u)}},{key:"_getProgramKey",value:function(t,e){var r=t+":";for(var n in e)r+=n+"="+e[n]+",";return r}},{key:"_getMaterialProgram",value:function(t,e){var r=this,n=t.materialName,i=t.vertexSource,o=t.fragmentSource;if(null==n)throw new Error("Material does not have a name");if(null==i)throw new Error('Material "'+n+'" does not have a vertex source');if(null==o)throw new Error('Material "'+n+'" does not have a fragment source');var u=t.getProgramDefines(e),s=this._getProgramKey(n,u);if(s in this._programCache)return this._programCache[s];var c=i;c+="\nuniform mat4 PROJECTION_MATRIX, VIEW_MATRIX, MODEL_MATRIX;\n\nvoid main() {\n  gl_Position = vertex_main(PROJECTION_MATRIX, VIEW_MATRIX, MODEL_MATRIX);\n}\n";var l=(o.match(_)?"":"precision "+this._defaultFragPrecision+" float;\n")+o;l+="\nvoid main() {\n  gl_FragColor = fragment_main();\n}\n";var h=new a.Program(this._gl,c,l,f,u);return this._programCache[s]=h,h.onNextUse(function(e){for(var n=0;n<t._samplers.length;++n){var i=t._samplers[n],o=e.uniform[i._uniformName];o&&r._gl.uniform1i(o,n)}}),h}},{key:"_bindPrimitive",value:function(t,e){var r=this._gl;if(e!=t._attributeMask)for(var n in f)t._attributeMask&l[n]?r.enableVertexAttribArray(f[n]):r.disableVertexAttribArray(f[n]);var i=!0,o=!1,a=void 0;try{for(var u,s=t._attributeBuffers[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value;r.bindBuffer(r.ARRAY_BUFFER,c._buffer._buffer);var h=!0,d=!1,v=void 0;try{for(var _,m=c._attributes[Symbol.iterator]();!(h=(_=m.next()).done);h=!0){var p=_.value;r.vertexAttribPointer(p._attrib_index,p._componentCount,p._componentType,p._normalized,p._stride,p._byteOffset)}}catch(t){d=!0,v=t}finally{try{!h&&m.return&&m.return()}finally{if(d)throw v}}}}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}t._indexBuffer?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t._indexBuffer._buffer):r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}},{key:"_bindMaterialState",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._gl,n=t._state,o=e?e._state:~n;if(n!=o){if(t._capsDiff(o)){E(r,r.CULL_FACE,i.CAP.CULL_FACE,o,n),E(r,r.BLEND,i.CAP.BLEND,o,n),E(r,r.DEPTH_TEST,i.CAP.DEPTH_TEST,o,n),E(r,r.STENCIL_TEST,i.CAP.STENCIL_TEST,o,n);var a=(n&i.CAP.COLOR_MASK)-(o&i.CAP.COLOR_MASK);if(a){var u=a>1;this._colorMaskNeedsReset=!u,r.colorMask(u,u,u,u)}var s=(n&i.CAP.DEPTH_MASK)-(o&i.CAP.DEPTH_MASK);s&&(this._depthMaskNeedsReset=!(s>1),r.depthMask(s>1));var c=(n&i.CAP.STENCIL_MASK)-(o&i.CAP.STENCIL_MASK);c&&r.stencilMask(c>1)}t._blendDiff(o)&&r.blendFunc(t.blendFuncSrc,t.blendFuncDst),t._depthFuncDiff(o)&&r.depthFunc(t.depthFunc)}}},{key:"gl",get:function(){return this._gl}}]),t}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"fromMat4",function(){return o}),r.d(e,"clone",function(){return a}),r.d(e,"copy",function(){return u}),r.d(e,"fromValues",function(){return s}),r.d(e,"set",function(){return c}),r.d(e,"identity",function(){return f}),r.d(e,"transpose",function(){return l}),r.d(e,"invert",function(){return h}),r.d(e,"adjoint",function(){return d}),r.d(e,"determinant",function(){return v}),r.d(e,"multiply",function(){return _}),r.d(e,"translate",function(){return m}),r.d(e,"rotate",function(){return p}),r.d(e,"scale",function(){return y}),r.d(e,"fromTranslation",function(){return b}),r.d(e,"fromRotation",function(){return g}),r.d(e,"fromScaling",function(){return M}),r.d(e,"fromMat2d",function(){return x}),r.d(e,"fromQuat",function(){return T}),r.d(e,"normalFromMat4",function(){return E}),r.d(e,"projection",function(){return w}),r.d(e,"str",function(){return O}),r.d(e,"frob",function(){return P}),r.d(e,"add",function(){return R}),r.d(e,"subtract",function(){return S}),r.d(e,"multiplyScalar",function(){return A}),r.d(e,"multiplyScalarAndAdd",function(){return N}),r.d(e,"exactEquals",function(){return C}),r.d(e,"equals",function(){return I}),r.d(e,"mul",function(){return k}),r.d(e,"sub",function(){return L});var n=r(0);function i(){let t=new n.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function a(t){let e=new n.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function s(t,e,r,i,o,a,u,s,c){let f=new n.ARRAY_TYPE(9);return f[0]=t,f[1]=e,f[2]=r,f[3]=i,f[4]=o,f[5]=a,f[6]=u,f[7]=s,f[8]=c,f}function c(t,e,r,n,i,o,a,u,s,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=u,t[7]=s,t[8]=c,t}function f(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function l(t,e){if(t===e){let r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function h(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],f=e[8],l=f*a-u*c,h=-f*o+u*s,d=c*o-a*s,v=r*l+n*h+i*d;return v?(v=1/v,t[0]=l*v,t[1]=(-f*n+i*c)*v,t[2]=(u*n-i*a)*v,t[3]=h*v,t[4]=(f*r-i*s)*v,t[5]=(-u*r+i*o)*v,t[6]=d*v,t[7]=(-c*r+n*s)*v,t[8]=(a*r-n*o)*v,t):null}function d(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],f=e[8];return t[0]=a*f-u*c,t[1]=i*c-n*f,t[2]=n*u-i*a,t[3]=u*s-o*f,t[4]=r*f-i*s,t[5]=i*o-r*u,t[6]=o*c-a*s,t[7]=n*s-r*c,t[8]=r*a-n*o,t}function v(t){let e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],u=t[6],s=t[7],c=t[8];return e*(c*o-a*s)+r*(-c*i+a*u)+n*(s*i-o*u)}function _(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=r[0],d=r[1],v=r[2],_=r[3],m=r[4],p=r[5],y=r[6],b=r[7],g=r[8];return t[0]=h*n+d*a+v*c,t[1]=h*i+d*u+v*f,t[2]=h*o+d*s+v*l,t[3]=_*n+m*a+p*c,t[4]=_*i+m*u+p*f,t[5]=_*o+m*s+p*l,t[6]=y*n+b*a+g*c,t[7]=y*i+b*u+g*f,t[8]=y*o+b*s+g*l,t}function m(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=r[0],d=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=u,t[5]=s,t[6]=h*n+d*a+c,t[7]=h*i+d*u+f,t[8]=h*o+d*s+l,t}function p(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=Math.sin(r),d=Math.cos(r);return t[0]=d*n+h*a,t[1]=d*i+h*u,t[2]=d*o+h*s,t[3]=d*a-h*n,t[4]=d*u-h*i,t[5]=d*s-h*o,t[6]=c,t[7]=f,t[8]=l,t}function y(t,e,r){let n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function b(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function g(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function M(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function x(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function T(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,u=n+n,s=i+i,c=r*a,f=n*a,l=n*u,h=i*a,d=i*u,v=i*s,_=o*a,m=o*u,p=o*s;return t[0]=1-l-v,t[3]=f-p,t[6]=h+m,t[1]=f+p,t[4]=1-c-v,t[7]=d-_,t[2]=h-m,t[5]=d+_,t[8]=1-c-l,t}function E(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],f=e[8],l=e[9],h=e[10],d=e[11],v=e[12],_=e[13],m=e[14],p=e[15],y=r*u-n*a,b=r*s-i*a,g=r*c-o*a,M=n*s-i*u,x=n*c-o*u,T=i*c-o*s,E=f*_-l*v,w=f*m-h*v,O=f*p-d*v,P=l*m-h*_,R=l*p-d*_,S=h*p-d*m,A=y*S-b*R+g*P+M*O-x*w+T*E;return A?(A=1/A,t[0]=(u*S-s*R+c*P)*A,t[1]=(s*O-a*S-c*w)*A,t[2]=(a*R-u*O+c*E)*A,t[3]=(i*R-n*S-o*P)*A,t[4]=(r*S-i*O+o*w)*A,t[5]=(n*O-r*R-o*E)*A,t[6]=(_*T-m*x+p*M)*A,t[7]=(m*g-v*T-p*b)*A,t[8]=(v*x-_*g+p*y)*A,t):null}function w(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function O(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function P(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))}function R(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function S(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function A(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function N(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function C(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function I(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=t[8],h=e[0],d=e[1],v=e[2],_=e[3],m=e[4],p=e[5],y=e[6],b=e[7],g=e[8];return Math.abs(r-h)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-d)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-v)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-_)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(u-m)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(s-p)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(c-y)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(f-b)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(b))&&Math.abs(l-g)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))}const k=_,L=S},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PbrMaterial=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(5),o=r(11);e.PbrMaterial=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.baseColor=t.defineSampler("baseColorTex"),t.metallicRoughness=t.defineSampler("metallicRoughnessTex"),t.normal=t.defineSampler("normalTex"),t.occlusion=t.defineSampler("occlusionTex"),t.emissive=t.defineSampler("emissiveTex"),t.baseColorFactor=t.defineUniform("baseColorFactor",[1,1,1,1]),t.metallicRoughnessFactor=t.defineUniform("metallicRoughnessFactor",[1,1]),t.occlusionStrength=t.defineUniform("occlusionStrength",1),t.emissiveFactor=t.defineUniform("emissiveFactor",[0,0,0]),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.Material),n(e,[{key:"getProgramDefines",value:function(t){var e={};return t._attributeMask&o.ATTRIB_MASK.COLOR_0&&(e.USE_VERTEX_COLOR=1),t._attributeMask&o.ATTRIB_MASK.TEXCOORD_0&&(this.baseColor.texture&&(e.USE_BASE_COLOR_MAP=1),this.normal.texture&&t._attributeMask&o.ATTRIB_MASK.TANGENT&&(e.USE_NORMAL_MAP=1),this.metallicRoughness.texture&&(e.USE_METAL_ROUGH_MAP=1),this.occlusion.texture&&(e.USE_OCCLUSION=1),this.emissive.texture&&(e.USE_EMISSIVE_TEXTURE=1)),this.metallicRoughness.texture&&t._attributeMask&o.ATTRIB_MASK.TEXCOORD_0||1!=this.metallicRoughnessFactor.value[1]||(e.FULLY_ROUGH=1),e}},{key:"materialName",get:function(){return"PBR"}},{key:"vertexSource",get:function(){return"\nattribute vec3 POSITION, NORMAL;\nattribute vec2 TEXCOORD_0, TEXCOORD_1;\n\nuniform vec3 CAMERA_POSITION;\nuniform vec3 LIGHT_DIRECTION;\n\nvarying vec3 vLight; // Vector from vertex to light.\nvarying vec3 vView; // Vector from vertex to camera.\nvarying vec2 vTex;\n\n#ifdef USE_NORMAL_MAP\nattribute vec4 TANGENT;\nvarying mat3 vTBN;\n#else\nvarying vec3 vNorm;\n#endif\n\n#ifdef USE_VERTEX_COLOR\nattribute vec4 COLOR_0;\nvarying vec4 vCol;\n#endif\n\nvec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n  vec3 n = normalize(vec3(model * vec4(NORMAL, 0.0)));\n#ifdef USE_NORMAL_MAP\n  vec3 t = normalize(vec3(model * vec4(TANGENT.xyz, 0.0)));\n  vec3 b = cross(n, t) * TANGENT.w;\n  vTBN = mat3(t, b, n);\n#else\n  vNorm = n;\n#endif\n\n#ifdef USE_VERTEX_COLOR\n  vCol = COLOR_0;\n#endif\n\n  vTex = TEXCOORD_0;\n  vec4 mPos = model * vec4(POSITION, 1.0);\n  vLight = -LIGHT_DIRECTION;\n  vView = CAMERA_POSITION - mPos.xyz;\n  return proj * view * mPos;\n}"}},{key:"fragmentSource",get:function(){return"\n#define M_PI 3.14159265\n\nuniform vec4 baseColorFactor;\n#ifdef USE_BASE_COLOR_MAP\nuniform sampler2D baseColorTex;\n#endif\n\nvarying vec3 vLight;\nvarying vec3 vView;\nvarying vec2 vTex;\n\n#ifdef USE_VERTEX_COLOR\nvarying vec4 vCol;\n#endif\n\n#ifdef USE_NORMAL_MAP\nuniform sampler2D normalTex;\nvarying mat3 vTBN;\n#else\nvarying vec3 vNorm;\n#endif\n\n#ifdef USE_METAL_ROUGH_MAP\nuniform sampler2D metallicRoughnessTex;\n#endif\nuniform vec2 metallicRoughnessFactor;\n\n#ifdef USE_OCCLUSION\nuniform sampler2D occlusionTex;\nuniform float occlusionStrength;\n#endif\n\n#ifdef USE_EMISSIVE_TEXTURE\nuniform sampler2D emissiveTex;\n#endif\nuniform vec3 emissiveFactor;\n\nuniform vec3 LIGHT_COLOR;\n\nconst vec3 dielectricSpec = vec3(0.04);\nconst vec3 black = vec3(0.0);\n\n\nvec3 lambertDiffuse(vec3 cDiff) {\n  return cDiff / M_PI;\n}\n\nfloat specD(float a, float nDotH) {\n  float aSqr = a * a;\n  float f = ((nDotH * nDotH) * (aSqr - 1.0) + 1.0);\n  return aSqr / (M_PI * f * f);\n}\n\nfloat specG(float roughness, float nDotL, float nDotV) {\n  float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n  float gl = nDotL / (nDotL * (1.0 - k) + k);\n  float gv = nDotV / (nDotV * (1.0 - k) + k);\n  return gl * gv;\n}\n\nvec3 specF(float vDotH, vec3 F0) {\n  float exponent = (-5.55473 * vDotH - 6.98316) * vDotH;\n  float base = 2.0;\n  return F0 + (1.0 - F0) * pow(base, exponent);\n}\n\nvec4 fragment_main() {\n#ifdef USE_BASE_COLOR_MAP\n  vec4 baseColor = texture2D(baseColorTex, vTex) * baseColorFactor;\n#else\n  vec4 baseColor = baseColorFactor;\n#endif\n\n#ifdef USE_VERTEX_COLOR\n  baseColor *= vCol;\n#endif\n\n#ifdef USE_NORMAL_MAP\n  vec3 n = texture2D(normalTex, vTex).rgb;\n  n = normalize(vTBN * (2.0 * n - 1.0));\n#else\n  vec3 n = normalize(vNorm);\n#endif\n\n#ifdef FULLY_ROUGH\n  float metallic = 0.0;\n#else\n  float metallic = metallicRoughnessFactor.x;\n#endif\n\n  float roughness = metallicRoughnessFactor.y;\n\n#ifdef USE_METAL_ROUGH_MAP\n  vec4 metallicRoughness = texture2D(metallicRoughnessTex, vTex);\n  metallic *= metallicRoughness.b;\n  roughness *= metallicRoughness.g;\n#endif\n  \n  vec3 l = normalize(vLight);\n  vec3 v = normalize(vView);\n  vec3 h = normalize(l+v);\n\n  float nDotL = clamp(dot(n, l), 0.001, 1.0);\n  float nDotV = abs(dot(n, v)) + 0.001;\n  float nDotH = max(dot(n, h), 0.0);\n  float vDotH = max(dot(v, h), 0.0);\n\n  // From GLTF Spec\n  vec3 cDiff = mix(baseColor.rgb * (1.0 - dielectricSpec.r), black, metallic); // Diffuse color\n  vec3 F0 = mix(dielectricSpec, baseColor.rgb, metallic); // Specular color\n  float a = roughness * roughness;\n\n#ifdef FULLY_ROUGH\n  vec3 specular = F0 * 0.45;\n#else\n  vec3 F = specF(vDotH, F0);\n  float D = specD(a, nDotH);\n  float G = specG(roughness, nDotL, nDotV);\n  vec3 specular = (D * F * G) / (4.0 * nDotL * nDotV);\n#endif\n  float halfLambert = dot(n, l) * 0.5 + 0.5;\n  halfLambert *= halfLambert;\n\n  vec3 color = (halfLambert * LIGHT_COLOR * lambertDiffuse(cDiff)) + specular;\n\n#ifdef USE_OCCLUSION\n  float occlusion = texture2D(occlusionTex, vTex).r;\n  color = mix(color, color * occlusion, occlusionStrength);\n#endif\n  \n  vec3 emissive = emissiveFactor;\n#ifdef USE_EMISSIVE_TEXTURE\n  emissive *= texture2D(emissiveTex, vTex).rgb;\n#endif\n  color += emissive;\n\n  // gamma correction\n  color = pow(color, vec3(1.0/2.2));\n\n  return vec4(color, baseColor.a);\n}"}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BoxBuilder=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(10);e.BoxBuilder=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.GeometryBuilderBase),n(e,[{key:"pushBox",value:function(t,e){var r=this.primitiveStream,n=.5*(e[0]-t[0]),i=.5*(e[1]-t[1]),o=.5*(e[2]-t[2]),a=t[0]+n,u=t[1]+i,s=t[2]+o;r.startGeometry();var c=r.nextVertexIndex;r.pushTriangle(c,c+1,c+2),r.pushTriangle(c,c+2,c+3),r.pushVertex(-n+a,-i+u,-o+s,0,1,0,-1,0),r.pushVertex(+n+a,-i+u,-o+s,1,1,0,-1,0),r.pushVertex(+n+a,-i+u,+o+s,1,0,0,-1,0),r.pushVertex(-n+a,-i+u,+o+s,0,0,0,-1,0),c=r.nextVertexIndex,r.pushTriangle(c,c+2,c+1),r.pushTriangle(c,c+3,c+2),r.pushVertex(-n+a,+i+u,-o+s,0,0,0,1,0),r.pushVertex(+n+a,+i+u,-o+s,1,0,0,1,0),r.pushVertex(+n+a,+i+u,+o+s,1,1,0,1,0),r.pushVertex(-n+a,+i+u,+o+s,0,1,0,1,0),c=r.nextVertexIndex,r.pushTriangle(c,c+2,c+1),r.pushTriangle(c,c+3,c+2),r.pushVertex(-n+a,-i+u,-o+s,0,1,-1,0,0),r.pushVertex(-n+a,+i+u,-o+s,0,0,-1,0,0),r.pushVertex(-n+a,+i+u,+o+s,1,0,-1,0,0),r.pushVertex(-n+a,-i+u,+o+s,1,1,-1,0,0),c=r.nextVertexIndex,r.pushTriangle(c,c+1,c+2),r.pushTriangle(c,c+2,c+3),r.pushVertex(+n+a,-i+u,-o+s,1,1,1,0,0),r.pushVertex(+n+a,+i+u,-o+s,1,0,1,0,0),r.pushVertex(+n+a,+i+u,+o+s,0,0,1,0,0),r.pushVertex(+n+a,-i+u,+o+s,0,1,1,0,0),c=r.nextVertexIndex,r.pushTriangle(c,c+2,c+1),r.pushTriangle(c,c+3,c+2),r.pushVertex(-n+a,-i+u,-o+s,1,1,0,0,-1),r.pushVertex(+n+a,-i+u,-o+s,0,1,0,0,-1),r.pushVertex(+n+a,+i+u,-o+s,0,0,0,0,-1),r.pushVertex(-n+a,+i+u,-o+s,1,0,0,0,-1),c=r.nextVertexIndex,r.pushTriangle(c,c+1,c+2),r.pushTriangle(c,c+2,c+3),r.pushVertex(-n+a,-i+u,+o+s,0,1,0,0,1),r.pushVertex(+n+a,-i+u,+o+s,1,1,0,0,1),r.pushVertex(+n+a,+i+u,+o+s,1,0,0,0,1),r.pushVertex(-n+a,+i+u,+o+s,0,0,0,0,1),r.endGeometry()}},{key:"pushCube",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],e=.5*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);this.pushBox([t[0]-e,t[1]-e,t[2]-e],[t[0]+e,t[1]+e,t[2]+e])}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FallbackHelper=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(6);e.FallbackHelper=function(){function t(e,r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=e,this.gl=r,this._emulateStage=!1,this.lookYaw=0,this.lookPitch=0,this.viewMatrix=i.mat4.create();var o=i.mat4.create();function a(){r.canvas.width=r.canvas.offsetWidth*window.devicePixelRatio,r.canvas.height=r.canvas.offsetHeight*window.devicePixelRatio,i.mat4.perspective(o,.4*Math.PI,r.canvas.width/r.canvas.height,.1,1e3),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight)}this.projectionMatrix=o,i.mat4.identity(this.viewMatrix),window.addEventListener("resize",a),a();var u=r.canvas,s=0,c=0;u.addEventListener("touchstart",function(t){2==t.touches.length&&(s=t.touches[1].pageX,c=t.touches[1].pageY)}),u.addEventListener("touchmove",function(t){2==t.touches.length&&(n.onLook(t.touches[1].pageX-s,t.touches[1].pageY-c),s=t.touches[1].pageX,c=t.touches[1].pageY)}),u.addEventListener("mousemove",function(t){2&t.buttons&&n.onLook(t.movementX,t.movementY)}),u.addEventListener("contextmenu",function(t){t.preventDefault()}),this.boundOnFrame=this.onFrame.bind(this),window.requestAnimationFrame(this.boundOnFrame)}return n(t,[{key:"onLook",value:function(t,e){this.lookYaw+=.0025*t,this.lookPitch+=.0025*e,this.lookPitch<.5*-Math.PI&&(this.lookPitch=.5*-Math.PI),this.lookPitch>.5*Math.PI&&(this.lookPitch=.5*Math.PI),this.updateView()}},{key:"onFrame",value:function(t){var e=this.gl;window.requestAnimationFrame(this.boundOnFrame),this.scene.startFrame(),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.scene.draw(this.projectionMatrix,this.viewMatrix),this.scene.endFrame()}},{key:"updateView",value:function(){i.mat4.identity(this.viewMatrix),i.mat4.rotateX(this.viewMatrix,this.viewMatrix,-this.lookPitch),i.mat4.rotateY(this.viewMatrix,this.viewMatrix,-this.lookYaw),this._emulateStage&&i.mat4.translate(this.viewMatrix,this.viewMatrix,[0,-1.6,0])}},{key:"emulateStage",get:function(){return this._emulateStage},set:function(t){this._emulateStage=t,this.updateView()}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SevenSegmentText=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(5),o=r(2),a=r(7);function u(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=function(t){function e(){return s(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"SEVEN_SEGMENT_TEXT"}},{key:"vertexSource",get:function(){return"\n    attribute vec2 POSITION;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      return proj * view * model * vec4(POSITION, 0.0, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return"\n    precision mediump float;\n    const vec4 color = vec4(0.0, 1.0, 0.0, 1.0);\n\n    vec4 fragment_main() {\n      return color;\n    }"}}]),e}();e.SevenSegmentText=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._text="",t._charNodes=[],t}return f(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){this.clearNodes(),this._charNodes=[];var e=[],r={},n=[];function i(t,n,i,o,a){var u=e.length/2;e.push(n,i,o,i,o,a,n,a),r[t]=[u,u+2,u+1,u,u+3,u+2]}var o={};function s(t,e){for(var i={character:t,offset:2*n.length,count:0},a=0;a<e.length;++a){var s=e[a],c=r[s];i.count+=c.length,n.push.apply(n,u(c))}o[t]=i}i(0,-1,1,.5,.75),i(1,-1,.125,.5,-.125),i(2,-1,-.75,.5,-1),i(3,-1,1,-.75,-.125),i(4,.25,1,.5,-.125),i(5,-1,.125,-.75,-1),i(6,.25,.125,.5,-1),s("0",[0,2,3,4,5,6]),s("1",[4,6]),s("2",[0,1,2,4,5]),s("3",[0,1,2,4,6]),s("4",[1,3,4,6]),s("5",[0,1,2,3,6]),s("6",[0,1,2,3,5,6]),s("7",[0,4,6]),s("8",[0,1,2,3,4,5,6]),s("9",[0,1,2,3,4,6]),s("A",[0,1,3,4,5,6]),s("B",[1,2,3,5,6]),s("C",[0,2,3,5]),s("D",[1,2,4,5,6]),s("E",[0,1,2,4,6]),s("F",[0,1,3,5]),s("P",[0,1,3,4,5]),s("-",[1]),s(" ",[]),s("_",[2]);var c=t.gl,f=t.createRenderBuffer(c.ARRAY_BUFFER,new Float32Array(e)),h=t.createRenderBuffer(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(n)),d=[new a.PrimitiveAttribute("POSITION",f,2,c.FLOAT,8,0)],v=new a.Primitive(d,n.length);v.setIndexBuffer(h);var _=new l;for(var m in this._charPrimitives={},o){var p=o[m];v.elementCount=p.count,v.indexByteOffset=p.offset,this._charPrimitives[m]=t.createRenderPrimitive(v,_)}this.text=this._text}},{key:"text",get:function(){return this._text},set:function(t){this._text=t;for(var e=0,r=null;e<t.length;++e)if(r=t[e]in this._charPrimitives?this._charPrimitives[t[e]]:this._charPrimitives._,this._charNodes.length<=e){var n=new o.Node;n.addRenderPrimitive(r);var i=2*e;n.translation=[i,0,0],this._charNodes.push(n),this.addNode(n)}else this._charNodes[e].clearRenderPrimitives(),this._charNodes[e].addRenderPrimitive(r),this._charNodes[e].visible=!0;for(;e<this._charNodes.length;++e)this._charNodes[e].visible=!1}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StatsViewer=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(5),o=r(2),a=r(7),u=r(16);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=30,h=90,d=function(t){function e(){return s(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"STATS_VIEWER"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n    attribute vec3 COLOR_0;\n    varying vec4 vColor;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vColor = vec4(COLOR_0, 1.0);\n      return proj * view * model * vec4(POSITION, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return"\n    precision mediump float;\n    varying vec4 vColor;\n\n    vec4 fragment_main() {\n      return vColor;\n    }"}}]),e}();function v(t){return.9/l*t-.45}function _(t){return Math.min(t,h)*(.7/h)-.45}var m=window.performance&&performance.now?performance.now.bind(performance):Date.now;e.StatsViewer=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._performanceMonitoring=!1,t._startTime=m(),t._prevFrameTime=t._startTime,t._prevGraphUpdateTime=t._startTime,t._frames=0,t._fpsAverage=0,t._fpsMin=0,t._fpsStep=t._performanceMonitoring?1e3:250,t._lastSegment=0,t._fpsVertexBuffer=null,t._fpsRenderPrimitive=null,t._fpsNode=null,t._sevenSegmentNode=new u.SevenSegmentText,t._sevenSegmentNode.matrix=new Float32Array([.075,0,0,0,0,.075,0,0,0,0,1,0,-.3625,.3625,.02,1]),t}return f(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){this.clearNodes();for(var e=t.gl,r=[],n=[],i=0;i<l;++i){r.push(v(i),_(0),.02,0,1,1),r.push(v(i+1),_(0),.02,0,1,1),r.push(v(i),_(0),.02,0,1,1),r.push(v(i+1),_(0),.02,0,1,1);var u=4*i;n.push(u,u+3,u+1,u+3,u,u+2)}function s(t,e,i,o,a,u,s,c){var f=r.length/6;r.push(t,e,a,u,s,c),r.push(i,o,a,u,s,c),r.push(t,o,a,u,s,c),r.push(i,e,a,u,s,c),n.push(f,f+1,f+2,f,f+3,f+1)}s(-.5,-.5,.5,.5,0,0,0,.125),s(-.45,-.45,.45,.25,.01,0,0,.4),s(-.45,_(30),.45,_(32),.015,.5,0,.5),s(-.45,_(60),.45,_(62),.015,.2,0,.75),this._fpsVertexBuffer=t.createRenderBuffer(e.ARRAY_BUFFER,new Float32Array(r),e.DYNAMIC_DRAW);var c=t.createRenderBuffer(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n)),f=[new a.PrimitiveAttribute("POSITION",this._fpsVertexBuffer,3,e.FLOAT,24,0),new a.PrimitiveAttribute("COLOR_0",this._fpsVertexBuffer,3,e.FLOAT,24,12)],h=new a.Primitive(f,n.length);h.setIndexBuffer(c),h.setBounds([-.5,-.5,0],[.5,.5,.015]),this._fpsRenderPrimitive=t.createRenderPrimitive(h,new d),this._fpsNode=new o.Node,this._fpsNode.addRenderPrimitive(this._fpsRenderPrimitive),this.addNode(this._fpsNode),this.addNode(this._sevenSegmentNode)}},{key:"begin",value:function(){this._startTime=m()}},{key:"end",value:function(){var t=m(),e=1e3/(t-this._prevFrameTime);if(this._prevFrameTime=t,this._fpsMin=this._frames?Math.min(this._fpsMin,e):e,this._frames++,t>this._prevGraphUpdateTime+this._fpsStep){var r=t-this._prevGraphUpdateTime;this._fpsAverage=Math.round(1e3/(r/this._frames)),this._updateGraph(this._fpsMin,this._fpsAverage),this._performanceMonitoring&&console.log("Average FPS: "+this._fpsAverage+" Min FPS: "+this._fpsMin),this._prevGraphUpdateTime=t,this._frames=0,this._fpsMin=0}}},{key:"_updateGraph",value:function(t,e){var r,n=(r=t,{r:Math.max(0,Math.min(1,1-r/60)),g:Math.max(0,Math.min(1,(r-15)/(h-15))),b:Math.max(0,Math.min(1,(r-15)/(h-15)))}),i=_(t-1),o=_(e+1),a=[v(this._lastSegment),o,.02,n.r,n.g,n.b,v(this._lastSegment+1),o,.02,n.r,n.g,n.b,v(this._lastSegment),i,.02,n.r,n.g,n.b,v(this._lastSegment+1),i,.02,n.r,n.g,n.b];n.r=.2,n.g=1,n.b=.2,this._lastSegment==l-1?(this._renderer.updateRenderBuffer(this._fpsVertexBuffer,new Float32Array(a),24*this._lastSegment*4),a=[v(0),_(h),.02,n.r,n.g,n.b,v(.25),_(h),.02,n.r,n.g,n.b,v(0),_(0),.02,n.r,n.g,n.b,v(.25),_(0),.02,n.r,n.g,n.b],this._renderer.updateRenderBuffer(this._fpsVertexBuffer,new Float32Array(a),0)):(a.push(v(this._lastSegment+1),_(h),.02,n.r,n.g,n.b,v(this._lastSegment+1.25),_(h),.02,n.r,n.g,n.b,v(this._lastSegment+1),_(0),.02,n.r,n.g,n.b,v(this._lastSegment+1.25),_(0),.02,n.r,n.g,n.b),this._renderer.updateRenderBuffer(this._fpsVertexBuffer,new Float32Array(a),24*this._lastSegment*4)),this._lastSegment=(this._lastSegment+1)%l,this._sevenSegmentNode.text=this._fpsAverage+" FP5"}},{key:"performanceMonitoring",get:function(){return this._performanceMonitoring},set:function(t){this._performanceMonitoring=t,this._fpsStep=t?1e3:250}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InputRenderer=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(5),o=r(2),a=r(7),u=r(8);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=WebGLRenderingContext,h=new Uint8Array([255,255,255,1,255,255,255,2,191,191,191,4,204,204,204,5,219,219,219,7,204,204,204,10,216,216,216,13,210,210,210,17,206,206,206,21,206,206,206,26,206,206,206,31,205,205,205,36,200,200,200,42,201,201,201,47,201,201,201,52,201,201,201,57,201,201,201,61,200,200,200,65,203,203,203,68,238,238,238,135,250,250,250,200,249,249,249,201,249,249,249,201,250,250,250,201,250,250,250,201,249,249,249,201,249,249,249,201,250,250,250,200,238,238,238,135,203,203,203,68,200,200,200,65,201,201,201,61,201,201,201,57,201,201,201,52,201,201,201,47,200,200,200,42,205,205,205,36,206,206,206,31,206,206,206,26,206,206,206,21,210,210,210,17,216,216,216,13,204,204,204,10,219,219,219,7,204,204,204,5,191,191,191,4,255,255,255,2,255,255,255,1]),d=[1,1,1,.25],v=[1,1,1,1],_=[.5,.5,.5,.25],m={controllers:!0,lasers:!0,cursors:!0},p=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.renderOrder=i.RENDER_ORDER.ADDITIVE,t.state.cullFace=!1,t.state.blend=!0,t.state.blendFuncSrc=l.ONE,t.state.blendFuncDst=l.ONE,t.state.depthMask=!1,t.laser=t.defineSampler("diffuse"),t.laser.texture=new u.DataTexture(h,48,1),t.laserColor=t.defineUniform("laserColor",d),t}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"INPUT_LASER"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vTexCoord = TEXCOORD_0;\n      return proj * view * model * vec4(POSITION, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return"\n    precision mediump float;\n\n    uniform vec4 laserColor;\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    const float fadePoint = 0.5335;\n    const float fadeEnd = 0.535;\n\n    vec4 fragment_main() {\n      vec2 uv = vTexCoord;\n      float front_fade_factor = 1.0 - clamp(1.0 - (uv.y - fadePoint) / (1.0 - fadePoint), 0.0, 1.0);\n      float back_fade_factor = clamp((uv.y - fadePoint) / (fadeEnd - fadePoint), 0.0, 1.0);\n      vec4 color = laserColor * texture2D(diffuse, vTexCoord);\n      float opacity = color.a * front_fade_factor * back_fade_factor;\n      return vec4(color.rgb * opacity, opacity);\n    }"}}]),e}(),y="\nattribute vec4 POSITION;\n\nvarying float vLuminance;\nvarying float vOpacity;\n\nvec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n  vLuminance = POSITION.z;\n  vOpacity = POSITION.w;\n\n  // Billboarded, constant size vertex transform.\n  vec4 screenPos = proj * view * model * vec4(0.0, 0.0, 0.0, 1.0);\n  screenPos /= screenPos.w;\n  screenPos.xy += POSITION.xy;\n  return screenPos;\n}",b="\nprecision mediump float;\n\nuniform vec4 cursorColor;\nvarying float vLuminance;\nvarying float vOpacity;\n\nvec4 fragment_main() {\n  vec3 color = cursorColor.rgb * vLuminance;\n  float opacity = cursorColor.a * vOpacity;\n  return vec4(color * opacity, opacity);\n}",g=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.renderOrder=i.RENDER_ORDER.ADDITIVE,t.state.cullFace=!1,t.state.blend=!0,t.state.blendFuncSrc=l.ONE,t.state.depthMask=!1,t.cursorColor=t.defineUniform("cursorColor",v),t}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"INPUT_CURSOR"}},{key:"vertexSource",get:function(){return y}},{key:"fragmentSource",get:function(){return b}}]),e}(),M=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.renderOrder=i.RENDER_ORDER.ADDITIVE,t.state.cullFace=!1,t.state.blend=!0,t.state.blendFuncSrc=l.ONE,t.state.depthFunc=l.GEQUAL,t.state.depthMask=!1,t.cursorColor=t.defineUniform("cursorColor",_),t}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"INPUT_CURSOR_2"}},{key:"vertexSource",get:function(){return y}},{key:"fragmentSource",get:function(){return b}}]),e}();e.InputRenderer=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._maxInputElements=32,t._controllers=[],t._controllerNode=null,t._controllerNodeHandedness=null,t._lasers=null,t._cursors=null,t._activeControllers=0,t._activeLasers=0,t._activeCursors=0,t}return f(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){this._controllers=[],this._controllerNode=null,this._controllerNodeHandedness=null,this._lasers=null,this._cursors=null,this._activeControllers=0,this._activeLasers=0,this._activeCursors=0}},{key:"setControllerMesh",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";this._controllerNode=t,this._controllerNode.visible=!1,this.addNode(this._controllerNode),this._controllerNodeHandedness=e}},{key:"addController",value:function(t){if(this._controllerNode){var e=null;this._activeControllers<this._controllers.length?e=this._controllers[this._activeControllers]:(e=this._controllerNode.clone(),this.addNode(e),this._controllers.push(e)),this._activeControllers=(this._activeControllers+1)%this._maxInputElements,e.matrix=t,e.visible=!0}}},{key:"addLaserPointer",value:function(t){!this._lasers&&this._renderer&&(this._lasers=[this._createLaserMesh()],this.addNode(this._lasers[0]));var e=null;this._activeLasers<this._lasers.length?e=this._lasers[this._activeLasers]:(e=this._lasers[0].clone(),this.addNode(e),this._lasers.push(e)),this._activeLasers=(this._activeLasers+1)%this._maxInputElements,e.matrix=t,e.visible=!0}},{key:"addCursor",value:function(t){!this._cursors&&this._renderer&&(this._cursors=[this._createCursorMesh()],this.addNode(this._cursors[0]));var e=null;this._activeCursors<this._cursors.length?e=this._cursors[this._activeCursors]:(e=this._cursors[0].clone(),this.addNode(e),this._cursors.push(e)),this._activeCursors=(this._activeCursors+1)%this._maxInputElements,e.translation=t,e.visible=!0}},{key:"reset",value:function(t){if(t||(t=m),this._controllers&&t.controllers){var e=!0,r=!1,n=void 0;try{for(var i,o=this._controllers[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.visible=!1}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}this._activeControllers=0}if(this._lasers&&t.lasers){var a=!0,u=!1,s=void 0;try{for(var c,f=this._lasers[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){c.value.visible=!1}}catch(t){u=!0,s=t}finally{try{!a&&f.return&&f.return()}finally{if(u)throw s}}this._activeLasers=0}if(this._cursors&&t.cursors){var l=!0,h=!1,d=void 0;try{for(var v,_=this._cursors[Symbol.iterator]();!(l=(v=_.next()).done);l=!0){v.value.visible=!1}}catch(t){h=!0,d=t}finally{try{!l&&_.return&&_.return()}finally{if(h)throw d}}this._activeCursors=0}}},{key:"_createLaserMesh",value:function(){var t=this._renderer._gl,e=.005,r=[0,e,0,0,1,0,e,-1,0,0,0,-e,0,1,1,0,-e,-1,1,0,e,0,0,0,1,e,0,-1,0,0,-e,0,0,1,1,-e,0,-1,1,0,0,-e,0,0,1,0,-e,-1,0,0,0,e,0,1,1,0,e,-1,1,0,-e,0,0,0,1,-e,0,-1,0,0,e,0,0,1,1,e,0,-1,1,0],n=[0,1,2,1,3,2,4,5,6,5,7,6,8,9,10,9,11,10,12,13,14,13,15,14],i=this._renderer.createRenderBuffer(t.ARRAY_BUFFER,new Float32Array(r)),u=this._renderer.createRenderBuffer(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(n)),s=n.length,c=[new a.PrimitiveAttribute("POSITION",i,3,t.FLOAT,20,0),new a.PrimitiveAttribute("TEXCOORD_0",i,2,t.FLOAT,20,12)],f=new a.Primitive(c,s);f.setIndexBuffer(u);var l=new p,h=this._renderer.createRenderPrimitive(f,l),d=new o.Node;return d.addRenderPrimitive(h),d}},{key:"_createCursorMesh",value:function(){for(var t=this._renderer._gl,e=[],r=[],n=2*Math.PI/16,i=0;i<16;++i){var u=i*n,s=Math.cos(u),c=Math.sin(u);e.push(.004*s,.004*c,1,.9),i>1&&r.push(0,i-1,i)}for(var f=0;f<16;++f){var l=f*n,h=Math.cos(l),d=Math.sin(l);if(e.push(.004*h,.004*d,.5,.75),e.push(.007*h,.007*d,0,0),f>0){var v=16+2*f;r.push(v-2,v-1,v),r.push(v-1,v+1,v)}}r.push(46,47,16),r.push(47,17,16);var _=this._renderer.createRenderBuffer(t.ARRAY_BUFFER,new Float32Array(e)),m=this._renderer.createRenderBuffer(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(r)),p=r.length,y=[new a.PrimitiveAttribute("POSITION",_,4,t.FLOAT,16,0)],b=new a.Primitive(y,p);b.setIndexBuffer(m);var x=new g,T=new M,E=this._renderer.createRenderPrimitive(b,x),w=this._renderer.createRenderPrimitive(b,T),O=new o.Node;return O.addRenderPrimitive(E),O.addRenderPrimitive(w),O}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=e.WebXRView=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(11),o=r(18),a=r(17),u=r(2),s=r(6);function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=e.WebXRView=function(t){function e(t,r,n){return c(this,e),f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t?t.projectionMatrix:null,r&&t?r.getViewMatrix(t):null,n&&t?n.getViewport(t):null,t?t.eye:"left"))}return l(e,i.RenderView),e}();e.Scene=function(t){function e(){c(this,e);var t=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._timestamp=-1,t._frameDelta=0,t._statsStanding=!1,t._stats=null,t._statsEnabled=!1,t.enableStats(!0),t._inputRenderer=null,t._resetInputEndFrame=!0,t._lastTimestamp=0,t._hoverFrame=0,t._hoveredNodes=[],t.clear=!0,t}return l(e,u.Node),n(e,[{key:"setRenderer",value:function(t){this._setRenderer(t)}},{key:"loseRenderer",value:function(){this._renderer&&(this._stats=null,this._renderer=null,this._inputRenderer=null)}},{key:"updateInputSources",value:function(t,e){if(t.session.getInputSources){var r=t.session.getInputSources(),n=[],i=this._hoverFrame;this._hoverFrame++;var o=!0,a=!1,u=void 0;try{for(var c,f=r[Symbol.iterator]();!(o=(c=f.next()).done);o=!0){var l=c.value,h=t.getInputPose(l,e);if(h&&(h.gripMatrix&&this.inputRenderer.addController(h.gripMatrix),h.pointerMatrix)){"hand"==l.pointerOrigin&&this.inputRenderer.addLaserPointer(h.pointerMatrix);var d=this.hitTest(h.pointerMatrix);if(d)this.inputRenderer.addCursor(d.intersection),d.node._hoverFrameId!=i&&d.node.onHoverStart(),d.node._hoverFrameId=this._hoverFrame,n.push(d.node);else{var v=s.vec3.fromValues(0,0,-1);s.vec3.transformMat4(v,v,h.pointerMatrix),this.inputRenderer.addCursor(v)}}}}catch(t){a=!0,u=t}finally{try{!o&&f.return&&f.return()}finally{if(a)throw u}}var _=!0,m=!1,p=void 0;try{for(var y,b=this._hoveredNodes[Symbol.iterator]();!(_=(y=b.next()).done);_=!0){var g=y.value;g._hoverFrameId!=this._hoverFrame&&g.onHoverEnd()}}catch(t){m=!0,p=t}finally{try{!_&&b.return&&b.return()}finally{if(m)throw p}}this._hoveredNodes=n}}},{key:"handleSelect",value:function(t,e,r){var n=e.getInputPose(t,r);n&&this.handleSelectPointer(n.pointerMatrix)}},{key:"handleSelectPointer",value:function(t){if(t){var e=this.hitTest(t);e&&e.node.handleSelect()}}},{key:"enableStats",value:function(t){t!=this._statsEnabled&&(this._statsEnabled=t,t?(this._stats=new a.StatsViewer,this._stats.selectable=!0,this.addNode(this._stats),this._statsStanding?this._stats.translation=[0,1.4,-.75]:this._stats.translation=[0,-.3,-.5],this._stats.scale=[.3,.3,.3],s.quat.fromEuler(this._stats.rotation,-45,0,0)):t||this._stats&&(this.removeNode(this._stats),this._stats=null))}},{key:"standingStats",value:function(t){this._statsStanding=t,this._stats&&(this._statsStanding?this._stats.translation=[0,1.4,-.75]:this._stats.translation=[0,-.3,-.5],this._stats.scale=[.3,.3,.3],s.quat.fromEuler(this._stats.rotation,-45,0,0))}},{key:"draw",value:function(t,e,r){var n=new i.RenderView;n.projectionMatrix=t,n.viewMatrix=e,r&&(n.eye=r),this.drawViewArray([n])}},{key:"drawXRFrame",value:function(t,e){if(this._renderer&&e){var r=this._renderer.gl,n=t.session.baseLayer;if(r){r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer),this.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);var i=[],o=!0,a=!1,u=void 0;try{for(var s,c=t.views[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var f=s.value;i.push(new h(f,e,n))}}catch(t){a=!0,u=t}finally{try{!o&&c.return&&c.return()}finally{if(a)throw u}}this.drawViewArray(i)}}}},{key:"drawViewArray",value:function(t){this._renderer&&this._renderer.drawViews(t,this)}},{key:"startFrame",value:function(){var t=this._timestamp;return this._timestamp=performance.now(),this._stats&&this._stats.begin(),this._frameDelta=t>=0?this._timestamp-t:0,this._update(this._timestamp,this._frameDelta),this._frameDelta}},{key:"endFrame",value:function(){this._inputRenderer&&this._resetInputEndFrame&&this._inputRenderer.reset(),this._stats&&this._stats.end()}},{key:"onLoadScene",value:function(t){return Promise.resolve()}},{key:"inputRenderer",get:function(){return this._inputRenderer||(this._inputRenderer=new o.InputRenderer,this.addNode(this._inputRenderer)),this._inputRenderer}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VideoNode=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(5),o=r(7),a=r(2),u=r(8);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=WebGLRenderingContext,h=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.image=t.defineSampler("diffuse"),t.texCoordScaleOffset=t.defineUniform("texCoordScaleOffset",[1,1,0,0,1,1,0,0],4),t}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"VIDEO_PLAYER"}},{key:"vertexSource",get:function(){return"\n    uniform int EYE_INDEX;\n    uniform vec4 texCoordScaleOffset[2];\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec4 scaleOffset = texCoordScaleOffset[EYE_INDEX];\n      vTexCoord = (TEXCOORD_0 * scaleOffset.xy) + scaleOffset.zw;\n      vec4 out_vec = proj * view * model * vec4(POSITION, 1.0);\n      return out_vec;\n    }"}},{key:"fragmentSource",get:function(){return"\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(diffuse, vTexCoord);\n    }"}}]),e}();e.VideoNode=function(t){function e(t){s(this,e);var r=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._video=t.video,r._displayMode=t.displayMode||"mono",r._video_texture=new u.VideoTexture(r._video),r}return f(e,a.Node),n(e,[{key:"onRendererChanged",value:function(t){var e=[0,2,1,0,3,2],r=t.createRenderBuffer(l.ARRAY_BUFFER,new Float32Array([-1,1,0,0,0,1,1,0,1,0,1,-1,0,1,1,-1,-1,0,0,1])),n=t.createRenderBuffer(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(e)),i=[new o.PrimitiveAttribute("POSITION",r,3,l.FLOAT,20,0),new o.PrimitiveAttribute("TEXCOORD_0",r,2,l.FLOAT,20,12)],a=new o.Primitive(i,e.length);a.setIndexBuffer(n),a.setBounds([-1,-1,0],[1,1,.015]);var u=new h;switch(u.image.texture=this._video_texture,this._displayMode){case"mono":u.texCoordScaleOffset.value=[1,1,0,0,1,1,0,0];break;case"stereoTopBottom":u.texCoordScaleOffset.value=[1,.5,0,0,1,.5,0,.5];break;case"stereoLeftRight":u.texCoordScaleOffset.value=[.5,1,0,0,.5,1,.5,0]}var s=t.createRenderPrimitive(a,u);this.addRenderPrimitive(s)}},{key:"aspectRatio",get:function(){var t=this._video.videoWidth,e=this._video.videoHeight;switch(this._displayMode){case"stereoTopBottom":e*=.5;break;case"stereoLeftRight":t*=.5}return e&&t?t/e:1}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SkyboxNode=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(5),o=r(7),a=r(2),u=r(8);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=WebGLRenderingContext,h=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.renderOrder=i.RENDER_ORDER.SKY,t.state.depthFunc=l.LEQUAL,t.state.depthMask=!1,t.image=t.defineSampler("diffuse"),t.texCoordScaleOffset=t.defineUniform("texCoordScaleOffset",[1,1,0,0,1,1,0,0],4),t}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"SKYBOX"}},{key:"vertexSource",get:function(){return"\n    uniform int EYE_INDEX;\n    uniform vec4 texCoordScaleOffset[2];\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec4 scaleOffset = texCoordScaleOffset[EYE_INDEX];\n      vTexCoord = (TEXCOORD_0 * scaleOffset.xy) + scaleOffset.zw;\n      // Drop the translation portion of the view matrix\n      view[3].xyz = vec3(0.0, 0.0, 0.0);\n      vec4 out_vec = proj * view * model * vec4(POSITION, 1.0);\n\n      // Returning the W component for both Z and W forces the geometry depth to\n      // the far plane. When combined with a depth func of LEQUAL this makes the\n      // sky write to any depth fragment that has not been written to yet.\n      return out_vec.xyww;\n    }"}},{key:"fragmentSource",get:function(){return"\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(diffuse, vTexCoord);\n    }"}}]),e}();e.SkyboxNode=function(t){function e(t){s(this,e);var r=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._url=t.url,r._displayMode=t.displayMode||"mono",r._rotationY=t.rotationY||0,r}return f(e,a.Node),n(e,[{key:"onRendererChanged",value:function(t){for(var e=[],r=[],n=0;n<=40;++n)for(var i=n*Math.PI/40,a=Math.sin(i),s=Math.cos(i),c=41*n,f=41*(n+1),d=0;d<=40;++d){var v=2*d*Math.PI/40+this._rotationY,_=Math.sin(v)*a,m=s,p=-Math.cos(v)*a,y=d/40,b=n/40;if(e.push(_,m,p,y,b),n<40&&d<40){var g=c+d,M=f+d;r.push(g,M,g+1,M,M+1,g+1)}}var x=t.createRenderBuffer(l.ARRAY_BUFFER,new Float32Array(e)),T=t.createRenderBuffer(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(r)),E=[new o.PrimitiveAttribute("POSITION",x,3,l.FLOAT,20,0),new o.PrimitiveAttribute("TEXCOORD_0",x,2,l.FLOAT,20,12)],w=new o.Primitive(E,r.length);w.setIndexBuffer(T);var O=new h;switch(O.image.texture=new u.UrlTexture(this._url),this._displayMode){case"mono":O.texCoordScaleOffset.value=[1,1,0,0,1,1,0,0];break;case"stereoTopBottom":O.texCoordScaleOffset.value=[1,.5,0,0,1,.5,0,.5];break;case"stereoLeftRight":O.texCoordScaleOffset.value=[.5,1,0,0,.5,1,.5,0]}var P=t.createRenderPrimitive(w,O);this.addRenderPrimitive(P)}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Gltf2Loader=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(13),o=r(2),a=r(7),u=r(8);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var c=WebGLRenderingContext,f=1313821514,l=5130562;function h(t){return!!t.match(/^data:/)}function d(t,e){return function(t){var e=new RegExp("^"+window.location.protocol,"i");return!!t.match(e)}(t)||h(t)?t:e+t}function v(t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;default:return 0}}e.Gltf2Loader=function(){function t(e){s(this,t),this.renderer=e,this._gl=e._gl}return n(t,[{key:"loadFromUrl",value:function(t){var e=this;return fetch(t).then(function(r){var n=t.lastIndexOf("/"),i=0!==n?t.substring(0,n+1):"";if(t.endsWith(".gltf"))return r.json().then(function(t){return e.loadFromJson(t,i)});if(t.endsWith(".glb"))return r.arrayBuffer().then(function(t){return e.loadFromBinary(t,i)});throw new Error("Unrecognized file extension")})}},{key:"loadFromBinary",value:function(t,e){var r=new DataView(t,0,12),n=r.getUint32(0,!0),i=r.getUint32(4,!0),o=r.getUint32(8,!0);if(1179937895!=n)throw new Error("Invalid magic string in binary header.");if(2!=i)throw new Error("Incompatible version in binary header.");for(var a={},u=12;u<o;){var s=new DataView(t,u,8),c=s.getUint32(0,!0);a[s.getUint32(4,!0)]=t.slice(u+8,u+8+c),u+=c+8}if(!a[f])throw new Error("File contained no json chunk.");var h=new TextDecoder("utf-8").decode(a[f]),d=JSON.parse(h);return this.loadFromJson(d,e,a[l])}},{key:"loadFromJson",value:function(t,e,r){if(!t.asset)throw new Error("Missing asset description.");if("2.0"!=t.asset.minVersion&&"2.0"!=t.asset.version)throw new Error("Incompatible asset version.");var n=[];if(r)n[0]=new p({},e,r);else{var s=!0,f=!1,l=void 0;try{for(var h,d=t.buffers[Symbol.iterator]();!(s=(h=d.next()).done);s=!0){var y=h.value;n.push(new p(y,e))}}catch(t){f=!0,l=t}finally{try{!s&&d.return&&d.return()}finally{if(f)throw l}}}var b=[],g=!0,M=!1,x=void 0;try{for(var T,E=t.bufferViews[Symbol.iterator]();!(g=(T=E.next()).done);g=!0){var w=T.value;b.push(new m(w,n))}}catch(t){M=!0,x=t}finally{try{!g&&E.return&&E.return()}finally{if(M)throw x}}var O=[];if(t.images){var P=!0,R=!1,S=void 0;try{for(var A,N=t.images[Symbol.iterator]();!(P=(A=N.next()).done);P=!0){var C=A.value;O.push(new p(C,e))}}catch(t){R=!0,S=t}finally{try{!P&&N.return&&N.return()}finally{if(R)throw S}}}var I=[];if(t.textures){var k=!0,L=!1,F=void 0;try{for(var D,B=t.textures[Symbol.iterator]();!(k=(D=B.next()).done);k=!0){var j=D.value,U=O[j.source].texture(b);if(j.sampler){var V=V[j.sampler];U.sampler.minFilter=V.minFilter,U.sampler.magFilter=V.magFilter,U.sampler.wrapS=V.wrapS,U.sampler.wrapT=V.wrapT}I.push(U)}}catch(t){L=!0,F=t}finally{try{!k&&B.return&&B.return()}finally{if(L)throw F}}}function Y(t){return t?I[t.index]:null}var G=[];if(t.materials){var H=!0,q=!1,X=void 0;try{for(var W,K=t.materials[Symbol.iterator]();!(H=(W=K.next()).done);H=!0){var z=W.value,Q=new i.PbrMaterial,J=z.pbrMetallicRoughness||{};switch(Q.baseColorFactor.value=J.baseColorFactor||[1,1,1,1],Q.baseColor.texture=Y(J.baseColorTexture),Q.metallicRoughnessFactor.value=[J.metallicFactor||1,J.roughnessFactor||1],Q.metallicRoughness.texture=Y(J.metallicRoughnessTexture),Q.normal.texture=Y(t.normalTexture),Q.occlusion.texture=Y(t.occlusionTexture),Q.occlusionStrength.value=t.occlusionTexture&&t.occlusionTexture.strength?t.occlusionTexture.strength:1,Q.emissiveFactor.value=z.emissiveFactor||[0,0,0],Q.emissive.texture=Y(t.emissiveTexture),!Q.emissive.texture&&t.emissiveFactor&&(Q.emissive.texture=new u.ColorTexture(1,1,1,1)),z.alphaMode){case"BLEND":case"MASK":Q.state.blend=!0;break;default:Q.state.blend=!1}Q.state.cullFace=!z.doubleSided,G.push(Q)}}catch(t){q=!0,X=t}finally{try{!H&&K.return&&K.return()}finally{if(q)throw X}}}var Z=t.accessors,$=[],tt=!0,et=!1,rt=void 0;try{for(var nt,it=t.meshes[Symbol.iterator]();!(tt=(nt=it.next()).done);tt=!0){var ot=nt.value,at=new _;$.push(at);var ut=!0,st=!1,ct=void 0;try{for(var ft,lt=ot.primitives[Symbol.iterator]();!(ut=(ft=lt.next()).done);ut=!0){var ht=ft.value,dt=null;dt="material"in ht?G[ht.material]:new i.PbrMaterial;var vt=[],_t=0,mt=null,pt=null;for(var yt in ht.attributes){var bt=Z[ht.attributes[yt]],gt=b[bt.bufferView];_t=bt.count;var Mt=new a.PrimitiveAttribute(yt,gt.renderBuffer(this.renderer,c.ARRAY_BUFFER),v(bt.type),bt.componentType,gt.byteStride||0,bt.byteOffset||0);Mt.normalized=bt.normalized||!1,"POSITION"==yt&&(mt=bt.min,pt=bt.max),vt.push(Mt)}var xt=new a.Primitive(vt,_t,ht.mode);if("indices"in ht){var Tt=Z[ht.indices],Et=b[Tt.bufferView];xt.setIndexBuffer(Et.renderBuffer(this.renderer,c.ELEMENT_ARRAY_BUFFER),Tt.byteOffset||0,Tt.componentType),xt.indexType=Tt.componentType,xt.indexByteOffset=Tt.byteOffset||0,xt.elementCount=Tt.count}mt&&pt&&xt.setBounds(mt,pt),at.primitives.push(this.renderer.createRenderPrimitive(xt,dt))}}catch(t){st=!0,ct=t}finally{try{!ut&&lt.return&&lt.return()}finally{if(st)throw ct}}}}catch(t){et=!0,rt=t}finally{try{!tt&&it.return&&it.return()}finally{if(et)throw rt}}var wt=new o.Node,Ot=t.scenes[t.scene],Pt=!0,Rt=!1,St=void 0;try{for(var At,Nt=Ot.nodes[Symbol.iterator]();!(Pt=(At=Nt.next()).done);Pt=!0){var Ct=At.value,It=t.nodes[Ct];wt.addNode(this.processNodes(It,t.nodes,$))}}catch(t){Rt=!0,St=t}finally{try{!Pt&&Nt.return&&Nt.return()}finally{if(Rt)throw St}}return wt}},{key:"processNodes",value:function(t,e,r){var n=new o.Node;if(n.name=t.name,"mesh"in t){var i=r[t.mesh],a=!0,u=!1,s=void 0;try{for(var c,f=i.primitives[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var l=c.value;n.addRenderPrimitive(l)}}catch(t){u=!0,s=t}finally{try{!a&&f.return&&f.return()}finally{if(u)throw s}}}if(t.matrix?n.matrix=new Float32Array(t.matrix):(t.translation||t.rotation||t.scale)&&(t.translation&&(n.translation=new Float32Array(t.translation)),t.rotation&&(n.rotation=new Float32Array(t.rotation)),t.scale&&(n.scale=new Float32Array(t.scale))),t.children){var h=!0,d=!1,v=void 0;try{for(var _,m=t.children[Symbol.iterator]();!(h=(_=m.next()).done);h=!0){var p=e[_.value];n.addNode(this.processNodes(p,e,r))}}catch(t){d=!0,v=t}finally{try{!h&&m.return&&m.return()}finally{if(d)throw v}}}return n}}]),t}();var _=function t(){s(this,t),this.primitives=[]},m=function(){function t(e,r){s(this,t),this.buffer=r[e.buffer],this.byteOffset=e.byteOffset||0,this.byteLength=e.byteLength||null,this.byteStride=e.byteStride,this._viewPromise=null,this._renderBuffer=null}return n(t,[{key:"dataView",value:function(){var t=this;return this._viewPromise||(this._viewPromise=this.buffer.arrayBuffer().then(function(e){return new DataView(e,t.byteOffset,t.byteLength)})),this._viewPromise}},{key:"renderBuffer",value:function(t,e){return this._renderBuffer||(this._renderBuffer=t.createRenderBuffer(e,this.dataView())),this._renderBuffer}}]),t}(),p=function(){function t(e,r,n){s(this,t),this.json=e,this.baseUrl=r,this._dataPromise=null,this._texture=null,n&&(this._dataPromise=Promise.resolve(n))}return n(t,[{key:"arrayBuffer",value:function(){if(!this._dataPromise){if(h(this.json.uri)){var t=this.json.uri.replace("data:application/octet-stream;base64,",""),e=Uint8Array.from(atob(t),function(t){return t.charCodeAt(0)});return this._dataPromise=Promise.resolve(e.buffer),this._dataPromise}this._dataPromise=fetch(d(this.json.uri,this.baseUrl)).then(function(t){return t.arrayBuffer()})}return this._dataPromise}},{key:"texture",value:function(t){var e=this;if(!this._texture){var r=new Image;if(this._texture=new u.ImageTexture(r),this.json.uri)h(this.json.uri)?r.src=this.json.uri:r.src=""+this.baseUrl+this.json.uri;else t[this.json.bufferView].dataView().then(function(t){var n=new Blob([t],{type:e.json.mimeType});r.src=window.URL.createObjectURL(n)})}return this._texture}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Gltf2Node=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(2),o=r(22);var a=new WeakMap;e.Gltf2Node=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._url=t.url,r._promise=null,r._resolver=null,r._rejecter=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.Node),n(e,[{key:"onRendererChanged",value:function(t){var e=this,r=a.get(t);r||(r=new o.Gltf2Loader(t),a.set(t,r)),!this._resolver&&this._promise&&(this._promise=null),this._ensurePromise(),r.loadFromUrl(this._url).then(function(t){e.addNode(t),e._resolver(t.waitForComplete()),e._resolver=null,e._rejecter=null}).catch(function(t){e._rejecter(t),e._resolver=null,e._rejecter=null})}},{key:"_ensurePromise",value:function(){var t=this;return this._promise||(this._promise=new Promise(function(e,r){t._resolver=e,t._rejecter=r})),this._promise}},{key:"waitForComplete",value:function(){return this._ensurePromise()}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CubeSeaNode=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(5),o=r(2),a=r(8),u=r(14),s=r(6);function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];c(this,e);var r=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.heavy=t,r.baseColor=r.defineSampler("baseColor"),r}return l(e,i.Material),n(e,[{key:"materialName",get:function(){return"CUBE_SEA"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    attribute vec3 NORMAL;\n\n    varying vec2 vTexCoord;\n    varying vec3 vLight;\n\n    const vec3 lightDir = vec3(0.75, 0.5, 1.0);\n    const vec3 ambientColor = vec3(0.5, 0.5, 0.5);\n    const vec3 lightColor = vec3(0.75, 0.75, 0.75);\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec3 normalRotated = vec3(model * vec4(NORMAL, 0.0));\n      float lightFactor = max(dot(normalize(lightDir), normalRotated), 0.0);\n      vLight = ambientColor + (lightColor * lightFactor);\n      vTexCoord = TEXCOORD_0;\n      return proj * view * model * vec4(POSITION, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return this.heavy?"\n      precision mediump float;\n\n      uniform sampler2D diffuse;\n      varying vec2 vTexCoord;\n      varying vec3 vLight;\n\n      vec2 dimensions = vec2(64, 64);\n      float seed = 0.42;\n\n      vec2 hash( vec2 p ) {\n        p=vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)));\n        return fract(sin(p)*18.5453);\n      }\n\n      vec3 hash3( vec2 p ) {\n          vec3 q = vec3( dot(p,vec2(127.1,311.7)),\n                 dot(p,vec2(269.5,183.3)),\n                 dot(p,vec2(419.2,371.9)) );\n        return fract(sin(q)*43758.5453);\n      }\n\n      float iqnoise( in vec2 x, float u, float v ) {\n        vec2 p = floor(x);\n        vec2 f = fract(x);\n        float k = 1.0+63.0*pow(1.0-v,4.0);\n        float va = 0.0;\n        float wt = 0.0;\n        for( int j=-2; j<=2; j++ )\n          for( int i=-2; i<=2; i++ ) {\n            vec2 g = vec2( float(i),float(j) );\n            vec3 o = hash3( p + g )*vec3(u,u,1.0);\n            vec2 r = g - f + o.xy;\n            float d = dot(r,r);\n            float ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );\n            va += o.z*ww;\n            wt += ww;\n          }\n        return va/wt;\n      }\n\n      // return distance, and cell id\n      vec2 voronoi( in vec2 x ) {\n        vec2 n = floor( x );\n        vec2 f = fract( x );\n        vec3 m = vec3( 8.0 );\n        for( int j=-1; j<=1; j++ )\n          for( int i=-1; i<=1; i++ ) {\n            vec2  g = vec2( float(i), float(j) );\n            vec2  o = hash( n + g );\n            vec2  r = g - f + (0.5+0.5*sin(seed+6.2831*o));\n            float d = dot( r, r );\n            if( d<m.x )\n              m = vec3( d, o );\n          }\n        return vec2( sqrt(m.x), m.y+m.z );\n      }\n\n      vec4 fragment_main() {\n        vec2 uv = ( vTexCoord );\n        uv *= vec2( 10., 10. );\n        uv += seed;\n        vec2 p = 0.5 - 0.5*sin( 0.*vec2(1.01,1.71) );\n\n        vec2 c = voronoi( uv );\n        vec3 col = vec3( c.y / 2. );\n\n        float f = iqnoise( 1. * uv + c.y, p.x, p.y );\n        col *= 1.0 + .25 * vec3( f );\n\n        return vec4(vLight, 1.0) * texture2D(diffuse, vTexCoord) * vec4( col, 1. );\n      }":"\n      precision mediump float;\n      uniform sampler2D baseColor;\n      varying vec2 vTexCoord;\n      varying vec3 vLight;\n\n      vec4 fragment_main() {\n        return vec4(vLight, 1.0) * texture2D(baseColor, vTexCoord);\n      }"}}]),e}();e.CubeSeaNode=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,e);var r=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.heavyGpu=!!t.heavyGpu,r.cubeCount=t.cubeCount||(r.heavyGpu?12:10),r.cubeScale=t.cubeScale||1,r.halfOnly=!!t.halfOnly,r.autoRotate=!!t.autoRotate,r._texture=new a.UrlTexture(t.imageUrl||"media/textures/cube-sea.png"),r._material=new h(r.heavyGpu),r._material.baseColor.texture=r._texture,r._renderPrimitive=null,r}return l(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){this._renderPrimitive=null;var e=new u.BoxBuilder;e.pushCube([0,.25,-.8],.1),e.pushCube([.8,.25,0],.1),e.pushCube([0,.25,.8],.1),e.pushCube([-.8,.25,0],.1);var r=e.finishPrimitive(t);return this.heroNode=t.createMesh(r,this._material),this.rebuildCubes(e),this.cubeSeaNode=new o.Node,this.cubeSeaNode.addRenderPrimitive(this._renderPrimitive),this.addNode(this.cubeSeaNode),this.addNode(this.heroNode),this.waitForComplete()}},{key:"rebuildCubes",value:function(t){if(this._renderer){t?t.clear():t=new u.BoxBuilder;for(var e=.4*this.cubeScale,r=.5*this.cubeCount,n=0;n<this.cubeCount;++n)for(var i=0;i<this.cubeCount;++i)for(var o=0;o<this.cubeCount;++o){var a=[n-r,i-r,o-r];this.halfOnly&&a[0]<0||(0==a[0]&&0==a[1]&&0==a[2]||t.pushCube(a,e))}this.cubeCount>12&&(t.indexType=5125);var s=t.finishPrimitive(this._renderer);this._renderPrimitive?this._renderPrimitive.setPrimitive(s):this._renderPrimitive=this._renderer.createRenderPrimitive(s,this._material)}}},{key:"onUpdate",value:function(t,e){this.autoRotate&&s.mat4.fromRotation(this.cubeSeaNode.matrix,t/500,[0,-1,0]),s.mat4.fromRotation(this.heroNode.matrix,t/2e3,[0,1,0])}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ButtonNode=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(5),o=r(2),a=r(10);function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=function(t){function e(){u(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.state.blend=!0,t.defineUniform("hoverAmount",0),t}return c(e,i.Material),n(e,[{key:"materialName",get:function(){return"BUTTON_MATERIAL"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n\n    uniform float hoverAmount;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      float scale = mix(1.0, 1.1, hoverAmount);\n      vec4 pos = vec4(POSITION.x * scale, POSITION.y * scale, POSITION.z * (scale + (hoverAmount * 0.2)), 1.0);\n      return proj * view * model * pos;\n    }"}},{key:"fragmentSource",get:function(){return"\n    uniform float hoverAmount;\n\n    const vec4 default_color = vec4(0.75, 0.75, 0.75, 0.85);\n    const vec4 hover_color = vec4(0.9, 0.9,\n                                  0.9, 1);\n\n    vec4 fragment_main() {\n      return mix(default_color, hover_color, hoverAmount);\n    }"}}]),e}(),l=function(t){function e(){u(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.state.blend=!0,t.defineUniform("hoverAmount",0),t.icon=t.defineSampler("icon"),t}return c(e,i.Material),n(e,[{key:"materialName",get:function(){return"BUTTON_ICON_MATERIAL"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n\n    uniform float hoverAmount;\n\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vTexCoord = TEXCOORD_0;\n      float scale = mix(1.0, 1.1, hoverAmount);\n      vec4 pos = vec4(POSITION.x * scale, POSITION.y * scale, POSITION.z * (scale + (hoverAmount * 0.2)), 1.0);\n      return proj * view * model * pos;\n    }"}},{key:"fragmentSource",get:function(){return"\n    uniform sampler2D icon;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(icon, vTexCoord);\n    }"}}]),e}();e.ButtonNode=function(t){function e(t,r){u(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.selectable=!0,n._selectHandler=r,n._iconTexture=t,n._hovered=!1,n._hoverT=0,n}return c(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){var e=new a.PrimitiveStream,r=.0025,n=.05,i=n-.025;e.startGeometry();for(var o=0;o<32;++o){var u=o*(2*Math.PI/32),s=.025*Math.cos(u),c=.025*Math.sin(u);switch(Math.floor(o/8)){case 0:s+=i,c+=i;break;case 1:s-=i,c+=i;break;case 2:s-=i,c-=i;break;case 3:s+=i,c-=i}e.pushVertex(s,c,-r,0,0,0,0,1),o>1&&e.pushTriangle(0,o-1,o)}e.endGeometry();var h=e.finishPrimitive(t);this._buttonRenderPrimitive=t.createRenderPrimitive(h,new f),this.addRenderPrimitive(this._buttonRenderPrimitive),n=.035,e.clear(),e.startGeometry(),e.pushVertex(-n,n,r,0,0,0,0,1),e.pushVertex(-n,-n,r,0,1,0,0,1),e.pushVertex(n,-n,r,1,1,0,0,1),e.pushVertex(n,n,r,1,0,0,0,1),e.pushTriangle(0,1,2),e.pushTriangle(0,2,3),e.endGeometry();var d=e.finishPrimitive(t),v=new l;v.icon.texture=this._iconTexture,this._iconRenderPrimitive=t.createRenderPrimitive(d,v),this.addRenderPrimitive(this._iconRenderPrimitive)}},{key:"onHoverStart",value:function(){this._hovered=!0}},{key:"onHoverEnd",value:function(){this._hovered=!1}},{key:"_updateHoverState",value:function(){var t=this._hoverT/200,e=t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1;this._buttonRenderPrimitive.uniforms.hoverAmount.value=e,this._iconRenderPrimitive.uniforms.hoverAmount.value=e}},{key:"onUpdate",value:function(t,e){this._hovered&&this._hoverT<200?(this._hoverT=Math.min(200,this._hoverT+e),this._updateHoverState()):!this._hovered&&this._hoverT>0&&(this._hoverT=Math.max(0,this._hoverT-e),this._updateHoverState())}},{key:"iconTexture",get:function(){return this._iconTexture},set:function(t){this._iconTexture!=t&&(this._iconTexture=t,this._iconRenderPrimitive.samplers.icon.texture=t)}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BoundsRenderer=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(5),o=r(2),a=r(7);function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=WebGLRenderingContext,l=function(t){function e(){u(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.state.blend=!0,t.state.blendFuncSrc=f.SRC_ALPHA,t.state.blendFuncDst=f.ONE,t.state.depthTest=!1,t}return c(e,i.Material),n(e,[{key:"materialName",get:function(){return"BOUNDS_RENDERER"}},{key:"vertexSource",get:function(){return"\n    attribute vec2 POSITION;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      return proj * view * model * vec4(POSITION, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return"\n    precision mediump float;\n\n    vec4 fragment_main() {\n      return vec4(0.0, 1.0, 0.0, 0.3);\n    }"}}]),e}();e.BoundsRenderer=function(t){function e(){u(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._stageBounds=null,t}return c(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){this.stageBounds=this._stageBounds}},{key:"stageBounds",get:function(){return this._stageBounds},set:function(t){if(this._stageBounds&&this.clearRenderPrimitives(),this._stageBounds=t,t&&0!==t.length&&this._renderer){for(var e=[],r=[],n=t.geometry.length,i=0;i<n;i++){var o=t.geometry[i];e.push(o.x,0,o.z),r.push(i,0===i?n-1:i-1,n)}e.push(0,0,0);var u=this._renderer.createRenderBuffer(f.ARRAY_BUFFER,new Float32Array(e)),s=this._renderer.createRenderBuffer(f.ELEMENT_ARRAY_BUFFER,new Uint16Array(r)),c=[new a.PrimitiveAttribute("POSITION",u,3,f.FLOAT,12,0)],h=new a.Primitive(c,r.length);h.setIndexBuffer(s);var d=this._renderer.createRenderPrimitive(h,new l);this.addRenderPrimitive(d)}}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.Program=function(){function t(e,r,n,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._gl=e,this.program=e.createProgram(),this.attrib=null,this.uniform=null,this.defines={},this._firstUse=!0,this._nextUseCallbacks=[];var a="";if(o)for(var u in o)this.defines[u]=o[u],a+="#define "+u+" "+o[u]+"\n";if(this._vertShader=e.createShader(e.VERTEX_SHADER),e.attachShader(this.program,this._vertShader),e.shaderSource(this._vertShader,a+r),e.compileShader(this._vertShader),this._fragShader=e.createShader(e.FRAGMENT_SHADER),e.attachShader(this.program,this._fragShader),e.shaderSource(this._fragShader,a+n),e.compileShader(this._fragShader),i)for(var s in this.attrib={},i)e.bindAttribLocation(this.program,i[s],s),this.attrib[s]=i[s];e.linkProgram(this.program)}return n(t,[{key:"onNextUse",value:function(t){this._nextUseCallbacks.push(t)}},{key:"use",value:function(){var t=this._gl;if(this._firstUse){if(this._firstUse=!1,t.getProgramParameter(this.program,t.LINK_STATUS)){if(!this.attrib){this.attrib={};for(var e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),r=0;r<e;r++){var n=t.getActiveAttrib(this.program,r);this.attrib[n.name]=t.getAttribLocation(this.program,n.name)}}this.uniform={};for(var i=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),o="",a=0;a<i;a++){o=t.getActiveUniform(this.program,a).name.replace("[0]",""),this.uniform[o]=t.getUniformLocation(this.program,o)}}else t.getShaderParameter(this._vertShader,t.COMPILE_STATUS)?t.getShaderParameter(this._fragShader,t.COMPILE_STATUS)?console.error("Program link error: "+t.getProgramInfoLog(this.program)):console.error("Fragment shader compile error: "+t.getShaderInfoLog(this._fragShader)):console.error("Vertex shader compile error: "+t.getShaderInfoLog(this._vertShader)),t.deleteProgram(this.program),this.program=null;t.deleteShader(this._vertShader),t.deleteShader(this._fragShader)}if(t.useProgram(this.program),this._nextUseCallbacks.length){var u=!0,s=!1,c=void 0;try{for(var f,l=this._nextUseCallbacks[Symbol.iterator]();!(u=(f=l.next()).done);u=!0){(0,f.value)(this)}}catch(t){s=!0,c=t}finally{try{!u&&l.return&&l.return()}finally{if(s)throw c}}this._nextUseCallbacks=[]}}}]),t}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"fromValues",function(){return a}),r.d(e,"copy",function(){return u}),r.d(e,"set",function(){return s}),r.d(e,"add",function(){return c}),r.d(e,"subtract",function(){return f}),r.d(e,"multiply",function(){return l}),r.d(e,"divide",function(){return h}),r.d(e,"ceil",function(){return d}),r.d(e,"floor",function(){return v}),r.d(e,"min",function(){return _}),r.d(e,"max",function(){return m}),r.d(e,"round",function(){return p}),r.d(e,"scale",function(){return y}),r.d(e,"scaleAndAdd",function(){return b}),r.d(e,"distance",function(){return g}),r.d(e,"squaredDistance",function(){return M}),r.d(e,"length",function(){return x}),r.d(e,"squaredLength",function(){return T}),r.d(e,"negate",function(){return E}),r.d(e,"inverse",function(){return w}),r.d(e,"normalize",function(){return O}),r.d(e,"dot",function(){return P}),r.d(e,"cross",function(){return R}),r.d(e,"lerp",function(){return S}),r.d(e,"random",function(){return A}),r.d(e,"transformMat2",function(){return N}),r.d(e,"transformMat2d",function(){return C}),r.d(e,"transformMat3",function(){return I}),r.d(e,"transformMat4",function(){return k}),r.d(e,"str",function(){return L}),r.d(e,"exactEquals",function(){return F}),r.d(e,"equals",function(){return D}),r.d(e,"len",function(){return B}),r.d(e,"sub",function(){return j}),r.d(e,"mul",function(){return U}),r.d(e,"div",function(){return V}),r.d(e,"dist",function(){return Y}),r.d(e,"sqrDist",function(){return G}),r.d(e,"sqrLen",function(){return H}),r.d(e,"forEach",function(){return q});var n=r(0);function i(){let t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t}function o(t){let e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e}function a(t,e){let r=new n.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r}function u(t,e){return t[0]=e[0],t[1]=e[1],t}function s(t,e,r){return t[0]=e,t[1]=r,t}function c(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function f(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function l(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function h(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function d(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function v(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function _(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function m(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function p(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function y(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function b(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function g(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}function M(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function x(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function T(t){var e=t[0],r=t[1];return e*e+r*r}function E(t,e){return t[0]=-e[0],t[1]=-e[1],t}function w(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function O(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t}function P(t,e){return t[0]*e[0]+t[1]*e[1]}function R(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function S(t,e,r,n){var i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t}function A(t,e){e=e||1;var r=2*n.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function N(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t}function C(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t}function I(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function k(t,e,r){let n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}function L(t){return"vec2("+t[0]+", "+t[1]+")"}function F(t,e){return t[0]===e[0]&&t[1]===e[1]}function D(t,e){let r=t[0],i=t[1],o=e[0],a=e[1];return Math.abs(r-o)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))}const B=x,j=f,U=l,V=h,Y=g,G=M,H=T,q=function(){let t=i();return function(e,r,n,i,o,a){let u,s;for(r||(r=2),n||(n=0),s=i?Math.min(i*r+n,e.length):e.length,u=n;u<s;u+=r)t[0]=e[u],t[1]=e[u+1],o(t,t,a),e[u]=t[0],e[u+1]=t[1];return e}}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return a}),r.d(e,"clone",function(){return u}),r.d(e,"fromValues",function(){return s}),r.d(e,"fromRotationTranslationValues",function(){return c}),r.d(e,"fromRotationTranslation",function(){return f}),r.d(e,"fromTranslation",function(){return l}),r.d(e,"fromRotation",function(){return h}),r.d(e,"fromMat4",function(){return d}),r.d(e,"copy",function(){return v}),r.d(e,"identity",function(){return _}),r.d(e,"set",function(){return m}),r.d(e,"getReal",function(){return p}),r.d(e,"getDual",function(){return y}),r.d(e,"setReal",function(){return b}),r.d(e,"setDual",function(){return g}),r.d(e,"getTranslation",function(){return M}),r.d(e,"translate",function(){return x}),r.d(e,"rotateX",function(){return T}),r.d(e,"rotateY",function(){return E}),r.d(e,"rotateZ",function(){return w}),r.d(e,"rotateByQuatAppend",function(){return O}),r.d(e,"rotateByQuatPrepend",function(){return P}),r.d(e,"rotateAroundAxis",function(){return R}),r.d(e,"add",function(){return S}),r.d(e,"multiply",function(){return A}),r.d(e,"mul",function(){return N}),r.d(e,"scale",function(){return C}),r.d(e,"dot",function(){return I}),r.d(e,"lerp",function(){return k}),r.d(e,"invert",function(){return L}),r.d(e,"conjugate",function(){return F}),r.d(e,"length",function(){return D}),r.d(e,"len",function(){return B}),r.d(e,"squaredLength",function(){return j}),r.d(e,"sqrLen",function(){return U}),r.d(e,"normalize",function(){return V}),r.d(e,"str",function(){return Y}),r.d(e,"exactEquals",function(){return G}),r.d(e,"equals",function(){return H});var n=r(0),i=r(4),o=r(9);function a(){let t=new n.ARRAY_TYPE(8);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function u(t){let e=new n.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function s(t,e,r,i,o,a,u,s){let c=new n.ARRAY_TYPE(8);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=o,c[5]=a,c[6]=u,c[7]=s,c}function c(t,e,r,i,o,a,u){let s=new n.ARRAY_TYPE(8);s[0]=t,s[1]=e,s[2]=r,s[3]=i;let c=.5*o,f=.5*a,l=.5*u;return s[4]=c*i+f*r-l*e,s[5]=f*i+l*t-c*r,s[6]=l*i+c*e-f*t,s[7]=-c*t-f*e-l*r,s}function f(t,e,r){let n=.5*r[0],i=.5*r[1],o=.5*r[2],a=e[0],u=e[1],s=e[2],c=e[3];return t[0]=a,t[1]=u,t[2]=s,t[3]=c,t[4]=n*c+i*s-o*u,t[5]=i*c+o*a-n*s,t[6]=o*c+n*u-i*a,t[7]=-n*a-i*u-o*s,t}function l(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function h(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function d(t,e){let r=i.create();o.getRotation(r,e);let a=new n.ARRAY_TYPE(3);return o.getTranslation(a,e),f(t,r,a),t}function v(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function _(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function m(t,e,r,n,i,o,a,u,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=u,t[7]=s,t}const p=i.copy;function y(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}const b=i.copy;function g(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function M(t,e){let r=e[4],n=e[5],i=e[6],o=e[7],a=-e[0],u=-e[1],s=-e[2],c=e[3];return t[0]=2*(r*c+o*a+n*s-i*u),t[1]=2*(n*c+o*u+i*a-r*s),t[2]=2*(i*c+o*s+r*u-n*a),t}function x(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=.5*r[0],s=.5*r[1],c=.5*r[2],f=e[4],l=e[5],h=e[6],d=e[7];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=a*u+i*c-o*s+f,t[5]=a*s+o*u-n*c+l,t[6]=a*c+n*s-i*u+h,t[7]=-n*u-i*s-o*c+d,t}function T(t,e,r){let n=-e[0],o=-e[1],a=-e[2],u=e[3],s=e[4],c=e[5],f=e[6],l=e[7],h=s*u+l*n+c*a-f*o,d=c*u+l*o+f*n-s*a,v=f*u+l*a+s*o-c*n,_=l*u-s*n-c*o-f*a;return i.rotateX(t,e,r),n=t[0],o=t[1],a=t[2],u=t[3],t[4]=h*u+_*n+d*a-v*o,t[5]=d*u+_*o+v*n-h*a,t[6]=v*u+_*a+h*o-d*n,t[7]=_*u-h*n-d*o-v*a,t}function E(t,e,r){let n=-e[0],o=-e[1],a=-e[2],u=e[3],s=e[4],c=e[5],f=e[6],l=e[7],h=s*u+l*n+c*a-f*o,d=c*u+l*o+f*n-s*a,v=f*u+l*a+s*o-c*n,_=l*u-s*n-c*o-f*a;return i.rotateY(t,e,r),n=t[0],o=t[1],a=t[2],u=t[3],t[4]=h*u+_*n+d*a-v*o,t[5]=d*u+_*o+v*n-h*a,t[6]=v*u+_*a+h*o-d*n,t[7]=_*u-h*n-d*o-v*a,t}function w(t,e,r){let n=-e[0],o=-e[1],a=-e[2],u=e[3],s=e[4],c=e[5],f=e[6],l=e[7],h=s*u+l*n+c*a-f*o,d=c*u+l*o+f*n-s*a,v=f*u+l*a+s*o-c*n,_=l*u-s*n-c*o-f*a;return i.rotateZ(t,e,r),n=t[0],o=t[1],a=t[2],u=t[3],t[4]=h*u+_*n+d*a-v*o,t[5]=d*u+_*o+v*n-h*a,t[6]=v*u+_*a+h*o-d*n,t[7]=_*u-h*n-d*o-v*a,t}function O(t,e,r){let n=r[0],i=r[1],o=r[2],a=r[3],u=e[0],s=e[1],c=e[2],f=e[3];return t[0]=u*a+f*n+s*o-c*i,t[1]=s*a+f*i+c*n-u*o,t[2]=c*a+f*o+u*i-s*n,t[3]=f*a-u*n-s*i-c*o,u=e[4],s=e[5],c=e[6],f=e[7],t[4]=u*a+f*n+s*o-c*i,t[5]=s*a+f*i+c*n-u*o,t[6]=c*a+f*o+u*i-s*n,t[7]=f*a-u*n-s*i-c*o,t}function P(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=r[0],s=r[1],c=r[2],f=r[3];return t[0]=n*f+a*u+i*c-o*s,t[1]=i*f+a*s+o*u-n*c,t[2]=o*f+a*c+n*s-i*u,t[3]=a*f-n*u-i*s-o*c,u=r[4],s=r[5],c=r[6],f=r[7],t[4]=n*f+a*u+i*c-o*s,t[5]=i*f+a*s+o*u-n*c,t[6]=o*f+a*c+n*s-i*u,t[7]=a*f-n*u-i*s-o*c,t}function R(t,e,r,i){if(Math.abs(i)<n.EPSILON)return v(t,e);let o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);i*=.5;let a=Math.sin(i),u=a*r[0]/o,s=a*r[1]/o,c=a*r[2]/o,f=Math.cos(i),l=e[0],h=e[1],d=e[2],_=e[3];t[0]=l*f+_*u+h*c-d*s,t[1]=h*f+_*s+d*u-l*c,t[2]=d*f+_*c+l*s-h*u,t[3]=_*f-l*u-h*s-d*c;let m=e[4],p=e[5],y=e[6],b=e[7];return t[4]=m*f+b*u+p*c-y*s,t[5]=p*f+b*s+y*u-m*c,t[6]=y*f+b*c+m*s-p*u,t[7]=b*f-m*u-p*s-y*c,t}function S(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function A(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=r[4],s=r[5],c=r[6],f=r[7],l=e[4],h=e[5],d=e[6],v=e[7],_=r[0],m=r[1],p=r[2],y=r[3];return t[0]=n*y+a*_+i*p-o*m,t[1]=i*y+a*m+o*_-n*p,t[2]=o*y+a*p+n*m-i*_,t[3]=a*y-n*_-i*m-o*p,t[4]=n*f+a*u+i*c-o*s+l*y+v*_+h*p-d*m,t[5]=i*f+a*s+o*u-n*c+h*y+v*m+d*_-l*p,t[6]=o*f+a*c+n*s-i*u+d*y+v*p+l*m-h*_,t[7]=a*f-n*u-i*s-o*c+v*y-l*_-h*m-d*p,t}const N=A;function C(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}const I=i.dot;function k(t,e,r,n){let i=1-n;return I(e,r)<0&&(n=-n),t[0]=e[0]*i+r[0]*n,t[1]=e[1]*i+r[1]*n,t[2]=e[2]*i+r[2]*n,t[3]=e[3]*i+r[3]*n,t[4]=e[4]*i+r[4]*n,t[5]=e[5]*i+r[5]*n,t[6]=e[6]*i+r[6]*n,t[7]=e[7]*i+r[7]*n,t}function L(t,e){let r=j(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function F(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}const D=i.length,B=D,j=i.squaredLength,U=j;function V(t,e){let r=j(e);return r>0&&(r=Math.sqrt(r),t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r,t[3]=e[3]/r,t[4]=e[4]/r,t[5]=e[5]/r,t[6]=e[6]/r,t[7]=e[7]/r),t}function Y(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function G(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function H(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=e[0],h=e[1],d=e[2],v=e[3],_=e[4],m=e[5],p=e[6],y=e[7];return Math.abs(r-l)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-h)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-d)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-v)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(u-_)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(s-m)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(c-p)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))&&Math.abs(f-y)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(y))}},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"copy",function(){return a}),r.d(e,"identity",function(){return u}),r.d(e,"fromValues",function(){return s}),r.d(e,"set",function(){return c}),r.d(e,"invert",function(){return f}),r.d(e,"determinant",function(){return l}),r.d(e,"multiply",function(){return h}),r.d(e,"rotate",function(){return d}),r.d(e,"scale",function(){return v}),r.d(e,"translate",function(){return _}),r.d(e,"fromRotation",function(){return m}),r.d(e,"fromScaling",function(){return p}),r.d(e,"fromTranslation",function(){return y}),r.d(e,"str",function(){return b}),r.d(e,"frob",function(){return g}),r.d(e,"add",function(){return M}),r.d(e,"subtract",function(){return x}),r.d(e,"multiplyScalar",function(){return T}),r.d(e,"multiplyScalarAndAdd",function(){return E}),r.d(e,"exactEquals",function(){return w}),r.d(e,"equals",function(){return O}),r.d(e,"mul",function(){return P}),r.d(e,"sub",function(){return R});var n=r(0);function i(){let t=new n.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function o(t){let e=new n.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function u(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function s(t,e,r,i,o,a){let u=new n.ARRAY_TYPE(6);return u[0]=t,u[1]=e,u[2]=r,u[3]=i,u[4]=o,u[5]=a,u}function c(t,e,r,n,i,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t}function f(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=r*o-n*i;return s?(s=1/s,t[0]=o*s,t[1]=-n*s,t[2]=-i*s,t[3]=r*s,t[4]=(i*u-o*a)*s,t[5]=(n*a-r*u)*s,t):null}function l(t){return t[0]*t[3]-t[1]*t[2]}function h(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=r[0],f=r[1],l=r[2],h=r[3],d=r[4],v=r[5];return t[0]=n*c+o*f,t[1]=i*c+a*f,t[2]=n*l+o*h,t[3]=i*l+a*h,t[4]=n*d+o*v+u,t[5]=i*d+a*v+s,t}function d(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=Math.sin(r),f=Math.cos(r);return t[0]=n*f+o*c,t[1]=i*f+a*c,t[2]=n*-c+o*f,t[3]=i*-c+a*f,t[4]=u,t[5]=s,t}function v(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=r[0],f=r[1];return t[0]=n*c,t[1]=i*c,t[2]=o*f,t[3]=a*f,t[4]=u,t[5]=s,t}function _(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=r[0],f=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=n*c+o*f+u,t[5]=i*c+a*f+s,t}function m(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function p(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function y(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function b(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function g(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)}function M(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function x(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function T(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function E(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function w(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function O(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],c=e[0],f=e[1],l=e[2],h=e[3],d=e[4],v=e[5];return Math.abs(r-c)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-f)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-l)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-h)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(u-d)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(d))&&Math.abs(s-v)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))}const P=h,R=x},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"copy",function(){return a}),r.d(e,"identity",function(){return u}),r.d(e,"fromValues",function(){return s}),r.d(e,"set",function(){return c}),r.d(e,"transpose",function(){return f}),r.d(e,"invert",function(){return l}),r.d(e,"adjoint",function(){return h}),r.d(e,"determinant",function(){return d}),r.d(e,"multiply",function(){return v}),r.d(e,"rotate",function(){return _}),r.d(e,"scale",function(){return m}),r.d(e,"fromRotation",function(){return p}),r.d(e,"fromScaling",function(){return y}),r.d(e,"str",function(){return b}),r.d(e,"frob",function(){return g}),r.d(e,"LDU",function(){return M}),r.d(e,"add",function(){return x}),r.d(e,"subtract",function(){return T}),r.d(e,"exactEquals",function(){return E}),r.d(e,"equals",function(){return w}),r.d(e,"multiplyScalar",function(){return O}),r.d(e,"multiplyScalarAndAdd",function(){return P}),r.d(e,"mul",function(){return R}),r.d(e,"sub",function(){return S});var n=r(0);function i(){let t=new n.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function o(t){let e=new n.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function u(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function s(t,e,r,i){let o=new n.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o}function c(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function f(t,e){if(t===e){let r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function l(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=r*o-i*n;return a?(a=1/a,t[0]=o*a,t[1]=-n*a,t[2]=-i*a,t[3]=r*a,t):null}function h(t,e){let r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function d(t){return t[0]*t[3]-t[2]*t[1]}function v(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=r[0],s=r[1],c=r[2],f=r[3];return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=n*c+o*f,t[3]=i*c+a*f,t}function _(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(r),s=Math.cos(r);return t[0]=n*s+o*u,t[1]=i*s+a*u,t[2]=n*-u+o*s,t[3]=i*-u+a*s,t}function m(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=r[0],s=r[1];return t[0]=n*u,t[1]=i*u,t[2]=o*s,t[3]=a*s,t}function p(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function y(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function b(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function g(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))}function M(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function x(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function T(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function E(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function w(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=e[0],s=e[1],c=e[2],f=e[3];return Math.abs(r-u)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-c)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-f)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))}function O(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function P(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}const R=v,S=T},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Ray=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(6);var o=i.mat3.create();e.Ray=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.origin=i.vec3.create(),this._dir=i.vec3.create(),this._dir[2]=-1,e&&(i.vec3.transformMat4(this.origin,this.origin,e),i.mat3.fromMat4(o,e),i.vec3.transformMat3(this._dir,this._dir,o)),this.dir=this._dir}return n(t,[{key:"intersectsAABB",value:function(t,e){var r=this,n=[t,e],o=(n[r.sign[0]][0]-r.origin[0])*r.inv_dir[0],a=(n[1-r.sign[0]][0]-r.origin[0])*r.inv_dir[0],u=(n[r.sign[1]][1]-r.origin[1])*r.inv_dir[1],s=(n[1-r.sign[1]][1]-r.origin[1])*r.inv_dir[1];if(o>s||u>a)return null;u>o&&(o=u),s<a&&(a=s);var c=(n[r.sign[2]][2]-r.origin[2])*r.inv_dir[2],f=(n[1-r.sign[2]][2]-r.origin[2])*r.inv_dir[2];if(o>f||c>a)return null;c>o&&(o=c),f<a&&(a=f);var l=-1;if(o>0&&a>0)l=Math.min(o,a);else if(o>0)l=o;else{if(!(a>0))return null;l=a}l-=.02;var h=i.vec3.clone(this._dir);return i.vec3.scale(h,h,l),i.vec3.add(h,h,this.origin),h}},{key:"dir",get:function(){return this._dir},set:function(t){this._dir=i.vec3.copy(this._dir,t),i.vec3.normalize(this._dir,this._dir),this.inv_dir=i.vec3.fromValues(1/this._dir[0],1/this._dir[1],1/this._dir[2]),this.sign=[this.inv_dir[0]<0?1:0,this.inv_dir[1]<0?1:0,this.inv_dir[2]<0?1:0]}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2);Object.defineProperty(e,"Node",{enumerable:!0,get:function(){return n.Node}});var i=r(11);Object.defineProperty(e,"Renderer",{enumerable:!0,get:function(){return i.Renderer}}),Object.defineProperty(e,"createWebGLContext",{enumerable:!0,get:function(){return i.createWebGLContext}});var o=r(8);Object.defineProperty(e,"UrlTexture",{enumerable:!0,get:function(){return o.UrlTexture}});var a=r(10);Object.defineProperty(e,"PrimitiveStream",{enumerable:!0,get:function(){return a.PrimitiveStream}});var u=r(14);Object.defineProperty(e,"BoxBuilder",{enumerable:!0,get:function(){return u.BoxBuilder}});var s=r(13);Object.defineProperty(e,"PbrMaterial",{enumerable:!0,get:function(){return s.PbrMaterial}});var c=r(6);Object.defineProperty(e,"mat4",{enumerable:!0,get:function(){return c.mat4}}),Object.defineProperty(e,"mat3",{enumerable:!0,get:function(){return c.mat3}}),Object.defineProperty(e,"vec3",{enumerable:!0,get:function(){return c.vec3}}),Object.defineProperty(e,"quat",{enumerable:!0,get:function(){return c.quat}});var f=r(26);Object.defineProperty(e,"BoundsRenderer",{enumerable:!0,get:function(){return f.BoundsRenderer}});var l=r(25);Object.defineProperty(e,"ButtonNode",{enumerable:!0,get:function(){return l.ButtonNode}});var h=r(24);Object.defineProperty(e,"CubeSeaNode",{enumerable:!0,get:function(){return h.CubeSeaNode}});var d=r(23);Object.defineProperty(e,"Gltf2Node",{enumerable:!0,get:function(){return d.Gltf2Node}});var v=r(21);Object.defineProperty(e,"SkyboxNode",{enumerable:!0,get:function(){return v.SkyboxNode}});var _=r(20);Object.defineProperty(e,"VideoNode",{enumerable:!0,get:function(){return _.VideoNode}});var m=r(19);Object.defineProperty(e,"WebXRView",{enumerable:!0,get:function(){return m.WebXRView}}),Object.defineProperty(e,"Scene",{enumerable:!0,get:function(){return m.Scene}});var p=r(15);Object.defineProperty(e,"FallbackHelper",{enumerable:!0,get:function(){return p.FallbackHelper}})}])});
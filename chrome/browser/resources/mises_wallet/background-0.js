LavaPack.loadBundle([[3972,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.REJECT_NOTFICIATION_CLOSE_SIG=r.REJECT_NOTFICIATION_CLOSE=r.METAMETRICS_BACKGROUND_PAGE_OBJECT=r.METAMETRICS_ANONYMOUS_ID=void 0;r.METAMETRICS_ANONYMOUS_ID="";r.METAMETRICS_BACKGROUND_PAGE_OBJECT={path:"/background-process",title:"Background Process",url:"/background-process"};r.REJECT_NOTFICIATION_CLOSE="Cancel Via Notification Close";r.REJECT_NOTFICIATION_CLOSE_SIG="Cancel Sig Request Via Notification Close"}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/shared/constants/metametrics.js"}],[37,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s={config:{},PreferencesController:{frequentRpcListDetail:[{rpcUrl:"http://localhost:8545",chainId:"0x539",ticker:"ETH",nickname:"Localhost 8545",rpcPrefs:{}}]}};r.default=s}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/first-time-state.js"}],[56,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return n((0,s.cloneDeep)(e),(e=>null===e?"null":typeof e))};var s=e("lodash");function n(e={},t){return Object.entries(e).forEach((([r,s])=>{e[r]="object"==typeof s&&null!==s?n(s,t):t(s)})),e}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/getObjStructure.js"}],[1825,{debounce:1826,duplexer:1885,through:3734},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("through"),n=e("duplexer"),o=e("debounce");t.exports=function(e,t){var r=s(o((function(e){a.queue(e)}),e||100,t)),a=s();return n(r,a)}}}},{package:"debounce-stream",file:"/Users/mac/code/metamask-extension/node_modules/debounce-stream/index.js"}],[63,{"../platforms/extension":148,"@babel/runtime/helpers/interopRequireDefault":190,"safe-event-emitter":3578},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.NOTIFICATION_MANAGER_EVENTS=void 0;var n=s(e("safe-event-emitter")),o=s(e("../platforms/extension"));const a={POPUP_CLOSED:"onPopupClosed"};r.NOTIFICATION_MANAGER_EVENTS=a;class i extends n.default{constructor(){super(),this.platform=new o.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}async showPopup(){const e=await this._getPopup();if(e)await this.platform.focusWindow(e.id);else{let e=0,t=0;try{const r=await this.platform.getLastFocusedWindow();t=r.top,e=r.left+(r.width-360)}catch(r){const{screenX:s,screenY:n,outerWidth:o}=window;t=Math.max(n,0),e=Math.max(s+(o-360),0)}const r=await this.platform.getActiveTabs();this._openerTab=r.length>0?r[0]:undefined,console.log("openerTab",this._openerTab);const s=await this.platform.openWindow({url:"notification.html",type:"popup",openerTabId:this._openerTab&&this._openerTab.id,index:this._openerTab&&this._openerTab.index,width:360,height:620,left:e,top:t});s.left!==e&&"fullscreen"!==s.state&&await this.platform.updateWindowPosition(s.id,e,t),this._popupId=s.id}}async closePopup(){await this.platform.closeCurrentWindow(),this._openerTab&&(await this.platform.switchToTab(this._openerTab.id),this._openerTab=undefined)}_onWindowClosed(e){e===this._popupId&&(this._popupId=undefined,this.emit(a.POPUP_CLOSED))}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find((e=>e&&"popup"===e.type&&e.id===this._popupId)):null}}r.default=i}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/notification-manager.js"}],[46,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"promise-to-callback":3206,"readable-stream":3468},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){return new c(e,t)};var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("readable-stream"),a=s(e("promise-to-callback"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}class c extends o.Writable{constructor(e,t){const r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({objectMode:!0},t);super(r),this._asyncWriteFn=e}_write(e,t,r){(0,a.default)(this._asyncWriteFn(e,t))(r)}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/createStreamSink.js"}],[57,{"./util":78,"@babel/runtime/helpers/interopRequireDefault":190,extensionizer:2143,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("extensionizer")),o=s(e("loglevel")),a=e("./util");r.default=class{constructor(){this.isSupported=Boolean(n.default.storage.local),this.isSupported||o.default.error("Storage local API not available.")}async get(){if(!this.isSupported)return undefined;const e=await this._get();return t=e,0===Object.keys(t).length?undefined:e;var t}async set(e){return this._set(e)}_get(){const{local:e}=n.default.storage;return new Promise(((t,r)=>{e.get(null,(e=>{const s=(0,a.checkForError)();s?r(s):t(e)}))}))}_set(e){const{local:t}=n.default.storage;return new Promise(((r,s)=>{t.set(e,(()=>{const e=(0,a.checkForError)();e?s(e):r()}))}))}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/local-store.js"}],[55,{"../../_locales/index.json":1,"@babel/runtime/helpers/interopRequireDefault":190,extensionizer:2143,pify:3199},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=async function(){let e;try{e=await i()}catch(t){e=[]}e||(e=[]);let t=e.map((e=>e.toLowerCase().replace("_","-"))).find((e=>c[e]!==undefined||c[e.split("-")[0]]!==undefined));t!==undefined&&c[t]===undefined&&(t=t.split("-")[0]);return c[t]||"en"};var n=s(e("extensionizer")),o=s(e("pify")),a=s(e("../../_locales/index.json"));const i=n.default.i18n?(0,o.default)(n.default.i18n.getAcceptLanguages,{errorFirst:!1}):async()=>[],c={};a.default.forEach((e=>{e&&e.code&&(c[e.code.toLowerCase().replace("_","-")]=e.code)}))}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/get-first-preferred-lang-code.js"}],[61,{"../../../shared/constants/time":3976,"../../../shared/modules/fetch-with-timeout":3981,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=s(e("loglevel")),a=e("../../../shared/constants/time");const i=(0,s(e("../../../shared/modules/fetch-with-timeout")).default)(30*a.SECOND);r.default=class{constructor(){(0,n.default)(this,"isSupported",!0),this._initialized=!1,this._initializing=this._init(),this._state=undefined}async _init(){try{const e=await i("http://localhost:12345/state.json");e.ok&&(this._state=await e.json())}catch(e){o.default.debug(`Error loading network state: '${e.message}'`)}finally{this._initialized=!0}}async get(){return this._initialized||await this._initializing,this._state}async set(e){this._initialized||await this._initializing,this._state=e}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/network-store.js"}],[1119,{"./ComposedStore":1114,"./LocalStorageStore":1115,"./MergedStore":1116,"./ObservableStore":1117,"./asStream":1118,"./transform":1120},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){s===undefined&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){s===undefined&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),n(e("./asStream"),r),n(e("./ComposedStore"),r),n(e("./LocalStorageStore"),r),n(e("./MergedStore"),r),n(e("./ObservableStore"),r),n(e("./transform"),r)}}},{package:"@metamask/obs-store",file:"/Users/mac/code/metamask-extension/node_modules/@metamask/obs-store/dist/index.js"}],[60,{"@babel/runtime/helpers/interopRequireDefault":190,events:1660},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events"));class o extends n.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort(((e,t)=>e.version-t.version));const r=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||r&&r.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter((function(t){return t.version>e.meta.version}));for(const r of t)try{const t=await r.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==r.version)throw new Error("Migrator - Migration did not update version number correctly");e=t}catch(t){const s=t.message;return t.message=`MetaMask Migration Error #${r.version}: ${s}`,this.emit("error",t),e}return e}generateInitialState(e){return{meta:{version:this.defaultVersion},data:e}}}r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/migrator/index.js"}],[147,{"./002":80,"./003":81,"./004":82,"./005":83,"./006":84,"./007":85,"./008":86,"./009":87,"./010":88,"./011":89,"./012":90,"./013":91,"./014":92,"./015":93,"./016":94,"./017":95,"./018":96,"./019":97,"./020":98,"./021":99,"./022":100,"./023":101,"./024":102,"./025":103,"./026":104,"./027":105,"./028":106,"./029":107,"./030":108,"./031":109,"./032":110,"./033":111,"./034":112,"./035":113,"./036":114,"./037":115,"./038":116,"./039":117,"./040":118,"./041":119,"./042":120,"./043":121,"./044":122,"./045":123,"./046":124,"./047":125,"./048":126,"./049":127,"./050":128,"./051":129,"./052":130,"./053":131,"./054":132,"./055":133,"./056":134,"./057":135,"./058":136,"./059":137,"./060":138,"./061":139,"./062":140,"./063":141,"./064":142,"./065":143,"./066":144,"./067":145,"@babel/runtime/helpers/interopRequireDefault":190},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("./002")),o=s(e("./003")),a=s(e("./004")),i=s(e("./005")),c=s(e("./006")),l=s(e("./007")),u=s(e("./008")),d=s(e("./009")),h=s(e("./010")),p=s(e("./011")),f=s(e("./012")),g=s(e("./013")),m=s(e("./014")),y=s(e("./015")),v=s(e("./016")),w=s(e("./017")),b=s(e("./018")),k=s(e("./019")),S=s(e("./020")),P=s(e("./021")),C=s(e("./022")),T=s(e("./023")),_=s(e("./024")),M=s(e("./025")),A=s(e("./026")),E=s(e("./027")),O=s(e("./028")),x=s(e("./029")),I=s(e("./030")),j=s(e("./031")),D=s(e("./032")),N=s(e("./033")),R=s(e("./034")),U=s(e("./035")),L=s(e("./036")),F=s(e("./037")),B=s(e("./038")),K=s(e("./039")),G=s(e("./040")),H=s(e("./041")),q=s(e("./042")),$=s(e("./043")),V=s(e("./044")),W=s(e("./045")),Y=s(e("./046")),z=s(e("./047")),Q=s(e("./048")),J=s(e("./049")),X=s(e("./050")),Z=s(e("./051")),ee=s(e("./052")),te=s(e("./053")),re=s(e("./054")),se=s(e("./055")),ne=s(e("./056")),oe=s(e("./057")),ae=s(e("./058")),ie=s(e("./059")),ce=s(e("./060")),le=s(e("./061")),ue=s(e("./062")),de=s(e("./063")),he=s(e("./064")),pe=s(e("./065")),fe=s(e("./066")),ge=s(e("./067"));var me=[n.default,o.default,a.default,i.default,c.default,l.default,u.default,d.default,h.default,p.default,f.default,g.default,m.default,y.default,v.default,w.default,b.default,k.default,S.default,P.default,C.default,T.default,_.default,M.default,A.default,E.default,O.default,x.default,I.default,j.default,D.default,N.default,R.default,U.default,L.default,F.default,B.default,K.default,G.default,H.default,q.default,$.default,V.default,W.default,Y.default,z.default,Q.default,J.default,X.default,Z.default,ee.default,te.default,re.default,se.default,ne.default,oe.default,ae.default,ie.default,ce.default,le.default,ue.default,de.default,he.default,pe.default,fe.default,ge.default];r.default=me}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/index.js"}],[53,{"../../../../shared/constants/time":3976,"../../../../shared/modules/fetch-with-timeout":3981,"./resolver":52,"@babel/runtime/helpers/interopRequireDefault":190,"base32-encode":1522,"base64-js":1525,extensionizer:2143},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:r}){const s=d.map((e=>`*://*.${e}/*`));return a.default.webRequest.onErrorOccurred.addListener(i,{urls:s,types:["main_frame"]}),{remove(){a.default.webRequest.onErrorOccurred.removeListener(i)}};async function i(s){const{tabId:i,url:c}=s;if(-1===i||"0x1"!==t())return;const{hostname:h,pathname:p,search:f,hash:g}=new URL(c),m=h.split("."),y=m[m.length-1];d.includes(y)&&async function({tabId:t,name:s,pathname:i,search:c,fragment:d}){const h=r();a.default.tabs.update(t,{url:"loading.html"});let p=`https://app.ens.domains/name/${s}`;try{const{type:r,hash:f}=await(0,l.default)({provider:e,name:s});if("ipfs-ns"===r||"ipns-ns"===r){const e=`https://${f}.${r.slice(0,4)}.${h}${i}${c||""}${d||""}`;try{200===(await u(e,{method:"HEAD"})).status&&(p=e)}catch(e){console.warn(e)}}else if("swarm-ns"===r)p=`https://swarm-gateways.net/bzz:/${f}${i}${c||""}${d||""}`;else if("onion"===r||"onion3"===r)p=`http://${f}.onion${i}${c||""}${d||""}`;else if("zeronet"===r)p=`http://127.0.0.1:43110/${f}${i}${c||""}${d||""}`;else if("skynet-ns"===r){const e=f.padEnd(f.length+4-f.length%4,"="),t=o.default.toByteArray(e),r={padding:!1};p=`https://${(0,n.default)(t,"RFC4648-HEX",r).toLowerCase()}.siasky.net${i}${c||""}${d||""}`}}catch(e){console.warn(e)}finally{a.default.tabs.update(t,{url:p})}}({tabId:i,name:h,pathname:p,search:f,fragment:g})}};var n=s(e("base32-encode")),o=s(e("base64-js")),a=s(e("extensionizer")),i=e("../../../../shared/constants/time"),c=s(e("../../../../shared/modules/fetch-with-timeout")),l=s(e("./resolver"));const u=(0,c.default)(30*i.SECOND),d=["eth"]}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/ens-ipfs/setup.js"}],[79,{"../../shared/constants/app":3968,"../../shared/constants/hardware-wallets":3970,"../../shared/constants/network":3973,"../../shared/constants/swaps":3975,"../../shared/constants/time":3976,"../../shared/constants/transaction":3977,"../../shared/modules/hexstring-utils":3983,"../../shared/notifications":3989,"../../ui/helpers/utils/conversions.util":4436,"../../ui/helpers/utils/is-mobile-view":4443,"./account-import-strategies":2,"./controllers/alert":6,"./controllers/app-state":7,"./controllers/cached-balances":8,"./controllers/detect-tokens":9,"./controllers/ens":11,"./controllers/incoming-transactions":12,"./controllers/metametrics":13,"./controllers/mises":14,"./controllers/network":18,"./controllers/onboarding":22,"./controllers/permissions":24,"./controllers/permissions/enums":23,"./controllers/permissions/restrictedMethods":27,"./controllers/preferences":28,"./controllers/swaps":29,"./controllers/threebox":30,"./controllers/transactions":31,"./lib/ComposableObservableStore":38,"./lib/account-tracker":39,"./lib/createLoggerMiddleware":42,"./lib/createMetaRPCHandler":43,"./lib/createOnboardingMiddleware":44,"./lib/createOriginMiddleware":45,"./lib/createTabIdMiddleware":47,"./lib/decrypt-message-manager":48,"./lib/encryption-public-key-manager":49,"./lib/message-manager":58,"./lib/nodeify":62,"./lib/personal-message-manager":64,"./lib/rpc-method-middleware":72,"./lib/seed-phrase-verifier":73,"./lib/segment":74,"./lib/stream-utils":76,"./lib/typed-message-manager":77,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@keystonehq/metamask-airgapped-keyring":569,"@metamask/controllers":1032,"@metamask/eth-ledger-bridge-keyring":1071,"@metamask/obs-store":1119,"@metamask/obs-store/dist/asStream":1118,"@sentry/browser":1147,"await-semaphore":1352,buffer:1659,"eth-json-rpc-filters":1942,"eth-json-rpc-filters/subscriptionManager":1948,"eth-json-rpc-middleware":1966,"eth-keyring-controller":1998,"eth-lattice-keyring":1999,"eth-query":2006,"eth-rpc-errors":2010,"eth-trezor-keyring":2028,"ethereumjs-util":2077,events:1660,"json-rpc-engine":2580,"json-rpc-middleware-stream/engineStream":2582,lodash:2948,loglevel:2959,nanoid:3024,pump:3303},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.METAMASK_CONTROLLER_EVENTS=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=s(e("events")),a=s(e("pump")),i=e("@metamask/obs-store"),c=e("@metamask/obs-store/dist/asStream"),l=e("json-rpc-engine"),u=e("lodash"),d=s(e("json-rpc-middleware-stream/engineStream")),h=s(e("eth-json-rpc-filters")),p=s(e("eth-json-rpc-filters/subscriptionManager")),f=e("eth-json-rpc-middleware"),g=s(e("eth-keyring-controller")),m=e("await-semaphore"),y=e("ethereumjs-util"),v=s(e("loglevel")),w=s(e("eth-trezor-keyring")),b=s(e("@metamask/eth-ledger-bridge-keyring")),k=s(e("eth-lattice-keyring")),S=e("@keystonehq/metamask-airgapped-keyring"),P=s(e("eth-query")),C=s(e("nanoid")),T=e("eth-rpc-errors"),_=e("@sentry/browser"),M=e("@metamask/controllers"),A=e("../../shared/constants/transaction"),E=e("../../shared/constants/swaps"),O=e("../../shared/constants/network"),x=e("../../shared/constants/hardware-wallets"),I=e("../../shared/notifications"),j=e("../../shared/modules/hexstring-utils"),D=e("../../shared/constants/time"),N=e("../../shared/constants/app"),R=e("../../ui/helpers/utils/conversions.util"),U=e("../../ui/helpers/utils/is-mobile-view"),L=s(e("./lib/ComposableObservableStore")),F=s(e("./lib/account-tracker")),B=s(e("./lib/createLoggerMiddleware")),K=s(e("./lib/rpc-method-middleware")),G=s(e("./lib/createOriginMiddleware")),H=s(e("./lib/createTabIdMiddleware")),q=s(e("./lib/createOnboardingMiddleware")),$=e("./lib/stream-utils"),V=s(e("./controllers/ens")),W=be(e("./controllers/network")),Y=s(e("./controllers/preferences")),z=s(e("./controllers/app-state")),Q=s(e("./controllers/cached-balances")),J=s(e("./controllers/alert")),X=s(e("./controllers/onboarding")),Z=s(e("./controllers/threebox")),ee=s(e("./controllers/incoming-transactions")),te=be(e("./lib/message-manager")),re=s(e("./lib/decrypt-message-manager")),se=s(e("./lib/encryption-public-key-manager")),ne=s(e("./lib/personal-message-manager")),oe=s(e("./lib/typed-message-manager")),ae=s(e("./controllers/transactions")),ie=s(e("./controllers/detect-tokens")),ce=s(e("./controllers/swaps")),le=e("./controllers/permissions"),ue=e("./controllers/permissions/enums"),de=s(e("./controllers/permissions/restrictedMethods")),he=s(e("./lib/nodeify")),pe=s(e("./account-import-strategies")),fe=s(e("./lib/seed-phrase-verifier")),ge=s(e("./controllers/metametrics")),me=e("./lib/segment"),ye=s(e("./lib/createMetaRPCHandler")),ve=s(e("./controllers/mises"));function we(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(we=function(e){return e?r:t})(e)}function be(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=we(t);if(r&&r.has(e))return r.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(s,o,a):s[o]=e[o]}return s.default=e,r&&r.set(e,s),s}function ke(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ke(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.METAMASK_CONTROLLER_EVENTS={UPDATE_BADGE:"updateBadge",APPROVAL_STATE_CHANGE:"ApprovalController:stateChange"};class Pe extends o.default{constructor(e){var t;super(),this.defaultMaxListeners=20,this.sendUpdate=(0,u.debounce)(this.privateSendUpdate.bind(this),200*D.MILLISECOND),this.opts=e,this.extension=e.extension,this.platform=e.platform;const r=e.initState||{},s=this.platform.getVersion();this.recordFirstTimeInfo(r),this.activeControllerConnections=0,this.getRequestAccountTabIds=e.getRequestAccountTabIds,this.getOpenMetamaskTabsIds=e.getOpenMetamaskTabsIds,this.controllerMessenger=new M.ControllerMessenger,this.store=new L.default({state:r,controllerMessenger:this.controllerMessenger,persist:!0}),this.connections={},this.createVaultMutex=new m.Mutex,this.extension.runtime.onInstalled.addListener((e=>{"update"!==e.reason||"8.1.0"!==s||(0,U.isMobile)()||this.platform.openExtensionInBrowser()})),this.approvalController=new M.ApprovalController({messenger:this.controllerMessenger.getRestricted({name:"ApprovalController"}),showApprovalRequest:e.showUserConfirmation}),this.networkController=new W.default(r.NetworkController),this.networkController.setInfuraProjectId(e.infuraProjectId),this.initializeProvider(),this.provider=this.networkController.getProviderAndBlockTracker().provider,this.blockTracker=this.networkController.getProviderAndBlockTracker().blockTracker,this.preferencesController=new Y.default({initState:r.PreferencesController,initLangCode:e.initLangCode,openPopup:e.openPopup,network:this.networkController,provider:this.provider,migrateAddressBookState:this.migrateAddressBookState.bind(this)}),this.tokensController=new M.TokensController({onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),config:{provider:this.provider},state:r.TokensController}),this.assetsContractController=new M.AssetsContractController,this.collectiblesController=new M.CollectiblesController({onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),getAssetName:this.assetsContractController.getAssetName.bind(this.assetsContractController),getAssetSymbol:this.assetsContractController.getAssetSymbol.bind(this.assetsContractController),getCollectibleTokenURI:this.assetsContractController.getCollectibleTokenURI.bind(this.assetsContractController),getOwnerOf:this.assetsContractController.getOwnerOf.bind(this.assetsContractController),balanceOfERC1155Collectible:this.assetsContractController.balanceOfERC1155Collectible.bind(this.assetsContractController),uriERC1155Collectible:this.assetsContractController.uriERC1155Collectible.bind(this.assetsContractController)}),this.metaMetricsController=new ge.default({segment:me.segment,preferencesStore:this.preferencesController.store,onNetworkDidChange:this.networkController.on.bind(this.networkController,W.NETWORK_EVENTS.NETWORK_DID_CHANGE),getNetworkIdentifier:this.networkController.getNetworkIdentifier.bind(this.networkController),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),version:this.platform.getVersion(),environment:"other",initState:r.MetaMetricsController,captureException:_.captureException});const n=this.controllerMessenger.getRestricted({name:"GasFeeController"}),o=E.GAS_API_BASE_URL;this.gasFeeController=new M.GasFeeController({interval:1e4,messenger:n,clientId:E.SWAPS_CLIENT_ID,getProvider:()=>this.networkController.getProviderAndBlockTracker().provider,onNetworkStateChange:this.networkController.on.bind(this.networkController,W.NETWORK_EVENTS.NETWORK_DID_CHANGE),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),legacyAPIEndpoint:`${o}/networks/<chain_id>/gasPrices`,EIP1559APIEndpoint:`${o}/networks/<chain_id>/suggestedGasFees`,getCurrentNetworkLegacyGasAPICompatibility:()=>this.networkController.getCurrentChainId()===O.MAINNET_CHAIN_ID,getChainId:()=>this.networkController.getCurrentChainId()}),this.qrHardwareKeyring=new S.MetaMaskKeyring,this.appStateController=new z.default({addUnlockListener:this.on.bind(this,"unlock"),isUnlocked:this.isUnlocked.bind(this),initState:r.AppStateController,onInactiveTimeout:()=>this.setLocked(),showUnlockRequest:e.showUserConfirmation,preferencesStore:this.preferencesController.store,qrHardwareStore:this.qrHardwareKeyring.getMemStore()});const a=this.controllerMessenger.getRestricted({name:"CurrencyRateController"});this.currencyRateController=new M.CurrencyRateController({includeUSDRate:!0,messenger:a,state:r.CurrencyController});const i=this.controllerMessenger.getRestricted({name:"TokenListController"});this.tokenListController=new M.TokenListController({chainId:(0,R.hexToDecimal)(this.networkController.getCurrentChainId()),useStaticTokenList:!this.preferencesController.store.getState().useTokenDetection,onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r=Se(Se({},t),{},{provider:Se(Se({},t.provider),{},{chainId:(0,R.hexToDecimal)(t.provider.chainId)})});return e(r)})),onPreferencesStateChange:e=>this.preferencesController.store.subscribe((t=>{const r=Se(Se({},t),{},{useStaticTokenList:!this.preferencesController.store.getState().useTokenDetection});return e(r)})),messenger:i,state:r.TokenListController}),this.phishingController=new M.PhishingController,this.notificationController=new M.NotificationController({allNotifications:I.UI_NOTIFICATIONS},r.NotificationController),this.tokenRatesController=new M.TokenRatesController({onTokensStateChange:e=>this.tokensController.subscribe(e),onCurrencyRateStateChange:e=>this.controllerMessenger.subscribe(`${this.currencyRateController.name}:stateChange`,e),onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r=Se(Se({},t),{},{provider:Se(Se({},t.provider),{},{chainId:(0,R.hexToDecimal)(t.provider.chainId)})});return e(r)}))}),this.ensController=new V.default({provider:this.provider,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),onNetworkDidChange:this.networkController.on.bind(this.networkController,W.NETWORK_EVENTS.NETWORK_DID_CHANGE)}),this.incomingTransactionsController=new ee.default({blockTracker:this.blockTracker,onNetworkDidChange:this.networkController.on.bind(this.networkController,W.NETWORK_EVENTS.NETWORK_DID_CHANGE),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),preferencesController:this.preferencesController,initState:r.IncomingTransactionsController}),this.accountTracker=new F.default({provider:this.provider,blockTracker:this.blockTracker,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController)}),this.on("controllerConnectionChanged",(e=>{e>0?(this.accountTracker.start(),this.incomingTransactionsController.start(),this.currencyRateController.start(),this.tokenListController.start()):(this.accountTracker.stop(),this.incomingTransactionsController.stop(),this.currencyRateController.stop(),this.tokenListController.stop())})),this.cachedBalancesController=new Q.default({accountTracker:this.accountTracker,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),initState:r.CachedBalancesController}),this.onboardingController=new X.default({initState:r.OnboardingController}),this.tokensController.hub.on("pendingSuggestedAsset",(async()=>{await e.openPopup()}));const c=[w.default,b.default,k.default,S.MetaMaskKeyring];this.keyringController=new g.default({keyringTypes:c,initState:r.KeyringController,encryptor:e.encryptor||undefined}),this.keyringController.memStore.subscribe((e=>this._onKeyringControllerUpdate(e))),this.keyringController.on("unlock",(()=>this._onUnlock())),this.keyringController.on("lock",(()=>this._onLock())),this.misesController=new ve.default({exportAccount:this.keyringController.exportAccount.bind(this.keyringController),getKeyringAccounts:this.keyringController.getAccounts.bind(this.keyringController)}),this.permissionsController=new le.PermissionsController({approvals:this.approvalController,getKeyringAccounts:this.keyringController.getAccounts.bind(this.keyringController),getRestrictedMethods:de.default,getUnlockPromise:this.appStateController.getUnlockPromise.bind(this.appStateController),isUnlocked:this.isUnlocked.bind(this),notifyDomain:this.notifyConnections.bind(this),notifyAllDomains:this.notifyAllConnections.bind(this),preferences:this.preferencesController.store,setInfo:this.misesController.setUserInfo.bind(this.misesController),setUnFollow:this.misesController.setUnFollow.bind(this.misesController),setFollow:this.misesController.setFollow.bind(this.misesController),getActive:this.misesController.getActive.bind(this.misesController),generateAuth:this.misesController.generateAuth.bind(this.misesController),exportAccount:this.keyringController.exportAccount.bind(this.keyringController),restorePage:this.restorePage.bind(this),connect:this.misesController.connect.bind(this.misesController),disconnect:this.misesController.disconnect.bind(this.misesController),addressToMisesId:this.misesController.addressToMisesId.bind(this.misesController),getAccountFlag:this.misesController.getAccountFlag.bind(this.misesController)},r.PermissionsController,r.PermissionsMetadata),this.detectTokensController=new ie.default({preferences:this.preferencesController,tokensController:this.tokensController,network:this.networkController,keyringMemStore:this.keyringController.memStore,tokenList:this.tokenListController}),this.addressBookController=new M.AddressBookController(undefined,r.AddressBookController),this.alertController=new J.default({initState:r.AlertController,preferencesStore:this.preferencesController.store}),this.threeBoxController=new Z.default({preferencesController:this.preferencesController,addressBookController:this.addressBookController,keyringController:this.keyringController,initState:r.ThreeBoxController,getKeyringControllerState:this.keyringController.memStore.getState.bind(this.keyringController.memStore),version:s,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.txController=new ae.default({initState:r.TransactionController||r.TransactionManager,getPermittedAccounts:this.permissionsController.getAccounts.bind(this.permissionsController),getProviderConfig:this.networkController.getProviderConfig.bind(this.networkController),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),networkStore:this.networkController.networkStore,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),preferencesStore:this.preferencesController.store,txHistoryLimit:40,signTransaction:this.keyringController.signTransaction.bind(this.keyringController),provider:this.provider,blockTracker:this.blockTracker,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getParticipateInMetrics:()=>this.metaMetricsController.state.participateInMetaMetrics,getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController)}),this.txController.on("newUnapprovedTx",(()=>e.showUserConfirmation())),this.txController.on("tx:status-update",(async(e,t)=>{if(t===A.TRANSACTION_STATUSES.CONFIRMED||t===A.TRANSACTION_STATUSES.FAILED){const t=this.txController.txStateManager.getTransaction(e),n=this.preferencesController.getFrequentRpcListDetail();let o={};if(t.chainId){var r;const e=n.find((e=>t.chainId===e.chainId));o=null!==(r=null==e?void 0:e.rpcPrefs)&&void 0!==r?r:{}}this.platform.showTransactionNotification(t,o);const{txReceipt:a}=t,i=await this.getState();var s;if(a&&"0x0"===a.status)this.metaMetricsController.trackEvent({event:"Tx Status Update: On-Chain Failure",category:"Background",properties:{action:"Transactions",errorMessage:null===(s=t.simulationFails)||void 0===s?void 0:s.reason,numberOfTokens:i.tokens.length,numberOfAccounts:Object.keys(i.accounts).length}},{matomoEvent:!0})}})),this.networkController.on(W.NETWORK_EVENTS.NETWORK_DID_CHANGE,(async()=>{const{ticker:e}=this.networkController.getProviderConfig();try{console.log(e),await this.currencyRateController.setNativeCurrency(e)}catch(e){console.error(e)}})),this.networkController.lookupNetwork(),this.messageManager=new te.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.personalMessageManager=new ne.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.decryptMessageManager=new re.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.encryptionPublicKeyManager=new se.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.typedMessageManager=new oe.default({getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.swapsController=new ce.default({getBufferedGasLimit:this.txController.txGasUtil.getBufferedGasLimit.bind(this.txController.txGasUtil),networkController:this.networkController,provider:this.provider,getProviderConfig:this.networkController.getProviderConfig.bind(this.networkController),getTokenRatesState:()=>this.tokenRatesController.state,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController)}),this.networkController.on(W.NETWORK_EVENTS.NETWORK_DID_CHANGE,(()=>{this.accountTracker._updateAccounts()})),this.networkController.on(W.NETWORK_EVENTS.NETWORK_WILL_CHANGE,(()=>{this.txController.txStateManager.clearUnapprovedTxs(),this.encryptionPublicKeyManager.clearUnapproved(),this.personalMessageManager.clearUnapproved(),this.typedMessageManager.clearUnapproved(),this.decryptMessageManager.clearUnapproved(),this.messageManager.clearUnapproved()})),this.on("update",(e=>this._onStateUpdate(e))),this.store.updateStructure({AppStateController:this.appStateController.store,TransactionController:this.txController.store,KeyringController:this.keyringController.store,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,NetworkController:this.networkController.store,CachedBalancesController:this.cachedBalancesController.store,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,IncomingTransactionsController:this.incomingTransactionsController.store,PermissionsController:this.permissionsController.permissions,PermissionsMetadata:this.permissionsController.store,ThreeBoxController:this.threeBoxController.store,NotificationController:this.notificationController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,MisesController:this.misesController.store,CollectiblesController:this.collectiblesController}),this.memStore=new L.default({config:{AppStateController:this.appStateController.store,NetworkController:this.networkController.store,AccountTracker:this.accountTracker.store,TxController:this.txController.memStore,CachedBalancesController:this.cachedBalancesController.store,TokenRatesController:this.tokenRatesController,MessageManager:this.messageManager.memStore,PersonalMessageManager:this.personalMessageManager.memStore,DecryptMessageManager:this.decryptMessageManager.memStore,EncryptionPublicKeyManager:this.encryptionPublicKeyManager.memStore,TypesMessageManager:this.typedMessageManager.memStore,KeyringController:this.keyringController.memStore,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,IncomingTransactionsController:this.incomingTransactionsController.store,PermissionsController:this.permissionsController.permissions,PermissionsMetadata:this.permissionsController.store,ThreeBoxController:this.threeBoxController.store,SwapsController:this.swapsController.store,MisesController:this.misesController.store,EnsController:this.ensController.store,ApprovalController:this.approvalController,NotificationController:this.notificationController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,CollectiblesController:this.collectiblesController},controllerMessenger:this.controllerMessenger}),this.memStore.subscribe(this.sendUpdate.bind(this));const l=null===(t={})||void 0===t?void 0:t.PASSWORD;l&&!this.isUnlocked()&&this.onboardingController.store.getState().completedOnboarding&&this.submitPassword(l),this.extension.runtime.getPlatformInfo((({os:e})=>{this.appStateController.setBrowserEnvironment(e,this.extension.runtime.getBrowserInfo===undefined?"chrome":"firefox")})),this.publicConfigStore=this.createPublicConfigStore()}initializeProvider(){const e=this.platform.getVersion(),t={static:{eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`},version:e,getAccounts:async({origin:e})=>{if("metamask"===e){const e=this.preferencesController.getSelectedAddress();return e?[e]:[]}return this.isUnlocked()?await this.permissionsController.getAccounts(e):[]},processTransaction:this.newUnapprovedTransaction.bind(this),processEthSignMessage:this.newUnsignedMessage.bind(this),processTypedMessage:this.newUnsignedTypedMessage.bind(this),processTypedMessageV3:this.newUnsignedTypedMessage.bind(this),processTypedMessageV4:this.newUnsignedTypedMessage.bind(this),processPersonalMessage:this.newUnsignedPersonalMessage.bind(this),processDecryptMessage:this.newRequestDecryptMessage.bind(this),processEncryptionPublicKey:this.newRequestEncryptionPublicKey.bind(this),getPendingNonce:this.getPendingNonce.bind(this),getPendingTransactionByHash:e=>this.txController.getTransactions({searchCriteria:{hash:e,status:A.TRANSACTION_STATUSES.SUBMITTED}})[0]};return this.networkController.initializeProvider(t)}createPublicConfigStore(){const e=new i.ObservableStore,{networkController:t}=this;function r(r){const s=t.getCurrentChainId();"loading"!==r.network&&e.putState(function(e,{isUnlocked:t,network:r}){return{isUnlocked:t,chainId:e,networkVersion:r}}(s,r))}return this.on("update",r),r(this.getState()),e}async getProviderState(e){return Se(Se({isUnlocked:this.isUnlocked()},this.getProviderNetworkState()),{},{accounts:await this.permissionsController.getAccounts(e)})}getProviderNetworkState(e){const{network:t}=e||this.getState();return{chainId:this.networkController.getCurrentChainId(),networkVersion:t}}getState(){const{vault:e}=this.keyringController.store.getState();return Se({isInitialized:Boolean(e)},this.memStore.getFlatState())}getApi(){const{alertController:e,approvalController:t,keyringController:r,metaMetricsController:s,networkController:n,onboardingController:o,permissionsController:a,preferencesController:i,swapsController:c,threeBoxController:l,txController:u,tokensController:d,collectiblesController:h}=this;return{getState:e=>e(null,this.getState()),setCurrentCurrency:(0,he.default)(this.currencyRateController.setCurrentCurrency.bind(this.currencyRateController)),setUseBlockie:this.setUseBlockie.bind(this),setUseNonceField:this.setUseNonceField.bind(this),setUsePhishDetect:this.setUsePhishDetect.bind(this),setUseTokenDetection:(0,he.default)(this.preferencesController.setUseTokenDetection,this.preferencesController),setIpfsGateway:this.setIpfsGateway.bind(this),setParticipateInMetaMetrics:this.setParticipateInMetaMetrics.bind(this),setCurrentLocale:this.setCurrentLocale.bind(this),markPasswordForgotten:this.markPasswordForgotten.bind(this),unMarkPasswordForgotten:this.unMarkPasswordForgotten.bind(this),safelistPhishingDomain:this.safelistPhishingDomain.bind(this),getRequestAccountTabIds:e=>e(null,this.getRequestAccountTabIds()),getOpenMetamaskTabsIds:e=>e(null,this.getOpenMetamaskTabsIds()),addNewAccount:(0,he.default)(this.addNewAccount,this),verifySeedPhrase:(0,he.default)(this.verifySeedPhrase,this),resetAccount:(0,he.default)(this.resetAccount,this),removeAccount:(0,he.default)(this.removeAccount,this),importAccountWithStrategy:(0,he.default)(this.importAccountWithStrategy,this),connectHardware:(0,he.default)(this.connectHardware,this),forgetDevice:(0,he.default)(this.forgetDevice,this),checkHardwareStatus:(0,he.default)(this.checkHardwareStatus,this),unlockHardwareWalletAccount:(0,he.default)(this.unlockHardwareWalletAccount,this),setLedgerTransportPreference:(0,he.default)(this.setLedgerTransportPreference,this),attemptLedgerTransportCreation:(0,he.default)(this.attemptLedgerTransportCreation,this),establishLedgerTransportPreference:(0,he.default)(this.establishLedgerTransportPreference,this),submitQRHardwareCryptoHDKey:(0,he.default)(this.qrHardwareKeyring.submitCryptoHDKey,this.qrHardwareKeyring),submitQRHardwareCryptoAccount:(0,he.default)(this.qrHardwareKeyring.submitCryptoAccount,this.qrHardwareKeyring),cancelSyncQRHardware:(0,he.default)(this.qrHardwareKeyring.cancelSync,this.qrHardwareKeyring),submitQRHardwareSignature:(0,he.default)(this.qrHardwareKeyring.submitSignature,this.qrHardwareKeyring),cancelQRHardwareSignRequest:(0,he.default)(this.qrHardwareKeyring.cancelSignRequest,this.qrHardwareKeyring),fetchInfoToSync:(0,he.default)(this.fetchInfoToSync,this),submitPassword:(0,he.default)(this.submitPassword,this),verifyPassword:(0,he.default)(this.verifyPassword,this),setProviderType:(0,he.default)(n.setProviderType,n),rollbackToPreviousProvider:(0,he.default)(n.rollbackToPreviousProvider,n),setCustomRpc:(0,he.default)(this.setCustomRpc,this),updateAndSetCustomRpc:(0,he.default)(this.updateAndSetCustomRpc,this),delCustomRpc:(0,he.default)(this.delCustomRpc,this),addToken:(0,he.default)(d.addToken,d),rejectWatchAsset:(0,he.default)(d.rejectWatchAsset,d),acceptWatchAsset:(0,he.default)(d.acceptWatchAsset,d),updateTokenType:(0,he.default)(d.updateTokenType,d),removeToken:(0,he.default)(d.removeAndIgnoreToken,d),setAccountLabel:(0,he.default)(i.setAccountLabel,i),setFeatureFlag:(0,he.default)(i.setFeatureFlag,i),setPreference:(0,he.default)(i.setPreference,i),addKnownMethodData:(0,he.default)(i.addKnownMethodData,i),setDismissSeedBackUpReminder:(0,he.default)(this.preferencesController.setDismissSeedBackUpReminder,this.preferencesController),setAdvancedGasFee:(0,he.default)(i.setAdvancedGasFee,i),addCollectible:(0,he.default)(h.addCollectible,h),removeAndIgnoreCollectible:(0,he.default)(h.removeAndIgnoreCollectible,h),removeCollectible:(0,he.default)(h.removeCollectible,h),setAddressBook:(0,he.default)(this.addressBookController.set,this.addressBookController),removeFromAddressBook:(0,he.default)(this.addressBookController.delete,this.addressBookController),setLastActiveTime:(0,he.default)(this.appStateController.setLastActiveTime,this.appStateController),setDefaultHomeActiveTabName:(0,he.default)(this.appStateController.setDefaultHomeActiveTabName,this.appStateController),setConnectedStatusPopoverHasBeenShown:(0,he.default)(this.appStateController.setConnectedStatusPopoverHasBeenShown,this.appStateController),setRecoveryPhraseReminderHasBeenShown:(0,he.default)(this.appStateController.setRecoveryPhraseReminderHasBeenShown,this.appStateController),setRecoveryPhraseReminderLastShown:(0,he.default)(this.appStateController.setRecoveryPhraseReminderLastShown,this.appStateController),setShowTestnetMessageInDropdown:(0,he.default)(this.appStateController.setShowTestnetMessageInDropdown,this.appStateController),tryReverseResolveAddress:(0,he.default)(this.ensController.reverseResolveAddress,this.ensController),setLocked:(0,he.default)(this.setLocked,this),createNewVaultAndKeychain:(0,he.default)(this.createNewVaultAndKeychain,this),createNewVaultAndRestore:(0,he.default)(this.createNewVaultAndRestore,this),exportAccount:(0,he.default)(r.exportAccount,r),setSelectedAddress:(0,he.default)(this.setSelectedAddress,this),setMisesUser:(0,he.default)(this.setMisesUser,this),lockAll:(0,he.default)(this.lockAll,this),initMisesBalance:(0,he.default)(this.initMisesBalance,this),setMisesBook:(0,he.default)(this.setMisesBook,this),recentTransactions:(0,he.default)(this.recentTransactions,this),getMisesUser:(0,he.default)(this.getMisesUser,this),addressToMisesId:(0,he.default)(this.addressToMisesId,this),resetTranstionFlag:(0,he.default)(this.resetTranstionFlag,this),cancelTransaction:(0,he.default)(u.cancelTransaction,u),updateTransaction:(0,he.default)(u.updateTransaction,u),updateAndApproveTransaction:(0,he.default)(u.updateAndApproveTransaction,u),createCancelTransaction:(0,he.default)(this.createCancelTransaction,this),createSpeedUpTransaction:(0,he.default)(this.createSpeedUpTransaction,this),estimateGas:(0,he.default)(this.estimateGas,this),getNextNonce:(0,he.default)(this.getNextNonce,this),addUnapprovedTransaction:(0,he.default)(u.addUnapprovedTransaction,u),signMessage:(0,he.default)(this.signMessage,this),cancelMessage:this.cancelMessage.bind(this),signPersonalMessage:(0,he.default)(this.signPersonalMessage,this),cancelPersonalMessage:this.cancelPersonalMessage.bind(this),signTypedMessage:(0,he.default)(this.signTypedMessage,this),cancelTypedMessage:this.cancelTypedMessage.bind(this),decryptMessage:(0,he.default)(this.decryptMessage,this),decryptMessageInline:(0,he.default)(this.decryptMessageInline,this),cancelDecryptMessage:this.cancelDecryptMessage.bind(this),encryptionPublicKey:(0,he.default)(this.encryptionPublicKey,this),cancelEncryptionPublicKey:this.cancelEncryptionPublicKey.bind(this),setSeedPhraseBackedUp:(0,he.default)(o.setSeedPhraseBackedUp,o),completeOnboarding:(0,he.default)(o.completeOnboarding,o),setFirstTimeFlowType:(0,he.default)(o.setFirstTimeFlowType,o),setAlertEnabledness:(0,he.default)(e.setAlertEnabledness,e),setUnconnectedAccountAlertShown:(0,he.default)(e.setUnconnectedAccountAlertShown,e),setWeb3ShimUsageAlertDismissed:(0,he.default)(e.setWeb3ShimUsageAlertDismissed,e),setThreeBoxSyncingPermission:(0,he.default)(l.setThreeBoxSyncingPermission,l),restoreFromThreeBox:(0,he.default)(l.restoreFromThreeBox,l),setShowRestorePromptToFalse:(0,he.default)(l.setShowRestorePromptToFalse,l),getThreeBoxLastUpdated:(0,he.default)(l.getLastUpdated,l),turnThreeBoxSyncingOn:(0,he.default)(l.turnThreeBoxSyncingOn,l),initializeThreeBox:(0,he.default)(this.initializeThreeBox,this),approvePermissionsRequest:(0,he.default)(a.approvePermissionsRequest,a),rejectPermissionsRequest:(0,he.default)(a.rejectPermissionsRequest,a),removePermissionsFor:a.removePermissionsFor.bind(a),addPermittedAccount:(0,he.default)(a.addPermittedAccount,a),removePermittedAccount:(0,he.default)(a.removePermittedAccount,a),requestAccountsPermissionWithId:(0,he.default)(a.requestAccountsPermissionWithId,a),fetchAndSetQuotes:(0,he.default)(c.fetchAndSetQuotes,c),setSelectedQuoteAggId:(0,he.default)(c.setSelectedQuoteAggId,c),resetSwapsState:(0,he.default)(c.resetSwapsState,c),setSwapsTokens:(0,he.default)(c.setSwapsTokens,c),clearSwapsQuotes:(0,he.default)(c.clearSwapsQuotes,c),setApproveTxId:(0,he.default)(c.setApproveTxId,c),setTradeTxId:(0,he.default)(c.setTradeTxId,c),setSwapsTxGasPrice:(0,he.default)(c.setSwapsTxGasPrice,c),setSwapsTxGasLimit:(0,he.default)(c.setSwapsTxGasLimit,c),setSwapsTxMaxFeePerGas:(0,he.default)(c.setSwapsTxMaxFeePerGas,c),setSwapsTxMaxFeePriorityPerGas:(0,he.default)(c.setSwapsTxMaxFeePriorityPerGas,c),safeRefetchQuotes:(0,he.default)(c.safeRefetchQuotes,c),stopPollingForQuotes:(0,he.default)(c.stopPollingForQuotes,c),setBackgroundSwapRouteState:(0,he.default)(c.setBackgroundSwapRouteState,c),resetPostFetchState:(0,he.default)(c.resetPostFetchState,c),setSwapsErrorKey:(0,he.default)(c.setSwapsErrorKey,c),setInitialGasEstimate:(0,he.default)(c.setInitialGasEstimate,c),setCustomApproveTxData:(0,he.default)(c.setCustomApproveTxData,c),setSwapsLiveness:(0,he.default)(c.setSwapsLiveness,c),setSwapsUserFeeLevel:(0,he.default)(c.setSwapsUserFeeLevel,c),setSwapsQuotesPollingLimitEnabled:(0,he.default)(c.setSwapsQuotesPollingLimitEnabled,c),trackMetaMetricsEvent:(0,he.default)(s.trackEvent,s),trackMetaMetricsPage:(0,he.default)(s.trackPage,s),resolvePendingApproval:(0,he.default)(t.accept,t),rejectPendingApproval:(0,he.default)(t.reject,t),updateViewedNotifications:(0,he.default)(this.notificationController.updateViewed,this.notificationController),getGasFeeEstimatesAndStartPolling:(0,he.default)(this.gasFeeController.getGasFeeEstimatesAndStartPolling,this.gasFeeController),disconnectGasFeeEstimatePoller:(0,he.default)(this.gasFeeController.disconnectPoller,this.gasFeeController),getGasFeeTimeEstimate:(0,he.default)(this.gasFeeController.getTimeEstimate,this.gasFeeController),addPollingTokenToAppState:(0,he.default)(this.appStateController.addPollingToken,this.appStateController),removePollingTokenFromAppState:(0,he.default)(this.appStateController.removePollingToken,this.appStateController),detectNewTokens:(0,he.default)(this.detectTokensController.detectNewTokens,this.detectTokensController),detectCollectibles:null}}async createNewVaultAndKeychain(e){const t=await this.createVaultMutex.acquire();try{let r;if((await this.keyringController.getAccounts()).length>0)r=await this.keyringController.fullUpdate();else{r=await this.keyringController.createNewVaultAndKeychain(e);const t=await this.keyringController.getAccounts();this.preferencesController.setAddresses(t),this.selectFirstIdentity()}return this.lockAll(),r}finally{t()}}async createNewVaultAndRestore(e,t){const r=await this.createVaultMutex.acquire();try{let s,n;const{keyringController:o}=this;this.preferencesController.setAddresses([]),this.permissionsController.clearPermissions(),this.accountTracker.clearAccounts(),this.cachedBalancesController.clearCachedBalances(),this.txController.txStateManager.clearUnapprovedTxs(),this.lockAll();const a=await o.createNewVaultAndRestore(e,t),i=new P.default(this.provider);s=await o.getAccounts(),n=await this.getBalance(s[s.length-1],i);const c=o.getKeyringsByType("HD Key Tree")[0];if(!c)throw new Error("MetamaskController - No HD Key Tree found");for(;"0x0"!==n;)await o.addNewAccount(c),s=await o.getAccounts(),n=await this.getBalance(s[s.length-1],i);s.length>1&&"0x0"===n&&(await this.removeAccount(s[s.length-1]),s=await o.getAccounts());const l=this.preferencesController.getLedgerTransportPreference();return this.setLedgerTransportPreference(l),this.preferencesController.setAddresses(s),this.selectFirstIdentity(),a}finally{r()}}getBalance(e,t){return new Promise(((r,s)=>{const n=this.accountTracker.store.getState().accounts[e];n&&n.balance?r(n.balance):t.getBalance(e,((e,t)=>{e?(s(e),v.default.error(e)):r(t||"0x0")}))}))}async fetchInfoToSync(){const{currentLocale:e,frequentRpcList:t,identities:r,selectedAddress:s,useTokenDetection:n}=this.preferencesController.store.getState(),{tokenList:o}=this.tokenListController.state,a={currentLocale:e,frequentRpcList:t,identities:r,selectedAddress:s},{allTokens:i,allIgnoredTokens:c}=this.tokensController.state,l={};Object.keys(i).forEach((e=>{l[e]={},Object.keys(i[e]).forEach((t=>{const r=(0,j.toChecksumHexAddress)(t);l[e][r]=i[e][r].filter((e=>{if(e.isERC721===undefined){const t=n?e.address.toLowerCase():e.address;if(o[t]!==undefined)return!0}else if(!1===e.isERC721)return!0;return!1}))}))}));const u=this.keyringController.getKeyringsByType("HD Key Tree")[0],d=this.keyringController.getKeyringsByType("Simple Key Pair"),h=await u.getAccounts(),p=(await Promise.all(d.map((e=>e.getAccounts())))).reduce(((e,t)=>[...e,...t]),[]),f={hd:h.filter(((e,t)=>h.indexOf(e)===t)).map((e=>(0,j.toChecksumHexAddress)(e))),simpleKeyPair:p.filter(((e,t)=>p.indexOf(e)===t)).map((e=>(0,j.toChecksumHexAddress)(e))),ledger:[],trezor:[],lattice:[]};let{transactions:g}=this.txController.store.getState();return g=Object.values(g).filter((e=>{const t=(0,j.toChecksumHexAddress)(e.txParams.from);return f.hd.includes(t)})),{accounts:f,preferences:a,transactions:g,tokens:{allTokens:l,allIgnoredTokens:c},network:this.networkController.store.getState()}}async submitPassword(e){await this.keyringController.submitPassword(e);try{await this.blockTracker.checkForLatestBlock()}catch(e){v.default.error("Error while unlocking extension.",e)}try{const e=this.threeBoxController.getThreeBoxSyncingState();e&&!this.threeBoxController.box?(this.threeBoxController.init(),this.threeBoxController.turnThreeBoxSyncingOn()):e&&this.threeBoxController.box&&this.threeBoxController.turnThreeBoxSyncingOn()}catch(e){v.default.error("Error while unlocking extension.",e)}const t=this.preferencesController.getLedgerTransportPreference();return this.setLedgerTransportPreference(t),this.keyringController.fullUpdate()}async verifyPassword(e){await this.keyringController.verifyPassword(e)}selectFirstIdentity(){const{identities:e}=this.preferencesController.store.getState(),t=Object.keys(e)[0];this.setSelectedAddress(t)}getFirstIdentity(){const{identities:e}=this.preferencesController.store.getState();return Object.keys(e)[0]}async getKeyringForDevice(e,t=null){let r=null;switch(e){case x.DEVICE_NAMES.TREZOR:r=w.default.type;break;case x.DEVICE_NAMES.LEDGER:r=b.default.type;break;case x.DEVICE_NAMES.QR:r=S.MetaMaskKeyring.type;break;case x.DEVICE_NAMES.LATTICE:r=k.default.type;break;default:throw new Error("MetamaskController:getKeyringForDevice - Unknown device")}let s=await this.keyringController.getKeyringsByType(r)[0];return s||(s=await this.keyringController.addNewKeyring(r)),t&&s.setHdPath&&s.setHdPath(t),e===x.DEVICE_NAMES.LATTICE&&(s.appName="MetaMask"),s.network=this.networkController.getProviderConfig().type,s}async attemptLedgerTransportCreation(){const e=await this.getKeyringForDevice("ledger");return await e.attemptMakeApp()}async establishLedgerTransportPreference(){const e=this.preferencesController.getLedgerTransportPreference();return await this.setLedgerTransportPreference(e)}async connectHardware(e,t,r){const s=await this.getKeyringForDevice(e,r);let n=[];switch(t){case-1:n=await s.getPreviousPage();break;case 1:n=await s.getNextPage();break;default:n=await s.getFirstPage()}const o=await this.keyringController.getAccounts(),a=[...new Set(o.concat(n.map((e=>e.address.toLowerCase()))))];return this.accountTracker.syncWithAddresses(a),n}async checkHardwareStatus(e,t){return(await this.getKeyringForDevice(e,t)).isUnlocked()}async forgetDevice(e){return(await this.getKeyringForDevice(e)).forgetDevice(),!0}getAccountLabel(e,t,r){return`${e[0].toUpperCase()}${e.slice(1)} ${parseInt(t,10)+1} ${r||""}`.trim()}async unlockHardwareWalletAccount(e,t,r,s){const n=await this.getKeyringForDevice(t,r);n.setAccountToUnlock(e);const o=await this.keyringController.getAccounts(),a=await this.keyringController.addNewAccount(n),i=await this.keyringController.getAccounts();this.preferencesController.setAddresses(i),i.forEach((r=>{if(!o.includes(r)){const o=this.getAccountLabel(t===x.DEVICE_NAMES.QR?n.getName():t,e,s);this.preferencesController.setAccountLabel(r,o),this.setSelectedAddress(r)}}));const{identities:c}=this.preferencesController.store.getState();return Se(Se({},a),{},{identities:c})}async addNewAccount(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e)throw new Error("MetamaskController - No HD Key Tree found");const{keyringController:t}=this,r=await t.getAccounts(),s=await t.addNewAccount(e),n=await t.getAccounts();await this.verifySeedPhrase(),this.preferencesController.setAddresses(n),n.forEach((e=>{r.includes(e)||this.setSelectedAddress(e)}));const{identities:o}=this.preferencesController.store.getState();return Se(Se({},s),{},{identities:o})}async verifySeedPhrase(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e)throw new Error("MetamaskController - No HD Key Tree found");const t=(await e.serialize()).mnemonic,r=await e.getAccounts();if(r.length<1)throw new Error("MetamaskController - No accounts found");try{return await fe.default.verifyAccounts(r,t),t}catch(e){throw v.default.error(e.message),e}}async resetAccount(){const e=this.preferencesController.getSelectedAddress();return this.txController.wipeTransactions(e),this.networkController.resetConnection(),e}async removeAccount(e){return await this.permissionsController.removeAllAccountPermissions(e),this.preferencesController.removeAddress(e),this.accountTracker.removeAccount([e]),await this.keyringController.removeAccount(e),e}async importAccountWithStrategy(e,t){const r=await pe.default.importAccount(e,t),s=await this.keyringController.addNewKeyring("Simple Key Pair",[r]),n=await s.getAccounts(),o=await this.keyringController.getAccounts();this.preferencesController.setAddresses(o),await this.setSelectedAddress(n[0])}async newUnapprovedTransaction(e,t){return await this.txController.newUnapprovedTransaction(e,t)}async newUnsignedMessage(e,t){const r=(0,te.normalizeMsgData)(e.data);let s;if(66!==r.length&&67!==r.length)throw T.ethErrors.rpc.invalidParams("eth_sign requires 32 byte message hash");return s=this.messageManager.addUnapprovedMessageAsync(e,t),this.sendUpdate(),this.opts.showUserConfirmation(),await s}async signMessage(e){v.default.info("MetaMaskController - signMessage");const t=e.metamaskId;try{const r=await this.messageManager.approveMessage(e),s=await this.keyringController.signMessage(r);return this.messageManager.setMsgStatusSigned(t,s),this.getState()}catch(e){throw v.default.info("MetaMaskController - eth_sign failed",e),this.messageManager.errorMessage(t,e),e}}cancelMessage(e,t){const{messageManager:r}=this;r.rejectMsg(e),t&&"function"==typeof t&&t(null,this.getState())}async newUnsignedPersonalMessage(e,t){const r=this.personalMessageManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}async signPersonalMessage(e){v.default.info("MetaMaskController - signPersonalMessage");const t=e.metamaskId;try{const r=await this.personalMessageManager.approveMessage(e),s=await this.keyringController.signPersonalMessage(r);return this.personalMessageManager.setMsgStatusSigned(t,s),this.getState()}catch(e){throw v.default.info("MetaMaskController - eth_personalSign failed",e),this.personalMessageManager.errorMessage(t,e),e}}cancelPersonalMessage(e,t){this.personalMessageManager.rejectMsg(e),t&&"function"==typeof t&&t(null,this.getState())}async newRequestDecryptMessage(e,t){const r=this.decryptMessageManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}async decryptMessageInline(e){v.default.info("MetaMaskController - decryptMessageInline");const r=e.metamaskId,s=this.decryptMessageManager.getMsg(r);try{const r=(0,y.stripHexPrefix)(e.data),n=t.from(r,"hex");e.data=JSON.parse(n.toString("utf8")),s.rawData=await this.keyringController.decryptMessage(e)}catch(e){s.error=e.message}return this.decryptMessageManager._updateMsg(s),this.getState()}async decryptMessage(e){v.default.info("MetaMaskController - decryptMessage");const r=e.metamaskId;try{const s=await this.decryptMessageManager.approveMessage(e),n=(0,y.stripHexPrefix)(s.data),o=t.from(n,"hex");s.data=JSON.parse(o.toString("utf8"));const a=await this.keyringController.decryptMessage(s);this.decryptMessageManager.setMsgStatusDecrypted(r,a)}catch(e){v.default.info("MetaMaskController - eth_decrypt failed.",e),this.decryptMessageManager.errorMessage(r,e)}return this.getState()}cancelDecryptMessage(e,t){this.decryptMessageManager.rejectMsg(e),t&&"function"==typeof t&&t(null,this.getState())}async newRequestEncryptionPublicKey(e,t){const r=e;switch((await this.keyringController.getKeyringForAccount(r)).type){case x.KEYRING_TYPES.LEDGER:return new Promise(((e,t)=>{t(new Error("Ledger does not support eth_getEncryptionPublicKey."))}));case x.KEYRING_TYPES.TREZOR:return new Promise(((e,t)=>{t(new Error("Trezor does not support eth_getEncryptionPublicKey."))}));case x.KEYRING_TYPES.LATTICE:return new Promise(((e,t)=>{t(new Error("Lattice does not support eth_getEncryptionPublicKey."))}));case x.KEYRING_TYPES.QR:return Promise.reject(new Error("QR hardware does not support eth_getEncryptionPublicKey."));default:{const r=this.encryptionPublicKeyManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}}}async tryUnlockMetamask(e){v.default.info("MetaMaskController - encryptionPublicKey");const t=e.metamaskId;try{const r=await this.encryptionPublicKeyManager.approveMessage(e),s=await this.keyringController.getEncryptionPublicKey(r.data);this.encryptionPublicKeyManager.setMsgStatusReceived(t,s)}catch(e){v.default.info("MetaMaskController - eth_getEncryptionPublicKey failed.",e),this.encryptionPublicKeyManager.errorMessage(t,e)}return this.getState()}cancelEncryptionPublicKey(e,t){this.encryptionPublicKeyManager.rejectMsg(e),t&&"function"==typeof t&&t(null,this.getState())}newUnsignedTypedMessage(e,t,r){const s=this.typedMessageManager.addUnapprovedMessageAsync(e,t,r);return this.sendUpdate(),this.opts.showUserConfirmation(),s}async signTypedMessage(e){v.default.info("MetaMaskController - eth_signTypedData");const t=e.metamaskId,{version:r}=e;try{const s=await this.typedMessageManager.approveMessage(e);"V1"!==r&&"string"==typeof s.data&&(s.data=JSON.parse(s.data));const n=await this.keyringController.signTypedMessage(s,{version:r});return this.typedMessageManager.setMsgStatusSigned(t,n),this.getState()}catch(e){throw v.default.info("MetaMaskController - eth_signTypedData failed.",e),this.typedMessageManager.errorMessage(t,e),e}}cancelTypedMessage(e,t){this.typedMessageManager.rejectMsg(e),t&&"function"==typeof t&&t(null,this.getState())}async getCurrentAccountEIP1559Compatibility(e){const t=e||this.preferencesController.getSelectedAddress();return(await this.keyringController.getKeyringForAccount(t)).type!==x.KEYRING_TYPES.TREZOR}async createCancelTransaction(e,t,r){await this.txController.createCancelTransaction(e,t,r);return await this.getState()}async createSpeedUpTransaction(e,t,r){await this.txController.createSpeedUpTransaction(e,t,r);return await this.getState()}estimateGas(e){return new Promise(((t,r)=>this.txController.txGasUtil.query.estimateGas(e,((e,s)=>e?r(e):t(s.toString(16))))))}markPasswordForgotten(e){this.preferencesController.setPasswordForgotten(!0),this.sendUpdate(),e()}unMarkPasswordForgotten(e){this.preferencesController.setPasswordForgotten(!1),this.sendUpdate(),e()}setupUntrustedCommunication(e,t){const{usePhishDetect:r}=this.preferencesController.store.getState(),{hostname:s}=new URL(t.url);if(r&&this.phishingController.test(s))return v.default.debug("MetaMask - sending phishing warning for",s),void this.sendPhishingWarning(e,s);const n=(0,$.setupMultiplex)(e);this.setupProviderConnection(n.createStream("metamask-provider"),t),this.setupPublicConfig(n.createStream("publicConfig"))}setupTrustedCommunication(e,t){const r=(0,$.setupMultiplex)(e);this.setupControllerConnection(r.createStream("controller")),this.setupProviderConnection(r.createStream("provider"),t,!0)}sendPhishingWarning(e,t){(0,$.setupMultiplex)(e).createStream("phishing").write({hostname:t})}setupControllerConnection(e){const t=this.getApi();this.activeControllerConnections+=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),e.on("data",(0,ye.default)(t,e));const r=t=>{e._writableState.ended||e.write({jsonrpc:"2.0",method:"sendUpdate",params:[t]})};this.on("update",r),e.on("end",(()=>{this.activeControllerConnections-=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),this.removeListener("update",r)}))}setupProviderConnection(e,t,r){const s=r?"metamask":new URL(t.url).origin;let n,o;t.id!==this.extension.runtime.id&&(n=t.id),t.tab&&t.tab.id&&(o=t.tab.id);const i=this.setupProviderEngine({origin:s,location:t.url,extensionId:n,tabId:o,isInternal:r}),c=(0,d.default)({engine:i}),l=this.addConnection(s,{engine:i});(0,a.default)(e,c,e,(e=>{i._middleware.forEach((e=>{e.destroy&&"function"==typeof e.destroy&&e.destroy()})),l&&this.removeConnection(s,l),e&&v.default.error(e)}))}setupProviderEngine({origin:e,location:t,extensionId:r,tabId:s,isInternal:n=!1}){const o=new l.JsonRpcEngine,{provider:a,blockTracker:i}=this,c=(0,h.default)({provider:a,blockTracker:i}),u=(0,p.default)({provider:a,blockTracker:i});return u.events.on("notification",(e=>o.emit("notification",e))),o.push((0,G.default)({origin:e})),s&&o.push((0,H.default)({tabId:s})),o.push((0,B.default)({origin:e})),o.push((0,q.default)({location:t,registerOnboarding:this.onboardingController.registerOnboarding})),o.push((0,K.default)({origin:e,getProviderState:this.getProviderState.bind(this),sendMetrics:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),handleWatchAssetRequest:this.tokensController.watchAsset.bind(this.tokensController),getWeb3ShimUsageState:this.alertController.getWeb3ShimUsageState.bind(this.alertController),setWeb3ShimUsageRecorded:this.alertController.setWeb3ShimUsageRecorded.bind(this.alertController),findCustomRpcBy:this.findCustomRpcBy.bind(this),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),requestUserApproval:this.approvalController.addAndShowApprovalRequest.bind(this.approvalController),updateRpcTarget:({rpcUrl:e,chainId:t,ticker:r,nickname:s})=>{this.networkController.setRpcTarget(e,t,r,s)},setProviderType:this.networkController.setProviderType.bind(this.networkController),addCustomRpc:async({chainId:e,blockExplorerUrl:t,ticker:r,chainName:s,rpcUrl:n}={})=>{await this.preferencesController.addToFrequentRpcList(n,e,r,s,{blockExplorerUrl:t})}})),o.push(c),o.push(u.middleware),n||o.push(this.permissionsController.createMiddleware({origin:e,extensionId:r})),o.push((0,f.providerAsMiddleware)(a)),o}setupPublicConfig(e){const t=(0,c.storeAsStream)(this.publicConfigStore);(0,a.default)(t,e,(e=>{t.destroy(),e&&v.default.error(e)}))}addConnection(e,{engine:t}){if("metamask"===e)return null;this.connections[e]||(this.connections[e]={});const r=(0,C.default)();return this.connections[e][r]={engine:t},r}removeConnection(e,t){const r=this.connections[e];r&&(delete r[t],0===Object.keys(r).length&&delete this.connections[e])}notifyConnections(e,t){const r=this.connections[e];r&&Object.values(r).forEach((e=>{e.engine&&e.engine.emit("notification",t)}))}notifyAllConnections(e){const t="function"==typeof e?t=>e(t):()=>e;Object.keys(this.connections).forEach((e=>{Object.values(this.connections[e]).forEach((async r=>{r.engine&&r.engine.emit("notification",await t(e))}))}))}async _onKeyringControllerUpdate(e){const{keyrings:t}=e,r=t.reduce(((e,{accounts:t})=>e.concat(t)),[]);r.length&&(this.preferencesController.syncAddresses(r),this.accountTracker.syncWithAddresses(r))}_onUnlock(){this.notifyAllConnections((async e=>({method:ue.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!0,accounts:await this.permissionsController.getAccounts(e)}}))),this.emit("unlock")}_onLock(){this.notifyAllConnections({method:ue.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!1}}),this.emit("lock")}_onStateUpdate(e){this.isClientOpenAndUnlocked=e.isUnlocked&&this._isClientOpen,this.notifyAllConnections({method:ue.NOTIFICATION_NAMES.chainChanged,params:this.getProviderNetworkState(e)})}privateSendUpdate(){this.emit("update",this.getState())}isUnlocked(){return this.keyringController.memStore.getState().isUnlocked}async getPendingNonce(e){const{nonceDetails:t,releaseLock:r}=await this.txController.nonceTracker.getNonceLock(e),s=t.params.highestSuggested;return r(),s}async getNextNonce(e){const t=await this.txController.nonceTracker.getNonceLock(e);return t.releaseLock(),t.nextNonce}async migrateAddressBookState(e,t,r=!1){const{addressBook:s}=this.addressBookController.state;if(s[e])for(const n of Object.keys(s[e])){const o=s[e][n];this.addressBookController.set(n,o.name,t,o.memo),r||this.addressBookController.delete(e,n)}}async updateAndSetCustomRpc(e,t,r="ETH",s,n){return this.networkController.setRpcTarget(e,t,r,s,n),await this.preferencesController.updateRpc({rpcUrl:e,chainId:t,ticker:r,nickname:s,rpcPrefs:n}),e}async setCustomRpc(e,t,r="ETH",s="",n={}){const o=this.preferencesController.getFrequentRpcListDetail().find((t=>e===t.rpcUrl));return o?this.networkController.setRpcTarget(o.rpcUrl,o.chainId,o.ticker,o.nickname,n):(this.networkController.setRpcTarget(e,t,r,s,n),await this.preferencesController.addToFrequentRpcList(e,t,r,s,n)),e}async delCustomRpc(e){await this.preferencesController.removeFromFrequentRpcList(e)}findCustomRpcBy(e){const t=this.preferencesController.getFrequentRpcListDetail();for(const r of t)for(const t of Object.keys(e))if(r[t]===e[t])return r;return null}async initializeThreeBox(){await this.threeBoxController.init()}setUseBlockie(e,t){try{return this.preferencesController.setUseBlockie(e),void t(null)}catch(e){return void t(e)}}setUseNonceField(e,t){try{return this.preferencesController.setUseNonceField(e),void t(null)}catch(e){return void t(e)}}setUsePhishDetect(e,t){try{return this.preferencesController.setUsePhishDetect(e),void t(null)}catch(e){return void t(e)}}setIpfsGateway(e,t){try{return this.preferencesController.setIpfsGateway(e),void t(null)}catch(e){return void t(e)}}async setLedgerTransportPreference(e){const t=this.preferencesController.getLedgerTransportPreference(),r=this.preferencesController.setLedgerTransportPreference(e),s=await this.getKeyringForDevice("ledger");return null!=s&&s.updateTransportMethod?s.updateTransportMethod(r).catch((e=>{throw this.preferencesController.setLedgerTransportPreference(t),e})):undefined}setParticipateInMetaMetrics(e,t){try{return void t(null,this.metaMetricsController.setParticipateInMetaMetrics(e))}catch(e){return void t(e)}}setCurrentLocale(e,t){try{return void t(null,this.preferencesController.setCurrentLocale(e))}catch(e){return void t(e)}}recordFirstTimeInfo(e){if(!("firstTimeInfo"in e)){const t=this.platform.getVersion();e.firstTimeInfo={version:t,date:Date.now()}}}set isClientOpen(e){this._isClientOpen=e,this.detectTokensController.isOpen=e}onClientClosed(){try{this.gasFeeController.stopPolling(),this.appStateController.clearPollingTokens()}catch(e){console.error(e)}}onEnvironmentTypeClosed(e){const t=N.POLLING_TOKEN_ENVIRONMENT_TYPES[e];this.appStateController.store.getState()[t].forEach((e=>{this.gasFeeController.disconnectPoller(e),this.appStateController.removePollingToken(e,t)}))}safelistPhishingDomain(e){return this.phishingController.bypass(e)}setLocked(){return this.keyringController.setLocked()}async importAccount(e){return this.misesController.importAccount(e)}async setSelectedAddress(e){await this.preferencesController.setSelectedAddress(e),this.setMisesUser(e),console.log("切换了用户")}async setMisesUser(e){console.log("设置用户");try{const t=await this.keyringController.exportAccount(e);await this.misesController.activate(t);const r=await this.misesController.getMisesUserInfo(e);return await this.misesController.setToMisesPrivate(r),Promise.resolve()}catch(e){return console.log(e,"设置用户信息失败"),Promise.reject(e)}}lockAll(){this.misesController.lockAll()}restorePage(){this.opts.restoreAccount()}initMisesBalance(){return this.misesController.initMisesBalance()}setMisesBook(e,t){return this.misesController.setMisesBook(e,t)}getMisesUser(e){return this.misesController.getMisesUser(e)}addressToMisesId(e){return this.misesController.addressToMisesId(e)}resetTranstionFlag(){return this.misesController.resetTranstionFlag()}recentTransactions(){return this.misesController.recentTransactions()}}r.default=Pe}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/metamask-controller.js"}],[1826,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var s,n,o,a,i;function c(){var l=Date.now()-a;l<t&&l>=0?s=setTimeout(c,t-l):(s=null,r||(i=e.apply(o,n),o=n=null))}null==t&&(t=100);var l=function(){o=this,n=arguments,a=Date.now();var l=r&&!s;return s||(s=setTimeout(c,t)),l&&(i=e.apply(o,n),o=n=null),i};return l.clear=function(){s&&(clearTimeout(s),s=null)},l.flush=function(){s&&(i=e.apply(o,n),o=n=null,clearTimeout(s),s=null)},l}}}},{package:"debounce",file:"/Users/mac/code/metamask-extension/node_modules/debounce/index.js"}],[3734,{_process:3204,stream:3698},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var s=e("stream");function n(e,t,n){e=e||function(e){this.queue(e)},t=t||function(){this.queue(null)};var o=!1,a=!1,i=[],c=!1,l=new s;function u(){for(;i.length&&!l.paused;){var e=i.shift();if(null===e)return l.emit("end");l.emit("data",e)}}function d(){l.writable=!1,t.call(l),!l.readable&&l.autoDestroy&&l.destroy()}return l.readable=l.writable=!0,l.paused=!1,l.autoDestroy=!(n&&!1===n.autoDestroy),l.write=function(t){return e.call(this,t),!l.paused},l.queue=l.push=function(e){return c||(null===e&&(c=!0),i.push(e),u()),l},l.on("end",(function(){l.readable=!1,!l.writable&&l.autoDestroy&&r.nextTick((function(){l.destroy()}))})),l.end=function(e){if(!o)return o=!0,arguments.length&&l.write(e),d(),l},l.destroy=function(){if(!a)return a=!0,o=!0,i.length=0,l.writable=l.readable=!1,l.emit("close"),l},l.pause=function(){if(!l.paused)return l.paused=!0,l},l.resume=function(){return l.paused&&(l.paused=!1,l.emit("resume")),u(),l.paused||l.emit("drain"),l},l}t.exports=n,n.through=n}).call(this)}).call(this,e("_process"))}}},{package:"through",file:"/Users/mac/code/metamask-extension/node_modules/through/index.js"}],[1885,{stream:3698},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("stream"),n=["write","end","destroy"],o=["resume","pause"],a=["data","close"],i=Array.prototype.slice;function c(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r)}t.exports=function(e,t){var r=new s,l=!1;return c(n,(function(t){function s(){return e[t].apply(e,arguments)}r[t]=s})),c(o,(function(e){function s(){r.emit(e);var s=t[e];if(s)return s.apply(t,arguments);t.emit(e)}r[e]=s})),c(a,(function(e){function s(){var t=i.call(arguments);t.unshift(e),r.emit.apply(r,t)}t.on(e,s)})),t.on("end",(function(){if(l)return;l=!0;var e=i.call(arguments);e.unshift("end"),r.emit.apply(r,e)})),e.on("drain",(function(){r.emit("drain")})),e.on("error",u),t.on("error",u),r.writable=e.writable,r.readable=t.readable,r;function u(e){r.emit("error",e)}}}}},{package:"duplexer",file:"/Users/mac/code/metamask-extension/node_modules/duplexer/index.js"}],[1118,{stream:3698},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeAsStream=void 0;const s=e("stream");class n extends s.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const r=super.pipe(e,t);return e.write(this.obsStore.getState()),r}_write(e,t,r){this.obsStore.putState(e),r()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}r.storeAsStream=function(e){return new n(e)}}}},{package:"@metamask/obs-store",file:"/Users/mac/code/metamask-extension/node_modules/@metamask/obs-store/dist/asStream.js"}],[1116,{"./ObservableStore":1117},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MergedStore=void 0;const s=e("./ObservableStore");class n extends s.ObservableStore{constructor(e=[]){super();this.getState()||this.putState({}),this._children=e,e.forEach((e=>this._addChild(e))),this._updateWholeState()}_addChild(e){e.subscribe((()=>this._updateWholeState()))}_updateWholeState(){const e=this._children.map((e=>e.getState())),t=Object.assign({},...e);this.putState(t)}}r.MergedStore=n}}},{package:"@metamask/obs-store",file:"/Users/mac/code/metamask-extension/node_modules/@metamask/obs-store/dist/MergedStore.js"}],[1114,{"./ObservableStore":1117},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ComposedStore=void 0;const s=e("./ObservableStore");class n extends s.ObservableStore{constructor(e){super();this.getState()||this.putState({}),this._children=e||{},Object.keys(this._children).forEach((e=>{const t=this._children[e];this._addChild(e,t)}))}_addChild(e,t){const r=t=>{const r=this.getState();r[e]=t,this.putState(r)};t.subscribe(r),r(t.getState())}}r.ComposedStore=n}}},{package:"@metamask/obs-store",file:"/Users/mac/code/metamask-extension/node_modules/@metamask/obs-store/dist/ComposedStore.js"}],[1115,{"./ObservableStore":1117},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LocalStorageStore=void 0;const s=e("./ObservableStore");class n extends s.ObservableStore{constructor(e={}){if(!global.localStorage)throw new Error("LocalStorageStore - can't find localStorage.");if(super(),!e.storageKey)throw new Error("LocalStorageStore - no storageKey specified.");this._storageKey=e.storageKey}_getState(){const e=global.localStorage.getItem(this._storageKey);return e?JSON.parse(e):undefined}_putState(e){const t=JSON.stringify(e);return global.localStorage.setItem(this._storageKey,t)}}r.LocalStorageStore=n}}},{package:"@metamask/obs-store",file:"/Users/mac/code/metamask-extension/node_modules/@metamask/obs-store/dist/LocalStorageStore.js"}],[1117,{"@metamask/safe-event-emitter":1122},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ObservableStore=void 0;const n=s(e("@metamask/safe-event-emitter"));class o extends n.default{constructor(e={}){super(),this._state=e}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState(),r=Object.assign({},t,e);this.putState(r)}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}r.ObservableStore=o}}},{package:"@metamask/obs-store",file:"/Users/mac/code/metamask-extension/node_modules/@metamask/obs-store/dist/ObservableStore.js"}],[1120,{through2:1121},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeTransformStream=void 0;const s=e("through2");r.storeTransformStream=function(e){return s.obj(((t,r,s)=>{try{return s(null,e(t)),undefined}catch(e){return s(e),undefined}}))}}}},{package:"@metamask/obs-store",file:"/Users/mac/code/metamask-extension/node_modules/@metamask/obs-store/dist/transform.js"}],[82,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:4,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=4;try{if("rpc"!==t.data.config.provider.type)return Promise.resolve(t);switch(t.data.config.provider.rpcTarget){case"https://testrpc.metamask.io/":t.data.config.provider={type:"testnet"};break;case"https://rpc.metamask.io/":t.data.config.provider={type:"mainnet"}}}catch(e){}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/004.js"}],[81,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:3,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=3;try{"https://rawtestrpc.metamask.io/"===t.data.config.provider.rpcTarget&&(t.data.config.provider.rpcTarget="https://testrpc.metamask.io/")}catch(e){}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/003.js"}],[87,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:9,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=9;try{const e=function(e){const t=(0,s.merge)({},e,{CurrencyController:{currentCurrency:e.currentFiat||e.fiatCurrency||"USD",conversionRate:e.conversionRate,conversionDate:e.conversionDate}});return delete t.currentFiat,delete t.fiatCurrency,delete t.conversionRate,delete t.conversionDate,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #9${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/009.js"}],[89,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:11,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=11;try{const e=function(e){const t=e;return delete t.TOSHash,delete t.isDisclaimerConfirmed,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #11${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/011.js"}],[88,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:10,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=10;try{const e=function(e){const t=(0,s.merge)({},e,{ShapeShiftController:{shapeShiftTxList:e.shapeShiftTxList||[]}});return delete t.shapeShiftTxList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #10${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/010.js"}],[92,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:14,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=14;try{const e=function(e){const t=e;return t.NetworkController={},t.NetworkController.provider=t.config.provider,delete t.config.provider,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #14${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/014.js"}],[90,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:12,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=12;try{const e=function(e){const t=e;return t.NoticeController.noticesList.forEach((e=>{e.read&&(e.body="")})),t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #12${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/012.js"}],[80,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:2,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=2;try{"etherscan"===t.data.config.provider.type&&(t.data.config.provider.type="rpc",t.data.config.provider.rpcTarget="https://rpc.metamask.io/")}catch(e){}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/002.js"}],[91,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:13,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=13;try{const e=function(e){const t=e,{config:r}=t;r&&r.provider&&"testnet"===r.provider.type&&(t.config.provider.type="ropsten");return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #13${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/013.js"}],[101,{"../../../shared/constants/transaction":3977,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var o={version:23,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=23;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;if(e.length<=40)return t;const r=e.reverse();let s=!0;for(;r.length>40&&s;){const e=r.findIndex((e=>e.status===n.TRANSACTION_STATUSES.FAILED||e.status===n.TRANSACTION_STATUSES.REJECTED||e.status===n.TRANSACTION_STATUSES.CONFIRMED||e.status===n.TRANSACTION_STATUSES.DROPPED));e<0?s=!1:r.splice(e,1)}t.TransactionController.transactions=r.reverse()}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #23${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/023.js"}],[100,{"../../../shared/constants/transaction":3977,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var o={version:22,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=22;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(e.status!==n.TRANSACTION_STATUSES.SUBMITTED||e.submittedTime||(e.submittedTime=(new Date).getTime()),e)))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #22${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/022.js"}],[102,{"../../../shared/constants/transaction":3977,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var o={version:24,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=24;const r=function(e){const t=e;if(!t.TransactionController)return t;const{transactions:r}=t.TransactionController;return t.TransactionController.transactions=r.map(((e,t)=>(e.status===n.TRANSACTION_STATUSES.UNAPPROVED&&e.txParams&&e.txParams.from&&(e.txParams.from=e.txParams.from.toLowerCase()),e))),t}(t.data);return t.data=r,t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/024.js"}],[106,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:28,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=28;const r=function(e){const t=e;if(t.PreferencesController&&t.PreferencesController.tokens&&t.PreferencesController.identities){const{identities:e,tokens:r}=t.PreferencesController;t.PreferencesController.accountTokens={},Object.keys(e).forEach((e=>{t.PreferencesController.accountTokens[e]={mainnet:r}})),t.PreferencesController.tokens=[]}return t}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/028.js"}],[95,{"../../../shared/constants/transaction":3977,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var o={version:17,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=17;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(!e.status===n.TRANSACTION_STATUSES.FAILED||e.retryCount>0&&e.retryCount<2&&(e.status=n.TRANSACTION_STATUSES.SUBMITTED,delete e.err),e)))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #17${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/017.js"}],[103,{"../../../shared/constants/transaction":3977,"../lib/util":78,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../lib/util"),o=e("../../../shared/constants/transaction");var a={version:25,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=25;const r=function(e){const t=e;if(t.TransactionController&&t.TransactionController.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(e.status!==o.TRANSACTION_STATUSES.UNAPPROVED||(e.txParams=function(e){const t={from:e=>(0,n.addHexPrefix)(e).toLowerCase(),to:()=>(0,n.addHexPrefix)(e.to).toLowerCase(),nonce:e=>(0,n.addHexPrefix)(e),value:e=>(0,n.addHexPrefix)(e),data:e=>(0,n.addHexPrefix)(e),gas:e=>(0,n.addHexPrefix)(e),gasPrice:e=>(0,n.addHexPrefix)(e)},r={};return Object.keys(t).forEach((s=>{e[s]&&(r[s]=t[s](e[s]))})),r}(e.txParams)),e)))}return t}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/025.js"}],[94,{"../../../shared/constants/transaction":3977,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var o={version:16,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=16;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>e.err?("transaction with the same hash was already imported."===e.err&&(e.status=n.TRANSACTION_STATUSES.SUBMITTED,delete e.err),e):e))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #16${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/016.js"}],[93,{"../../../shared/constants/transaction":3977,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var o={version:15,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=15;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=r;t.TransactionController.transactions=e.map((e=>e.err?("Gave up submitting tx."===e.err.message&&(e.status=n.TRANSACTION_STATUSES.FAILED),e):e))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #15${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/015.js"}],[105,{"../../../shared/constants/transaction":3977,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var o={version:27,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=27;const r=function(e){const t=e;if(t.TransactionController&&t.TransactionController.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.filter((e=>e.status!==n.TRANSACTION_STATUSES.REJECTED))}return t}(t.data);return t.data=r,t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/027.js"}],[108,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:30,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=30;const r=function(e){const t=e;if(e.PreferencesController){const{frequentRpcListDetail:e}=t.PreferencesController;e&&(e.forEach(((t,r)=>{Boolean(t.chainId)&&Number.isNaN(parseInt(t.chainId))&&delete e[r].chainId})),t.PreferencesController.frequentRpcListDetail=e)}e.NetworkController&&(t.NetworkController.network&&Number.isNaN(parseInt(t.NetworkController.network))&&delete t.NetworkController.network,t.NetworkController.provider&&t.NetworkController.provider.chainId&&Number.isNaN(parseInt(t.NetworkController.provider.chainId))&&delete t.NetworkController.provider.chainId);return t}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/030.js"}],[114,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:36,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=36;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.featureFlags||{};void 0!==e.privacyMode&&delete e.privacyMode}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/036.js"}],[98,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:20,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=20;try{const e=function(e){const t=e;"metamask"in t&&!("firstTimeInfo"in t.metamask)&&(t.metamask.firstTimeInfo={version:"3.12.0",date:Date.now()});return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #20${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/020.js"}],[120,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:42,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=42;const r=t.data;return t.data=function(e){e.AppStateController?e.AppStateController.connectedStatusPopoverHasBeenShown=!1:e.AppStateController={connectedStatusPopoverHasBeenShown:!1};return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/042.js"}],[97,{"../../../shared/constants/transaction":3977,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var o={version:19,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=19;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map(((e,t,r)=>{if(e.status!==n.TRANSACTION_STATUSES.SUBMITTED)return e;const s=function(e){const t=e.map((e=>{const{nonce:t}=e.txParams;return parseInt(t||"0x0",16)}));return Math.max.apply(null,t)}(r.filter((e=>e.status===n.TRANSACTION_STATUSES.CONFIRMED)).filter((t=>t.txParams.from===e.txParams.from)).filter((t=>t.metamaskNetworkId.from===e.metamaskNetworkId.from))),o=function(e,t){const r=e.map((e=>{const{nonce:t}=e.txParams;return parseInt(t,16)}));let s=t;for(;r.includes(s);)s+=1;return s}(r.filter((e=>e.status===n.TRANSACTION_STATUSES.SUBMITTED)).filter((t=>t.txParams.from===e.txParams.from)).filter((t=>t.metamaskNetworkId.from===e.metamaskNetworkId.from)),s),a=Math.max(o,s);return parseInt(e.txParams.nonce,16)>a+1&&(e.status=n.TRANSACTION_STATUSES.FAILED,e.err={message:"nonce too high",note:"migration 019 custom error"}),e}))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #19${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/019.js"}],[112,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:34,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=34;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.featureFlags||{};e.privacyMode||void 0!==t.migratedPrivacyMode||(t.migratedPrivacyMode=!0,e.privacyMode=!0)}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/034.js"}],[109,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:31,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=31;const r=function(e){const{KeyringController:t,PreferencesController:r}=e;if(t&&r){const{vault:e}=t;r.completedOnboarding=Boolean(e)}return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/031.js"}],[122,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:44,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=44;const r=t.data;return t.data=function(e){var t;void 0!==(null==e||null===(t=e.AppStateController)||void 0===t?void 0:t.mkrMigrationReminderTimestamp)&&delete e.AppStateController.mkrMigrationReminderTimestamp;return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/044.js"}],[110,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:32,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=32;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const{betaUI:e}=t.featureFlags||{};t.completedUiMigration=e}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/032.js"}],[119,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:41,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=41;const r=t.data;return t.data=function(e){e.PreferencesController&&e.PreferencesController.preferences&&(e.PreferencesController.preferences.autoLockTimeLimit=e.PreferencesController.preferences.autoLogoutTimeLimit,delete e.PreferencesController.preferences.autoLogoutTimeLimit);return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/041.js"}],[113,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:35,async migrate(e){const t=(0,s.cloneDeep)(e);return t.meta.version=35,t.data=function(e){e.PreferencesController&&e.PreferencesController.seedWords!==undefined&&delete e.PreferencesController.seedWords;return e}(t.data),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/035.js"}],[128,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");const n=["METASWAP_GAS_PRICE_ESTIMATES_LAST_RETRIEVED","METASWAP_GAS_PRICE_ESTIMATES","cachedFetch","BASIC_PRICE_ESTIMATES_LAST_RETRIEVED","BASIC_PRICE_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES"];var o={version:50,async migrate(e){const t=(0,s.cloneDeep)(e);return t.meta.version=50,n.forEach((e=>{var t;return null===(t=window.localStorage)||void 0===t?void 0:t.removeItem(e)})),t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/050.js"}],[129,{"../../../shared/constants/network":3973,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/network");var o={version:51,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=51;const r=t.data;return t.data=function(e){var t,r;const{chainId:s,type:o}=(null==e||null===(t=e.NetworkController)||void 0===t?void 0:t.provider)||{},a=null===(r=n.NETWORK_TYPE_TO_ID_MAP[o])||void 0===r?void 0:r.chainId;a&&s!==a&&(e.NetworkController.provider.chainId=a);return e}(r),t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/051.js"}],[125,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:47,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=47;const r=t.data;return t.data=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;Array.isArray(r)&&r.forEach((e=>{"number"==typeof e.metamaskNetworkId&&(e.metamaskNetworkId=e.metamaskNetworkId.toString())}));return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/047.js"}],[99,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:21,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=21;try{const e=function(e){const t=e;return delete t.BlacklistController,delete t.RecentBlocks,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #21${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/021.js"}],[111,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:33,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=33;const r=function(e){const t=e;e.NoticeController&&delete t.NoticeController;return t}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/033.js"}],[104,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:26,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=26;try{const e=t.data;t.data=function(e){if(!e.KeyringController||!e.PreferencesController)return e;if(!e.KeyringController.walletNicknames)return e;return e.PreferencesController.identities=Object.keys(e.KeyringController.walletNicknames).reduce(((t,r)=>(t[r]={name:e.KeyringController.walletNicknames[r],address:r},t)),{}),delete e.KeyringController.walletNicknames,e}(e)}catch(e){return console.warn(`MetaMask Migration #26${e.stack}`),Promise.reject(e)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/026.js"}],[123,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:45,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=45;const r=t.data;return t.data=function(e){var t;o.includes(null==e||null===(t=e.PreferencesController)||void 0===t?void 0:t.ipfsGateway)&&(e.PreferencesController.ipfsGateway="dweb.link");return e}(r),t}};r.default=n;const o=["ipfs.io","ipfs.dweb.link"]}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/045.js"}],[137,{"../../../shared/constants/transaction":3977,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var o={version:59,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=59;const r=t.data;return t.data=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,s.isPlainObject)(r)){const t=(0,s.groupBy)(Object.values(r),(e=>{var t,r;return`${null===(t=e.txParams)||void 0===t?void 0:t.nonce}-${null!==(r=e.chainId)&&void 0!==r?r:e.metamaskNetworkId}`})),o=(0,s.pickBy)(t,(e=>e.some((e=>e.type!==n.TRANSACTION_TYPES.CANCEL&&e.type!==n.TRANSACTION_TYPES.RETRY))));e.TransactionController.transactions=(0,s.keyBy)((0,s.concat)(...Object.values(o)),(e=>e.id))}return e}(r),t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/059.js"}],[133,{"../../../shared/constants/network":3973,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/network");var o={version:55,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=55;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.IncomingTransactionsController)&&void 0!==t&&t.incomingTxLastFetchedBlocksByNetwork&&(e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId=(0,s.mapKeys)(e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork,((e,t)=>{var r,s;return null!==(r=null===(s=n.NETWORK_TYPE_TO_ID_MAP[t])||void 0===s?void 0:s.chainId)&&void 0!==r?r:a})),delete e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId.UNKNOWN,delete e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork);return e}(r),t}};r.default=o;const a="UNKNOWN"}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/055.js"}],[136,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:58,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=58;const r=t.data;return t.data=function(e){var t;return null===(t=e.AppStateController)||void 0===t||delete t.swapsWelcomeMessageHasBeenShown,e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/058.js"}],[139,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:61,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=61;const r=function(e){const t=(new Date).getTime();e.AppStateController?(e.AppStateController.recoveryPhraseReminderHasBeenShown=!1,e.AppStateController.recoveryPhraseReminderLastShown=t):e.AppStateController={recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:t};return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/061.js"}],[134,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:56,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=56;const{PreferencesController:r}=t.data;return Array.isArray(null==r?void 0:r.tokens)&&(r.tokens=r.tokens.filter((({address:e})=>e))),null!=r&&r.accountTokens&&"object"==typeof r.accountTokens&&Object.keys(r.accountTokens).forEach((e=>{Object.keys(r.accountTokens[e]).forEach((t=>{r.accountTokens[e][t]=r.accountTokens[e][t].filter((({address:e})=>e))}))})),null!=r&&r.assetImages&&"undefined"in r.assetImages&&delete r.assetImages.undefined,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/056.js"}],[140,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:62,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=62;const r=function(e){if(e.MetaMetricsController){const{metaMetricsSendCount:t}=e.MetaMetricsController;t!==undefined&&delete e.MetaMetricsController.metaMetricsSendCount}return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/062.js"}],[132,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");function n(e){return"number"==typeof e||"string"==typeof e&&e.match(/^(0x)?\d+$/u)}var o={version:54,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=54;const r=function(e){const t=e;if(!t.PreferencesController)return t;const r=(t.PreferencesController.tokens||[]).filter((({decimals:e})=>n(e)));for(const e of r)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t.PreferencesController.tokens=r;const{accountTokens:s}=t.PreferencesController;if(s&&"object"==typeof s)for(const e of Object.keys(s)){const t=s[e];if(t&&"object"==typeof t)for(const e of Object.keys(t)){const r=(t[e]||[]).filter((({decimals:e})=>n(e)));for(const e of r)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t[e]=r}}return t.PreferencesController.accountTokens=s,t}(t.data);return t.data=r,t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/054.js"}],[121,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:43,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=43;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.PreferencesController)&&void 0!==t&&t.currentAccountTab&&delete e.PreferencesController.currentAccountTab;return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/043.js"}],[127,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:49,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=49;const r=t.data;return t.data=function(e={}){if(e.PreferencesController){var t;const{metaMetricsId:r,participateInMetaMetrics:s,metaMetricsSendCount:n}=e.PreferencesController;e.MetaMetricsController=null!==(t=e.MetaMetricsController)&&void 0!==t?t:{},r!==undefined&&(e.MetaMetricsController.metaMetricsId=r,delete e.PreferencesController.metaMetricsId),s!==undefined&&(e.MetaMetricsController.participateInMetaMetrics=s,delete e.PreferencesController.participateInMetaMetrics),n!==undefined&&(e.MetaMetricsController.metaMetricsSendCount=n,delete e.PreferencesController.metaMetricsSendCount)}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/049.js"}],[124,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:46,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=46;const r=t.data;return t.data=function(e){void 0!==(null==e?void 0:e.ABTestController)&&delete e.ABTestController;return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/046.js"}],[130,{"../../../shared/constants/network":3973,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/network");var o={version:52,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=52;const r=t.data;return t.data=function(e={}){if(e.PreferencesController){const{accountTokens:t,accountHiddenTokens:r,frequentRpcListDetail:s}=e.PreferencesController,o={},a={};if(t&&Object.keys(t).length>0){for(const e of Object.keys(t)){o[e]={},t[e][n.NETWORK_TYPE_RPC]&&s.forEach((r=>{o[e][r.chainId]=t[e][n.NETWORK_TYPE_RPC]}));for(const r of Object.keys(t[e]))switch(r){case n.MAINNET:o[e][n.MAINNET_CHAIN_ID]=t[e][n.MAINNET];break;case n.ROPSTEN:o[e][n.ROPSTEN_CHAIN_ID]=t[e][n.ROPSTEN];break;case n.RINKEBY:o[e][n.RINKEBY_CHAIN_ID]=t[e][n.RINKEBY];break;case n.GOERLI:o[e][n.GOERLI_CHAIN_ID]=t[e][n.GOERLI];break;case n.KOVAN:o[e][n.KOVAN_CHAIN_ID]=t[e][n.KOVAN]}}e.PreferencesController.accountTokens=o}if(r&&Object.keys(r).length>0){for(const e of Object.keys(r)){a[e]={},r[e][n.NETWORK_TYPE_RPC]&&s.forEach((t=>{a[e][t.chainId]=r[e][n.NETWORK_TYPE_RPC]}));for(const t of Object.keys(r[e]))switch(t){case n.MAINNET:a[e][n.MAINNET_CHAIN_ID]=r[e][n.MAINNET];break;case n.ROPSTEN:a[e][n.ROPSTEN_CHAIN_ID]=r[e][n.ROPSTEN];break;case n.RINKEBY:a[e][n.RINKEBY_CHAIN_ID]=r[e][n.RINKEBY];break;case n.GOERLI:a[e][n.GOERLI_CHAIN_ID]=r[e][n.GOERLI];break;case n.KOVAN:a[e][n.KOVAN_CHAIN_ID]=r[e][n.KOVAN]}}e.PreferencesController.accountHiddenTokens=a}}return e}(r),t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/052.js"}],[142,{"../../../shared/constants/transaction":3977,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");const o="sentEther";var a={version:64,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=64;const r=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,s.isPlainObject)(r))for(const e of Object.values(r))e.type===o&&(e.type=n.TRANSACTION_TYPES.SIMPLE_SEND),e.history&&e.history.map((e=>(e.type&&e.type===o&&(e.type=n.TRANSACTION_TYPES.SIMPLE_SEND),e)));return e}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/064.js"}],[143,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:65,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=65;const r=function(e){if(e.PreferencesController){var t;const{completedOnboarding:r,firstTimeFlowType:s}=e.PreferencesController;e.OnboardingController=null!==(t=e.OnboardingController)&&void 0!==t?t:{},r!==undefined&&(e.OnboardingController.completedOnboarding=r,delete e.PreferencesController.completedOnboarding),s!==undefined&&(e.OnboardingController.firstTimeFlowType=s,delete e.PreferencesController.firstTimeFlowType)}return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/065.js"}],[138,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");const n="2020-08-31";var o={version:60,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=60;const r=function(e){var t;const r=null==e||null===(t=e.NotificationController)||void 0===t?void 0:t.notifications;var o;(0,s.isPlainObject)(r)&&(null===(o=r[2])||void 0===o?void 0:o.date)===n&&delete e.NotificationController.notifications[2];return e}(t.data);return t.data=r,t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/060.js"}],[118,{lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:40,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=40;const r=t.data;return t.data=function(e){return delete e.ProviderApprovalController,e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/040.js"}],[117,{"../../../shared/modules/hexstring-utils":3983,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/modules/hexstring-utils");const o="SAI";function a(e={}){return e&&"object"==typeof e&&"DAI"===e.symbol&&"0x89d24A6b4CcB1B6fAA2625fE562bDD9a23260359"===(0,n.toChecksumHexAddress)(e.address)}var i={version:39,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=39;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.tokens||[];if(Array.isArray(e))for(const t of e)a(t)&&(t.symbol=o);const r=t.accountTokens||{};if(r&&"object"==typeof r)for(const e of Object.keys(r)){const t=r[e];if(t&&"object"==typeof t)for(const e of Object.keys(t)){const r=t[e];if(Array.isArray(r))for(const e of r)a(e)&&(e.symbol=o)}}}return e}(r),t}};r.default=i}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/039.js"}],[115,{"@metamask/controllers":1032,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("@metamask/controllers");var o={version:37,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=37;const r=t.data;return t.data=function(e){if(e.AddressBookController){const t=e.AddressBookController.addressBook,r=new Set,s={};Object.values(t).forEach((e=>{r.add(e.chainId)}));for(const e of r.values()){s[e]={};for(const r in t)t[r].chainId===e&&(t[r].isEns=!1,n.util.normalizeEnsName(t[r].name)&&(t[r].isEns=!0),s[e][r]=t[r])}e.AddressBookController.addressBook=s}return e}(r),t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/037.js"}],[84,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:6,migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=6;try{const e=function(e){const t=e.KeyringController,r=i(i({},e),{},{PreferencesController:{selectedAddress:t.selectedAccount}});return delete r.KeyringController.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #6${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/006.js"}],[85,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:7,migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=7;try{const e=function(e){const t=i(i({},e),{},{TransactionManager:{transactions:e.transactions||[],gasMultiplier:e.gasMultiplier||1}});return delete t.transactions,delete t.gasMultiplier,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #7${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/007.js"}],[86,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:8,migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=8;try{const e=function(e){const t=i(i({},e),{},{NoticeController:{noticesList:e.noticesList||[]}});return delete t.noticesList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #8${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/008.js"}],[83,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:5,migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=5;try{const e=function(e){const{config:t}=e,r=i(i({},e),{},{KeyringController:{vault:e.vault,selectedAccount:t.selectedAccount,walletNicknames:e.walletNicknames}});return delete r.vault,delete r.walletNicknames,delete r.config.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #5${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/005.js"}],[107,{"../../../shared/constants/transaction":3977,"./fail-tx":146,"@babel/runtime/helpers/interopRequireDefault":190},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("../../../shared/constants/transaction"),o=s(e("./fail-tx"));var a={version:29,migrate:(0,o.default)(29,"Stuck in approved state for too long.",(e=>{const t=e.status===n.TRANSACTION_STATUSES.APPROVED,r=e.submittedTime,s=Date.now();return t&&s-r>432e5}))};r.default=a}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/029.js"}],[126,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:48,async migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=48;const r=t.data;return t.data=function(e={}){var t,r,s,n,o,a,c,d,h;null===(t=e.NetworkController)||void 0===t||delete t.settings;const p=(null===(r=e.NetworkController)||void 0===r?void 0:r.provider)||{};if(("rpc"!==p.type||"string"==typeof p.chainId&&u.test(p.chainId))&&"localhost"!==p.type){if(null!==(s=e.NetworkController)&&void 0!==s&&s.provider){var f,g;if("rpcTarget"in e.NetworkController.provider){const t=e.NetworkController.provider.rpcTarget;e.NetworkController.provider.rpcUrl=t}null===(f=e.NetworkController)||void 0===f||(null===(g=f.provider)||void 0===g||delete g.rpcTarget)}}else e.NetworkController.provider={type:"rinkeby",rpcUrl:"",chainId:"0x4",nickname:"",rpcPrefs:{},ticker:"ETH"};e.PreferencesController||(e.PreferencesController={});e.PreferencesController.frequentRpcListDetail||(e.PreferencesController.frequentRpcListDetail=[]);e.PreferencesController.frequentRpcListDetail.unshift({rpcUrl:"http://localhost:8545",chainId:"0x539",ticker:"ETH",nickname:"Localhost 8545",rpcPrefs:{}}),null===(n=e.CachedBalancesController)||void 0===n||delete n.cachedBalances;const m=null===(o=e.TransactionController)||void 0===o?void 0:o.transactions;Array.isArray(m)&&m.forEach((e=>{const t=null==e?void 0:e.metamaskNetworkId;"string"==typeof t&&l.test(t)&&(e.metamaskNetworkId=parseInt(t,16).toString(10))}));const y=(null===(a=e.AddressBookController)||void 0===a?void 0:a.addressBook)||{};Object.keys(y).forEach((e=>{if(/^\d+$/iu.test(e)){const t=`0x${parseInt(e,10).toString(16)}`;!function(e,t){Object.values(e).forEach((e=>{e&&"object"==typeof e&&(e.chainId=t)}))}(y[e],t),y[t]?function(e,t,r){const s=e[t]||{},n=i({},e[r]);Object.keys(s).forEach((e=>{if(n[e]&&"object"==typeof n[e]){const t={};new Set([...Object.keys(n[e]),...Object.keys(s[e]||{})]).forEach((r=>{var o;t[r]=n[e][r]||(null===(o=s[e])||void 0===o?void 0:o[r])||""})),n[e]=t}else s[e]&&"object"==typeof s[e]&&(n[e]=s[e])})),e[r]=n}(y,e,t):y[t]=y[e],delete y[e]}})),null===(c=e.IncomingTransactionsController)||void 0===c||null===(d=c.incomingTxLastFetchedBlocksByNetwork)||void 0===d||delete d.localhost;const v=null===(h=e.PreferencesController)||void 0===h?void 0:h.accountTokens;v&&Object.keys(v).forEach((e=>{var t,r;const s=(null===(t=v[e])||void 0===t?void 0:t.localhost)||[];if(s.length>0){const t=v[e].rpc||[];t.length>0?v[e].rpc=function(e,t){const r=o(e),s=o(t),n=[];return new Set([...Object.keys(r),...Object.keys(s)]).forEach((e=>{n.push(i(i({},r[e]),s[e]))})),n;function o(e){return e.reduce(((e,t)=>(null!=t&&t.address&&"string"==typeof(null==t?void 0:t.address)&&(e[t.address]=t),e)),{})}}(s,t):v[e].rpc=s}null===(r=v[e])||void 0===r||delete r.localhost}));return e}(r),t}};r.default=c;const l=/^0x[0-9a-f]+$/iu,u=/^0x[1-9a-f]+[0-9a-f]*$/iu}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/048.js"}],[116,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:38,async migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=38;const r=t.data;return t.data=function(e){const{ABTestController:t={}}=e,{abTests:r={}}=t;if(r.fullScreenVsPopup)return e;return i(i({},e),{},{ABTestController:i(i({},t),{},{abTests:i(i({},r),{},{fullScreenVsPopup:"control"})})})}(r),t}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/038.js"}],[131,{"../../../shared/constants/transaction":3977,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash"),a=e("../../../shared/constants/transaction");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={version:53,async migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=53;const r=t.data;return t.data=function(e){var t,r;const s=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions,n=null==e||null===(r=e.IncomingTransactionsController)||void 0===r?void 0:r.incomingTransactions;Array.isArray(s)&&s.forEach((e=>{e&&(e.type!==a.TRANSACTION_TYPES.RETRY&&e.type!==a.TRANSACTION_TYPES.CANCEL&&(e.type=e.transactionCategory),delete e.transactionCategory)}));if(n){Object.entries(n).forEach((([t,r])=>{r&&(delete r.transactionCategory,e.IncomingTransactionsController.incomingTransactions[t]=c(c({},r),{},{type:a.TRANSACTION_TYPES.INCOMING}))}))}return e}(r),t}};r.default=l}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/053.js"}],[135,{"../../../shared/modules/random-id":3985,"@babel/runtime/helpers/interopRequireDefault":190,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),o=s(e("../../../shared/modules/random-id"));var a={version:57,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=57;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.TransactionController)&&void 0!==t&&t.transactions&&Array.isArray(e.TransactionController.transactions)&&!e.TransactionController.transactions.some((e=>"object"!=typeof e||void 0===e.txParams))&&(e.TransactionController.transactions=(0,n.keyBy)(e.TransactionController.transactions,(e=>(void 0!==e.id&&null!==e.id||(e.id=(0,o.default)()),e.id))));return e}(r),t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/057.js"}],[145,{"../../../shared/constants/network":3973,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"bignumber.js":1530,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash"),a=s(e("bignumber.js")),i=e("../../../shared/constants/network");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const u=e=>new a.default(e||"0x0",16).gt(0);var d={version:67,async migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=67;const r=function(e){var t,r,s;const n=(null==e?void 0:e.PreferencesController)||{},o=n.preferences||{};if(o.showTestNetworks)return e;const a=(null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions)||{},c=(null===(r=e.NetworkController)||void 0===r?void 0:r.provider)||{},d=(null===(s=e.CachedBalancesController)||void 0===s?void 0:s.cachedBalances)||{},h=i.TEST_CHAINS.includes(null==c?void 0:c.chainId),p=Object.values(a).some((({chainId:e})=>i.TEST_CHAINS.includes(e))),f=i.TEST_CHAINS.some((e=>Object.values(d[e]||{}).some(u))),g=h||p||f;return l(l({},e),{},{PreferencesController:l(l({},n),{},{preferences:l(l({},o),{},{showTestNetworks:g})})})}(t.data);return t.data=r,t}};r.default=d}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/067.js"}],[144,{"../../../shared/constants/hardware-wallets":3970,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash"),a=e("../../../shared/constants/hardware-wallets");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={version:66,async migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=66;const r=function(e){var t;const r=window.navigator.hid?a.LEDGER_TRANSPORT_TYPES.WEBHID:a.LEDGER_TRANSPORT_TYPES.U2F,s=Boolean(null===(t=e.PreferencesController)||void 0===t?void 0:t.useLedgerLive),n=c(c({},e),{},{PreferencesController:c(c({},null==e?void 0:e.PreferencesController),{},{ledgerTransportType:s?a.LEDGER_TRANSPORT_TYPES.LIVE:r})});return delete n.PreferencesController.useLedgerLive,n}(t.data);return t.data=r,t}};r.default=l}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/066.js"}],[141,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:63,async migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=63;const r=function(e){var t,r,s,n,o,a,c,l;const u=null==e||null===(t=e.PreferencesController)||void 0===t?void 0:t.accountTokens,d=null==e||null===(r=e.PreferencesController)||void 0===r?void 0:r.accountHiddenTokens,h={};u&&Object.keys(u).forEach((e=>{Object.keys(u[e]).forEach((t=>{const r=u[e][t];h[t]===undefined?h[t]={[e]:r}:h[t]=i(i({},h[t]),{},{[e]:r})}))}));const p={};d&&Object.keys(d).forEach((e=>{Object.keys(d[e]).forEach((t=>{const r=d[e][t];p[t]===undefined?p[t]={[e]:r}:p[t]=i(i({},p[t]),{},{[e]:r})}))}));e.TokensController?(e.TokensController.allTokens=h,e.TokensController.allIgnoredTokens=p):e.TokensController={allTokens:h,allIgnoredTokens:p};return null==e||(null===(s=e.PreferencesController)||void 0===s||delete s.accountHiddenTokens),null==e||null===(n=e.PreferencesController)||void 0===n||delete n.accountTokens,null==e||null===(o=e.PreferencesController)||void 0===o||delete o.assetImages,null==e||null===(a=e.PreferencesController)||void 0===a||delete a.hiddenTokens,null==e||null===(c=e.PreferencesController)||void 0===c||delete c.tokens,null==e||null===(l=e.PreferencesController)||void 0===l||delete l.suggestedTokens,e}(t.data);return t.data=r,t}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/063.js"}],[96,{"../controllers/transactions/lib/tx-state-history-helpers":32,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../controllers/transactions/lib/tx-state-history-helpers");var o={version:18,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=18;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>{if(!e.history||0===e.history.length){const t=(0,n.snapshotFromTxMeta)(e);return e.history=[t],e}const t=(0,n.migrateFromSnapshotsToDiffs)(e.history).filter((e=>!Array.isArray(e)||e.length>0));return e.history=t,e}))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #18${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/migrations/018.js"}],[1522,{"to-data-view":3741},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("to-data-view");t.exports=function(e,t,r){var n,o;switch(r=r||{},t){case"RFC3548":case"RFC4648":n="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",o=!0;break;case"RFC4648-HEX":n="0123456789ABCDEFGHIJKLMNOPQRSTUV",o=!0;break;case"Crockford":n="0123456789ABCDEFGHJKMNPQRSTVWXYZ",o=!1;break;default:throw new Error("Unknown base32 variant: "+t)}for(var a=r.padding!==undefined?r.padding:o,i=s(e),c=0,l=0,u="",d=0;d<i.byteLength;d++)for(l=l<<8|i.getUint8(d),c+=8;c>=5;)u+=n[l>>>c-5&31],c-=5;if(c>0&&(u+=n[l<<5-c&31]),a)for(;u.length%8!=0;)u+="=";return u}}}},{package:"base32-encode",file:"/Users/mac/code/metamask-extension/node_modules/base32-encode/index.js"}],[52,{"./contracts/registry":50,"./contracts/resolver":51,"@babel/runtime/helpers/interopRequireDefault":190,"@ensdomains/content-hash":260,"eth-ens-namehash":1928,"ethjs-contract":2110,"ethjs-query":2127},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=async function({provider:e,name:t}){const r=new o.default(e),s=n.default.hash(t),d=new a.default(r),h=Number.parseInt(await r.net_version(),10),p=function(e){switch(e){case 1:case 3:case 4:case 5:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(h);if(!p)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${h}"`);const f=d(c.default).at(p),g=(await f.resolver(s))[0];if(u(g))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const m=d(l.default).at(g),y=await m.supportsInterface("0xbc1c58d1"),v=await m.supportsInterface("0xd8389dc5");if(y[0]){const e=(await m.contenthash(s))[0];let t=i.default.decode(e);const r=i.default.getCodec(e);return"ipfs-ns"!==r&&"ipns-ns"!==r||(t=i.default.helpers.cidV0ToV1Base32(t)),{type:r,hash:t}}if(v[0]){const e=(await m.content(s))[0];if(u(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var n=s(e("eth-ens-namehash")),o=s(e("ethjs-query")),a=s(e("ethjs-contract")),i=s(e("@ensdomains/content-hash")),c=s(e("./contracts/registry")),l=s(e("./contracts/resolver"));function u(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/ens-ipfs/resolver.js"}],[45,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,s){t.origin=e.origin,s()}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/createOriginMiddleware.js"}],[47,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,s){t.tabId=e.tabId,s()}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/createTabIdMiddleware.js"}],[27,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({getIdentities:e,getKeyringAccounts:t}){return{eth_accounts:{method:async(r,s,n,o)=>{try{const r=await t(),n=e();s.result=r.sort(((e,t)=>{if(!n[e])throw new Error(`Missing identity for address ${e}`);if(!n[t])throw new Error(`Missing identity for address ${t}`);return n[e].lastSelected===n[t].lastSelected?0:n[e].lastSelected===undefined?1:n[t].lastSelected===undefined?-1:n[t].lastSelected-n[e].lastSelected})),o()}catch(e){s.error=e,o(e)}}}}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/permissions/restrictedMethods.js"}],[23,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.WALLET_PREFIX=r.SAFE_METHODS=r.NOTIFICATION_NAMES=r.METADATA_STORE_KEY=r.METADATA_CACHE_MAX_SIZE=r.LOG_STORE_KEY=r.LOG_METHOD_TYPES=r.LOG_LIMIT=r.LOG_IGNORE_METHODS=r.HISTORY_STORE_KEY=r.CAVEAT_TYPES=r.APPROVAL_TYPE=void 0;r.APPROVAL_TYPE="wallet_requestPermissions";r.WALLET_PREFIX="wallet_";r.HISTORY_STORE_KEY="permissionsHistory";r.LOG_STORE_KEY="permissionsLog";r.METADATA_STORE_KEY="domainMetadata";r.METADATA_CACHE_MAX_SIZE=100;r.CAVEAT_TYPES={limitResponseLength:"limitResponseLength",filterResponse:"filterResponse"};r.NOTIFICATION_NAMES={accountsChanged:"metamask_accountsChanged",unlockStateChanged:"metamask_unlockStateChanged",chainChanged:"metamask_chainChanged"};r.LOG_IGNORE_METHODS=["wallet_registerOnboarding","wallet_watchAsset"];r.LOG_METHOD_TYPES={restricted:"restricted",internal:"internal"};r.LOG_LIMIT=100;r.SAFE_METHODS=["eth_blockNumber","eth_call","eth_chainId","eth_coinbase","eth_decrypt","eth_estimateGas","eth_feeHistory","eth_gasPrice","eth_getBalance","eth_getBlockByHash","eth_getBlockByNumber","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getCode","eth_getEncryptionPublicKey","eth_getFilterChanges","eth_getFilterLogs","eth_getLogs","eth_getProof","eth_getStorageAt","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionByHash","eth_getTransactionCount","eth_getTransactionReceipt","eth_getUncleByBlockHashAndIndex","eth_getUncleByBlockNumberAndIndex","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_getWork","eth_hashrate","eth_mining","eth_newBlockFilter","eth_newFilter","eth_newPendingTransactionFilter","eth_protocolVersion","eth_sendRawTransaction","eth_sendTransaction","eth_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v3","eth_signTypedData_v4","eth_submitHashrate","eth_submitWork","eth_syncing","eth_uninstallFilter","metamask_getProviderState","metamask_watchAsset","net_listening","net_peerCount","net_version","personal_ecRecover","personal_sign","wallet_watchAsset","web3_clientVersion","web3_sha3"]}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/permissions/enums.js"}],[3024,{},function(){with(this)return function(){"use strict";return function(e,t,r){for(var s=self.crypto||self.msCrypto,n="-_",o=36;o--;)n+=o.toString(36);for(o=36;o---10;)n+=o.toString(36).toUpperCase();t.exports=function(e){var t="",r=s.getRandomValues(new Uint8Array(e||21));for(o=e||21;o--;)t+=n[63&r[o]];return t}}}},{package:"nanoid",file:"/Users/mac/code/metamask-extension/node_modules/nanoid/index.browser.js"}],[43,{"eth-rpc-errors":2010},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("eth-rpc-errors");var n=(e,t)=>r=>{t._writableState.ended||(e[r.method]?e[r.method](...r.params,((e,n)=>{t._writableState.ended||(e?t.write({jsonrpc:"2.0",error:(0,s.serializeError)(e,{shouldIncludeStack:!0}),id:r.id}):t.write({jsonrpc:"2.0",result:n,id:r.id}))})):t.write({jsonrpc:"2.0",error:s.ethErrors.rpc.methodNotFound({message:`${r.method} not found`}),id:r.id}))};r.default=n}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/createMetaRPCHandler.js"}],[1948,{"./getBlocksForRange.js":1940,"./hexUtils.js":1941,"./index.js":1942,"eth-json-rpc-middleware/scaffold":1944,"json-rpc-engine/src/createAsyncMiddleware":1945,"safe-event-emitter":3578},function(){with(this)return function(){"use strict";return function(e,t,r){const s=e("safe-event-emitter"),n=e("eth-json-rpc-middleware/scaffold"),o=e("json-rpc-engine/src/createAsyncMiddleware"),a=e("./index.js"),{unsafeRandomBytes:i,incrementHexInt:c}=e("./hexUtils.js"),l=e("./getBlocksForRange.js");function u(e){return{hash:e.hash,parentHash:e.parentHash,sha3Uncles:e.sha3Uncles,miner:e.miner,stateRoot:e.stateRoot,transactionsRoot:e.transactionsRoot,receiptsRoot:e.receiptsRoot,logsBloom:e.logsBloom,difficulty:e.difficulty,number:e.number,gasLimit:e.gasLimit,gasUsed:e.gasUsed,nonce:e.nonce,mixHash:e.mixHash,timestamp:e.timestamp,extraData:e.extraData}}t.exports=function({blockTracker:e,provider:t}){const r={},d=a({blockTracker:e,provider:t});let h=!1;const p=new s,f=n({eth_subscribe:o((async function(s,n){if(h)throw new Error("SubscriptionManager - attempting to use after destroying");const o=s.params[0],a=i(16);let p;switch(o){case"newHeads":p=f({subId:a});break;case"logs":const e=s.params[1];p=m({subId:a,filter:await d.newLogFilter(e)});break;default:throw new Error(`SubscriptionManager - unsupported subscription type "${o}"`)}return r[a]=p,void(n.result=a);function f({subId:r}){const s={type:o,destroy:async()=>{e.removeListener("sync",s.update)},update:async({oldBlock:e,newBlock:s})=>{const n=s,o=c(e);(await l({provider:t,fromBlock:o,toBlock:n})).map(u).forEach((e=>{g(r,e)}))}};return e.on("sync",s.update),s}function m({subId:e,filter:t}){t.on("update",(t=>g(e,t)));return{type:o,destroy:async()=>await d.uninstallFilter(t.idHex)}}})),eth_unsubscribe:o((async function(e,t){if(h)throw new Error("SubscriptionManager - attempting to use after destroying");const s=e.params[0],n=r[s];if(!n)return void(t.result=!1);delete r[s],await n.destroy(),t.result=!0}))});return f.destroy=function(){p.removeAllListeners();for(const e in r)r[e].destroy(),delete r[e];h=!0},{events:p,middleware:f};function g(e,t){p.emit("notification",{jsonrpc:"2.0",method:"eth_subscription",params:{subscription:e,result:t}})}}}}},{package:"eth-json-rpc-filters",file:"/Users/mac/code/metamask-extension/node_modules/eth-json-rpc-filters/subscriptionManager.js"}],[2582,{"readable-stream":3468},function(){with(this)return function(){"use strict";return function(e,t,r){const s=e("readable-stream").Duplex;t.exports=function({engine:e}){if(!e)throw new Error("Missing engine parameter!");const t=new s({objectMode:!0,read:function(){return!1},write:function(t,r,s){e.handle(t,((e,t)=>{this.push(t)})),s()}});e.on&&e.on("notification",(e=>{t.push(e)}));return t}}}},{package:"json-rpc-middleware-stream",file:"/Users/mac/code/metamask-extension/node_modules/json-rpc-middleware-stream/engineStream.js"}],[1352,{_process:3204,timers:3736},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e,t){(function(){class s{constructor(e){this.tasks=[],this.count=e}sched(){if(this.count>0&&this.tasks.length>0){this.count--;let e=this.tasks.shift();if(e===undefined)throw"Unexpected undefined value in tasks list";e()}}acquire(){return new Promise(((r,s)=>{this.tasks.push((()=>{var e=!1;r((()=>{e||(e=!0,this.count++,this.sched())}))})),e&&e.nextTick?e.nextTick(this.sched.bind(this)):t(this.sched.bind(this))}))}use(e){return this.acquire().then((t=>e().then((e=>(t(),e))).catch((e=>{throw t(),e}))))}}r.Semaphore=s;r.Mutex=class extends s{constructor(){super(1)}}}).call(this)}).call(this,e("_process"),e("timers").setImmediate)}}},{package:"await-semaphore",file:"/Users/mac/code/metamask-extension/node_modules/await-semaphore/index.js"}],[1942,{"./block-filter.js":1939,"./hexUtils":1941,"./log-filter.js":1943,"./tx-filter.js":1949,"await-semaphore":1352,"eth-json-rpc-middleware/scaffold":1944,"json-rpc-engine/src/createAsyncMiddleware":1945},function(){with(this)return function(){"use strict";return function(e,t,r){const s=e("await-semaphore").Mutex,n=e("json-rpc-engine/src/createAsyncMiddleware"),o=e("eth-json-rpc-middleware/scaffold"),a=e("./log-filter.js"),i=e("./block-filter.js"),c=e("./tx-filter.js"),{intToHex:l,hexToInt:u}=e("./hexUtils");function d(e){return h((async(...t)=>{const r=await e(...t);return l(r.id)}))}function h(e){return n((async(t,r)=>{const s=await e.apply(null,t.params);r.result=s}))}function p(e,t){const r=[];for(let t in e)r.push(e[t]);return r}t.exports=function({blockTracker:e,provider:t}){let r=0,n={};const f=new s,g=function({mutex:e}){return t=>async(r,s,n,o)=>{(await e.acquire())(),t(r,s,n,o)}}({mutex:f}),m=o({eth_newFilter:g(d(v)),eth_newBlockFilter:g(d(w)),eth_newPendingTransactionFilter:g(d(b)),eth_uninstallFilter:g(h(P)),eth_getFilterChanges:g(h(k)),eth_getFilterLogs:g(h(S))}),y=async({oldBlock:e,newBlock:t})=>{if(0===n.length)return;const r=await f.acquire();try{await Promise.all(p(n).map((async r=>{try{await r.update({oldBlock:e,newBlock:t})}catch(e){console.error(e)}})))}catch(e){console.error(e)}r()};return m.newLogFilter=v,m.newBlockFilter=w,m.newPendingTransactionFilter=b,m.uninstallFilter=P,m.getFilterChanges=k,m.getFilterLogs=S,m.destroy=()=>{!async function(){const e=p(n).length;n={},T({prevFilterCount:e,newFilterCount:0})}()},m;async function v(e){const r=new a({provider:t,params:e});await C(r);return r}async function w(){const e=new i({provider:t});await C(e);return e}async function b(){const e=new c({provider:t});await C(e);return e}async function k(e){const t=u(e),r=n[t];if(!r)throw new Error(`No filter for index "${t}"`);return r.getChangesAndClear()}async function S(e){const t=u(e),r=n[t];if(!r)throw new Error(`No filter for index "${t}"`);return"log"===r.type?results=r.getAllResults():results=[],results}async function P(e){const t=u(e),r=n[t],s=Boolean(r);return s&&await async function(e){const t=p(n).length;delete n[e];const r=p(n).length;T({prevFilterCount:t,newFilterCount:r})}(t),s}async function C(t){const s=p(n).length,o=await e.getLatestBlock();await t.initialize({currentBlock:o}),r++,n[r]=t,t.id=r,t.idHex=l(r);return T({prevFilterCount:s,newFilterCount:p(n).length}),r}function T({prevFilterCount:t,newFilterCount:r}){0===t&&r>0?e.on("sync",y):t>0&&0===r&&e.removeListener("sync",y)}}}}},{package:"eth-json-rpc-filters",file:"/Users/mac/code/metamask-extension/node_modules/eth-json-rpc-filters/index.js"}],[38,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/controllers":1032,"@metamask/obs-store":1119},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("@metamask/obs-store"),a=e("@metamask/controllers");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class l extends o.ObservableStore{constructor({config:e,controllerMessenger:t,state:r,persist:s}){super(r),(0,n.default)(this,"config",{}),this.persist=s,this.controllerMessenger=t,e&&this.updateStructure(e)}updateStructure(e){this.config=e,this.removeAllListeners();for(const t of Object.keys(e)){if(!e[t])throw new Error(`Undefined '${t}'`);const r=e[t];r.subscribe?e[t].subscribe((e=>{this.updateState({[t]:e})})):this.controllerMessenger.subscribe(`${r.name}:stateChange`,(r=>{let s=r;this.persist&&(s=(0,a.getPersistentState)(r,e[t].metadata)),this.updateState({[t]:s})}))}}getFlatState(){if(!this.config)return{};let e={};for(const t of Object.keys(this.config)){const r=this.config[t],s=r.getState?r.getState():r.state;e=c(c({},e),s)}return e}}r.default=l}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/ComposableObservableStore.js"}],[7,{"../../../shared/constants/time":3976,"../metamask-controller":79,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,events:1660},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=s(e("events")),a=e("@metamask/obs-store"),i=e("../metamask-controller"),c=e("../../../shared/constants/time");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class d extends o.default{constructor(e={}){const{addUnlockListener:t,isUnlocked:r,initState:s,onInactiveTimeout:n,showUnlockRequest:o,preferencesStore:i,qrHardwareStore:c}=e;super(),this.onInactiveTimeout=n||(()=>undefined),this.store=new a.ObservableStore(u(u({timeoutMinutes:0,connectedStatusPopoverHasBeenShown:!0,defaultHomeActiveTabName:null,browserEnvironment:{},popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[],recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:(new Date).getTime(),showTestnetMessageInDropdown:!0},s),{},{qrHardware:{}})),this.timer=null,this.isUnlocked=r,this.waitingForUnlock=[],t(this.handleUnlock.bind(this)),this._showUnlockRequest=o,i.subscribe((({preferences:e})=>{this.store.getState().timeoutMinutes!==e.autoLockTimeLimit&&this._setInactiveTimeout(e.autoLockTimeLimit)})),c.subscribe((e=>{this.store.updateState({qrHardware:e})}));const{preferences:l}=i.getState();this._setInactiveTimeout(l.autoLockTimeLimit)}getUnlockPromise(e){return new Promise((t=>{this.isUnlocked()?t():this.waitForUnlock(t,e)}))}waitForUnlock(e,t){this.waitingForUnlock.push({resolve:e}),this.emit(i.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE),t&&this._showUnlockRequest()}handleUnlock(){if(this.waitingForUnlock.length>0){for(;this.waitingForUnlock.length>0;)this.waitingForUnlock.shift().resolve();this.emit(i.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}setDefaultHomeActiveTabName(e){this.store.updateState({defaultHomeActiveTabName:e})}setConnectedStatusPopoverHasBeenShown(){this.store.updateState({connectedStatusPopoverHasBeenShown:!0})}setRecoveryPhraseReminderHasBeenShown(){this.store.updateState({recoveryPhraseReminderHasBeenShown:!0})}setRecoveryPhraseReminderLastShown(e){this.store.updateState({recoveryPhraseReminderLastShown:e})}setLastActiveTime(){this._resetTimer()}_setInactiveTimeout(e){this.store.updateState({timeoutMinutes:e}),this._resetTimer()}_resetTimer(){const{timeoutMinutes:e}=this.store.getState();this.timer&&clearTimeout(this.timer),e&&(this.timer=setTimeout((()=>this.onInactiveTimeout()),e*c.MINUTE))}setBrowserEnvironment(e,t){this.store.updateState({browserEnvironment:{os:e,browser:t}})}addPollingToken(e,t){const r=this.store.getState()[t];this.store.updateState({[t]:[...r,e]})}removePollingToken(e,t){const r=this.store.getState()[t];this.store.updateState({[t]:r.filter((t=>t!==e))})}clearPollingTokens(){this.store.updateState({popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[]})}setShowTestnetMessageInDropdown(e){this.store.updateState({showTestnetMessageInDropdown:e})}}r.default=d}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/app-state.js"}],[49,{"../../../shared/constants/app":3968,"../../../shared/modules/random-id":3985,"../metamask-controller":79,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,"eth-rpc-errors":2010,events:1660,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),o=e("@metamask/obs-store"),a=e("eth-rpc-errors"),i=s(e("loglevel")),c=e("../../../shared/constants/app"),l=e("../metamask-controller"),u=s(e("../../../shared/modules/random-id"));class d extends n.default{constructor(e){super(),this.memStore=new o.ObservableStore({unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0}),this.messages=[],this.metricsEvent=e.metricsEvent}get unapprovedEncryptionPublicKeyMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,s)=>{if(!e)return void s(new Error("MetaMask Message: address field is required."));const n=this.addUnapprovedMessage(e,t);this.once(`${n}:finished`,(t=>{switch(t.status){case"received":return void r(t.rawData);case"rejected":return void s(a.ethErrors.provider.userRejectedRequest("MetaMask EncryptionPublicKey: User denied message EncryptionPublicKey."));default:s(new Error(`MetaMask EncryptionPublicKey: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){i.default.debug("EncryptionPublicKeyManager addUnapprovedMessage: address");const r=(new Date).getTime(),s=(0,u.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:c.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY};return t&&(n.origin=t.origin),this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForEncryptionPublicKey(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusReceived(e,t){const r=this.getMsg(e);r.rawData=t,this._updateMsg(r),this._setMsgStatus(e,"received")}prepMsgForEncryptionPublicKey(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){t&&this.metricsEvent({event:t,category:"Messages",properties:{action:"Encryption public key Request"}}),this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`EncryptionPublicKeyManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"received"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedEncryptionPublicKeyMsgs:e,unapprovedEncryptionPublicKeyMsgCount:t}),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}r.default=d}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/encryption-public-key-manager.js"}],[8,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("@metamask/obs-store");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor(e={}){const{accountTracker:t,getCurrentChainId:r}=e;this.accountTracker=t,this.getCurrentChainId=r;const s=i({cachedBalances:{}},e.initState);this.store=new o.ObservableStore(s),this._registerUpdates()}async updateCachedBalances({accounts:e}){const t=this.getCurrentChainId(),r=await this._generateBalancesToCache(e,t);this.store.updateState({cachedBalances:r})}_generateBalancesToCache(e,t){const{cachedBalances:r}=this.store.getState(),s=i({},r[t]);Object.keys(e).forEach((t=>{const r=e[t];r.balance&&(s[t]=r.balance)}));return i(i({},r),{},{[t]:s})}clearCachedBalances(){this.store.updateState({cachedBalances:{}})}_registerUpdates(){const e=this.updateCachedBalances.bind(this);this.accountTracker.store.subscribe(e)}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/cached-balances.js"}],[42,{"@babel/runtime/helpers/interopRequireDefault":190,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,s){s((s=>{r.error&&n.default.error("Error in RPC response:\n",r),t.isMetamaskInternal||(n.default.info(`RPC (${e.origin}):`,t,"->",r),s())}))}};var n=s(e("loglevel"))}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/createLoggerMiddleware.js"}],[6,{"../../../shared/constants/alerts":3967,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("@metamask/obs-store"),a=e("../../../shared/constants/alerts");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const l={alertEnabledness:a.TOGGLEABLE_ALERT_TYPES.reduce(((e,t)=>(e[t]=!0,e)),{}),unconnectedAccountAlertShownOrigins:{},web3ShimUsageOrigins:{}};r.default=class{constructor(e={}){const{initState:t={},preferencesStore:r}=e,s=c(c({},l),{},{alertEnabledness:c(c({},l.alertEnabledness),t.alertEnabledness)});this.store=new o.ObservableStore(s),this.selectedAddress=r.getState().selectedAddress,r.subscribe((({selectedAddress:e})=>{this.store.getState().unconnectedAccountAlertShownOrigins&&this.selectedAddress!==e&&(this.selectedAddress=e,this.store.updateState({unconnectedAccountAlertShownOrigins:{}}))}))}setAlertEnabledness(e,t){let{alertEnabledness:r}=this.store.getState();r=c({},r),r[e]=t,this.store.updateState({alertEnabledness:r})}setUnconnectedAccountAlertShown(e){let{unconnectedAccountAlertShownOrigins:t}=this.store.getState();t=c({},t),t[e]=!0,this.store.updateState({unconnectedAccountAlertShownOrigins:t})}getWeb3ShimUsageState(e){return this.store.getState().web3ShimUsageOrigins[e]}setWeb3ShimUsageRecorded(e){this._setWeb3ShimUsageState(e,a.WEB3_SHIM_USAGE_ALERT_STATES.RECORDED)}setWeb3ShimUsageAlertDismissed(e){this._setWeb3ShimUsageState(e,a.WEB3_SHIM_USAGE_ALERT_STATES.DISMISSED)}_setWeb3ShimUsageState(e,t){let{web3ShimUsageOrigins:r}=this.store.getState();r=c({},r),r[e]=t,this.store.updateState({web3ShimUsageOrigins:r})}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/alert.js"}],[44,{"@babel/runtime/helpers/interopRequireDefault":190,extensionizer:2143,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({location:e,registerOnboarding:t}){return async function(r,s,a,i){try{if("wallet_registerOnboarding"!==r.method)return void a();r.tabId&&r.tabId!==o.default.tabs.TAB_ID_NONE?await t(e,r.tabId):n.default.debug(`'wallet_registerOnboarding' message from ${e} ignored due to missing tabId`),s.result=!0,i()}catch(e){i(e)}}};var n=s(e("loglevel")),o=s(e("extensionizer"))}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/createOnboardingMiddleware.js"}],[58,{"../../../shared/constants/app":3968,"../../../shared/modules/random-id":3985,"../metamask-controller":79,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,buffer:1659,"eth-rpc-errors":2010,"ethereumjs-util":2077,events:1660},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,r.normalizeMsgData=h;var n=s(e("events")),o=e("@metamask/obs-store"),a=e("ethereumjs-util"),i=e("eth-rpc-errors"),c=e("../../../shared/constants/app"),l=e("../metamask-controller"),u=s(e("../../../shared/modules/random-id"));class d extends n.default{constructor({metricsEvent:e}){super(),this.memStore=new o.ObservableStore({unapprovedMsgs:{},unapprovedMsgCount:0}),this.messages=[],this.metricsEvent=e}get unapprovedMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}async addUnapprovedMessageAsync(e,t){const r=this.addUnapprovedMessage(e,t);return await new Promise(((t,s)=>{this.once(`${r}:finished`,(r=>{switch(r.status){case"signed":return t(r.rawSig);case"rejected":return s(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return s(new Error(`MetaMask Message Signature: ${r.error}`));default:return s(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){t&&(e.origin=t.origin),e.data=h(e.data);const r=(new Date).getTime(),s=(0,u.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:c.MESSAGE_TYPE.ETH_SIGN};return this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:"Transactions",properties:{action:"Sign Request",type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`MessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedMsgs:e,unapprovedMsgCount:t}),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}function h(e){return"0x"===e.slice(0,2)?e:(0,a.bufferToHex)(t.from(e,"utf8"))}r.default=d}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/message-manager.js"}],[48,{"../../../shared/constants/app":3968,"../../../shared/modules/random-id":3985,"../metamask-controller":79,"./util":78,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,buffer:1659,"eth-rpc-errors":2010,"ethereumjs-util":2077,events:1660,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),o=e("@metamask/obs-store"),a=e("ethereumjs-util"),i=e("eth-rpc-errors"),c=s(e("loglevel")),l=e("../../../shared/constants/app"),u=e("../metamask-controller"),d=s(e("../../../shared/modules/random-id")),h=e("./util");const p=/^[0-9A-Fa-f]+$/gu;class f extends n.default{constructor(e){super(),this.memStore=new o.ObservableStore({unapprovedDecryptMsgs:{},unapprovedDecryptMsgCount:0}),this.messages=[],this.metricsEvent=e.metricsEvent}get unapprovedDecryptMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,s)=>{if(!e.from)return void s(new Error("MetaMask Decryption: from field is required."));const n=this.addUnapprovedMessage(e,t);this.once(`${n}:finished`,(t=>{switch(t.status){case"decrypted":return void r(t.rawData);case"rejected":return void s(i.ethErrors.provider.userRejectedRequest("MetaMask Decryption: User denied message decryption."));case"errored":return void s(new Error("This message cannot be decrypted"));default:s(new Error(`MetaMask Decryption: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){c.default.debug(`DecryptMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`),t&&(e.origin=t.origin),e.data=this.normalizeMsgData(e.data);const r=(new Date).getTime(),s=(0,d.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:l.MESSAGE_TYPE.ETH_DECRYPT};return this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForDecryption(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusDecrypted(e,t){const r=this.getMsg(e);r.rawData=t,this._updateMsg(r),this._setMsgStatus(e,"decrypted")}prepMsgForDecryption(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){t&&this.metricsEvent({event:t,category:"Messages",properties:{action:"Decrypt Message Request"}}),this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`DecryptMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"decrypted"!==t&&"errored"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedDecryptMsgs:e,unapprovedDecryptMsgCount:t}),this.emit(u.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}normalizeMsgData(e){try{const t=(0,a.stripHexPrefix)(e);if(t.match(p))return(0,h.addHexPrefix)(t)}catch(e){c.default.debug("Message was not hex encoded, interpreting as utf8.")}return(0,a.bufferToHex)(t.from(e,"utf8"))}}r.default=f}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/decrypt-message-manager.js"}],[12,{"../../../shared/constants/network":3973,"../../../shared/constants/time":3976,"../../../shared/constants/transaction":3977,"../../../shared/modules/fetch-with-timeout":3981,"../../../shared/modules/random-id":3985,"../lib/util":78,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,"bn.js":1614,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("@metamask/obs-store"),a=s(e("loglevel")),i=s(e("bn.js")),c=s(e("../../../shared/modules/random-id")),l=e("../lib/util"),u=s(e("../../../shared/modules/fetch-with-timeout")),d=e("../../../shared/constants/transaction"),h=e("../../../shared/constants/network"),p=e("../../../shared/constants/time");function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const m=(0,u.default)(30*p.SECOND),y=[h.GOERLI_CHAIN_ID,h.KOVAN_CHAIN_ID,h.MAINNET_CHAIN_ID,h.RINKEBY_CHAIN_ID,h.ROPSTEN_CHAIN_ID];function v(e,t){let r,s=!0;return n=>{try{return s?(s=!1,e(null!=t?t:n,n)):e(r,n)}finally{r=n}}}r.default=class{constructor(e={}){const{blockTracker:t,onNetworkDidChange:r,getCurrentChainId:s,preferencesController:n}=e;this.blockTracker=t,this.getCurrentChainId=s,this.preferencesController=n,this._onLatestBlock=async e=>{const t=this.preferencesController.getSelectedAddress(),r=parseInt(e,16);await this._update(t,r)};const a=g({incomingTransactions:{},incomingTxLastFetchedBlockByChainId:{[h.GOERLI_CHAIN_ID]:null,[h.KOVAN_CHAIN_ID]:null,[h.MAINNET_CHAIN_ID]:null,[h.RINKEBY_CHAIN_ID]:null,[h.ROPSTEN_CHAIN_ID]:null}},e.initState);this.store=new o.ObservableStore(a),this.preferencesController.store.subscribe(v(((e,t)=>{const{featureFlags:{showIncomingTransactions:r}={}}=e,{featureFlags:{showIncomingTransactions:s}={}}=t;s!==r&&(!r||s?this.start():this.stop())}),this.preferencesController.store.getState())),this.preferencesController.store.subscribe(v((async(e,t)=>{const{selectedAddress:r}=e,{selectedAddress:s}=t;s!==r&&await this._update(s)}),this.preferencesController.store.getState())),r((async()=>{const e=this.preferencesController.getSelectedAddress();await this._update(e)}))}start(){const{featureFlags:e={}}=this.preferencesController.store.getState(),{showIncomingTransactions:t}=e;t&&(this.blockTracker.removeListener("latest",this._onLatestBlock),this.blockTracker.addListener("latest",this._onLatestBlock))}stop(){this.blockTracker.removeListener("latest",this._onLatestBlock)}async _update(e,t){const r=this.getCurrentChainId();if(y.includes(r)&&e)try{var s;const n=this.store.getState(),o=parseInt(this.blockTracker.getCurrentBlock(),16),a=n.incomingTxLastFetchedBlockByChainId[r],i=null!==(s=null!=a?a:t)&&void 0!==s?s:o,c=await this._getNewIncomingTransactions(e,i,r);let l=i;c.forEach((e=>{e.blockNumber&&parseInt(l,10)<parseInt(e.blockNumber,10)&&(l=parseInt(e.blockNumber,10))})),this.store.updateState({incomingTxLastFetchedBlockByChainId:g(g({},n.incomingTxLastFetchedBlockByChainId),{},{[r]:l+1}),incomingTransactions:c.reduce(((e,t)=>(e[t.hash]=t,e)),g({},n.incomingTransactions))})}catch(e){a.default.error(e)}}async _getNewIncomingTransactions(e,t,r){let s=`${`https://${r===h.MAINNET_CHAIN_ID?"api":`api-${h.CHAIN_ID_TO_TYPE_MAP[r]}`}.etherscan.io`}/api?module=account&action=txlist&address=${e}&tag=latest&page=1`;t&&(s+=`&startBlock=${parseInt(t,10)}`);const n=await m(s),{status:o,result:a}=await n.json();let i=[];if("1"===o&&Array.isArray(a)&&a.length>0){const t={},s=[];a.forEach((e=>{t[e.hash]||(s.push(this._normalizeTxFromEtherscan(e,r)),t[e.hash]=1)})),i=s.filter((t=>{var r,s;return(null===(r=t.txParams)||void 0===r||null===(s=r.to)||void 0===s?void 0:s.toLowerCase())===e.toLowerCase()})),i.sort(((e,t)=>e.time<t.time?-1:1))}return i}_normalizeTxFromEtherscan(e,t){const r=1e3*parseInt(e.timeStamp,10),s="0"===e.isError?d.TRANSACTION_STATUSES.CONFIRMED:d.TRANSACTION_STATUSES.FAILED,n={from:e.from,gas:(0,l.bnToHex)(new i.default(e.gas)),nonce:(0,l.bnToHex)(new i.default(e.nonce)),to:e.to,value:(0,l.bnToHex)(new i.default(e.value))};return e.gasPrice?n.gasPrice=(0,l.bnToHex)(new i.default(e.gasPrice)):e.maxFeePerGas&&(n.maxFeePerGas=(0,l.bnToHex)(new i.default(e.maxFeePerGas)),n.maxPriorityFeePerGas=(0,l.bnToHex)(new i.default(e.maxPriorityFeePerGas))),{blockNumber:e.blockNumber,id:(0,c.default)(),chainId:t,metamaskNetworkId:h.CHAIN_ID_TO_NETWORK_ID_MAP[t],status:s,time:r,txParams:n,hash:e.hash,type:d.TRANSACTION_TYPES.INCOMING}}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/incoming-transactions.js"}],[22,{"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("@metamask/obs-store"),a=s(e("loglevel"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor(e={}){(0,n.default)(this,"registerOnboarding",(async(e,t)=>{if(this.completedOnboarding)return void a.default.debug("Ignoring registerOnboarding; user already onboarded");const r=c({},this.store.getState().onboardingTabs);r[e]&&r[e]===t||(a.default.debug(`Registering onboarding tab at location '${e}' with tabId '${t}'`),r[e]=t,this.store.updateState({onboardingTabs:r}))}));const t=c(c({seedPhraseBackedUp:null,firstTimeFlowType:null,completedOnboarding:!1},e.initState),{onboardingTabs:{}});this.store=new o.ObservableStore(t)}setSeedPhraseBackedUp(e){this.store.updateState({seedPhraseBackedUp:e})}completeOnboarding(){return this.store.updateState({completedOnboarding:!0}),Promise.resolve(!0)}setFirstTimeFlowType(e){this.store.updateState({firstTimeFlowType:e})}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/onboarding.js"}],[73,{"@babel/runtime/helpers/interopRequireDefault":190,"eth-keyring-controller":1998,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("eth-keyring-controller")),o=s(e("loglevel"));var a={async verifyAccounts(e,t){if(!e||e.length<1)throw new Error("No created accounts defined.");const r=new(new n.default({}).getKeyringClassForType("HD Key Tree"))({mnemonic:t,numberOfAccounts:e.length}),s=await r.getAccounts();if(o.default.debug(`Created accounts: ${JSON.stringify(e)}`),o.default.debug(`Restored accounts: ${JSON.stringify(s)}`),s.length!==e.length)throw new Error("Wrong number of accounts");for(let t=0;t<s.length;t++)if(s[t].toLowerCase()!==e[t].toLowerCase())throw new Error(`Not identical accounts! Original: ${e[t]}, Restored: ${s[t]}`)}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/seed-phrase-verifier.js"}],[64,{"../../../shared/constants/app":3968,"../../../shared/modules/random-id":3985,"../metamask-controller":79,"./util":78,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,buffer:1659,"eth-rpc-errors":2010,"ethereumjs-util":2077,events:1660,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),o=e("@metamask/obs-store"),a=e("ethereumjs-util"),i=e("eth-rpc-errors"),c=s(e("loglevel")),l=e("../../../shared/constants/app"),u=e("../metamask-controller"),d=s(e("../../../shared/modules/random-id")),h=e("./util");const p=/^[0-9A-Fa-f]+$/gu;class f extends n.default{constructor({metricsEvent:e}){super(),this.memStore=new o.ObservableStore({unapprovedPersonalMsgs:{},unapprovedPersonalMsgCount:0}),this.messages=[],this.metricsEvent=e}get unapprovedPersonalMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,s)=>{if(!e.from)return void s(new Error("MetaMask Message Signature: from field is required."));const n=this.addUnapprovedMessage(e,t);this.once(`${n}:finished`,(t=>{switch(t.status){case"signed":return void r(t.rawSig);case"rejected":return void s(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return void s(new Error(`MetaMask Message Signature: ${t.error}`));default:s(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){c.default.debug(`PersonalMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`),t&&(e.origin=t.origin),e.data=this.normalizeMsgData(e.data);const r=(new Date).getTime(),s=(0,d.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:l.MESSAGE_TYPE.PERSONAL_SIGN};return this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:"Transactions",properties:{action:"Sign Request",type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`PersonalMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedPersonalMsgs:e,unapprovedPersonalMsgCount:t}),this.emit(u.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}normalizeMsgData(e){try{const t=(0,a.stripHexPrefix)(e);if(t.match(p))return(0,h.addHexPrefix)(t)}catch(e){c.default.debug("Message was not hex encoded, interpreting as utf8.")}return(0,a.bufferToHex)(t.from(e,"utf8"))}}r.default=f}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/personal-message-manager.js"}],[13,{"../../../shared/constants/app":3968,"../../../shared/constants/metametrics":3972,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,buffer:1659,"ethereumjs-util":2077,lodash:2948},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("lodash"),a=e("@metamask/obs-store"),i=e("ethereumjs-util"),c=e("../../../shared/constants/app"),l=e("../../../shared/constants/metametrics");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const h=e=>{setTimeout((()=>{throw e}))},p={'You must pass either an "anonymousId" or a "userId".':!0};r.default=class{constructor({segment:e,preferencesStore:t,onNetworkDidChange:r,getCurrentChainId:s,getNetworkIdentifier:n,version:o,environment:i,initState:c,captureException:l=h}){this._captureException=e=>{p[e.message]||l(e)};const u=t.getState();this.chainId=s(),this.network=n(),this.locale=u.currentLocale.replace("_","-"),this.version="production"===i?o:`${o}-${i}`,this.store=new a.ObservableStore(d({participateInMetaMetrics:null,metaMetricsId:null},c)),t.subscribe((({currentLocale:e})=>{this.locale=e.replace("_","-")})),r((()=>{this.chainId=s(),this.network=n()})),this.segment=e}generateMetaMetricsId(){return(0,i.bufferToHex)((0,i.keccak)(t.from(String(Date.now())+String(Math.round(Math.random()*Number.MAX_SAFE_INTEGER)))))}setParticipateInMetaMetrics(e){let{metaMetricsId:t}=this.state;return e&&!t?t=this.generateMetaMetricsId():!1===e&&(t=null),this.store.updateState({participateInMetaMetrics:e,metaMetricsId:t}),t}get state(){return this.store.getState()}_buildContext(e,t=l.METAMETRICS_BACKGROUND_PAGE_OBJECT){return{app:{name:"MetaMask Extension",version:this.version},userAgent:window.navigator.userAgent,page:t,referrer:e}}_buildEventPayload(e){var t,r;const{event:s,properties:n,revenue:a,value:i,currency:l,category:u,page:h,referrer:p,environmentType:f=c.ENVIRONMENT_TYPE_BACKGROUND}=e;return{event:s,properties:d(d({},(0,o.omit)(n,["revenue","locale","currency","value"])),{},{revenue:a,value:i,currency:l,category:u,network:null!==(t=null==n?void 0:n.network)&&void 0!==t?t:this.network,locale:this.locale,chain_id:null!==(r=null==n?void 0:n.chain_id)&&void 0!==r?r:this.chainId,environment_type:f}),context:this._buildContext(p,h)}}_track(e,t){var r;const{isOptIn:s,metaMetricsId:n,matomoEvent:o,flushImmediately:a}=t||{};let i="userId",c=this.state.metaMetricsId,u=null!==(r=null==t?void 0:t.excludeMetaMetricsId)&&void 0!==r&&r;return Boolean(e.event.match(/^send|^confirm/iu))&&(u=!0),u||s&&!n?(i="anonymousId",c=l.METAMETRICS_ANONYMOUS_ID):s&&n&&(c=n),e[i]=c,!0===o&&(e.properties.legacy_event=!0),new Promise(((t,r)=>{this.segment.track(e,(e=>{if(e){const t=new Error(e.message);return t.stack=e.stack,r(t)}return t()})),a&&this.segment.flush()}))}trackPage({name:e,params:t,environmentType:r,page:s,referrer:n},o){try{if(!1===this.state.participateInMetaMetrics)return;if(null===this.state.participateInMetaMetrics&&(null==o||!o.isOptInPath))return;const{metaMetricsId:a}=this.state,i=a?"userId":"anonymousId",c=null!=a?a:l.METAMETRICS_ANONYMOUS_ID;this.segment.page({[i]:c,name:e,properties:{params:t,locale:this.locale,network:this.network,chain_id:this.chainId,environment_type:r},context:this._buildContext(n,s)})}catch(e){this._captureException(e)}}trackEvent(e,t){this.validatePayload(e),this.submitEvent(e,t).catch((e=>this._captureException(e)))}async submitEvent(e,t){if(this.validatePayload(e),!(this.state.participateInMetaMetrics||null!=t&&t.isOptIn))return;const r=[];if(e.sensitiveProperties){if(!0===(null==t?void 0:t.excludeMetaMetricsId))throw new Error("sensitiveProperties was specified in an event payload that also set the excludeMetaMetricsId flag");const s=(0,o.merge)(e.sensitiveProperties,e.properties);r.push(this._track(this._buildEventPayload(d(d({},e),{},{properties:s})),d(d({},t),{},{excludeMetaMetricsId:!0})))}r.push(this._track(this._buildEventPayload(e),t)),await Promise.all(r)}validatePayload(e){if(!e.event||!e.category)throw new Error(`Must specify event and category. Event was: ${e.event}. Category was: ${e.category}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`)}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/metametrics.js"}],[9,{"../../../shared/constants/network":3973,"../../../shared/constants/time":3976,"../../../ui/helpers/utils/util":4452,"../constants/contracts":4,"@babel/runtime/helpers/interopRequireDefault":190,loglevel:2959,"single-call-balance-checker-abi":3645,web3:3902},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("web3")),o=e("loglevel"),a=s(e("single-call-balance-checker-abi")),i=e("../constants/contracts"),c=e("../../../shared/constants/time"),l=e("../../../ui/helpers/utils/util"),u=e("../../../shared/constants/network");const d=3*c.MINUTE;r.default=class{constructor({interval:e=d,preferences:t,network:r,keyringMemStore:s,tokenList:n,tokensController:o}={}){var a,i,c;this.tokensController=o,this.preferences=t,this.interval=e,this.network=r,this.keyringMemStore=s,this.tokenList=n,this.selectedAddress=null===(a=this.preferences)||void 0===a?void 0:a.store.getState().selectedAddress,this.tokenAddresses=null===(i=this.tokensController)||void 0===i?void 0:i.state.tokens.map((e=>e.address)),this.hiddenTokens=null===(c=this.tokensController)||void 0===c?void 0:c.state.ignoredTokens,null==t||t.store.subscribe((({selectedAddress:e,useTokenDetection:t})=>{this.selectedAddress===e&&this.useTokenDetection===t||(this.selectedAddress=e,this.useTokenDetection=t,this.restartTokenDetection())})),null==o||o.subscribe((({tokens:e=[],ignoredTokens:t=[]})=>{this.tokenAddresses=e.map((e=>e.address)),this.hiddenTokens=t}))}async _getTokenBalances(e){const t=this.web3.eth.contract(a.default).at(i.SINGLE_CALL_BALANCES_ADDRESS);return new Promise(((r,s)=>{t.balances([this.selectedAddress],e,((e,t)=>e?s(e):r(t)))}))}async detectNewTokens(){if(!this.isActive)return;const{tokenList:e}=this._tokenList.state;if(this._network.store.getState().provider.chainId!==u.MAINNET_CHAIN_ID||0===Object.keys(e).length)return;const t=[];this.web3.setProvider(this._network._provider);for(const r in e)this.tokenAddresses.find((e=>(0,l.isEqualCaseInsensitive)(e,r)))||this.hiddenTokens.find((e=>(0,l.isEqualCaseInsensitive)(e,r)))||t.push(r);const r=[t.slice(0,1e3),t.slice(1e3,t.length-1)];for(const t of r){let r;try{r=await this._getTokenBalances(t)}catch(e){return void(0,o.warn)("MetaMask - DetectTokensController single call balance fetch failed",e)}const s=t.filter(((e,t)=>{const s=r[t];return s&&!s.isZero()}));await Promise.all(s.map((t=>this.tokensController.addToken(t,e[t].symbol,e[t].decimals))))}}restartTokenDetection(){this.isActive&&this.selectedAddress&&(this.detectNewTokens(),this.interval=d)}set interval(e){this._handle&&clearInterval(this._handle),e&&(this._handle=setInterval((()=>{this.detectNewTokens()}),e))}set network(e){e&&(this._network=e,this.web3=new n.default(e._provider))}set keyringMemStore(e){e&&(this._keyringMemStore=e,this._keyringMemStore.subscribe((({isUnlocked:e})=>{this.isUnlocked!==e&&(this.isUnlocked=e,e&&this.restartTokenDetection())})))}set tokenList(e){e&&(this._tokenList=e)}get isActive(){return this.isOpen&&this.isUnlocked}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/detect-tokens.js"}],[62,{"@babel/runtime/helpers/interopRequireDefault":190,"promise-to-callback":3206},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){return function(...r){const s=r[r.length-1];let a,i;"function"==typeof s?(a=s,r.pop()):a=o;try{i=Promise.resolve(e.apply(t,r))}catch(e){i=Promise.reject(e)}(0,n.default)(i)(a)}};var n=s(e("promise-to-callback"));const o=function(e){if(e)throw e}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/nodeify.js"}],[2580,{"./JsonRpcEngine":2575,"./createAsyncMiddleware":2576,"./createScaffoldMiddleware":2577,"./getUniqueId":2578,"./idRemapMiddleware":2579,"./mergeMiddleware":2581},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){s===undefined&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){s===undefined&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),n(e("./idRemapMiddleware"),r),n(e("./createAsyncMiddleware"),r),n(e("./createScaffoldMiddleware"),r),n(e("./getUniqueId"),r),n(e("./JsonRpcEngine"),r),n(e("./mergeMiddleware"),r)}}},{package:"json-rpc-engine",file:"/Users/mac/code/metamask-extension/node_modules/json-rpc-engine/dist/index.js"}],[77,{"../../../shared/constants/app":3968,"../../../shared/modules/hexstring-utils":3983,"../../../shared/modules/random-id":3985,"../metamask-controller":79,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,assert:1270,"eth-rpc-errors":2010,"eth-sig-util":2012,events:1660,jsonschema:2593,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),o=e("assert"),a=e("@metamask/obs-store"),i=e("eth-rpc-errors"),c=e("eth-sig-util"),l=s(e("loglevel")),u=s(e("jsonschema")),d=e("../../../shared/constants/app"),h=e("../metamask-controller"),p=s(e("../../../shared/modules/random-id")),f=e("../../../shared/modules/hexstring-utils");class g extends n.default{constructor({getCurrentChainId:e,metricEvents:t}){super(),this._getCurrentChainId=e,this.memStore=new a.ObservableStore({unapprovedTypedMessages:{},unapprovedTypedMessagesCount:0}),this.messages=[],this.metricEvents=t}get unapprovedTypedMessagesCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t,r){return new Promise(((s,n)=>{const o=this.addUnapprovedMessage(e,t,r);this.once(`${o}:finished`,(t=>{switch(t.status){case"signed":return s(t.rawSig);case"rejected":return n(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return n(new Error(`MetaMask Message Signature: ${t.error}`));default:return n(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t,r){e.version=r,t&&(e.origin=t.origin),this.validateParams(e),l.default.debug(`TypedMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`);const s=(new Date).getTime(),n=(0,p.default)(),o={id:n,msgParams:e,time:s,status:"unapproved",type:d.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA};return this.addMsg(o),this.emit("update"),n}validateParams(e){switch(o.strict.ok(e&&"object"==typeof e,"Params must be an object."),o.strict.ok("data"in e,'Params must include a "data" field.'),o.strict.ok("from"in e,'Params must include a "from" field.'),o.strict.ok("string"==typeof e.from&&(0,f.isValidHexAddress)(e.from,{allowNonPrefixed:!1}),'"from" field must be a valid, lowercase, hexadecimal Ethereum address string.'),e.version){case"V1":o.strict.ok(Array.isArray(e.data),'"params.data" must be an array.'),o.strict.doesNotThrow((()=>{(0,c.typedSignatureHash)(e.data)}),"Signing data must be valid EIP-712 typed data.");break;case"V3":case"V4":{let t;o.strict.equal(typeof e.data,"string",'"params.data" must be a string.'),o.strict.doesNotThrow((()=>{t=JSON.parse(e.data)}),'"data" must be a valid JSON string.');const r=u.default.validate(t,c.TYPED_MESSAGE_SCHEMA);o.strict.ok(t.primaryType in t.types,`Primary type of "${t.primaryType}" has no type definition.`),o.strict.equal(r.errors.length,0,"Signing data must conform to EIP-712 schema. See https://git.io/fNtcx.");let{chainId:s}=t.domain;if(s){const e=parseInt(this._getCurrentChainId(),16);o.strict.ok(!Number.isNaN(e),`Cannot sign messages for chainId "${s}", because MetaMask is switching networks.`),"string"==typeof s&&(s=parseInt(s,s.startsWith("0x")?16:10)),o.strict.equal(s,e,`Provided chainId "${s}" must match the active chainId "${e}"`)}break}default:o.strict.fail(`Unknown typed data version "${e.version}"`)}}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,delete e.version,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:"Transactions",properties:{action:"Sign Request",version:r.msgParams.version,type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`TypedMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t&&"errored"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedTypedMessages:e,unapprovedTypedMessagesCount:t}),this.emit(h.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}r.default=g}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/typed-message-manager.js"}],[11,{"../../../../shared/constants/network":3973,"../../../../shared/modules/hexstring-utils":3983,"./ens":10,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,loglevel:2959,"punycode/punycode":3304},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=s(e("punycode/punycode")),a=e("@metamask/obs-store"),i=s(e("loglevel")),c=e("../../../../shared/constants/network"),l=e("../../../../shared/modules/hexstring-utils"),u=s(e("./ens"));function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor({ens:e,provider:t,onNetworkDidChange:r,getCurrentChainId:s}={}){const n={ensResolutionsByAddress:{}};if(this._ens=e,!this._ens){const e=s(),r=c.CHAIN_ID_TO_NETWORK_ID_MAP[e];u.default.getNetworkEnsSupport(r)&&(this._ens=new u.default({network:r,provider:t}))}this.store=new a.ObservableStore(n),r((()=>{this.store.putState(n);const e=s(),r=c.CHAIN_ID_TO_NETWORK_ID_MAP[e];u.default.getNetworkEnsSupport(r)?this._ens=new u.default({network:r,provider:t}):delete this._ens}))}reverseResolveAddress(e){return this._reverseResolveAddress((0,l.toChecksumHexAddress)(e))}async _reverseResolveAddress(e){if(!this._ens)return undefined;const t=this.store.getState();if(t.ensResolutionsByAddress[e])return t.ensResolutionsByAddress[e];let r,s;try{r=await this._ens.reverse(e)}catch(e){return i.default.debug(e),undefined}try{s=await this._ens.lookup(r)}catch(e){return i.default.debug(e),undefined}return"0x0000000000000000000000000000000000000000"===s||"0x"===s||(0,l.toChecksumHexAddress)(s)!==e?undefined:(this._updateResolutionsByAddress(e,o.default.toASCII(r)),r)}_updateResolutionsByAddress(e,t){const r=this.store.getState();this.store.putState({ensResolutionsByAddress:h(h({},r.ensResolutionsByAddress),{},{[e]:t})})}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/ens/index.js"}],[31,{"../../../../shared/constants/gas":3969,"../../../../shared/constants/network":3973,"../../../../shared/constants/transaction":3977,"../../../../shared/modules/contract-utils":3979,"../../../../shared/modules/conversion.utils":3980,"../../../../shared/modules/transaction.utils":3988,"../../../../ui/helpers/constants/error-keys":4419,"../../../../ui/helpers/constants/transactions":4423,"../../../../ui/helpers/utils/conversions.util":4436,"../../../../ui/pages/swaps/swaps.util":4788,"../../lib/cleanErrorStack":41,"../../lib/util":78,"../../metamask-controller":79,"./lib/util":33,"./pending-tx-tracker":34,"./tx-gas-utils":35,"./tx-state-manager":36,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@ethereumjs/common":397,"@ethereumjs/tx":401,"@metamask/obs-store":1119,"bignumber.js":1530,"eth-rpc-errors":2010,"ethereumjs-util":2077,ethers:2102,"ethjs-query":2127,"human-standard-token-abi":2236,loglevel:2959,"nonce-tracker":3058,"safe-event-emitter":3578},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.TRANSACTION_EVENTS=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=s(e("safe-event-emitter")),a=e("@metamask/obs-store"),i=e("ethereumjs-util"),c=s(e("ethjs-query")),l=e("eth-rpc-errors"),u=s(e("human-standard-token-abi")),d=s(e("@ethereumjs/common")),h=e("@ethereumjs/tx"),p=e("ethers"),f=s(e("nonce-tracker")),g=s(e("loglevel")),m=s(e("bignumber.js")),y=s(e("../../lib/cleanErrorStack")),v=e("../../lib/util"),w=e("../../../../ui/helpers/constants/error-keys"),b=e("../../../../ui/pages/swaps/swaps.util"),k=e("../../../../ui/helpers/utils/conversions.util"),S=e("../../../../shared/constants/transaction"),P=e("../../../../ui/helpers/constants/transactions"),C=e("../../metamask-controller"),T=e("../../../../shared/constants/gas"),_=e("../../../../shared/modules/conversion.utils"),M=e("../../../../shared/constants/network"),A=e("../../../../shared/modules/transaction.utils"),E=e("../../../../shared/modules/contract-utils"),O=s(e("./tx-state-manager")),x=s(e("./tx-gas-utils")),I=s(e("./pending-tx-tracker")),j=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=D(t);if(r&&r.has(e))return r.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(s,o,a):s[o]=e[o]}s.default=e,r&&r.set(e,s);return s}(e("./lib/util"));function D(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(D=function(e){return e?r:t})(e)}function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const U=new p.ethers.utils.Interface(u.default),L={ADDED:"Transaction Added",APPROVED:"Transaction Approved",FINALIZED:"Transaction Finalized",REJECTED:"Transaction Rejected",SUBMITTED:"Transaction Submitted"};r.TRANSACTION_EVENTS=L;class F extends o.default{constructor(e){super(),this.networkStore=e.networkStore||new a.ObservableStore({}),this._getCurrentChainId=e.getCurrentChainId,this.getProviderConfig=e.getProviderConfig,this._getCurrentNetworkEIP1559Compatibility=e.getCurrentNetworkEIP1559Compatibility,this._getCurrentAccountEIP1559Compatibility=e.getCurrentAccountEIP1559Compatibility,this.preferencesStore=e.preferencesStore||new a.ObservableStore({}),this.provider=e.provider,this.getPermittedAccounts=e.getPermittedAccounts,this.blockTracker=e.blockTracker,this.signEthTx=e.signTransaction,this.inProcessOfSigning=new Set,this._trackMetaMetricsEvent=e.trackMetaMetricsEvent,this._getParticipateInMetrics=e.getParticipateInMetrics,this._getEIP1559GasFeeEstimates=e.getEIP1559GasFeeEstimates,this.memStore=new a.ObservableStore({}),this.query=new c.default(this.provider),this.txGasUtil=new x.default(this.provider),this._mapMethods(),this.txStateManager=new O.default({initState:e.initState,txHistoryLimit:e.txHistoryLimit,getNetwork:this.getNetwork.bind(this),getCurrentChainId:e.getCurrentChainId}),this._onBootCleanUp(),this.store=this.txStateManager.store,this.nonceTracker=new f.default({provider:this.provider,blockTracker:this.blockTracker,getPendingTransactions:this.txStateManager.getPendingTransactions.bind(this.txStateManager),getConfirmedTransactions:this.txStateManager.getConfirmedTransactions.bind(this.txStateManager)}),this.pendingTxTracker=new I.default({provider:this.provider,nonceTracker:this.nonceTracker,publishTransaction:e=>this.query.sendRawTransaction(e),getPendingTransactions:()=>[...this.txStateManager.getPendingTransactions(),...this.txStateManager.getApprovedTransactions()],approveTransaction:this.approveTransaction.bind(this),getCompletedTransactions:this.txStateManager.getConfirmedTransactions.bind(this.txStateManager)}),this.txStateManager.store.subscribe((()=>this.emit(C.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE))),this._setupListeners(),this._updateMemstore(),this.txStateManager.store.subscribe((()=>this._updateMemstore())),this.networkStore.subscribe((()=>{this._onBootCleanUp(),this._updateMemstore()})),this._updatePendingTxsAfterFirstBlock()}getChainId(){const e=this.networkStore.getState(),t=this._getCurrentChainId(),r=parseInt(t,16);return"loading"===e||Number.isNaN(r)?0:r}async getEIP1559Compatibility(e){const t=await this._getCurrentNetworkEIP1559Compatibility(),r=await this._getCurrentAccountEIP1559Compatibility(e);return t&&r}async getCommonConfiguration(e){const{type:t,nickname:r}=this.getProviderConfig(),s=await this.getEIP1559Compatibility(e)?M.HARDFORKS.LONDON:M.HARDFORKS.BERLIN;if(t!==M.NETWORK_TYPE_RPC)return new d.default({chain:t,hardfork:s});const n=parseInt(this._getCurrentChainId(),16),o=this.networkStore.getState(),a={name:r,chainId:n,networkId:"loading"===o?0:parseInt(o,10)};return d.default.forCustomChain(M.MAINNET,a,s)}addTransaction(e){this.txStateManager.addTransaction(e),this.emit(`${e.id}:unapproved`,e),this._trackTransactionMetricsEvent(e,L.ADDED)}wipeTransactions(e){this.txStateManager.wipeTransactions(e)}async newUnapprovedTransaction(e,t={}){g.default.debug(`MetaMaskController newUnapprovedTransaction ${JSON.stringify(e)}`);const r=await this.addUnapprovedTransaction(e,t.origin);return new Promise(((e,t)=>{this.txStateManager.once(`${r.id}:finished`,(r=>{switch(r.status){case S.TRANSACTION_STATUSES.SUBMITTED:return e(r.hash);case S.TRANSACTION_STATUSES.REJECTED:return t((0,y.default)(l.ethErrors.provider.userRejectedRequest("MetaMask Tx Signature: User denied transaction signature.")));case S.TRANSACTION_STATUSES.FAILED:return t((0,y.default)(l.ethErrors.rpc.internal(r.err.message)));default:return t((0,y.default)(l.ethErrors.rpc.internal(`MetaMask Tx Signature: Unknown problem: ${JSON.stringify(r.txParams)}`)))}}))}))}async addUnapprovedTransaction(e,t){const r=j.normalizeTxParams(e),s=await this.getEIP1559Compatibility();j.validateTxParams(r,s);let n=this.txStateManager.generateTxMeta({txParams:r,origin:t});if("metamask"===t){if(r.from!==this.getSelectedAddress())throw l.ethErrors.rpc.internal({message:"Internally initiated transaction is using invalid account.",data:{origin:t,fromAddress:r.from,selectedAddress:this.getSelectedAddress()}})}else{if(!(await this.getPermittedAccounts(t)).includes(r.from))throw l.ethErrors.provider.unauthorized({data:{origin:t}})}const{type:o,getCodeResponse:a}=await this._determineTransactionType(e);n.type=o,n.txParams.value=n.txParams.value?(0,v.addHexPrefix)(n.txParams.value):"0x0",this.addTransaction(n),this.emit("newUnapprovedTx",n);try{n=await this.addTxGasDefaults(n,a)}catch(e){throw g.default.warn(e),n=this.txStateManager.getTransaction(n.id),n.loadingDefaults=!1,this.txStateManager.updateTransaction(n,"Failed to calculate gas defaults."),e}return n.loadingDefaults=!1,this.txStateManager.updateTransaction(n,"Added new unapproved transaction."),n}async addTxGasDefaults(e,t){const r=e.txParams.type!==S.TRANSACTION_ENVELOPE_TYPES.LEGACY&&await this.getEIP1559Compatibility(),{gasPrice:s,maxFeePerGas:n,maxPriorityFeePerGas:o}=await this._getDefaultGasFees(e,r),{gasLimit:a,simulationFails:i}=await this._getDefaultGasLimit(e,t);return e=this.txStateManager.getTransaction(e.id),i&&(e.simulationFails=i),r?(!e.txParams.gasPrice||e.txParams.maxFeePerGas||e.txParams.maxPriorityFeePerGas?(n&&o&&!e.txParams.maxFeePerGas&&!e.txParams.maxPriorityFeePerGas||"metamask"===e.origin?e.userFeeLevel=T.GAS_RECOMMENDATIONS.MEDIUM:e.userFeeLevel=T.CUSTOM_GAS_ESTIMATE,n&&!e.txParams.maxFeePerGas&&(e.txParams.maxFeePerGas=n),o&&!e.txParams.maxPriorityFeePerGas&&(e.txParams.maxPriorityFeePerGas=o),s&&!e.txParams.maxFeePerGas&&(e.txParams.maxFeePerGas=s),e.txParams.maxFeePerGas&&!e.txParams.maxPriorityFeePerGas&&(e.txParams.maxPriorityFeePerGas=e.txParams.maxFeePerGas)):(e.txParams.maxFeePerGas=e.txParams.gasPrice,e.txParams.maxPriorityFeePerGas=e.txParams.gasPrice,e.userFeeLevel=T.CUSTOM_GAS_ESTIMATE),delete e.txParams.gasPrice):(delete e.txParams.maxPriorityFeePerGas,delete e.txParams.maxFeePerGas),!s||e.txParams.gasPrice||e.txParams.maxPriorityFeePerGas||e.txParams.maxFeePerGas||(e.txParams.gasPrice=s),a&&!e.txParams.gas&&(e.txParams.gas=a),e}async _getDefaultGasFees(e,t){if(!t&&e.txParams.gasPrice||t&&e.txParams.maxFeePerGas&&e.txParams.maxPriorityFeePerGas)return{};try{const{gasFeeEstimates:e,gasEstimateType:r}=await this._getEIP1559GasFeeEstimates();if(t&&r===T.GAS_ESTIMATE_TYPES.FEE_MARKET){const{medium:{suggestedMaxPriorityFeePerGas:t,suggestedMaxFeePerGas:r}={}}=e;if(t&&r)return{maxFeePerGas:(0,_.decGWEIToHexWEI)(r),maxPriorityFeePerGas:(0,_.decGWEIToHexWEI)(t)}}else{if(r===T.GAS_ESTIMATE_TYPES.LEGACY)return{gasPrice:(0,_.decGWEIToHexWEI)(e.medium)};if(r===T.GAS_ESTIMATE_TYPES.ETH_GASPRICE)return{gasPrice:(0,_.decGWEIToHexWEI)(e.gasPrice)}}}catch(e){console.error(e)}const r=await this.query.gasPrice();return{gasPrice:r&&(0,v.addHexPrefix)(r.toString(16))}}async _getDefaultGasLimit(e,t){const r=this._getCurrentChainId(),s=M.CHAIN_ID_TO_GAS_LIMIT_BUFFER_MAP[r],n=(0,v.getChainType)(r);if(e.txParams.gas)return{};if(e.txParams.to&&e.type===S.TRANSACTION_TYPES.SIMPLE_SEND&&"custom"!==n){if(e.txParams.data){const e=new Error("TxGasUtil - Trying to call a function on a non-contract address");throw e.errorKey=w.TRANSACTION_NO_CONTRACT_ERROR_KEY,e.getCodeResponse=t,e}return{gasLimit:T.GAS_LIMITS.SIMPLE}}const{blockGasLimit:o,estimatedGasHex:a,simulationFails:i}=await this.txGasUtil.analyzeGasUsage(e);return{gasLimit:this.txGasUtil.addGasBuffer((0,v.addHexPrefix)(a),o,s),simulationFails:i}}generateNewGasParams(e,t={},r=11){const{txParams:s}=e,n={},o={};var a;t.gasLimit&&(o.gas=null!==(a=null==t?void 0:t.gas)&&void 0!==a?a:T.GAS_LIMITS.SIMPLE);return t.estimateSuggested&&(o.estimateSuggested=t.estimateSuggested),t.estimateUsed&&(o.estimateUsed=t.estimateUsed),(0,A.isEIP1559Transaction)(e)?(n.maxFeePerGas=s.maxFeePerGas,n.maxPriorityFeePerGas=s.maxPriorityFeePerGas,o.maxFeePerGas=(null==t?void 0:t.maxFeePerGas)||(0,v.bnToHex)((0,v.BnMultiplyByFraction)((0,v.hexToBn)(s.maxFeePerGas),r,10)),o.maxPriorityFeePerGas=(null==t?void 0:t.maxPriorityFeePerGas)||(0,v.bnToHex)((0,v.BnMultiplyByFraction)((0,v.hexToBn)(s.maxPriorityFeePerGas),r,10))):(n.gasPrice=s.gasPrice,o.gasPrice=(null==t?void 0:t.gasPrice)||(0,v.bnToHex)((0,v.BnMultiplyByFraction)((0,v.hexToBn)(s.gasPrice),r,10))),{previousGasParams:n,newGasParams:o}}async createCancelTransaction(e,t,{estimatedBaseFee:r}={}){const s=this.txStateManager.getTransaction(e),{txParams:n}=s,{from:o,nonce:a}=n,{previousGasParams:i,newGasParams:c}=this.generateNewGasParams(s,R(R({},t),{},{gasLimit:t.gasLimit||T.GAS_LIMITS.SIMPLE})),l=this.txStateManager.generateTxMeta({txParams:R({from:o,to:o,nonce:a,value:"0x0"},c),previousGasParams:i,loadingDefaults:!1,status:S.TRANSACTION_STATUSES.APPROVED,type:S.TRANSACTION_TYPES.CANCEL});return r&&(l.estimatedBaseFee=r),this.addTransaction(l),await this.approveTransaction(l.id),l}async createSpeedUpTransaction(e,t,{estimatedBaseFee:r}={}){const s=this.txStateManager.getTransaction(e),{txParams:n}=s,{previousGasParams:o,newGasParams:a}=this.generateNewGasParams(s,t),i=this.txStateManager.generateTxMeta({txParams:R(R({},n),a),previousGasParams:o,loadingDefaults:!1,status:S.TRANSACTION_STATUSES.APPROVED,type:S.TRANSACTION_TYPES.RETRY});return r&&(i.estimatedBaseFee=r),this.addTransaction(i),await this.approveTransaction(i.id),i}async updateTransaction(e){this.txStateManager.updateTransaction(e,"confTx: user updated transaction")}async updateAndApproveTransaction(e){this.txStateManager.updateTransaction(e,"confTx: user approved transaction"),await this.approveTransaction(e.id)}async approveTransaction(e){if(this.inProcessOfSigning.has(e))return;let t;this.inProcessOfSigning.add(e);try{this.txStateManager.setTxStatusApproved(e);const r=this.txStateManager.getTransaction(e),s=r.txParams.from;let{customNonceValue:n}=r;n=Number(n),t=await this.nonceTracker.getNonceLock(s);const o=r.previousGasParams?r.txParams.nonce:t.nextNonce,a=0===n?n:n||o;r.txParams.nonce=(0,v.addHexPrefix)(a.toString(16)),r.nonceDetails=t.nonceDetails,n&&(r.nonceDetails.customNonceValue=n),this.txStateManager.updateTransaction(r,"transactions#approveTransaction");const i=await this.signTransaction(e);await this.publishTransaction(e,i),this._trackTransactionMetricsEvent(r,L.APPROVED),t.releaseLock()}catch(r){try{this._failTransaction(e,r)}catch(e){g.default.error(e)}throw t&&t.releaseLock(),r}finally{this.inProcessOfSigning.delete(e)}}async signTransaction(e){const t=this.txStateManager.getTransaction(e),r=this.getChainId(),s=(0,A.isEIP1559Transaction)(t)?S.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET:S.TRANSACTION_ENVELOPE_TYPES.LEGACY,n=R(R({},t.txParams),{},{type:s,chainId:r,gasLimit:t.txParams.gas}),o=n.from,a=await this.getCommonConfiguration(n.from),c=h.TransactionFactory.fromTxData(n,{common:a}),l=await this.signEthTx(c,o);t.r=(0,i.bufferToHex)(l.r),t.s=(0,i.bufferToHex)(l.s),t.v=(0,i.bufferToHex)(l.v),this.txStateManager.updateTransaction(t,"transactions#signTransaction: add r, s, v values"),this.txStateManager.setTxStatusSigned(t.id);return(0,i.bufferToHex)(l.serialize())}async publishTransaction(e,t){const r=this.txStateManager.getTransaction(e);if(r.rawTx=t,r.type===S.TRANSACTION_TYPES.SWAP){const e=await this.query.getBalance(r.txParams.from);r.preTxBalance=e.toString(16)}let s;this.txStateManager.updateTransaction(r,"transactions#publishTransaction");try{s=await this.query.sendRawTransaction(t)}catch(e){if(!e.message.toLowerCase().includes("known transaction"))throw e;s=(0,i.keccak)((0,i.toBuffer)((0,v.addHexPrefix)(t),"hex")).toString("hex"),s=(0,v.addHexPrefix)(s)}this.setTxHash(e,s),this.txStateManager.setTxStatusSubmitted(e),this._trackTransactionMetricsEvent(r,L.SUBMITTED)}async confirmTransaction(e,t,r){const s=this.txStateManager.getTransaction(e);if(s)try{const n="string"==typeof t.gasUsed?t.gasUsed:t.gasUsed.toString(16);s.txReceipt=R(R({},t),{},{gasUsed:n}),r&&(s.baseFeePerGas=r),this.txStateManager.setTxStatusConfirmed(e),this._markNonceDuplicatesDropped(e);const{submittedTime:o}=s,a={gas_used:n};if(o&&(a.completion_time=this._getTransactionCompletionTime(o)),"0x0"===t.status&&(a.status="failed on-chain"),this._trackTransactionMetricsEvent(s,L.FINALIZED,a),this.txStateManager.updateTransaction(s,"transactions#confirmTransaction - add txReceipt"),s.type===S.TRANSACTION_TYPES.SWAP){const t=await this.query.getBalance(s.txParams.from),r=this.txStateManager.getTransaction(e),n=r.approvalTxId?this.txStateManager.getTransaction(r.approvalTxId):null;r.postTxBalance=t.toString(16),this.txStateManager.updateTransaction(r,"transactions#confirmTransaction - add postTxBalance"),this._trackSwapsMetrics(r,n)}}catch(e){g.default.error(e)}}async cancelTransaction(e){const t=this.txStateManager.getTransaction(e);this.txStateManager.setTxStatusRejected(e),this._trackTransactionMetricsEvent(t,L.REJECTED)}setTxHash(e,t){const r=this.txStateManager.getTransaction(e);r.hash=t,this.txStateManager.updateTransaction(r,"transactions#setTxHash")}_mapMethods(){this.getState=()=>this.memStore.getState(),this.getNetwork=()=>this.networkStore.getState(),this.getSelectedAddress=()=>this.preferencesStore.getState().selectedAddress,this.getUnapprovedTxCount=()=>Object.keys(this.txStateManager.getUnapprovedTxList()).length,this.getPendingTxCount=e=>this.txStateManager.getPendingTransactions(e).length,this.getTransactions=e=>this.txStateManager.getTransactions(e)}async _updatePendingTxsAfterFirstBlock(){await this.blockTracker.getLatestBlock(),await this.pendingTxTracker.updatePendingTxs()}_onBootCleanUp(){this.txStateManager.getTransactions({searchCriteria:{status:S.TRANSACTION_STATUSES.UNAPPROVED,loadingDefaults:!0}}).forEach((e=>{this.addTxGasDefaults(e).then((e=>{e.loadingDefaults=!1,this.txStateManager.updateTransaction(e,"transactions: gas estimation for tx on boot")})).catch((t=>{const r=this.txStateManager.getTransaction(e.id);r.loadingDefaults=!1,this.txStateManager.updateTransaction(r,"failed to estimate gas during boot cleanup."),this._failTransaction(r.id,t)}))})),this.txStateManager.getTransactions({searchCriteria:{status:S.TRANSACTION_STATUSES.APPROVED}}).forEach((e=>{const t=new Error('Transaction found as "approved" during boot - possibly stuck during signing');this._failTransaction(e.id,t)}))}_setupListeners(){this.txStateManager.on("tx:status-update",this.emit.bind(this,"tx:status-update")),this._setupBlockTrackerListener(),this.pendingTxTracker.on("tx:warning",(e=>{this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:warning")})),this.pendingTxTracker.on("tx:failed",((e,t)=>{this._failTransaction(e,t)})),this.pendingTxTracker.on("tx:confirmed",((e,t,r)=>this.confirmTransaction(e,t,r))),this.pendingTxTracker.on("tx:dropped",(e=>{this._dropTransaction(e)})),this.pendingTxTracker.on("tx:block-update",((e,t)=>{e.firstRetryBlockNumber||(e.firstRetryBlockNumber=t,this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:block-update"))})),this.pendingTxTracker.on("tx:retry",(e=>{"retryCount"in e||(e.retryCount=0),e.retryCount+=1,this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:retry")}))}async _determineTransactionType(e){const{data:t,to:r}=e;let s;try{s=t&&U.parseTransaction({data:t}).name}catch(e){g.default.debug("Failed to parse transaction data.",e,t)}const n=[S.TRANSACTION_TYPES.TOKEN_METHOD_APPROVE,S.TRANSACTION_TYPES.TOKEN_METHOD_TRANSFER,S.TRANSACTION_TYPES.TOKEN_METHOD_TRANSFER_FROM].find((e=>e===s&&s.toLowerCase()));let o,a;if(t&&n?o=n:t&&!r&&(o=S.TRANSACTION_TYPES.DEPLOY_CONTRACT),!o){const{contractCode:e,isContractAddress:t}=await(0,E.readAddressAsContract)(this.query,r);a=e,o=t?S.TRANSACTION_TYPES.CONTRACT_INTERACTION:S.TRANSACTION_TYPES.SIMPLE_SEND}return{type:o,getCodeResponse:a}}_markNonceDuplicatesDropped(e){const t=this.txStateManager.getTransaction(e),{nonce:r,from:s}=t.txParams,n=this.txStateManager.getTransactions({searchCriteria:{nonce:r,from:s}});n.length&&n.forEach((r=>{r.id!==e&&(r.replacedBy=t.hash,this.txStateManager.updateTransaction(t,"transactions/pending-tx-tracker#event: tx:confirmed reference to confirmed txHash with same nonce"),this._dropTransaction(r.id))}))}_setupBlockTrackerListener(){let e=!1;const t=this._onLatestBlock.bind(this),{blockTracker:r,txStateManager:s}=this;function n(){const n=s.getPendingTransactions();!e&&n.length>0?(r.on("latest",t),e=!0):e&&!n.length&&(r.removeListener("latest",t),e=!1)}s.on("tx:status-update",n),n()}async _onLatestBlock(e){try{await this.pendingTxTracker.updatePendingTxs()}catch(e){g.default.error(e)}try{await this.pendingTxTracker.resubmitPendingTxs(e)}catch(e){g.default.error(e)}}_updateMemstore(){const e=this.txStateManager.getUnapprovedTxList(),t=this.txStateManager.getTransactions({limit:100});this.memStore.updateState({unapprovedTxs:e,currentNetworkTxList:t})}_trackSwapsMetrics(e,t){if(this._getParticipateInMetrics()&&e.swapMetaData)if("0x0"===e.txReceipt.status)this._trackMetaMetricsEvent({event:"Swap Failed",sensitiveProperties:R({},e.swapMetaData),category:"swaps"});else{const r=(0,b.getSwapsTokensReceivedFromTxMeta)(e.destinationTokenSymbol,e,e.destinationTokenAddress,e.txParams.from,e.destinationTokenDecimals,t,e.chainId),s=r?`${new m.default(r,10).div(e.swapMetaData.token_to_amount,10).times(100).round(2)}%`:null,n=`${new m.default(e.txReceipt.gasUsed,16).div(e.swapMetaData.estimated_gas,10).times(100).round(2)}%`;this._trackMetaMetricsEvent({event:"Swap Completed",category:"swaps",sensitiveProperties:R(R({},e.swapMetaData),{},{token_to_amount_received:r,quote_vs_executionRatio:s,estimated_vs_used_gasRatio:n})})}}_trackTransactionMetricsEvent(e,t,r={}){if(!e)return;const{type:s,time:n,status:o,chainId:a,origin:i,txParams:{gasPrice:c,gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,estimateSuggested:h,estimateUsed:p},metamaskNetworkId:f}=e,g="metamask"===i?"user":"dapp",m={};(0,A.isEIP1559Transaction)(e)?(m.max_fee_per_gas=u,m.max_priority_fee_per_gas=d):m.gas_price=c,h&&(m.estimate_suggested=h),p&&(m.estimate_used=p);const y=this._getGasValuesInGWEI(m);this._trackMetaMetricsEvent({event:t,category:"Transactions",properties:{chain_id:a,referrer:i,source:g,network:f,type:s},sensitiveProperties:R(R({status:o,transaction_envelope_type:(0,A.isEIP1559Transaction)(e)?P.TRANSACTION_ENVELOPE_TYPE_NAMES.FEE_MARKET:P.TRANSACTION_ENVELOPE_TYPE_NAMES.LEGACY,first_seen:n,gas_limit:l},y),r)})}_getTransactionCompletionTime(e){return Math.round((Date.now()-e)/1e3).toString()}_getGasValuesInGWEI(e){const t={};for(const r in e)(0,i.isHexString)(e[r])?t[r]=(0,k.hexWEIToDecGWEI)(e[r]):t[r]=e[r];return t}_failTransaction(e,t){this.txStateManager.setTxStatusFailed(e,t);const r=this.txStateManager.getTransaction(e);this._trackTransactionMetricsEvent(r,L.FINALIZED,{error:t.message})}_dropTransaction(e){this.txStateManager.setTxStatusDropped(e);const t=this.txStateManager.getTransaction(e);this._trackTransactionMetricsEvent(t,L.FINALIZED)}}r.default=F}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/transactions/index.js"}],[74,{"../../../shared/constants/time":3976,"@babel/runtime/helpers/interopRequireDefault":190,_process:3204,"analytics-node":1247},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.segment=r.createSegmentMock=void 0;var n,o,a=s(e("analytics-node")),i=e("../../../shared/constants/time");const c=Boolean(t.env.METAMASK_DEBUG||!1),l=null!==(n="NXLxrQVTKrWL23nm57fBQycLAcETRw9a")?n:null,u=null!==(o=t.env.SEGMENT_HOST)&&void 0!==o?o:null,d=5*i.SECOND,h=(e=1,t=d)=>{const r={queue:[],flush(){r.queue.forEach((([e,t])=>{t()})),r.queue=[]},track(t,s=(()=>undefined)){r.queue.push([t,s]),r.queue.length>=e&&r.flush()},page(){},identify(){}};return setInterval(r.flush,t),r};r.createSegmentMock=h;const p=!l||c&&!u?h(1,d):new a.default(l,{host:u,flushAt:1,flushInterval:d});r.segment=p}).call(this)}).call(this,e("_process"))}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/segment.js"}],[2,{"../lib/util":78,"@babel/runtime/helpers/interopRequireDefault":190,"ethereumjs-util":2077,"ethereumjs-wallet":2083,"ethereumjs-wallet/thirdparty":2098,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("loglevel")),o=s(e("ethereumjs-wallet")),a=s(e("ethereumjs-wallet/thirdparty")),i=e("ethereumjs-util"),c=e("../lib/util");var l={importAccount(e,t){try{const r=(0,this.strategies[e])(...t);return Promise.resolve(r)}catch(e){return Promise.reject(e)}},strategies:{"Private Key":e=>{if(!e)throw new Error("Cannot import an empty key.");const t=(0,c.addHexPrefix)(e),r=(0,i.toBuffer)(t);if(!(0,i.isValidPrivate)(r))throw new Error("Cannot import invalid private key.");return(0,i.stripHexPrefix)(t)},"JSON File":(e,t)=>{let r;try{r=a.default.fromEtherWallet(e,t)}catch(s){n.default.debug("Attempt to import as EtherWallet format failed, trying V3"),r=o.default.fromV3(e,t,!0)}return function(e){const t=e.getPrivateKey();return(0,i.bufferToHex)(t)}(r)}}};r.default=l}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/account-import-strategies/index.js"}],[39,{"../../../shared/constants/network":3973,"../constants/contracts":4,"./util":78,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,"eth-query":2006,loglevel:2959,pify:3199,"single-call-balance-checker-abi":3645,web3:3902},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("eth-query")),o=e("@metamask/obs-store"),a=s(e("loglevel")),i=s(e("pify")),c=s(e("web3")),l=s(e("single-call-balance-checker-abi")),u=e("../../../shared/constants/network"),d=e("../constants/contracts"),h=e("./util");r.default=class{constructor(e={}){this.store=new o.ObservableStore({accounts:{},currentBlockGasLimit:""}),this._provider=e.provider,this._query=(0,i.default)(new n.default(this._provider)),this._blockTracker=e.blockTracker,this._currentBlockNumber=this._blockTracker.getCurrentBlock(),this._blockTracker.once("latest",(e=>{this._currentBlockNumber=e})),this._updateForBlock=this._updateForBlock.bind(this),this.getCurrentChainId=e.getCurrentChainId,this.web3=new c.default(this._provider)}start(){this._blockTracker.removeListener("latest",this._updateForBlock),this._blockTracker.addListener("latest",this._updateForBlock),this._updateAccounts()}stop(){this._blockTracker.removeListener("latest",this._updateForBlock)}syncWithAddresses(e){const{accounts:t}=this.store.getState(),r=Object.keys(t),s=[];e.forEach((e=>{r.includes(e)||s.push(e)}));const n=[];r.forEach((t=>{e.includes(t)||n.push(t)})),this.addAccounts(s),this.removeAccount(n)}addAccounts(e){const{accounts:t}=this.store.getState();e.forEach((e=>{t[e]={}})),this.store.updateState({accounts:t}),this._currentBlockNumber&&this._updateAccounts()}removeAccount(e){const{accounts:t}=this.store.getState();e.forEach((e=>{delete t[e]})),this.store.updateState({accounts:t})}clearAccounts(){this.store.updateState({accounts:{}})}async _updateForBlock(e){this._currentBlockNumber=e;const t=await this._query.getBlockByNumber(e,!1);if(!t)return;const r=t.gasLimit;this.store.updateState({currentBlockGasLimit:r});try{await this._updateAccounts()}catch(e){a.default.error(e)}}async _updateAccounts(){const{accounts:e}=this.store.getState(),t=Object.keys(e);switch(this.getCurrentChainId()){case u.MAINNET_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,d.SINGLE_CALL_BALANCES_ADDRESS);break;case u.RINKEBY_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,d.SINGLE_CALL_BALANCES_ADDRESS_RINKEBY);break;case u.ROPSTEN_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,d.SINGLE_CALL_BALANCES_ADDRESS_ROPSTEN);break;case u.KOVAN_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,d.SINGLE_CALL_BALANCES_ADDRESS_KOVAN);break;default:await Promise.all(t.map(this._updateAccount.bind(this)))}}async _updateAccount(e){const t={address:e,balance:await this._query.getBalance(e)},{accounts:r}=this.store.getState();r[e]&&(r[e]=t,this.store.updateState({accounts:r}))}async _updateAccountsViaBalanceChecker(e,t){const{accounts:r}=this.store.getState();this.web3.setProvider(this._provider);this.web3.eth.contract(l.default).at(t).balances(e,["0x0"],((t,s)=>{if(t)return a.default.warn("MetaMask - Account Tracker single call balance fetch failed",t),void Promise.all(e.map(this._updateAccount.bind(this)));e.forEach(((e,t)=>{const n=s[t]?(0,h.bnToHex)(s[t]):"0x0";r[e]={address:e,balance:n}})),this.store.updateState({accounts:r})}))}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/account-tracker.js"}],[18,{"./network":20},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"NETWORK_EVENTS",{enumerable:!0,get:function(){return s.NETWORK_EVENTS}}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s.default}});var s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(s,a,i):s[a]=e[a]}s.default=e,r&&r.set(e,s);return s}(e("./network"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/network/index.js"}],[29,{"../../../shared/constants/gas":3969,"../../../shared/constants/swaps":3975,"../../../shared/constants/time":3976,"../../../shared/modules/conversion.utils":3980,"../../../shared/modules/swaps.utils":3987,"../../../ui/helpers/utils/fetch-with-cache":4437,"../../../ui/helpers/utils/token-util":4449,"../../../ui/helpers/utils/util":4452,"../../../ui/pages/send/send.utils":4693,"../../../ui/pages/swaps/swaps.util":4788,"./network":18,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,"bignumber.js":1530,ethers:2102,"human-standard-token-abi":2236,lodash:2948,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.utils=r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("ethers"),a=s(e("loglevel")),i=s(e("bignumber.js")),c=e("@metamask/obs-store"),l=e("lodash"),u=s(e("human-standard-token-abi")),d=e("../../../ui/helpers/utils/token-util"),h=e("../../../ui/pages/send/send.utils"),p=e("../../../shared/modules/conversion.utils"),f=e("../../../shared/constants/swaps"),g=e("../../../shared/constants/gas"),m=e("../../../shared/modules/swaps.utils"),y=e("../../../ui/pages/swaps/swaps.util"),v=s(e("../../../ui/helpers/utils/fetch-with-cache")),w=e("../../../shared/constants/time"),b=e("../../../ui/helpers/utils/util"),k=e("./network");function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const C=25e5,T=w.MINUTE;function _(e=25e5,t=0,r=0){const s=new i.default(e,10).minus(t,10);return s.lt(r,16)?s.toString(16):r}const M={swapsState:{quotes:{},quotesPollingLimitEnabled:!1,fetchParams:null,tokens:null,tradeTxId:null,approveTxId:null,quotesLastFetched:null,customMaxGas:"",customGasPrice:null,customMaxFeePerGas:null,customMaxPriorityFeePerGas:null,swapsUserFeeLevel:"",selectedAggId:null,customApproveTxData:"",errorKey:"",topAggId:null,routeState:"",swapsFeatureIsLive:!0,useNewSwapsApi:!1,saveFetchedQuotes:!1,swapsQuoteRefreshTime:T,swapsQuotePrefetchingRefreshTime:T}};function A(e){if(!Array.isArray(e)||0===e.length)throw new Error("Expected non-empty array param.");const t=[...e];if(t.sort(((e,t)=>{const r=new i.default(e.overallValueOfQuote,10),s=new i.default(t.overallValueOfQuote,10);return r.equals(s)?0:r.lessThan(s)?-1:1})),t.length%2==1){const e=t[(t.length-1)/2].overallValueOfQuote;return E(t.filter((t=>e===t.overallValueOfQuote)))}const r=t.length/2,s=r-1,n=t[r].overallValueOfQuote,o=t[s].overallValueOfQuote,a=t.filter((e=>n===e.overallValueOfQuote)),c=t.filter((e=>o===e.overallValueOfQuote)),l=E(a),u=E(c);return{ethFee:new i.default(l.ethFee,10).plus(u.ethFee,10).dividedBy(2).toString(10),metaMaskFeeInEth:new i.default(l.metaMaskFeeInEth,10).plus(u.metaMaskFeeInEth,10).dividedBy(2).toString(10),ethValueOfTokens:new i.default(l.ethValueOfTokens,10).plus(u.ethValueOfTokens,10).dividedBy(2).toString(10)}}function E(e){const t=e.reduce(((e,t)=>({ethFee:e.ethFee.plus(t.ethFee,10),metaMaskFeeInEth:e.metaMaskFeeInEth.plus(t.metaMaskFeeInEth,10),ethValueOfTokens:e.ethValueOfTokens.plus(t.ethValueOfTokens,10)})),{ethFee:new i.default(0,10),metaMaskFeeInEth:new i.default(0,10),ethValueOfTokens:new i.default(0,10)});return{ethFee:t.ethFee.div(e.length,10).toString(10),metaMaskFeeInEth:t.metaMaskFeeInEth.div(e.length,10).toString(10),ethValueOfTokens:t.ethValueOfTokens.div(e.length,10).toString(10)}}r.default=class{constructor({getBufferedGasLimit:e,networkController:t,provider:r,getProviderConfig:s,getTokenRatesState:n,fetchTradesInfo:a=y.fetchTradesInfo,getCurrentChainId:i,getEIP1559GasFeeEstimates:l}){this.store=new c.ObservableStore({swapsState:P({},M.swapsState)}),this._fetchTradesInfo=a,this._getCurrentChainId=i,this._getEIP1559GasFeeEstimates=l,this.getBufferedGasLimit=e,this.getTokenRatesState=n,this.pollCount=0,this.getProviderConfig=s,this.indexOfNewestCallInFlight=0,this.ethersProvider=new o.ethers.providers.Web3Provider(r),this._currentNetwork=t.store.getState().network,t.on(k.NETWORK_EVENTS.NETWORK_DID_CHANGE,(e=>{"loading"!==e&&e!==this._currentNetwork&&(this._currentNetwork=e,this.ethersProvider=new o.ethers.providers.Web3Provider(r))}))}async fetchSwapsRefreshRates(e,t){const r=await(0,v.default)((0,y.getBaseApi)("network",e,t),{method:"GET"},{cacheRefreshTime:6e5}),{refreshRates:s}=r||{};if(!s||"number"!=typeof s.quotes||"number"!=typeof s.quotesPrefetching)throw new Error(`MetaMask - invalid response for refreshRates: ${r}`);return{quotes:1e3*s.quotes,quotesPrefetching:1e3*s.quotesPrefetching}}async _setSwapsRefreshRates(){var e,t;const r=this._getCurrentChainId(),{swapsState:s}=this.store.getState();let n;try{n=await this.fetchSwapsRefreshRates(r,s.useNewSwapsApi)}catch(e){console.error("Request for swaps quote refresh time failed: ",e)}const{swapsState:o}=this.store.getState();this.store.updateState({swapsState:P(P({},o),{},{swapsQuoteRefreshTime:(null===(e=n)||void 0===e?void 0:e.quotes)||T,swapsQuotePrefetchingRefreshTime:(null===(t=n)||void 0===t?void 0:t.quotesPrefetching)||T})})}pollForNewQuotes(){const{swapsState:{swapsQuoteRefreshTime:e,swapsQuotePrefetchingRefreshTime:t,quotesPollingLimitEnabled:r}}=this.store.getState(),s=r?e:t;this.pollingTimeout=setTimeout((()=>{var e;const{swapsState:t}=this.store.getState();this.fetchAndSetQuotes(t.fetchParams,null===(e=t.fetchParams)||void 0===e?void 0:e.metaData,!0)}),s)}stopPollingForQuotes(){this.pollingTimeout&&clearTimeout(this.pollingTimeout)}async fetchAndSetQuotes(e,t={},r){const{chainId:s}=t,{swapsState:{useNewSwapsApi:n,quotesPollingLimitEnabled:o,saveFetchedQuotes:a}}=this.store.getState();if(!e)return null;r||(this.pollCount=0),clearTimeout(this.pollingTimeout),r||this.setSwapsErrorKey("");const i=this.indexOfNewestCallInFlight+1;this.indexOfNewestCallInFlight=i,a||this.setSaveFetchedQuotes(!0);let[c]=await Promise.all([this._fetchTradesInfo(e,P(P({},t),{},{useNewSwapsApi:n})),this._setSwapsRefreshRates()]);const{swapsState:{saveFetchedQuotes:u}}=this.store.getState();if(!u)return[{},null];c=(0,l.mapValues)(c,(e=>P(P({},e),{},{sourceTokenInfo:t.sourceTokenInfo,destinationTokenInfo:t.destinationTokenInfo})));const d=Date.now();let h=!1;if(!(0,m.isSwapsDefaultTokenAddress)(e.sourceToken,s)&&Object.values(c).length){if(h=(await this._getERC20Allowance(e.sourceToken,e.fromAddress,s)).eq(0)&&"wrappedNative"!==Object.values(c)[0].aggregator,h){if(!r){const{gasLimit:e}=await this.timedoutGasReturn(Object.values(c)[0].approvalNeeded);c=(0,l.mapValues)(c,(t=>P(P({},t),{},{approvalNeeded:P(P({},t.approvalNeeded),{},{gas:e||f.DEFAULT_ERC20_APPROVE_GAS})})))}}else c=(0,l.mapValues)(c,(e=>P(P({},e),{},{approvalNeeded:null})))}let p=null;if(h||null!=e&&e.balanceError||(c=await this.getAllQuotesWithGasEstimates(c)),0===Object.values(c).length)this.setSwapsErrorKey(f.QUOTES_NOT_AVAILABLE_ERROR);else{const[e,t]=await this._findTopQuoteAndCalculateSavings(c);p=e,c=t}if(this.indexOfNewestCallInFlight!==i)throw new Error(f.SWAPS_FETCH_ORDER_CONFLICT);const{swapsState:g}=this.store.getState();let{selectedAggId:y}=g;return c[y]||(y=null),this.store.updateState({swapsState:P(P({},g),{},{quotes:c,fetchParams:P(P({},e),{},{metaData:t}),quotesLastFetched:d,selectedAggId:y,topAggId:p})}),o&&(this.pollCount+=1),!o||this.pollCount<4?(this.pollForNewQuotes(),[c,p]):(this.resetPostFetchState(),this.setSwapsErrorKey(f.QUOTES_EXPIRED_ERROR),null)}safeRefetchQuotes(){const{swapsState:e}=this.store.getState();!this.pollingTimeout&&e.fetchParams&&this.fetchAndSetQuotes(e.fetchParams)}setSelectedQuoteAggId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{selectedAggId:e})})}setSwapsTokens(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{tokens:e})})}clearSwapsQuotes(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:P(P({},e),{},{quotes:{}})})}setSwapsErrorKey(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{errorKey:e})})}async getAllQuotesWithGasEstimates(e){const t=await Promise.all(Object.values(e).map((async e=>{const{gasLimit:t,simulationFails:r}=await this.timedoutGasReturn(e.trade);return[t,r,e.aggregator]}))),r={};return t.forEach((([t,s,n])=>{if(t&&!s){const s=_(e[n].maxGas,e[n].estimatedRefund,t);r[n]=P(P({},e[n]),{},{gasEstimate:t,gasEstimateWithRefund:s})}else e[n].approvalNeeded&&(r[n]=e[n])})),r}timedoutGasReturn(e){return new Promise((t=>{let r=!1;const s=setTimeout((()=>{r=!0,t({gasLimit:null,simulationFails:!0})}),5*w.SECOND),n={data:e.data,from:e.from,to:e.to,value:e.value};this.getBufferedGasLimit({txParams:n},1).then((({gasLimit:e,simulationFails:n})=>{r||(clearTimeout(s),t({gasLimit:e,simulationFails:n}))})).catch((e=>{a.default.error(e),r||(clearTimeout(s),t({gasLimit:null,simulationFails:!0}))}))}))}async setInitialGasEstimate(e){const{swapsState:t}=this.store.getState(),r=P({},t.quotes[e]),{gasLimit:s,simulationFails:n}=await this.timedoutGasReturn(r.trade);if(s&&!n){const e=_(r.maxGas,r.estimatedRefund,s);r.gasEstimate=s,r.gasEstimateWithRefund=e}this.store.updateState({swapsState:P(P({},t),{},{quotes:P(P({},t.quotes),{},{[e]:r})})})}setApproveTxId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{approveTxId:e})})}setTradeTxId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{tradeTxId:e})})}setQuotesLastFetched(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{quotesLastFetched:e})})}setSwapsTxGasPrice(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{customGasPrice:e})})}setSwapsTxMaxFeePerGas(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{customMaxFeePerGas:e})})}setSwapsUserFeeLevel(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{swapsUserFeeLevel:e})})}setSwapsQuotesPollingLimitEnabled(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{quotesPollingLimitEnabled:e})})}setSwapsTxMaxFeePriorityPerGas(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{customMaxPriorityFeePerGas:e})})}setSwapsTxGasLimit(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{customMaxGas:e})})}setCustomApproveTxData(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{customApproveTxData:e})})}setBackgroundSwapRouteState(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{routeState:e})})}setSaveFetchedQuotes(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:P(P({},t),{},{saveFetchedQuotes:e})})}setSwapsLiveness(e){const{swapsState:t}=this.store.getState(),{swapsFeatureIsLive:r,useNewSwapsApi:s}=e;this.store.updateState({swapsState:P(P({},t),{},{swapsFeatureIsLive:r,useNewSwapsApi:s})})}resetPostFetchState(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:P(P({},M.swapsState),{},{tokens:e.tokens,fetchParams:e.fetchParams,swapsFeatureIsLive:e.swapsFeatureIsLive,useNewSwapsApi:e.useNewSwapsApi,swapsQuoteRefreshTime:e.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsQuotePrefetchingRefreshTime})}),clearTimeout(this.pollingTimeout)}resetSwapsState(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:P(P({},M.swapsState),{},{swapsQuoteRefreshTime:e.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsQuotePrefetchingRefreshTime})}),clearTimeout(this.pollingTimeout)}async _findTopQuoteAndCalculateSavings(e={}){const{contractExchangeRates:t}=this.getTokenRatesState(),{swapsState:{customGasPrice:r,customMaxPriorityFeePerGas:s}}=this.store.getState(),n=this._getCurrentChainId();if(!Object.keys(e).length)return{};const o=(0,l.cloneDeep)(e),{gasFeeEstimates:a,gasEstimateType:c}=await this._getEIP1559GasFeeEstimates();let u="0x0";if(c===g.GAS_ESTIMATE_TYPES.FEE_MARKET){const{high:{suggestedMaxPriorityFeePerGas:e},estimatedBaseFee:t}=a;u=(0,p.addCurrencies)(s||(0,p.decGWEIToHexWEI)(e),(0,p.decGWEIToHexWEI)(t),{aBase:16,bBase:16,toNumericBase:"hex",numberOfDecimals:6})}else c===g.GAS_ESTIMATE_TYPES.LEGACY?u=r||(0,p.decGWEIToHexWEI)(a.high):c===g.GAS_ESTIMATE_TYPES.ETH_GASPRICE&&(u=r||(0,p.decGWEIToHexWEI)(a.gasPrice));let f=null,y=null;Object.values(o).forEach((e=>{const{aggregator:r,approvalNeeded:s,averageGas:o,destinationAmount:a=0,destinationToken:c,destinationTokenInfo:l,gasEstimate:g,sourceAmount:v,sourceToken:w,trade:k,fee:S}=e,P=(g?new i.default(g,16):new i.default(o||C,10)).plus((null==s?void 0:s.gas)||"0x0",16).toString(16),T=(0,h.calcGasTotal)(P,u),_=new i.default(T,16).plus(k.value,16),M=(0,p.conversionUtil)(_,{fromCurrency:"ETH",fromDenomination:"WEI",toDenomination:"ETH",fromNumericBase:"BN",numberOfDecimals:6}),A=(0,m.isSwapsDefaultTokenAddress)(w,n)?(0,p.conversionUtil)(_.minus(v,10),{fromCurrency:"ETH",fromDenomination:"WEI",toDenomination:"ETH",fromNumericBase:"BN",numberOfDecimals:6}):M,E=(0,d.calcTokenAmount)(a,l.decimals),O=new i.default(100,10).minus(S,10).div(100),x=E.div(O).minus(E),I=t[Object.keys(t).find((e=>(0,b.isEqualCaseInsensitive)(e,c)))],j=I||1,D=E.times(j.toString(10),10),N=(0,m.isSwapsDefaultTokenAddress)(c,n)?1:I,R=N===undefined?D:D.minus(A,10);e.ethFee=A.toString(10),N!==undefined&&(e.ethValueOfTokens=D.toString(10),e.overallValueOfQuote=R.toString(10),e.metaMaskFeeInEth=x.times(N.toString(10)).toString(10)),(null===y||R.gt(y))&&(f=r,y=R)}));let v=null;if((0,m.isSwapsDefaultTokenAddress)(o[f].destinationToken,n)||Boolean(t[Object.keys(t).find((e=>{var t;return(0,b.isEqualCaseInsensitive)(e,null===(t=o[f])||void 0===t?void 0:t.destinationToken)}))])){const e=o[f];v={};const{ethFee:t,metaMaskFeeInEth:r,ethValueOfTokens:s}=A(Object.values(o));v.performance=new i.default(e.ethValueOfTokens,10).minus(s,10),v.fee=new i.default(t).minus(e.ethFee,10),v.metaMaskFee=e.metaMaskFeeInEth,v.total=v.performance.plus(v.fee).minus(v.metaMaskFee).toString(10),v.performance=v.performance.toString(10),v.fee=v.fee.toString(10),v.medianMetaMaskFee=r,o[f].isBestQuote=!0,o[f].savings=v}return[f,o]}async _getERC20Allowance(e,t,r){const s=new o.ethers.Contract(e,u.default,this.ethersProvider);return await s.allowance(t,f.SWAPS_CHAINID_CONTRACT_ADDRESS_MAP[r])}};const O={getMedianEthValueQuote:A,meansOfQuotesFeesAndValue:E};r.utils=O}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/swaps.js"}],[1071,{"@ethereumjs/tx":401,buffer:1659,"eth-sig-util":1072,"ethereumjs-util":2077,events:1660,hdkey:1075},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const{EventEmitter:s}=e("events"),n=e("hdkey"),o=e("ethereumjs-util"),a=e("eth-sig-util"),{TransactionFactory:i}=e("@ethereumjs/tx"),c="m",l="Ledger Hardware",u={ropsten:"http://api-ropsten.etherscan.io",kovan:"http://api-kovan.etherscan.io",rinkeby:"https://api-rinkeby.etherscan.io",mainnet:"https://api.etherscan.io"};class d extends s{constructor(e={}){super(),this.accountDetails={},this.bridgeUrl=null,this.type=l,this.page=0,this.perPage=5,this.unlockedAccount=0,this.hdk=new n,this.paths={},this.iframe=null,this.network="mainnet",this.implementFullBIP44=!1,this.deserialize(e),this.iframeLoaded=!1,this._setupIframe()}serialize(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts,accountDetails:this.accountDetails,bridgeUrl:this.bridgeUrl,implementFullBIP44:!1})}deserialize(e={}){return this.hdPath=e.hdPath||"m/44'/60'/0'",this.bridgeUrl=e.bridgeUrl||"https://metamask.github.io/eth-ledger-bridge-keyring",this.accounts=e.accounts||[],this.accountDetails=e.accountDetails||{},e.accountDetails||this._migrateAccountDetails(e),this.implementFullBIP44=e.implementFullBIP44||!1,this.accounts=this.accounts.filter((e=>Object.keys(this.accountDetails).includes(o.toChecksumAddress(e)))),Promise.resolve()}_migrateAccountDetails(e){if(this._isLedgerLiveHdPath()&&e.accountIndexes)for(const t of Object.keys(e.accountIndexes))this.accountDetails[t]={bip44:!0,hdPath:this._getPathForIndex(e.accountIndexes[t])};this._isLedgerLiveHdPath()||this.accounts.filter((e=>!Object.keys(this.accountDetails).includes(o.toChecksumAddress(e)))).forEach((e=>{try{this.accountDetails[o.toChecksumAddress(e)]={bip44:!1,hdPath:this._pathFromAddress(e)}}catch(t){console.log(`failed to migrate account ${e}`)}}))}isUnlocked(){return Boolean(this.hdk&&this.hdk.publicKey)}setAccountToUnlock(e){this.unlockedAccount=parseInt(e,10)}setHdPath(e){this.hdPath!==e&&(this.hdk=new n),this.hdPath=e}unlock(e){if(this.isUnlocked()&&!e)return Promise.resolve("already unlocked");const t=e?this._toLedgerPath(e):this.hdPath;return new Promise(((e,s)=>{this._sendMessage({action:"ledger-unlock",params:{hdPath:t}},(({success:t,payload:n})=>{t?(this.hdk.publicKey=r.from(n.publicKey,"hex"),this.hdk.chainCode=r.from(n.chainCode,"hex"),e(n.address)):s(n.error||new Error("Unknown error"))}))}))}addAccounts(e=1){return new Promise(((t,r)=>{this.unlock().then((async r=>{const s=this.unlockedAccount,n=s+e;for(let e=s;e<n;e++){const t=this._getPathForIndex(e);let r;r=this._isLedgerLiveHdPath()?await this.unlock(t):this._addressFromIndex(c,e),this.accountDetails[o.toChecksumAddress(r)]={bip44:this._isLedgerLiveHdPath(),hdPath:t},this.accounts.includes(r)||this.accounts.push(r),this.page=0}t(this.accounts)})).catch(r)}))}getFirstPage(){return this.page=0,this.__getPage(1)}getNextPage(){return this.__getPage(1)}getPreviousPage(){return this.__getPage(-1)}getAccounts(){return Promise.resolve(this.accounts.slice())}removeAccount(e){if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase())),delete this.accountDetails[o.toChecksumAddress(e)]}attemptMakeApp(){return new Promise(((e,t)=>{this._sendMessage({action:"ledger-make-app"},(({success:r,error:s})=>{r?e(!0):t(s)}))}))}updateTransportMethod(e){return new Promise(((t,r)=>{this.iframeLoaded?this._sendMessage({action:"ledger-update-transport",params:{transportType:e}},(({success:e})=>{e?t(!0):r(new Error("Ledger transport could not be updated"))})):this.delayedPromise={resolve:t,reject:r,transportType:e}}))}signTransaction(e,t){let s;if("function"==typeof t.getChainId)return t.v=o.bufferToHex(t.getChainId()),t.r="0x00",t.s="0x00",s=t.serialize().toString("hex"),this._signTransaction(e,s,(e=>(t.v=r.from(e.v,"hex"),t.r=r.from(e.r,"hex"),t.s=r.from(e.s,"hex"),t)));const n=t.getMessageToSign(!1);return s=r.isBuffer(n)?n.toString("hex"):o.rlp.encode(n).toString("hex"),this._signTransaction(e,s,(e=>{const r=t.toJSON();return r.type=t.type,r.v=o.addHexPrefix(e.v),r.r=o.addHexPrefix(e.r),r.s=o.addHexPrefix(e.s),i.fromTxData(r,{common:t.common,freeze:Object.isFrozen(t)})}))}_signTransaction(e,t,r){return new Promise(((s,n)=>{this.unlockAccountByAddress(e).then((e=>{this._sendMessage({action:"ledger-sign-transaction",params:{tx:t,hdPath:e}},(({success:e,payload:t})=>{if(e){const e=r(t);e.verifySignature()?s(e):n(new Error("Ledger: The transaction signature is not valid"))}else n(t.error||new Error("Ledger: Unknown error while signing transaction"))}))})).catch(n)}))}signMessage(e,t){return this.signPersonalMessage(e,t)}signPersonalMessage(e,t){return new Promise(((r,s)=>{this.unlockAccountByAddress(e).then((n=>{this._sendMessage({action:"ledger-sign-personal-message",params:{hdPath:n,message:o.stripHexPrefix(t)}},(({success:n,payload:i})=>{if(n){let n=i.v-27;n=n.toString(16),n.length<2&&(n=`0${n}`);const c=`0x${i.r}${i.s}${n}`,l=a.recoverPersonalSignature({data:t,sig:c});o.toChecksumAddress(l)!==o.toChecksumAddress(e)&&s(new Error("Ledger: The signature doesnt match the right address")),r(c)}else s(i.error||new Error("Ledger: Unknown error while signing message"))}))})).catch(s)}))}async unlockAccountByAddress(e){const t=o.toChecksumAddress(e);if(!Object.keys(this.accountDetails).includes(t))throw new Error(`Ledger: Account for address '${t}' not found`);const{hdPath:r}=this.accountDetails[t];if((await this.unlock(r)).toLowerCase()!==e.toLowerCase())throw new Error(`Ledger: Account ${e} does not belong to the connected device`);return r}async signTypedData(e,t,r={}){const s="V4"===r.version;if(!s)throw new Error("Ledger: Only version 4 of typed data signing is supported");const{domain:n,types:i,primaryType:c,message:l}=a.TypedDataUtils.sanitizeData(t),u=a.TypedDataUtils.hashStruct("EIP712Domain",n,i,s).toString("hex"),d=a.TypedDataUtils.hashStruct(c,l,i,s).toString("hex"),h=await this.unlockAccountByAddress(e),{success:p,payload:f}=await new Promise((e=>{this._sendMessage({action:"ledger-sign-typed-data",params:{hdPath:h,domainSeparatorHex:u,hashStructMessageHex:d}},(t=>e(t)))}));if(p){let r=f.v-27;r=r.toString(16),r.length<2&&(r=`0${r}`);const s=`0x${f.r}${f.s}${r}`,n=a.recoverTypedSignature_v4({data:t,sig:s});if(o.toChecksumAddress(n)!==o.toChecksumAddress(e))throw new Error("Ledger: The signature doesnt match the right address");return s}throw f.error||new Error("Ledger: Unknown error while signing message")}exportAccount(){throw new Error("Not supported on this device")}forgetDevice(){this.accounts=[],this.page=0,this.unlockedAccount=0,this.paths={},this.accountDetails={},this.hdk=new n}_setupIframe(){this.iframe=document.createElement("iframe"),this.iframe.src=this.bridgeUrl,this.iframe.allow="hid 'src'",this.iframe.onload=async()=>{if(this.iframeLoaded=!0,this.delayedPromise)try{const e=await this.updateTransportMethod(this.delayedPromise.transportType);this.delayedPromise.resolve(e)}catch(e){this.delayedPromise.reject(e)}finally{delete this.delayedPromise}},document.head.appendChild(this.iframe)}_getOrigin(){const e=this.bridgeUrl.split("/");return e.splice(-1,1),e.join("/")}_sendMessage(e,t){e.target="LEDGER-IFRAME",this.iframe.contentWindow.postMessage(e,"*");const r=({origin:s,data:n})=>s===this._getOrigin()&&(n&&n.action&&n.action===`${e.action}-reply`&&t?(t(n),undefined):(window.removeEventListener("message",r),undefined));window.addEventListener("message",r)}async __getPage(e){this.page+=e,this.page<=0&&(this.page=1);const t=(this.page-1)*this.perPage,r=t+this.perPage;let s;return await this.unlock(),s=this._isLedgerLiveHdPath()?await this._getAccountsBIP44(t,r):this._getAccountsLegacy(t,r),s}async _getAccountsBIP44(e,t){const r=[];for(let s=e;s<t;s++){const e=this._getPathForIndex(s),t=await this.unlock(e),n=!this.implementFullBIP44||await this._hasPreviousTransactions(t);if(r.push({address:t,balance:null,index:s}),!n)break}return r}_getAccountsLegacy(e,t){const r=[];for(let s=e;s<t;s++){const e=this._addressFromIndex(c,s);r.push({address:e,balance:null,index:s}),this.paths[o.toChecksumAddress(e)]=s}return r}_padLeftEven(e){return e.length%2==0?e:`0${e}`}_normalize(e){return this._padLeftEven(o.bufferToHex(e).toLowerCase())}_addressFromIndex(e,t){const r=this.hdk.derive(`${e}/${t}`),s=o.publicToAddress(r.publicKey,!0).toString("hex");return o.toChecksumAddress(`0x${s}`)}_pathFromAddress(e){const t=o.toChecksumAddress(e);let r=this.paths[t];if(void 0===r)for(let e=0;e<1e3;e++)if(t===this._addressFromIndex(c,e)){r=e;break}if(void 0===r)throw new Error("Unknown address");return this._getPathForIndex(r)}_toAscii(e){let t="",r=0;const s=e.length;for("0x"===e.substring(0,2)&&(r=2);r<s;r+=2){const s=parseInt(e.substr(r,2),16);t+=String.fromCharCode(s)}return t}_getPathForIndex(e){return this._isLedgerLiveHdPath()?`m/44'/60'/${e}'/0/0`:`${this.hdPath}/${e}`}_isLedgerLiveHdPath(){return"m/44'/60'/0'/0/0"===this.hdPath}_toLedgerPath(e){return e.toString().replace("m/","")}async _hasPreviousTransactions(e){const t=this._getApiUrl(),r=await window.fetch(`${t}/api?module=account&action=txlist&address=${e}&tag=latest&page=1&offset=1`),s=await r.json();return"0"!==s.status&&s.result.length>0}_getApiUrl(){return u[this.network]||u.mainnet}}d.type=l,t.exports=d}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"/Users/mac/code/metamask-extension/node_modules/@metamask/eth-ledger-bridge-keyring/index.js"}],[72,{"./createMethodMiddleware":65,"@babel/runtime/helpers/interopRequireDefault":190},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return n.default}});var n=s(e("./createMethodMiddleware"))}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/lib/rpc-method-middleware/index.js"}],[2028,{"@ethereumjs/tx":401,buffer:1659,"ethereumjs-util":2077,events:1660,hdkey:2029,"trezor-connect":3758},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const{EventEmitter:s}=e("events"),n=e("ethereumjs-util"),o=e("hdkey"),a=e("trezor-connect").default,{TransactionFactory:i}=e("@ethereumjs/tx"),c="Trezor Hardware",l={email:"support@metamask.io",appUrl:"https://metamask.io"};class u extends s{constructor(e={}){super(),this.type=c,this.accounts=[],this.hdk=new o,this.page=0,this.perPage=5,this.unlockedAccount=0,this.paths={},this.deserialize(e),a.manifest(l)}serialize(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts,page:this.page,paths:this.paths,perPage:this.perPage,unlockedAccount:this.unlockedAccount})}deserialize(e={}){return this.hdPath=e.hdPath||"m/44'/60'/0'/0",this.accounts=e.accounts||[],this.page=e.page||0,this.perPage=e.perPage||5,Promise.resolve()}isUnlocked(){return Boolean(this.hdk&&this.hdk.publicKey)}unlock(){return this.isUnlocked()?Promise.resolve("already unlocked"):new Promise(((e,t)=>{a.getPublicKey({path:this.hdPath,coin:"ETH"}).then((s=>{s.success?(this.hdk.publicKey=r.from(s.payload.publicKey,"hex"),this.hdk.chainCode=r.from(s.payload.chainCode,"hex"),e("just unlocked")):t(new Error(s.payload&&s.payload.error||"Unknown error"))})).catch((e=>{t(new Error(e&&e.toString()||"Unknown error"))}))}))}setAccountToUnlock(e){this.unlockedAccount=parseInt(e,10)}addAccounts(e=1){return new Promise(((t,r)=>{this.unlock().then((r=>{const s=this.unlockedAccount,n=s+e;for(let e=s;e<n;e++){const t=this._addressFromIndex("m",e);this.accounts.includes(t)||this.accounts.push(t),this.page=0}t(this.accounts)})).catch((e=>{r(e)}))}))}getFirstPage(){return this.page=0,this.__getPage(1)}getNextPage(){return this.__getPage(1)}getPreviousPage(){return this.__getPage(-1)}__getPage(e){return this.page+=e,this.page<=0&&(this.page=1),new Promise(((e,t)=>{this.unlock().then((t=>{const r=(this.page-1)*this.perPage,s=r+this.perPage,o=[];for(let e=r;e<s;e++){const t=this._addressFromIndex("m",e);o.push({address:t,balance:null,index:e}),this.paths[n.toChecksumAddress(t)]=e}e(o)})).catch((e=>{t(e)}))}))}getAccounts(){return Promise.resolve(this.accounts.slice())}removeAccount(e){if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase()))}signTransaction(e,t){if("function"==typeof t.getChainId)return this._signTransaction(e,t.getChainId(),t,(e=>(t.v=r.from(e.v,"hex"),t.r=r.from(e.r,"hex"),t.s=r.from(e.s,"hex"),t)));const s=i.fromTxData(t.toJSON(),{common:t.common,freeze:!1});return s.v=new n.BN(n.addHexPrefix(t.common.chainId()),"hex"),this._signTransaction(e,t.common.chainIdBN().toNumber(),s,(e=>{const r=t.toJSON();return r.v=n.addHexPrefix(e.v),r.r=n.addHexPrefix(e.r),r.s=n.addHexPrefix(e.s),i.fromTxData(r,{common:t.common,freeze:Object.isFrozen(t)})}))}async _signTransaction(e,t,r,s){try{const i=await this.unlock();await(o="just unlocked"===i?1e3:0,new Promise((e=>setTimeout(e,o))));const c=await a.ethereumSignTransaction({path:this._pathFromAddress(e),transaction:{to:this._normalize(r.to),value:this._normalize(r.value),data:this._normalize(r.data),chainId:t,nonce:this._normalize(r.nonce),gasLimit:this._normalize(r.gasLimit),gasPrice:this._normalize(r.gasPrice)}});if(c.success){const t=s(c.payload),r=n.toChecksumAddress(n.addHexPrefix(t.getSenderAddress().toString("hex")));if(r!==n.toChecksumAddress(e))throw new Error("signature doesn't match the right address");return t}throw new Error(c.payload&&c.payload.error||"Unknown error")}catch(e){throw new Error(e&&e.toString()||"Unknown error")}var o}signMessage(e,t){return this.signPersonalMessage(e,t)}signPersonalMessage(e,t){return new Promise(((r,s)=>{this.unlock().then((o=>{setTimeout((o=>{a.ethereumSignMessage({path:this._pathFromAddress(e),message:n.stripHexPrefix(t),hex:!0}).then((t=>{if(t.success){t.payload.address!==n.toChecksumAddress(e)&&s(new Error("signature doesnt match the right address"));const o=`0x${t.payload.signature}`;r(o)}else s(new Error(t.payload&&t.payload.error||"Unknown error"))})).catch((e=>{s(new Error(e&&e.toString()||"Unknown error"))}))}),"just unlocked"===o?1e3:0)})).catch((e=>{s(new Error(e&&e.toString()||"Unknown error"))}))}))}signTypedData(){return Promise.reject(new Error("Not supported on this device"))}exportAccount(){return Promise.reject(new Error("Not supported on this device"))}forgetDevice(){this.accounts=[],this.hdk=new o,this.page=0,this.unlockedAccount=0,this.paths={}}_normalize(e){return n.bufferToHex(e).toString()}_addressFromIndex(e,t){const r=this.hdk.derive(`${e}/${t}`),s=n.publicToAddress(r.publicKey,!0).toString("hex");return n.toChecksumAddress(`0x${s}`)}_pathFromAddress(e){const t=n.toChecksumAddress(e);let r=this.paths[t];if(void 0===r)for(let e=0;e<1e3;e++)if(t===this._addressFromIndex("m",e)){r=e;break}if(void 0===r)throw new Error("Unknown address");return`${this.hdPath}/${r}`}}u.type=c,t.exports=u}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"eth-trezor-keyring",file:"/Users/mac/code/metamask-extension/node_modules/eth-trezor-keyring/index.js"}],[1966,{"./block-cache":1961,"./block-ref":1963,"./block-ref-rewrite":1962,"./block-tracker-inspector":1964,"./fetch":1965,"./inflight-cache":1967,"./providerAsMiddleware":1968,"./providerFromEngine":1969,"./providerFromMiddleware":1970,"./retryOnEmpty":1971,"./wallet":1973},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){s===undefined&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){s===undefined&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),n(e("./block-cache"),r),n(e("./block-ref-rewrite"),r),n(e("./block-ref"),r),n(e("./block-tracker-inspector"),r),n(e("./fetch"),r),n(e("./inflight-cache"),r),n(e("./providerAsMiddleware"),r),n(e("./providerFromEngine"),r),n(e("./providerFromMiddleware"),r),n(e("./retryOnEmpty"),r),n(e("./wallet"),r)}}},{package:"eth-json-rpc-middleware",file:"/Users/mac/code/metamask-extension/node_modules/eth-json-rpc-middleware/dist/index.js"}],[1999,{"@ethereumjs/common":397,"@ethereumjs/tx":401,"bignumber.js":2e3,buffer:1659,crypto:1742,"ethereumjs-util":2077,events:1660,"gridplus-sdk":2170},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const s=e("crypto"),n=e("events").EventEmitter,o=e("bignumber.js"),a=e("gridplus-sdk"),i=e("@ethereumjs/tx"),c=e("@ethereumjs/common").default,l=e("ethereumjs-util"),u="Lattice Hardware";class d extends n{constructor(e={}){super(),this.type=u,this._resetDefaults(),this.deserialize(e)}deserialize(e={}){return e.hdPath&&(this.hdPath=e.hdPath),e.creds&&(this.creds=e.creds),e.accounts&&(this.accounts=e.accounts),e.accountIndices&&(this.accountIndices=e.accountIndices),e.accountOpts&&(this.accountOpts=e.accountOpts),e.walletUID&&(this.walletUID=e.walletUID),e.name&&(this.appName=e.name),e.appName&&(this.appName=e.appName),e.network&&(this.network=e.network),e.page&&(this.page=e.page),Promise.resolve()}setHdPath(e){this.hdPath=e}serialize(){return Promise.resolve({creds:this.creds,accounts:this.accounts,accountIndices:this.accountIndices,accountOpts:this.accountOpts,walletUID:this.walletUID,appName:this.appName,name:this.name,network:this.network,page:this.page,hdPath:this.hdPath})}isUnlocked(){return this._hasCreds()&&this._hasSession()}unlock(){return new Promise(((e,t)=>{if(!this.accountOpts||this.accounts.length>0&&this.accountOpts.length!=this.accounts.length)return this.forgetDevice(),t(new Error("You can now add multiple Lattice and SafeCard accounts at the same time! "+"Your accounts have been cleared. Please press Continue to add them back in."));this._getCreds().then((e=>(e&&(this.creds.deviceID=e.deviceID,this.creds.password=e.password,this.creds.endpoint=e.endpoint||null),this._initSession()))).then((()=>this._connect())).then((()=>e("Unlocked"))).catch((e=>t(new Error(e))))}))}addAccounts(e=1){return new Promise(((t,r)=>-1e3===e?(this.forgetDevice(),t([])):e<=0?r("Number of accounts to add must be a positive number."):void this.unlock().then((()=>this._fetchAddresses(e,this.unlockedAccount))).then((e=>{const r=this._getCurrentWalletUID();return e.forEach(((e,t)=>{let s=!1;for(let t=0;t<this.accounts.length;t++)this.accounts[t]===e&&this.accountOpts[t].walletUID===r&&this.accountOpts[t].hdPath===this.hdPath&&(s=!0);s||(this.accounts.push(e),this.accountIndices.push(this.unlockedAccount+t),this.accountOpts.push({walletUID:r,hdPath:this.hdPath}))})),t(this.accounts)})).catch((e=>r(new Error(e))))))}getAccounts(){return Promise.resolve(this.accounts?this.accounts.slice():[].slice())}signTransaction(e,t){return new Promise(((r,s)=>{this._unlockAndFindAccount(e).then((e=>{if(!t.to)return s("Contract deployment is not supported by the Lattice at this time. "+"`to` field must be included.");const r=this.accountIndices[e],n=this.accountOpts[e].hdPath,o={chainId:`0x${this._getEthereumJsChainId(t).toString("hex")}`||1,nonce:`0x${t.nonce.toString("hex")}`||0,gasLimit:`0x${t.gasLimit.toString("hex")}`,to:t.to.toString("hex"),value:`0x${t.value.toString("hex")}`,data:0===t.data.length?null:`0x${t.data.toString("hex")}`,signerPath:this._getHDPathIndices(n,r)};switch(t._type){case 2:if(null===t.maxPriorityFeePerGas||null===t.maxFeePerGas||t.maxPriorityFeePerGas===undefined||t.maxFeePerGas===undefined)throw new Error("`maxPriorityFeePerGas` and `maxFeePerGas` must be included for EIP1559 transactions.");o.maxPriorityFeePerGas=`0x${t.maxPriorityFeePerGas.toString("hex")}`,o.maxFeePerGas=`0x${t.maxFeePerGas.toString("hex")}`,o.accessList=t.accessList||[],o.type=2;break;case 1:o.accessList=t.accessList||[],o.gasPrice=`0x${t.gasPrice.toString("hex")}`,o.type=1;break;default:o.gasPrice=`0x${t.gasPrice.toString("hex")}`,o.type=null}const a=this.sdkSession.fwVersion[2]<1&&this.sdkSession.fwVersion[1]<11;return a&&2===o.type?(console.warn("Lattice firmware must be >=0.11.0 to support EIP1559 transactions. Revering to legacy."),o.gasPrice=o.maxFeePerGas,o.revertToLegacy=!0,delete o.type,delete o.maxFeePerGas,delete o.maxPriorityFeePerGas,delete o.accessList):a&&1===o.type&&(console.warn("Lattice firmware must be >=0.11.0 to support EIP2930 transactions. Reverting to legacy."),o.revertToLegacy=!0,delete o.type,delete o.accessList),this._signTxData(o)})).then((e=>{if(!(e.sig&&e.sig.v&&e.sig.r&&e.sig.s))return s(new Error("No signature returned."));const n=t.toJSON(),a=0===e.sig.v.length?"0":e.sig.v.toString("hex");let u;n.r=l.addHexPrefix(e.sig.r.toString("hex")),n.s=l.addHexPrefix(e.sig.s.toString("hex")),n.v=l.addHexPrefix(a),!0===e.revertToLegacy?(n.type=0,n.gasPrice=e.gasPrice):n.type=e.type;const d=`0x${this._getEthereumJsChainId(t).toString("hex")}`,h=new o(d).toNumber(),p=c.forCustomChain("mainnet",{name:"notMainnet",networkId:h,chainId:h},"london");return u=i.TransactionFactory.fromTxData(n,{common:p,freeze:Object.isFrozen(t)}),r(u)})).catch((e=>s(new Error(e))))}))}signPersonalMessage(e,t){return this.signMessage(e,{payload:t,protocol:"signPersonal"})}signTypedData(e,t,r){if(r.version&&"V4"!==r.version&&"V3"!==r.version)throw new Error(`Only signTypedData V3 and V4 messages (EIP712) are supported. Got version ${r.version}`);return this.signMessage(e,{payload:t,protocol:"eip712"})}signMessage(e,t){return new Promise(((r,s)=>{this._unlockAndFindAccount(e).then((e=>{let{payload:n,protocol:o}=t;n&&o||(n=t,o="signPersonal");const a=this.accountIndices[e],i=this.accountOpts[e].hdPath,c={currency:"ETH_MSG",data:{protocol:o,payload:n,signerPath:this._getHDPathIndices(i,a)}};if(!this._hasSession())return s(new Error("No SDK session started. Cannot sign transaction."));this.sdkSession.sign(c,((e,t)=>{if(e)return s(new Error(e));if(!t.sig)return s(new Error("No signature returned"));try{let e=t.sig.v.toString("hex");return e.length<2&&(e=`0${e}`),r(`0x${t.sig.r}${t.sig.s}${e}`)}catch(e){return s(new Error("Invalid signature format returned."))}}))})).catch((e=>s(new Error(e))))}))}exportAccount(e){return Promise.reject(Error("exportAccount not supported by this device"))}removeAccount(e){this.accounts.forEach(((t,r)=>{if(t.toLowerCase()===e.toLowerCase())return this.accounts.splice(r,1),this.accountIndices.splice(r,1),void this.accountOpts.splice(r,1)}))}getFirstPage(){return this.page=0,this._getPage(0)}getNextPage(){return this._getPage(1)}getPreviousPage(){return this._getPage(-1)}setAccountToUnlock(e){this.unlockedAccount=parseInt(e,10)}forgetDevice(){this._resetDefaults()}_unlockAndFindAccount(e){return new Promise(((t,r)=>{this.unlock().then((()=>this.getAccounts())).then((s=>{let n=null;return s.forEach(((t,r)=>{e.toLowerCase()===t.toLowerCase()&&(n=r)})),null===n?r("Signer not present"):this.accountOpts[n].walletUID!==this._getCurrentWalletUID()?r(new Error("Account on a different wallet. "+"Please switch to the correct wallet on your Lattice.")):t(n)})).catch((e=>r(e)))}))}_getHDPathIndices(e,t=0){const r=e.split("/").slice(1),s=[];let n=!1;if(r.forEach((e=>{const r="'"===e[e.length-1];let o=r?2147483648:0;e.indexOf("x")>-1?(o+=t,n=!0):o+=Number(r?e.slice(0,e.length-1):e),s.push(o)})),!1===n&&s.push(t),s.length>5)throw new Error("Only HD paths with up to 5 indices are allowed.");return s}_resetDefaults(){this.accounts=[],this.accountIndices=[],this.accountOpts=[],this.isLocked=!0,this.creds={deviceID:null,password:null,endpoint:null},this.walletUID=null,this.sdkSession=null,this.page=0,this.unlockedAccount=0,this.network=null,this.hdPath="m/44'/60'/0'/0/x"}_openConnectorTab(e){return new Promise(((t,r)=>{const s=window.open(e);return s?t({chromium:s}):browser&&browser.tabs&&browser.tabs.create?void browser.tabs.create({url:e}).then((e=>t({firefox:e}))).catch((e=>r(new Error("Failed to open Lattice connector.")))):r(new Error("Unknown browser context. Cannot open Lattice connector."))}))}_findTabById(e){return new Promise(((t,r)=>{browser.tabs.query({}).then((r=>(r.forEach((r=>{if(r.id===e)return t(r)})),t(null)))).catch((e=>r(e)))}))}_getCreds(){return new Promise(((e,t)=>{if(this._hasCreds())return e();const s=this.appName?this.appName:"Unknown",n="https://wallet.gridplus.io",o=`${n}?keyring=${s}&forceLogin=true`;let a;function i(r){if(r.origin===n){try{clearInterval(a)}catch(e){console.warn("Failed to close interval",e)}try{const s=JSON.parse(r.data);return s.deviceID&&s.password?e(s):t(new Error("Invalid credentials returned from Lattice."))}catch(e){return t(e)}}}this._openConnectorTab(o).then((s=>{if(s.chromium)window.addEventListener("message",i,!1),a=setInterval((()=>{if(s.chromium.closed)return clearInterval(a),t(new Error("Lattice connector closed."))}),500);else if(s.firefox){const n="&loginCache=";a=setInterval((()=>{this._findTabById(s.firefox.id).then((s=>{if(!s||!s.url)return t(new Error("Lattice connector closed."));const o=s.url.indexOf(n);if(o<0)return;const i=o+n.length;clearInterval(a);try{const n=r.from(s.url.slice(i),"base64").toString();browser.tabs.remove(s.id).then((()=>{const r=JSON.parse(n);return r.deviceID&&r.password?e(r):t(new Error("Invalid credentials returned from Lattice."))}))}catch(e){return t("Failed to get login data from Lattice. Please try again.")}}))}),500)}}))}))}_connect(){return new Promise(((e,t)=>{this.sdkSession.connect(this.creds.deviceID,(r=>{if(r)return t(r);const s=this.sdkSession.getActiveWallet();if(!s||!s.uid)return t(new Error("No active wallet"));const n=s.uid.toString("hex");return n!=this.walletUID&&(this.walletUID=n),e()}))}))}_initSession(){return new Promise(((e,t)=>{if(this._hasSession())return e();try{let t="https://signing.gridpl.us";this.creds.endpoint&&(t=this.creds.endpoint);const r={name:this.appName,baseUrl:t,crypto:s,timeout:12e4,privKey:this._genSessionKey(),network:this.network};return this.sdkSession=new a.Client(r),e()}catch(e){return t(e)}}))}_fetchAddresses(e=1,t=0,r=[]){return new Promise(((r,s)=>{if(!this._hasSession())return s("No SDK session started. Cannot fetch addresses.");this.__fetchAddresses(e,t,((e,t)=>e?s(e):r(t)))}))}__fetchAddresses(e=1,t=0,r,s=[]){if(0===e)return r(null,s);const n=this._hdPathHasInternalVarIdx(),o={currency:"ETH",startPath:this._getHDPathIndices(this.hdPath,t),n:n?1:e,skipCache:!0};this.sdkSession.getAddresses(o,((o,a)=>o?r(o):a.length<1?r(new Error("No addresses returned")):n?this.__fetchAddresses(e-1,t+1,r,s.concat(a)):r(null,a)))}_signTxData(e){return new Promise(((t,r)=>{if(!this._hasSession())return r(new Error("No SDK session started. Cannot sign transaction."));this.sdkSession.sign({currency:"ETH",data:e},((s,n)=>s?r(s):n.tx?(n.type=e.type,e.revertToLegacy&&(n.revertToLegacy=!0,n.gasPrice=e.gasPrice),t(n)):r(new Error("No transaction payload returned."))))}))}_getPage(e=0){return new Promise(((t,r)=>{this.page+=e,this.page<0&&(this.page=0);const s=5*this.page;this.unlock().then((()=>this._fetchAddresses(5,s))).then((e=>{const r=[];return e.forEach(((e,t)=>{r.push({address:e,balance:null,index:s+t})})),t(r)})).catch((e=>r(e)))}))}_hasCreds(){return null!==this.creds.deviceID&&null!==this.creds.password&&this.appName}_hasSession(){return this.sdkSession&&this.walletUID}_genSessionKey(){if(this.name&&!this.appName&&(this.appName=this.name),!this._hasCreds())throw new Error("No credentials -- cannot create session key!");const e=r.concat([r.from(this.creds.password),r.from(this.creds.deviceID),r.from(this.appName)]);return s.createHash("sha256").update(e).digest()}_hdPathHasInternalVarIdx(){const e=this.hdPath.split("/").slice(1);for(let t=0;t<e.length-1;t++)if(e[t].indexOf("x")>-1)return!0;return!1}_getEthereumJsChainId(e){return"function"==typeof e.getChainId?e.getChainId():e.common&&"function"==typeof e.common.chainIdBN?e.common.chainIdBN().toString(16):"number"==typeof e.chainId?e.chainId.toString(16):"string"==typeof e.chainId?e.chainId:"1"}_getCurrentWalletUID(){return this.sdkSession?this.sdkSession.getActiveWallet().uid.toString("hex"):null}}d.type=u,t.exports=d}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"eth-lattice-keyring",file:"/Users/mac/code/metamask-extension/node_modules/eth-lattice-keyring/index.js"}],[14,{"../../../shared/constants/labels":3971,"../../../ui/helpers/utils/fetch":4438,"../../../ui/helpers/utils/util":4452,"../../../ui/misesPages/accountSet/misesNetwork.util":4487,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,"mises-js-sdk":2974},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=s(e("mises-js-sdk")),a=e("@metamask/obs-store"),i=e("../../../ui/misesPages/accountSet/misesNetwork.util"),c=e("../../../ui/helpers/utils/fetch"),l=e("../../../ui/helpers/utils/util"),u=e("../../../shared/constants/labels");function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor({exportAccount:e,getKeyringAccounts:t}){this.exportAccount=e,this.getKeyringAccounts=t,this.store=new a.ObservableStore({priKeyHex:"",accountList:[],transformFlag:"loading"});const r=o.default.newConfig();this.coinDefine=o.default.newCoinDefine(),this.coinDefine.load(),r.setLCDEndpoint(i.MISES_POINT),this.misesSdk=o.default.newSdk(r),this.misesUser=this.misesSdk.userMgr(),this.misesAppMgr=this.misesSdk.appMgr(),console.log(this.misesSdk,this.misesUser,this.misesAppMgr)}async activate(e){return console.log("拿到了priKeyHex",e),this.misesUser.activateUser(e)}getServerToken(e){return(0,c.request)({url:(0,i.getBaseApi)("signin"),method:"POST",body:e})}getActive(){return this.misesUser.activeUser()}async getMisesUserInfo(e){try{console.log("获取用户数据");const t=(new Date).getTime(),r=this.misesUser.activeUser(),s=await this.generateAuth(t),{accountList:n}=this.store.getState(),o=await this.getUserBalance(e),a=r.address(),i=n.find((t=>t.address===e))||{address:e,auth:s,misesBalance:o,misesId:a};if(!i.token){const{token:e}=await this.getServerToken({provider:"mises",user_authz:{auth:s}});i.token=e;const t=n.findIndex((e=>e.address===i.address));t>-1?n[t]=i:(console.log(n,i,"account"),n.push(i)),this.store.updateState({accountList:n})}if(await r.isRegistered()){const e=await r.info();return console.log(e,a,"用户数据"),{nickname:e.name||(0,l.shortenAddress)(a,u.MISES_TRUNCATED_ADDRESS_START_CHARS),avatar:e.avatarUrl,misesId:a,token:i.token}}return{token:i.token,misesId:a}}catch(e){return console.log(e,"error"),Promise.reject(e)}}async generateAuth(e,t){let r=this.misesUser.activeUser();return r||(r=await this.misesUser.activateUser(t)),r.generateAuth(e)}setToMisesPrivate(e){return console.log("准备i调用setMisesId",e),window.localStorage.setItem("setAccount",!0),new Promise((t=>chrome.misesPrivate?(chrome.misesPrivate.setMisesId(JSON.stringify(e)),t()):(console.log("chrome.misesPrivate对象不存在"),t("not defind setMisesId Function"))))}lockAll(){}async setUserInfo(e){try{const t=this.misesUser.activeUser(),r=(await t.info()).version.add(1);console.log(h(h({},e),{},{version:r}));const s=await t.setInfo(h(h({},e),{},{version:r})),{accountList:n}=this.store.getState(),o=t.address(),{token:a}=n.find((e=>e.misesId===o))||{};return console.log(a),a&&this.setToMisesPrivate({nickname:e.name||(0,l.shortenAddress)(o,u.MISES_TRUNCATED_ADDRESS_START_CHARS),avatar:e.avatarUrl,token:a,misesId:o}),console.log("setinfo success",s),s}catch(e){return console.log(e,"error"),!1}}setUnFollow(e){return this.misesUser.activeUser().follow(e)}setFollow(e){return this.misesUser.activeUser().unfollow(e)}async connect({domain:e,appid:t,userid:r,permissions:s}){console.log({domain:e,appid:t,userid:r,permissions:s},"connect");try{await this.misesAppMgr.ensureApp(t,e);const n=await this.misesSdk.connect(e,t,r,s);return console.log(n,"connect"),n}catch(e){return console.log(e,"wqeeeeee"),!1}}disconnect({appid:e,userid:t}){return console.log({appid:e,userid:t},"disconnect"),this.misesSdk.disconnect(e,t)}async initMisesBalance(){const e=(await this.getKeyringAccounts()).map((async e=>({address:e,misesBalance:await this.getUserBalance(e),misesId:(await this.getMisesUser(e)).address()})));await Promise.all(e).then((e=>{console.log(e,"accountList"),this.store.updateState({accountList:e})}))}async getMisesUser(e){const t=await this.exportAccount(e);return await this.misesUser.getUser(t)}async addressToMisesId(e){return(await this.getMisesUser(e)).address()}async getUserBalance(e){try{const t=await this.getMisesUser(e),r=await t.getBalanceUMIS();if(t&&r){const e=await this.coinDefine.toCoinMIS(r);return e.denom=e.denom.toUpperCase(),e}return Promise.resolve({amount:"0",denom:"MIS"})}catch(e){return console.log(e),Promise.resolve({amount:"0",denom:"MIS"})}}async setMisesBook(e,t){try{const r=this.misesUser.activeUser(),s=this.coinDefine.fromCoin({amount:t,denom:"mis"}),n=await r.sendUMIS(e,s);return this.store.updateState({transformFlag:n.height>0?"success":"error"}),!0}catch(e){return console.log(e,"wwww"),this.store.updateState({transformFlag:"error"}),!1}}resetTranstionFlag(){this.store.updateState({transformFlag:"loading"})}async recentTransactions(){try{const e=this.misesUser.activeUser();let t=await e.recentTransactions();return t=t.map((t=>{t.rawLog=JSON.parse(t.rawLog),t.raw=t.rawLog[0].events,console.log(t);const r=t.raw[3].attributes,s=r[2].value.replace("umis","|").split("|"),n=this.coinDefine.fromCoin({amount:s[0],denom:"umis"}),o=this.coinDefine.toCoinMIS(n);o.denom=o.denom.toUpperCase();return{category:r[0].value===e.address()?"receive":"send",date:`${t.height}`,displayedStatusKey:"confirmed",isPending:!1,primaryCurrency:`${o.amount} ${o.denom}`,recipientAddress:r[0].value,secondaryCurrency:`${o.amount} ${o.denom}`,senderAddress:r[1].value,subtitle:"",subtitleContainsOrigin:!1,title:"",nonce:"0x0",transactionGroupType:"mises",hasCancelled:!1,hasRetried:!1,initialTransaction:{id:"0x0"},primaryTransaction:{err:{},status:""}}})),console.log(t),t}catch(e){return console.log(e),Promise.reject(e)}}getAccountFlag(){return window.localStorage.getItem("setAccount")}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/mises.js"}],[28,{"../../../shared/constants/hardware-wallets":3970,"../../../shared/constants/network":3973,"../../../shared/modules/network.utils":3984,"./network":18,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,assert:1270,"eth-sig-util":2012,ethers:2102,loglevel:2959},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=e("assert"),a=e("@metamask/obs-store"),i=e("eth-sig-util"),c=e("ethers"),l=s(e("loglevel")),u=e("../../../shared/constants/network"),d=e("../../../shared/modules/network.utils"),h=e("../../../shared/constants/hardware-wallets"),p=e("./network");function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor(e={}){const t=g({frequentRpcListDetail:[],useBlockie:!1,useNonceField:!1,usePhishDetect:!0,dismissSeedBackUpReminder:!1,useTokenDetection:!1,advancedGasFee:null,featureFlags:{showIncomingTransactions:!0},knownMethodData:{},currentLocale:e.initLangCode,identities:{},lostIdentities:{},forgottenPassword:!1,preferences:{autoLockTimeLimit:undefined,showFiatInTestnets:!1,showTestNetworks:!1,useNativeCurrencyAsPrimaryCurrency:!0,hideZeroBalanceTokens:!1},ipfsGateway:"dweb.link",infuraBlocked:null,ledgerTransportType:window.navigator.hid?h.LEDGER_TRANSPORT_TYPES.WEBHID:h.LEDGER_TRANSPORT_TYPES.U2F},e.initState);this.network=e.network,this.ethersProvider=new c.ethers.providers.Web3Provider(e.provider),this.store=new a.ObservableStore(t),this.store.setMaxListeners(12),this.openPopup=e.openPopup,this.migrateAddressBookState=e.migrateAddressBookState,this._subscribeToInfuraAvailability(),global.setPreference=(e,t)=>this.setFeatureFlag(e,t)}setPasswordForgotten(e){this.store.updateState({forgottenPassword:e})}setUseBlockie(e){this.store.updateState({useBlockie:e})}setUseNonceField(e){this.store.updateState({useNonceField:e})}setUsePhishDetect(e){this.store.updateState({usePhishDetect:e})}setUseTokenDetection(e){this.store.updateState({useTokenDetection:e})}setAdvancedGasFee(e){this.store.updateState({advancedGasFee:e})}addKnownMethodData(e,t){const{knownMethodData:r}=this.store.getState();r[e]=t,this.store.updateState({knownMethodData:r})}setCurrentLocale(e){const t=["ar","dv","fa","he","ku"].includes(e)?"rtl":"auto";return this.store.updateState({currentLocale:e,textDirection:t}),t}setAddresses(e){const t=this.store.getState().identities,r=e.reduce(((e,r,s)=>{const n=t[r]||{};return e[r]=g({name:`Account ${s+1}`,address:r},n),e}),{});this.store.updateState({identities:r})}removeAddress(e){const{identities:t}=this.store.getState();if(!t[e])throw new Error(`${e} can't be deleted cause it was not found`);if(delete t[e],this.store.updateState({identities:t}),e===this.getSelectedAddress()){const e=Object.keys(t)[0];this.setSelectedAddress(e)}return e}addAddresses(e){const{identities:t}=this.store.getState();e.forEach((e=>{if(t[e])return;const r=Object.keys(t).length;t[e]={name:`Account ${r+1}`,address:e}})),this.store.updateState({identities:t})}syncAddresses(e){if(!Array.isArray(e)||0===e.length)throw new Error("Expected non-empty array of addresses. Error #11201");const{identities:t,lostIdentities:r}=this.store.getState(),s={};Object.keys(t).forEach((r=>{e.includes(r)||(s[r]=t[r],delete t[r])})),Object.keys(s).length>0&&Object.keys(s).forEach((e=>{r[e]=s[e]})),this.store.updateState({identities:t,lostIdentities:r}),this.addAddresses(e);let n=this.getSelectedAddress();return e.includes(n)||(n=e[0],this.setSelectedAddress(n)),n}setSelectedAddress(e){const t=(0,i.normalize)(e),{identities:r}=this.store.getState(),s=r[t];if(!s)throw new Error(`Identity for '${t} not found`);s.lastSelected=Date.now(),this.store.updateState({identities:r,selectedAddress:t})}getSelectedAddress(){return this.store.getState().selectedAddress}setAccountLabel(e,t){if(!e)throw new Error(`setAccountLabel requires a valid address, got ${String(e)}`);const r=(0,i.normalize)(e),{identities:s}=this.store.getState();return s[r]=s[r]||{},s[r].name=t,this.store.updateState({identities:s}),Promise.resolve(t)}async updateRpc(e){const t=this.getFrequentRpcListDetail(),r=t.findIndex((t=>t.rpcUrl===e.rpcUrl));if(r>-1){const s=t[r],n=g(g({},s),e);if(s.chainId!==n.chainId){let r=s.chainId;if(!r)try{r=await this.ethersProvider.send("net_version"),(0,o.strict)("string"==typeof r)}catch(e){l.default.debug(e),l.default.warn(`Failed to get networkId from ${s.rpcUrl}; skipping address book migration`)}let a=!1;const i=Object.values(u.NETWORK_TYPE_TO_ID_MAP).map((e=>e.networkId)),c=t.filter((t=>t.rpcUrl!==e.rpcUrl));(i.includes(r)||c.some((e=>e.chainId===r)))&&(a=!0),this.migrateAddressBookState(r,n.chainId,a)}t[r]=n,this.store.updateState({frequentRpcListDetail:t})}else{const{rpcUrl:t,chainId:r,ticker:s,nickname:n,rpcPrefs:o={}}=e;this.addToFrequentRpcList(t,r,s,n,o)}}addToFrequentRpcList(e,t,r="ETH",s="",n={}){const o=this.getFrequentRpcListDetail(),a=o.findIndex((t=>t.rpcUrl===e));if(-1!==a&&o.splice(a,1),!(0,d.isPrefixedFormattedHexString)(t))throw new Error(`Invalid chainId: "${t}"`);o.push({rpcUrl:e,chainId:t,ticker:r,nickname:s,rpcPrefs:n}),this.store.updateState({frequentRpcListDetail:o})}removeFromFrequentRpcList(e){const t=this.getFrequentRpcListDetail(),r=t.findIndex((t=>t.rpcUrl===e));return-1!==r&&t.splice(r,1),this.store.updateState({frequentRpcListDetail:t}),Promise.resolve(t)}getFrequentRpcListDetail(){return this.store.getState().frequentRpcListDetail}setFeatureFlag(e,t){const r=g(g({},this.store.getState().featureFlags),{},{[e]:t});return this.store.updateState({featureFlags:r}),Promise.resolve(r)}setPreference(e,t){const r=g(g({},this.getPreferences()),{},{[e]:t});return this.store.updateState({preferences:r}),Promise.resolve(r)}getPreferences(){return this.store.getState().preferences}getIpfsGateway(){return this.store.getState().ipfsGateway}setIpfsGateway(e){return this.store.updateState({ipfsGateway:e}),Promise.resolve(e)}setLedgerTransportPreference(e){return this.store.updateState({ledgerTransportType:e}),e}getLedgerTransportPreference(){return this.store.getState().ledgerTransportType}async setDismissSeedBackUpReminder(e){await this.store.updateState({dismissSeedBackUpReminder:e})}_subscribeToInfuraAvailability(){this.network.on(p.NETWORK_EVENTS.INFURA_IS_BLOCKED,(()=>{this._setInfuraBlocked(!0)})),this.network.on(p.NETWORK_EVENTS.INFURA_IS_UNBLOCKED,(()=>{this._setInfuraBlocked(!1)}))}_setInfuraBlocked(e){const{infuraBlocked:t}=this.store.getState();t!==e&&this.store.updateState({infuraBlocked:e})}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/preferences.js"}],[1998,{bip39:1531,"browser-passworder":1626,"eth-hd-keyring":1930,"eth-sig-util":2012,"eth-simple-keyring":2021,"ethereumjs-util":2077,events:1660,loglevel:2959,"obs-store":3067},function(){with(this)return function(){"use strict";return function(e,t,r){const{EventEmitter:s}=e("events"),n=e("loglevel"),o=e("ethereumjs-util"),{BN:a}=o,i=e("bip39"),c=e("obs-store"),l=e("browser-passworder"),{normalize:u}=e("eth-sig-util"),d=[e("eth-simple-keyring"),e("eth-hd-keyring")];t.exports=class extends s{constructor(e){super();const t=e.initState||{};this.keyringTypes=e.keyringTypes?d.concat(e.keyringTypes):d,this.store=new c(t),this.memStore=new c({isUnlocked:!1,keyringTypes:this.keyringTypes.map((e=>e.type)),keyrings:[]}),this.encryptor=e.encryptor||l,this.keyrings=[]}fullUpdate(){return this.emit("update",this.memStore.getState()),this.memStore.getState()}createNewVaultAndKeychain(e){return this.persistAllKeyrings(e).then(this.createFirstKeyTree.bind(this)).then(this.persistAllKeyrings.bind(this,e)).then(this.setUnlocked.bind(this)).then(this.fullUpdate.bind(this))}createNewVaultAndRestore(e,t){return"string"!=typeof e?Promise.reject(new Error("Password must be text.")):i.validateMnemonic(t)?(this.clearKeyrings(),this.persistAllKeyrings(e).then((()=>this.addNewKeyring("HD Key Tree",{mnemonic:t,numberOfAccounts:1}))).then((e=>e.getAccounts())).then((([e])=>{if(!e)throw new Error("KeyringController - First Account not found.");return null})).then(this.persistAllKeyrings.bind(this,e)).then(this.setUnlocked.bind(this)).then(this.fullUpdate.bind(this))):Promise.reject(new Error("Seed phrase is invalid."))}async setLocked(){return this.password=null,this.memStore.updateState({isUnlocked:!1}),this.keyrings=[],await this._updateMemStoreKeyrings(),this.emit("lock"),this.fullUpdate()}submitPassword(e){return this.unlockKeyrings(e).then((e=>(this.keyrings=e,this.setUnlocked(),this.fullUpdate())))}async verifyPassword(e){const t=this.store.getState().vault;if(!t)throw new Error("Cannot unlock without a previous vault.");await this.encryptor.decrypt(e,t)}addNewKeyring(e,t){const r=new(this.getKeyringClassForType(e))(t);return r.getAccounts().then((t=>this.checkForDuplicate(e,t))).then((()=>(this.keyrings.push(r),this.persistAllKeyrings()))).then((()=>this._updateMemStoreKeyrings())).then((()=>this.fullUpdate())).then((()=>r))}async removeEmptyKeyrings(){const e=[];await Promise.all(this.keyrings.map((async t=>{(await t.getAccounts()).length>0&&e.push(t)}))),this.keyrings=e}checkForDuplicate(e,t){return this.getAccounts().then((r=>{if("Simple Key Pair"===e){return Boolean(r.find((e=>e===t[0]||e===o.stripHexPrefix(t[0]))))?Promise.reject(new Error("The account you're are trying to import is a duplicate")):Promise.resolve(t)}return Promise.resolve(t)}))}addNewAccount(e){return e.addAccounts(1).then((e=>{e.forEach((e=>{this.emit("newAccount",e)}))})).then(this.persistAllKeyrings.bind(this)).then(this._updateMemStoreKeyrings.bind(this)).then(this.fullUpdate.bind(this))}exportAccount(e){try{return this.getKeyringForAccount(e).then((t=>t.exportAccount(u(e))))}catch(e){return Promise.reject(e)}}removeAccount(e){return this.getKeyringForAccount(e).then((t=>"function"==typeof t.removeAccount?(t.removeAccount(e),this.emit("removedAccount",e),t.getAccounts()):Promise.reject(new Error(`Keyring ${t.type} doesn't support account removal operations`)))).then((e=>0===e.length?this.removeEmptyKeyrings():undefined)).then(this.persistAllKeyrings.bind(this)).then(this._updateMemStoreKeyrings.bind(this)).then(this.fullUpdate.bind(this)).catch((e=>Promise.reject(e)))}signTransaction(e,t,r={}){const s=u(t);return this.getKeyringForAccount(s).then((t=>t.signTransaction(s,e,r)))}signMessage(e,t={}){const r=u(e.from);return this.getKeyringForAccount(r).then((s=>s.signMessage(r,e.data,t)))}signPersonalMessage(e,t={}){const r=u(e.from);return this.getKeyringForAccount(r).then((s=>s.signPersonalMessage(r,e.data,t)))}getEncryptionPublicKey(e,t={}){const r=u(e);return this.getKeyringForAccount(r).then((e=>e.getEncryptionPublicKey(r,t)))}decryptMessage(e,t={}){const r=u(e.from);return this.getKeyringForAccount(r).then((s=>s.decryptMessage(r,e.data,t)))}signTypedMessage(e,t={version:"V1"}){const r=u(e.from);return this.getKeyringForAccount(r).then((s=>s.signTypedData(r,e.data,t)))}async getAppKeyAddress(e,t){const r=u(e);return(await this.getKeyringForAccount(r)).getAppKeyAddress(r,t)}async exportAppKeyForAddress(e,t){const r=u(e),s=await this.getKeyringForAccount(r);if(!("exportAccount"in s))throw new Error(`The keyring for address ${e} does not support exporting.`);return s.exportAccount(r,{withAppKeyOrigin:t})}createFirstKeyTree(){return this.clearKeyrings(),this.addNewKeyring("HD Key Tree",{numberOfAccounts:1}).then((e=>e.getAccounts())).then((([e])=>{if(!e)throw new Error("KeyringController - No account found on keychain.");const t=u(e);return this.emit("newVault",t),null}))}persistAllKeyrings(e=this.password){return"string"!=typeof e?Promise.reject(new Error("KeyringController - password is not a string")):(this.password=e,Promise.all(this.keyrings.map((e=>Promise.all([e.type,e.serialize()]).then((e=>({type:e[0],data:e[1]})))))).then((e=>this.encryptor.encrypt(this.password,e))).then((e=>(this.store.updateState({vault:e}),!0))))}async unlockKeyrings(e){const t=this.store.getState().vault;if(!t)throw new Error("Cannot unlock without a previous vault.");await this.clearKeyrings();const r=await this.encryptor.decrypt(e,t);return this.password=e,await Promise.all(r.map(this._restoreKeyring.bind(this))),await this._updateMemStoreKeyrings(),this.keyrings}async restoreKeyring(e){const t=await this._restoreKeyring(e);return await this._updateMemStoreKeyrings(),t}async _restoreKeyring(e){const{type:t,data:r}=e,s=new(this.getKeyringClassForType(t));return await s.deserialize(r),await s.getAccounts(),this.keyrings.push(s),s}getKeyringClassForType(e){return this.keyringTypes.find((t=>t.type===e))}getKeyringsByType(e){return this.keyrings.filter((t=>t.type===e))}async getAccounts(){const e=this.keyrings||[];return(await Promise.all(e.map((e=>e.getAccounts()))).then((e=>e.reduce(((e,t)=>e.concat(t)),[])))).map(u)}getKeyringForAccount(e){const t=u(e);return n.debug(`KeyringController - getKeyringForAccount: ${t}`),Promise.all(this.keyrings.map((e=>Promise.all([e,e.getAccounts()])))).then((r=>{const s=r.filter((e=>e[1].map(u).includes(t)));if(s&&s.length>0)return s[0][0];let n="Error info: ";throw e||(n+="The address passed in is invalid/empty; "),r&&r.length||(n+="There are no keyrings; "),s&&s.length||(n+="There are keyrings, but none match the address;"),new Error(`No keyring found for the requested account. ${n}`)}))}displayForKeyring(e){return e.getAccounts().then((t=>({type:e.type,accounts:t.map(u)})))}addGasBuffer(e){const t=new a("100000",10),r=new a(o.stripHexPrefix(e),16).add(t);return o.addHexPrefix(r.toString(16))}async clearKeyrings(){this.keyrings=[],this.memStore.updateState({keyrings:[]})}async _updateMemStoreKeyrings(){const e=await Promise.all(this.keyrings.map(this.displayForKeyring));return this.memStore.updateState({keyrings:e})}setUnlocked(){this.memStore.updateState({isUnlocked:!0}),this.emit("unlock")}}}}},{package:"eth-keyring-controller",file:"/Users/mac/code/metamask-extension/node_modules/eth-keyring-controller/index.js"}],[24,{"../../../../shared/constants/permissions":3974,"./enums":23,"./permissionsLog":25,"./permissionsMethodMiddleware":26,"@babel/runtime/helpers/defineProperty":184,"@babel/runtime/helpers/interopRequireDefault":190,"@metamask/obs-store":1119,"eth-rpc-errors":2010,"json-rpc-engine":2580,lodash:2948,loglevel:2959,nanoid:3024,"rpc-cap":3503},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.PermissionsController=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),o=s(e("nanoid")),a=e("json-rpc-engine"),i=e("@metamask/obs-store"),c=s(e("loglevel")),l=e("rpc-cap"),u=e("eth-rpc-errors"),d=e("lodash"),h=e("../../../../shared/constants/permissions"),p=e("./enums"),f=s(e("./permissionsMethodMiddleware")),g=s(e("./permissionsLog"));function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const v=()=>undefined;r.PermissionsController=class{constructor({approvals:e,getKeyringAccounts:t,getRestrictedMethods:r,getUnlockPromise:s,isUnlocked:n,notifyDomain:o,notifyAllDomains:a,preferences:c,setInfo:l,setUnFollow:u,setFollow:d,generateAuth:h,getActive:f,exportAccount:m,restorePage:y,connect:v,disconnect:w,addressToMisesId:b,getAccountFlag:k}={},S={},P={}){this.store=new i.ObservableStore({[p.LOG_STORE_KEY]:P[p.LOG_STORE_KEY]||[],[p.HISTORY_STORE_KEY]:P[p.HISTORY_STORE_KEY]||{}}),this.getKeyringAccounts=t,this.getAccountFlag=k,this.getActive=f,this.setInfo=l,this.setUnFollow=u,this.setFollow=d,this.generateAuth=h,this.exportAccount=m,this._getUnlockPromise=s,this._notifyDomain=o,this._notifyAllDomains=a,this._isUnlocked=n,this.restorePage=y,this.connect=v,this.disconnect=w,this.addressToMisesId=b,this._restrictedMethods=r({getKeyringAccounts:this.getKeyringAccounts.bind(this),getIdentities:this._getIdentities.bind(this)}),this.permissionsLog=new g.default({restrictedMethods:Object.keys(this._restrictedMethods),store:this.store}),this.approvals=e,this._initializePermissions(S),this._lastSelectedAddress=c.getState().selectedAddress,this.preferences=c,this._initializeMetadataStore(P),c.subscribe((async({selectedAddress:e})=>{e&&e!==this._lastSelectedAddress&&(this._lastSelectedAddress=e,await this._handleAccountSelected(e))}))}createMiddleware({origin:e,extensionId:t}){var r;if("string"!=typeof e||!e.length)throw new Error("Must provide non-empty string origin.");const s=this.store.getState()[p.METADATA_STORE_KEY];t&&(null===(r=s[e])||void 0===r?void 0:r.extensionId)!==t&&this.addDomainMetadata(e,{extensionId:t});const n=new a.JsonRpcEngine;return n.push(this.permissionsLog.createMiddleware()),n.push((0,f.default)({addDomainMetadata:this.addDomainMetadata.bind(this),getAccounts:this.getAccounts.bind(this,e),getUnlockPromise:()=>this._getUnlockPromise(!0),hasPermission:this.hasPermission.bind(this,e),notifyAccountsChanged:this.notifyAccountsChanged.bind(this,e),requestAccountsPermission:this._requestPermissions.bind(this,{origin:e},{eth_accounts:{}}),setUnFollow:this.setUnFollow.bind(this),setFollow:this.setFollow.bind(this),setInfo:this.setInfo.bind(this),generateAuth:this.generateAuth.bind(this),getKeyringAccounts:this.getKeyringAccounts.bind(this),getAccountFlag:this.getAccountFlag.bind(this),getActive:this.getActive.bind(this),exportAccount:this.exportAccount.bind(this),restorePage:this.restorePage.bind(this),connect:this.connect.bind(this),disconnect:this.disconnect.bind(this),addressToMisesId:this.addressToMisesId.bind(this)})),n.push(this.permissions.providerMiddlewareFunction.bind(this.permissions,{origin:e})),n.asMiddleware()}async requestAccountsPermissionWithId(e){const t=(0,o.default)();return this._requestPermissions({origin:e},{eth_accounts:{}},t).then((async()=>{const t=await this.getAccounts(e);this.notifyAccountsChanged(e,t)})),t}getAccounts(e){return new Promise(((t,r)=>{const s={};this.permissions.providerMiddlewareFunction({origin:e},{method:"eth_accounts"},s,v,(function(){s.error||!Array.isArray(s.result)?t([]):t(s.result)}))}))}hasPermission(e,t){return Boolean(this.permissions.getPermission(e,t))}_getIdentities(){return this.preferences.getState().identities}_requestPermissions(e,t,r){return new Promise(((s,n)=>{const o={id:r,method:"wallet_requestPermissions",params:[t]},a={};this.permissions.providerMiddlewareFunction(e,o,a,v,(function(e){const t=e||a.error;t?n(t):s(a.result)}))}))}async approvePermissionsRequest(e,t){const{id:r}=e.metadata;if(c.default.debug(e,t),this.approvals.has({id:r}))try{0===Object.keys(e.permissions).length?this.approvals.reject(r,u.ethErrors.rpc.invalidRequest({message:"Must request at least one permission."})):(e.permissions=await this.finalizePermissionsRequest(e.permissions,t),this.approvals.accept(r,e.permissions))}catch(e){this.approvals.reject(r,u.ethErrors.rpc.invalidRequest({message:e.message,data:e}))}else c.default.debug(`Permissions request with id '${r}' not found.`)}async rejectPermissionsRequest(e){this.approvals.has({id:e})?this.approvals.reject(e,u.ethErrors.provider.userRejectedRequest()):c.default.debug(`Permissions request with id '${e}' not found.`)}async addPermittedAccount(e,t){if(!this.permissions.getDomains()[e])throw new Error("Unrecognized domain");this.validatePermittedAccounts([t]);const r=this._getPermittedAccounts(e);if(0===r.length)throw new Error("Origin does not have 'eth_accounts' permission");if(r.includes(t))throw new Error("Account is already permitted for origin");this.permissions.updateCaveatFor(e,"eth_accounts",h.CAVEAT_NAMES.exposedAccounts,[...r,t]);const s=await this.getAccounts(e);this.notifyAccountsChanged(e,s)}async removePermittedAccount(e,t){if(!this.permissions.getDomains()[e])throw new Error("Unrecognized domain");this.validatePermittedAccounts([t]);const r=this._getPermittedAccounts(e);if(0===r.length)throw new Error("Origin does not have 'eth_accounts' permission");if(!r.includes(t))throw new Error("Account is not permitted for origin");let s=r.filter((e=>e!==t));0===s.length?(console.log(s),this.removePermissionsFor({[e]:["eth_accounts"]})):(this.permissions.updateCaveatFor(e,"eth_accounts",h.CAVEAT_NAMES.exposedAccounts,s),s=await this.getAccounts(e)),this.notifyAccountsChanged(e,s)}async removeAllAccountPermissions(e){this.validatePermittedAccounts([e]);const t=this.permissions.getDomains(),r=Object.keys(t).filter((t=>this._getPermittedAccounts(t).includes(e)));await Promise.all(r.map((t=>this.removePermittedAccount(t,e))))}async finalizePermissionsRequest(e,t){const r=(0,d.cloneDeep)(e),s=(0,d.cloneDeep)(t),{eth_accounts:n}=r;return n&&(this.validatePermittedAccounts(s),n.caveats||(n.caveats=[]),n.caveats=n.caveats.filter((e=>e.name!==h.CAVEAT_NAMES.exposedAccounts&&e.name!==h.CAVEAT_NAMES.primaryAccountOnly)),n.caveats.push({type:p.CAVEAT_TYPES.limitResponseLength,value:1,name:h.CAVEAT_NAMES.primaryAccountOnly}),n.caveats.push({type:p.CAVEAT_TYPES.filterResponse,value:s,name:h.CAVEAT_NAMES.exposedAccounts})),r}validatePermittedAccounts(e){if(!Array.isArray(e)||0===e.length)throw new Error("Must provide non-empty array of account(s).");const t=this._getIdentities();e.forEach((e=>{if(!t[e])throw new Error(`Unknown account: ${e}`)}))}notifyAccountsChanged(e,t){if("string"!=typeof e||!e)throw new Error(`Invalid origin: '${e}'`);if(!Array.isArray(t))throw new Error("Invalid accounts",t);this._isUnlocked()&&(this._notifyDomain(e,{method:p.NOTIFICATION_NAMES.accountsChanged,params:t}),this.permissionsLog.updateAccountsHistory(e,t))}removePermissionsFor(e){Object.entries(e).forEach((([e,t])=>{this.permissions.removePermissionsFor(e,t.map((t=>("eth_accounts"===t&&this.notifyAccountsChanged(e,[]),{parentCapability:t}))))}))}clearPermissions(){this.permissions.clearDomains(),this._notifyAllDomains({method:p.NOTIFICATION_NAMES.accountsChanged,params:[]})}addDomainMetadata(e,t){const r=this.store.getState()[p.METADATA_STORE_KEY],s=y({},r);if(this._pendingSiteMetadata.size>=p.METADATA_CACHE_MAX_SIZE){const e=this.permissions.getDomains(),t=this._pendingSiteMetadata.values().next().value;this._pendingSiteMetadata.delete(t),e[t]||delete s[t]}s[e]=y(y(y({},r[e]),t),{},{lastUpdated:Date.now()}),s[e].extensionId||s[e].host||(s[e].host=new URL(e).host),this._pendingSiteMetadata.add(e),this._setDomainMetadata(s)}_initializeMetadataStore(e){const t=e[p.METADATA_STORE_KEY]||{},r=this._trimDomainMetadata(t);this._pendingSiteMetadata=new Set,this._setDomainMetadata(r)}_trimDomainMetadata(e){const t=y({},e),r=Object.keys(e),s=this.permissions.getDomains();return r.forEach((e=>{s[e]||delete t[e]})),t}_setDomainMetadata(e){this.store.updateState({[p.METADATA_STORE_KEY]:e})}_getPermittedAccounts(e){var t,r,s;return(null===(t=this.permissions.getPermission(e,"eth_accounts"))||void 0===t||null===(r=t.caveats)||void 0===r||null===(s=r.find((e=>e.name===h.CAVEAT_NAMES.exposedAccounts)))||void 0===s?void 0:s.value)||[]}async _handleAccountSelected(e){if("string"!=typeof e)throw new Error("Selected account should be a non-empty string.");const t=this.permissions.getDomains()||{},r=Object.entries(t).filter((([t,{permissions:r}])=>{var s;const n=r.find((e=>"eth_accounts"===e.parentCapability)),o=null==n||null===(s=n.caveats.find((e=>"exposedAccounts"===e.name)))||void 0===s?void 0:s.value;return null==o?void 0:o.includes(e)})).map((([e])=>e));await Promise.all(r.map((e=>this._handleConnectedAccountSelected(e))))}async _handleConnectedAccountSelected(e){const t=await this.getAccounts(e);this.notifyAccountsChanged(e,t)}_initializePermissions(e){const t=y(y({},e),{},{permissionsRequests:[]});this.permissions=new l.CapabilitiesController({safeMethods:p.SAFE_METHODS,methodPrefix:p.WALLET_PREFIX,restrictedMethods:this._restrictedMethods,requestUserApproval:async e=>{const{metadata:{id:t,origin:r}}=e;return this.approvals.addAndShowApprovalRequest({id:t,origin:r,type:p.APPROVAL_TYPE})}},t)}}}}},{package:"<root>",file:"/Users/mac/code/metamask-extension/app/scripts/controllers/permissions/index.js"}],[1032,{"./BaseController":1009,"./BaseControllerV2":1010,"./ComposableController":1011,"./ControllerMessenger":1012,"./approval/ApprovalController":1015,"./assets/AccountTrackerController":1016,"./assets/AssetsContractController":1017,"./assets/CollectibleDetectionController":1018,"./assets/CollectiblesController":1021,"./assets/CurrencyRateController":1022,"./assets/TokenBalancesController":1023,"./assets/TokenDetectionController":1024,"./assets/TokenListController":1025,"./assets/TokenRatesController":1026,"./assets/TokensController":1027,"./gas/GasFeeController":1030,"./keyring/KeyringController":1033,"./message-manager/MessageManager":1035,"./message-manager/PersonalMessageManager":1036,"./message-manager/TypedMessageManager":1037,"./network/NetworkController":1038,"./notification/NotificationController":1039,"./third-party/PhishingController":1040,"./transaction/TransactionController":1041,"./user/AddressBookController":1042,"./user/PreferencesController":1043,"./util":1044,"isomorphic-fetch":2564},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){s===undefined&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){s===undefined&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.util=r.getAnonymizedState=r.getPersistentState=r.BaseControllerV2=void 0,e("isomorphic-fetch");const i=o(e("./util"));r.util=i,a(e("./assets/AccountTrackerController"),r),a(e("./user/AddressBookController"),r),a(e("./approval/ApprovalController"),r),a(e("./assets/AssetsContractController"),r),a(e("./BaseController"),r);var c=e("./BaseControllerV2");Object.defineProperty(r,"BaseControllerV2",{enumerable:!0,get:function(){return c.BaseController}}),Object.defineProperty(r,"getPersistentState",{enumerable:!0,get:function(){return c.getPersistentState}}),Object.defineProperty(r,"getAnonymizedState",{enumerable:!0,get:function(){return c.getAnonymizedState}}),a(e("./ComposableController"),r),a(e("./ControllerMessenger"),r),a(e("./assets/CurrencyRateController"),r),a(e("./keyring/KeyringController"),r),a(e("./message-manager/MessageManager"),r),a(e("./network/NetworkController"),r),a(e("./third-party/PhishingController"),r),a(e("./user/PreferencesController"),r),a(e("./assets/TokenBalancesController"),r),a(e("./assets/TokenRatesController"),r),a(e("./transaction/TransactionController"),r),a(e("./message-manager/PersonalMessageManager"),r),a(e("./message-manager/TypedMessageManager"),r),a(e("./notification/NotificationController"),r),a(e("./assets/TokenListController"),r),a(e("./gas/GasFeeController"),r),a(e("./assets/TokensController"),r),a(e("./assets/CollectiblesController"),r),a(e("./assets/TokenDetectionController"),r),a(e("./assets/CollectibleDetectionController"),r)}}},{package:"@metamask/controllers",file:"/Users/mac/code/metamask-extension/node_modules/@metamask/controllers/dist/index.js"}],[569,{"./metamask-airgapped-keyring.cjs.development.js":570,"./metamask-airgapped-keyring.cjs.production.min.js":571},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("./metamask-airgapped-keyring.cjs.production.min.js")}}},{package:"@keystonehq/metamask-airgapped-keyring",file:"/Users/mac/code/metamask-extension/node_modules/@keystonehq/metamask-airgapped-keyring/dist/index.js"}]],[],{});
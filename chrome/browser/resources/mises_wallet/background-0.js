LavaPack.loadBundle([[6903,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.TRAITS=r.REJECT_NOTFICIATION_CLOSE_SIG=r.REJECT_NOTFICIATION_CLOSE=r.METAMETRICS_BACKGROUND_PAGE_OBJECT=r.METAMETRICS_ANONYMOUS_ID=r.EVENT_NAMES=void 0;r.TRAITS={ADDRESS_BOOK_ENTRIES:"address_book_entries",LEDGER_CONNECTION_TYPE:"ledger_connection_type",NETWORKS_ADDED:"networks_added",NFT_AUTODETECTION_ENABLED:"nft_autodetection_enabled",NUMBER_OF_ACCOUNTS:"number_of_accounts",NUMBER_OF_NFT_COLLECTIONS:"number_of_nft_collections",NUMBER_OF_TOKENS:"number_of_tokens",OPENSEA_API_ENABLED:"opensea_api_enabled",THREE_BOX_ENABLED:"three_box_enabled",THEME:"theme"};r.METAMETRICS_ANONYMOUS_ID="0x0000000000000000";r.METAMETRICS_BACKGROUND_PAGE_OBJECT={path:"/background-process",title:"Background Process",url:"/background-process"};r.REJECT_NOTFICIATION_CLOSE="Cancel Via Notification Close";r.REJECT_NOTFICIATION_CLOSE_SIG="Cancel Sig Request Via Notification Close";r.EVENT_NAMES={SIGNATURE_REQUESTED:"Signature Requested",ENCRYPTION_PUBLIC_KEY_REQUESTED:"Encryption Public Key Requested",DECRYPTION_REQUESTED:"Decryption Requested",PERMISSIONS_REQUESTED:"Permissions Requested"}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/shared/constants/metametrics.js"}],[42,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s={config:{},PreferencesController:{frequentRpcListDetail:[{rpcUrl:"http://localhost:8545",chainId:"0x539",ticker:"ETH",nickname:"Localhost 8545",rpcPrefs:{}}]}};r.default=s}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/first-time-state.js"}],[62,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return n((0,s.cloneDeep)(e),(e=>null===e?"null":typeof e))};var s=e("lodash");function n(e={},t){return Object.entries(e).forEach((([r,s])=>{e[r]="object"==typeof s&&null!==s?n(s,t):t(s)})),e}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/getObjStructure.js"}],[2924,{debounce:2925,duplexer:2988,through:6645},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("through"),n=e("duplexer"),a=e("debounce");t.exports=function(e,t){var r=s(a((function(e){o.queue(e)}),e||100,t)),o=s();return n(r,o)}}}},{package:"debounce-stream",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/debounce-stream/index.js"}],[68,{"../platforms/extension":171,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"safe-event-emitter":6451},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.NOTIFICATION_MANAGER_EVENTS=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("safe-event-emitter")),o=s(e("../platforms/extension"));const i={POPUP_CLOSED:"onPopupClosed"};r.NOTIFICATION_MANAGER_EVENTS=i;class c extends a.default{constructor(){super(),(0,n.default)(this,"setExtensionTab",!1),this.platform=new o.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(){const e=await this._getPopup();if(e)await this.platform.focusWindow(e.id);else{let e=0,t=0;try{const r=await this.platform.getLastFocusedWindow();t=r.top,e=r.left+(r.width-360)}catch(r){const{screenX:s,screenY:n,outerWidth:a}=window;t=Math.max(n,0),e=Math.max(s+(a-360),0)}const r=await this.platform.getActiveTabs();this._openerTab=r.length>0?r[0]:undefined,console.log("openerTab",this._openerTab);const s=await this.platform.openWindow({url:"notification.html",type:"popup",openerTabId:this._openerTab&&this._openerTab.id,index:this._openerTab&&this._openerTab.index,width:360,height:620,left:e,top:t});s.left!==e&&"fullscreen"!==s.state&&await this.platform.updateWindowPosition(s.id,e,t),this._popupId=s.id}}async closePopup(){this._popupId&&await this.platform.closeCurrentWindow(this._popupId),this._openerTab&&(console.log("closePopup"),await this.platform.switchToTab(this._openerTab.id),this._openerTab=undefined)}_onWindowClosed(e){console.log(e,"onremove"),e===this._popupId&&(this._popupId=undefined,this.setExtensionTab=!1,this.emit(i.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find((e=>e&&"popup"===e.type&&e.id===this._popupId)):null}}r.default=c}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/notification-manager.js"}],[52,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"promise-to-callback":6129,"readable-stream":6410},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){return new c(e,t)};var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("readable-stream"),o=s(e("promise-to-callback"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}class c extends a.Writable{constructor(e,t){const r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({objectMode:!0},t);super(r),this._asyncWriteFn=e}_write(e,t,r){(0,o.default)(this._asyncWriteFn(e,t))(r)}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/createStreamSink.js"}],[67,{"../../../shared/constants/time":6907,"../../../shared/modules/fetch-with-timeout":6912,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("loglevel")),o=e("../../../shared/constants/time");const i=(0,s(e("../../../shared/modules/fetch-with-timeout")).default)(30*o.SECOND);r.default=class{constructor(){(0,n.default)(this,"isSupported",!0),this._initialized=!1,this._initializing=this._init(),this._state=undefined}async _init(){try{const e=await i("http://localhost:12345/state.json");e.ok&&(this._state=await e.json())}catch(e){a.default.debug(`Error loading network state: '${e.message}'`)}finally{this._initialized=!0}}async get(){return this._initialized||await this._initializing,this._state}async set(e){this._initialized||await this._initializing,this._state=e}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/network-store.js"}],[61,{"../../_locales/index.json":1,"@babel/runtime/helpers/interopRequireDefault":213,"webextension-polyfill":6875},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=async function(){let e;try{e=await n.default.i18n.getAcceptLanguages()}catch(t){e=[]}e||(e=[]);let t=e.map((e=>e.toLowerCase().replace("_","-"))).find((e=>o[e]!==undefined||o[e.split("-")[0]]!==undefined));t!==undefined&&o[t]===undefined&&(t=t.split("-")[0]);return o[t]||"en"};var n=s(e("webextension-polyfill")),a=s(e("../../_locales/index.json"));const o={};a.default.forEach((e=>{e&&e.code&&(o[e.code.toLowerCase().replace("_","-")]=e.code)}))}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/get-first-preferred-lang-code.js"}],[63,{"./util":99,"@babel/runtime/helpers/interopRequireDefault":213,loglevel:5876,"webextension-polyfill":6875},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("webextension-polyfill")),a=s(e("loglevel")),o=e("./util");r.default=class{constructor(){this.isSupported=Boolean(n.default.storage.local),this.isSupported||a.default.error("Storage local API not available.")}async get(){if(!this.isSupported)return undefined;const e=await this._get();return t=e,0===Object.keys(t).length?undefined:e;var t}async set(e){return this._set(e)}_get(){const{local:e}=n.default.storage;return new Promise(((t,r)=>{e.get(null).then((e=>{const s=(0,o.checkForError)();s?r(s):t(e)}))}))}_set(e){const{local:t}=n.default.storage;return new Promise(((r,s)=>{t.set(e).then((()=>{const e=(0,o.checkForError)();e?s(e):r()}))}))}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/local-store.js"}],[1237,{"./ComposedStore":1232,"./LocalStorageStore":1233,"./MergedStore":1234,"./ObservableStore":1235,"./asStream":1236,"./transform":1238},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){s===undefined&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){s===undefined&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),n(e("./asStream"),r),n(e("./ComposedStore"),r),n(e("./LocalStorageStore"),r),n(e("./MergedStore"),r),n(e("./ObservableStore"),r),n(e("./transform"),r)}}},{package:"@metamask/obs-store",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/@metamask/obs-store/dist/index.js"}],[66,{"@babel/runtime/helpers/interopRequireDefault":213,events:2479},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events"));class a extends n.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort(((e,t)=>e.version-t.version));const r=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||r&&r.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter((function(t){return t.version>e.meta.version}));for(const r of t)try{const t=await r.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==r.version)throw new Error("Migrator - Migration did not update version number correctly");e=t}catch(t){const s=t.message;return t.message=`MetaMask Migration Error #${r.version}: ${s}`,this.emit("error",t),e}return e}generateInitialState(e){return{meta:{version:this.defaultVersion},data:e}}}r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/migrator/index.js"}],[170,{"./002":101,"./003":102,"./004":103,"./005":104,"./006":105,"./007":106,"./008":107,"./009":108,"./010":109,"./011":110,"./012":111,"./013":112,"./014":113,"./015":114,"./016":115,"./017":116,"./018":117,"./019":118,"./020":119,"./021":120,"./022":121,"./023":122,"./024":123,"./025":124,"./026":125,"./027":126,"./028":127,"./029":128,"./030":129,"./031":130,"./032":131,"./033":132,"./034":133,"./035":134,"./036":135,"./037":136,"./038":137,"./039":138,"./040":139,"./041":140,"./042":141,"./043":142,"./044":143,"./045":144,"./046":145,"./047":146,"./048":147,"./049":148,"./050":149,"./051":150,"./052":151,"./053":152,"./054":153,"./055":154,"./056":155,"./057":156,"./058":157,"./059":158,"./060":159,"./061":160,"./062":161,"./063":162,"./064":163,"./065":164,"./066":165,"./067":166,"./068":167,"./069":168,"@babel/runtime/helpers/interopRequireDefault":213},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("./002")),a=s(e("./003")),o=s(e("./004")),i=s(e("./005")),c=s(e("./006")),l=s(e("./007")),d=s(e("./008")),u=s(e("./009")),h=s(e("./010")),p=s(e("./011")),m=s(e("./012")),f=s(e("./013")),g=s(e("./014")),b=s(e("./015")),v=s(e("./016")),y=s(e("./017")),T=s(e("./018")),S=s(e("./019")),k=s(e("./020")),w=s(e("./021")),C=s(e("./022")),P=s(e("./023")),E=s(e("./024")),_=s(e("./025")),M=s(e("./026")),O=s(e("./027")),A=s(e("./028")),I=s(e("./029")),x=s(e("./030")),N=s(e("./031")),D=s(e("./032")),j=s(e("./033")),R=s(e("./034")),U=s(e("./035")),F=s(e("./036")),L=s(e("./037")),B=s(e("./038")),G=s(e("./039")),q=s(e("./040")),K=s(e("./041")),H=s(e("./042")),V=s(e("./043")),$=s(e("./044")),W=s(e("./045")),Y=s(e("./046")),Q=s(e("./047")),z=s(e("./048")),J=s(e("./049")),Z=s(e("./050")),X=s(e("./051")),ee=s(e("./052")),te=s(e("./053")),re=s(e("./054")),se=s(e("./055")),ne=s(e("./056")),ae=s(e("./057")),oe=s(e("./058")),ie=s(e("./059")),ce=s(e("./060")),le=s(e("./061")),de=s(e("./062")),ue=s(e("./063")),he=s(e("./064")),pe=s(e("./065")),me=s(e("./066")),fe=s(e("./067")),ge=s(e("./068")),be=s(e("./069"));var ve=[n.default,a.default,o.default,i.default,c.default,l.default,d.default,u.default,h.default,p.default,m.default,f.default,g.default,b.default,v.default,y.default,T.default,S.default,k.default,w.default,C.default,P.default,E.default,_.default,M.default,O.default,A.default,I.default,x.default,N.default,D.default,j.default,R.default,U.default,F.default,L.default,B.default,G.default,q.default,K.default,H.default,V.default,$.default,W.default,Y.default,Q.default,z.default,J.default,Z.default,X.default,ee.default,te.default,re.default,se.default,ne.default,ae.default,oe.default,ie.default,ce.default,le.default,de.default,ue.default,he.default,pe.default,me.default,fe.default,ge.default,be.default];r.default=ve}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/index.js"}],[59,{"../../../../shared/constants/time":6907,"../../../../shared/modules/fetch-with-timeout":6912,"./resolver":58,"@babel/runtime/helpers/interopRequireDefault":213,"base32-encode":2339,"base64-js":2342,"webextension-polyfill":6875},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:r}){const s=u.map((e=>`*://*.${e}/*`));return o.default.webRequest.onErrorOccurred.addListener(i,{urls:s,types:["main_frame"]}),{remove(){o.default.webRequest.onErrorOccurred.removeListener(i)}};async function i(s){const{tabId:i,url:c}=s;if(-1===i||"0x1"!==t())return;const{hostname:h,pathname:p,search:m,hash:f}=new URL(c),g=h.split("."),b=g[g.length-1];u.includes(b)&&async function({tabId:t,name:s,pathname:i,search:c,fragment:u}){const h=r();o.default.tabs.update(t,{url:"loading.html"});let p=`https://app.ens.domains/name/${s}`;try{const{type:r,hash:m}=await(0,l.default)({provider:e,name:s});if("ipfs-ns"===r||"ipns-ns"===r){const e=`https://${m}.${r.slice(0,4)}.${h}${i}${c||""}${u||""}`;try{200===(await d(e,{method:"HEAD"})).status&&(p=e)}catch(e){console.warn(e)}}else if("swarm-ns"===r)p=`https://swarm-gateways.net/bzz:/${m}${i}${c||""}${u||""}`;else if("onion"===r||"onion3"===r)p=`http://${m}.onion${i}${c||""}${u||""}`;else if("zeronet"===r)p=`http://127.0.0.1:43110/${m}${i}${c||""}${u||""}`;else if("skynet-ns"===r){const e=m.padEnd(m.length+4-m.length%4,"="),t=a.default.toByteArray(e),r={padding:!1};p=`https://${(0,n.default)(t,"RFC4648-HEX",r).toLowerCase()}.siasky.net${i}${c||""}${u||""}`}}catch(e){console.warn(e)}finally{o.default.tabs.update(t,{url:p})}}({tabId:i,name:h,pathname:p,search:m,fragment:f})}};var n=s(e("base32-encode")),a=s(e("base64-js")),o=s(e("webextension-polyfill")),i=e("../../../../shared/constants/time"),c=s(e("../../../../shared/modules/fetch-with-timeout")),l=s(e("./resolver"));const d=(0,c.default)(30*i.SECOND),u=["eth"]}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/ens-ipfs/setup.js"}],[100,{"../../shared/constants/app":6899,"../../shared/constants/hardware-wallets":6901,"../../shared/constants/network":6904,"../../shared/constants/permissions":6905,"../../shared/constants/swaps":6906,"../../shared/constants/time":6907,"../../shared/constants/transaction":6908,"../../shared/modules/hexstring-utils":6914,"../../shared/modules/string-utils":6918,"../../shared/modules/transaction.utils":6920,"../../shared/notifications":6921,"../../ui/helpers/utils/conversions.util":7459,"../../ui/helpers/utils/is-mobile-view":7467,"../../ui/helpers/utils/token-util":7475,"./account-import-strategies":2,"./controllers/alert":6,"./controllers/app-state":7,"./controllers/cached-balances":8,"./controllers/detect-tokens":9,"./controllers/ens":11,"./controllers/incoming-transactions":12,"./controllers/metametrics":13,"./controllers/mises":14,"./controllers/misesCollectibles":17,"./controllers/network":21,"./controllers/onboarding":25,"./controllers/permissions":29,"./controllers/preferences":33,"./controllers/swaps":34,"./controllers/threebox":35,"./controllers/transactions":36,"./lib/ComposableObservableStore":43,"./lib/account-tracker":44,"./lib/createLoggerMiddleware":47,"./lib/createMetaRPCHandler":48,"./lib/createOnboardingMiddleware":49,"./lib/createOriginMiddleware":50,"./lib/createRPCMethodTrackingMiddleware":51,"./lib/createTabIdMiddleware":53,"./lib/decrypt-message-manager":54,"./lib/encryption-public-key-manager":55,"./lib/message-manager":64,"./lib/personal-message-manager":69,"./lib/rpc-method-middleware":93,"./lib/seed-phrase-verifier":94,"./lib/segment":95,"./lib/stream-utils":97,"./lib/typed-message-manager":98,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@keystonehq/metamask-airgapped-keyring":610,"@metamask/controllers":1080,"@metamask/eth-ledger-bridge-keyring":1131,"@metamask/obs-store":1237,"@metamask/obs-store/dist/asStream":1236,"@metamask/smart-transactions-controller":1363,"@sentry/browser":1862,_process:6127,"await-semaphore":2169,buffer:2478,"eth-json-rpc-filters":3056,"eth-json-rpc-filters/subscriptionManager":3062,"eth-json-rpc-middleware":3080,"eth-keyring-controller":3116,"eth-lattice-keyring":3117,"eth-query":3125,"eth-rpc-errors":3129,"eth-trezor-keyring":3153,"ethereumjs-util":3195,events:2479,"json-rpc-engine":5419,"json-rpc-middleware-stream/engineStream":5421,lodash:5866,loglevel:5876,nanoid:5952,pump:6226},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t,s){(function(){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.METAMASK_CONTROLLER_EVENTS=void 0;var a=n(e("@babel/runtime/helpers/defineProperty")),o=n(e("events")),i=n(e("pump")),c=e("@metamask/obs-store"),l=e("@metamask/obs-store/dist/asStream"),d=e("json-rpc-engine"),u=e("lodash"),h=n(e("json-rpc-middleware-stream/engineStream")),p=n(e("eth-json-rpc-filters")),m=n(e("eth-json-rpc-filters/subscriptionManager")),f=e("eth-json-rpc-middleware"),g=n(e("eth-keyring-controller")),b=e("eth-rpc-errors"),v=e("await-semaphore"),y=e("ethereumjs-util"),T=n(e("loglevel")),S=n(e("eth-trezor-keyring")),k=n(e("@metamask/eth-ledger-bridge-keyring")),w=n(e("eth-lattice-keyring")),C=e("@keystonehq/metamask-airgapped-keyring"),P=n(e("eth-query")),E=n(e("nanoid")),_=e("@sentry/browser"),M=e("@metamask/controllers"),O=n(e("@metamask/smart-transactions-controller")),A=e("../../shared/constants/transaction"),I=e("../../shared/constants/swaps"),x=e("../../shared/constants/network"),N=e("../../shared/constants/hardware-wallets"),D=e("../../shared/constants/permissions"),j=e("../../shared/notifications"),R=e("../../shared/modules/hexstring-utils"),U=e("../../shared/constants/time"),F=e("../../shared/constants/app"),L=e("../../ui/helpers/utils/conversions.util"),B=e("../../ui/helpers/utils/is-mobile-view"),G=e("../../ui/helpers/utils/token-util"),q=e("../../shared/modules/string-utils"),K=e("../../shared/modules/transaction.utils"),H=n(e("./lib/ComposableObservableStore")),V=n(e("./lib/account-tracker")),$=n(e("./lib/createLoggerMiddleware")),W=e("./lib/rpc-method-middleware"),Y=n(e("./lib/createOriginMiddleware")),Q=n(e("./lib/createTabIdMiddleware")),z=n(e("./lib/createOnboardingMiddleware")),J=e("./lib/stream-utils"),Z=n(e("./controllers/ens")),X=Pe(e("./controllers/network")),ee=n(e("./controllers/preferences")),te=n(e("./controllers/app-state")),re=n(e("./controllers/cached-balances")),se=n(e("./controllers/alert")),ne=n(e("./controllers/onboarding")),ae=n(e("./controllers/threebox")),oe=n(e("./controllers/incoming-transactions")),ie=Pe(e("./lib/message-manager")),ce=n(e("./lib/decrypt-message-manager")),le=n(e("./lib/encryption-public-key-manager")),de=n(e("./lib/personal-message-manager")),ue=n(e("./lib/typed-message-manager")),he=n(e("./controllers/transactions")),pe=n(e("./controllers/detect-tokens")),me=n(e("./controllers/swaps")),fe=n(e("./account-import-strategies")),ge=n(e("./lib/seed-phrase-verifier")),be=n(e("./controllers/metametrics")),ve=e("./lib/segment"),ye=n(e("./lib/createMetaRPCHandler")),Te=n(e("./controllers/mises")),Se=e("./controllers/permissions"),ke=n(e("./lib/createRPCMethodTrackingMiddleware")),we=e("./controllers/misesCollectibles");function Ce(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Ce=function(e){return e?r:t})(e)}function Pe(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=Ce(t);if(r&&r.has(e))return r.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(s,a,o):s[a]=e[a]}return s.default=e,r&&r.set(e,s),s}function Ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function _e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.METAMASK_CONTROLLER_EVENTS={UPDATE_BADGE:"updateBadge",APPROVAL_STATE_CHANGE:"ApprovalController:stateChange"};class Me extends o.default{constructor(e){var r;super(),this.defaultMaxListeners=20,this.sendUpdate=(0,u.debounce)(this.privateSendUpdate.bind(this),200*U.MILLISECOND),this.opts=e,this.extension=e.browser,this.platform=e.platform,this.notificationManager=e.notificationManager;const s=e.initState||{},n=this.platform.getVersion();this.recordFirstTimeInfo(s),this.activeControllerConnections=0,this.getRequestAccountTabIds=e.getRequestAccountTabIds,this.getOpenMetamaskTabsIds=e.getOpenMetamaskTabsIds,this.controllerMessenger=new M.ControllerMessenger,this.store=new H.default({state:s,controllerMessenger:this.controllerMessenger,persist:!0}),this.connections={},this.createVaultMutex=new v.Mutex,this.extension.runtime.onInstalled.addListener((e=>{"update"!==e.reason||"8.1.0"!==n||(0,B.isMobile)()||this.platform.openExtensionInBrowser()})),this.approvalController=new M.ApprovalController({messenger:this.controllerMessenger.getRestricted({name:"ApprovalController"}),showApprovalRequest:e.showUserConfirmation});const a=[S.default,k.default,w.default,C.MetaMaskKeyring];this.keyringController=new g.default({keyringTypes:a,initState:s.KeyringController,encryptor:e.encryptor||undefined}),this.networkController=new X.default(_e({},s.NetworkController)),this.networkController.setInfuraProjectId(e.infuraProjectId),this.initializeProvider(),this.provider=this.networkController.getProviderAndBlockTracker().provider,this.blockTracker=this.networkController.getProviderAndBlockTracker().blockTracker,this.preferencesController=new ee.default({initState:s.PreferencesController,initLangCode:e.initLangCode,openPopup:e.openPopup,network:this.networkController,provider:this.provider,migrateAddressBookState:this.migrateAddressBookState.bind(this)}),this.misesController=new Te.default({exportAccount:this.keyringController.exportAccount.bind(this.keyringController),getKeyringAccounts:this.keyringController.getAccounts.bind(this.keyringController),preferencesStore:this.preferencesController.store}),this.tokensController=new M.TokensController({onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),config:{provider:this.provider},state:s.TokensController}),this.assetsContractController=new M.AssetsContractController({onPreferencesStateChange:e=>this.preferencesController.store.subscribe(e)},{provider:this.provider}),this.collectiblesController=new we.MisesCollectiblesController({onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),getERC721AssetName:this.assetsContractController.getERC721AssetName.bind(this.assetsContractController),getERC721AssetSymbol:this.assetsContractController.getERC721AssetSymbol.bind(this.assetsContractController),getERC721TokenURI:this.assetsContractController.getERC721TokenURI.bind(this.assetsContractController),getERC721OwnerOf:this.assetsContractController.getERC721OwnerOf.bind(this.assetsContractController),getERC1155BalanceOf:this.assetsContractController.getERC1155BalanceOf.bind(this.assetsContractController),getERC1155TokenURI:this.assetsContractController.getERC1155TokenURI.bind(this.assetsContractController),getMisesAccount:this.misesController.getMisesAccount.bind(this.misesController)},{},s.CollectiblesController),this.collectiblesController.setApiKey(t.env.OPENSEA_KEY),this.collectibleDetectionController=new we.MisesCollectibleDetectionController({onCollectiblesStateChange:e=>this.collectiblesController.subscribe(e),onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),getOpenSeaApiKey:()=>this.collectiblesController.openSeaApiKey,getBalancesInSingleCall:this.assetsContractController.getBalancesInSingleCall.bind(this.assetsContractController),addCollectible:this.collectiblesController.addCollectible.bind(this.collectiblesController),getCollectiblesState:()=>this.collectiblesController.state,isUnlocked:this.isUnlocked.bind(this),getNetwork:this.collectiblesController.getNetwork.bind(this.collectiblesController),getMisesAccount:this.misesController.getMisesAccount.bind(this.misesController)}),this.metaMetricsController=new be.default({segment:ve.segment,preferencesStore:this.preferencesController.store,onNetworkDidChange:this.networkController.on.bind(this.networkController,X.NETWORK_EVENTS.NETWORK_DID_CHANGE),getNetworkIdentifier:this.networkController.getNetworkIdentifier.bind(this.networkController),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),version:this.platform.getVersion(),environment:"other",initState:s.MetaMetricsController,captureException:_.captureException}),this.on("update",(e=>{this.metaMetricsController.handleMetaMaskStateUpdate(e)}));const o=this.controllerMessenger.getRestricted({name:"GasFeeController"}),i=I.GAS_API_BASE_URL;this.gasFeeController=new M.GasFeeController({interval:1e4,messenger:o,clientId:I.SWAPS_CLIENT_ID,getProvider:()=>this.networkController.getProviderAndBlockTracker().provider,onNetworkStateChange:this.networkController.on.bind(this.networkController,X.NETWORK_EVENTS.NETWORK_DID_CHANGE),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),legacyAPIEndpoint:`${i}/networks/<chain_id>/gasPrices`,EIP1559APIEndpoint:`${i}/networks/<chain_id>/suggestedGasFees`,getCurrentNetworkLegacyGasAPICompatibility:()=>{const e=this.networkController.getCurrentChainId();return t.env.IN_TEST||e===x.MAINNET_CHAIN_ID},getChainId:()=>t.env.IN_TEST?x.MAINNET_CHAIN_ID:this.networkController.getCurrentChainId()}),this.qrHardwareKeyring=new C.MetaMaskKeyring,this.appStateController=new te.default({addUnlockListener:this.on.bind(this,"unlock"),isUnlocked:this.isUnlocked.bind(this),initState:s.AppStateController,onInactiveTimeout:()=>this.setLocked(),showUnlockRequest:e.showUserConfirmation,preferencesStore:this.preferencesController.store,qrHardwareStore:this.qrHardwareKeyring.getMemStore()});const c=this.controllerMessenger.getRestricted({name:"CurrencyRateController"});this.currencyRateController=new M.CurrencyRateController({includeUSDRate:!0,messenger:c,state:s.CurrencyController});const l=this.controllerMessenger.getRestricted({name:"TokenListController"});this.tokenListController=new M.TokenListController({chainId:(0,L.hexToDecimal)(this.networkController.getCurrentChainId()),useStaticTokenList:!this.preferencesController.store.getState().useTokenDetection,onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r=_e(_e({},t),{},{provider:_e(_e({},t.provider),{},{chainId:(0,L.hexToDecimal)(t.provider.chainId)})});return e(r)})),onPreferencesStateChange:e=>this.preferencesController.store.subscribe((t=>{const r=_e(_e({},t),{},{useStaticTokenList:!this.preferencesController.store.getState().useTokenDetection});return e(r)})),messenger:l,state:s.TokenListController}),this.phishingController=new M.PhishingController,this.notificationController=new M.NotificationController({allNotifications:j.UI_NOTIFICATIONS},s.NotificationController),this.tokenRatesController=new M.TokenRatesController({onTokensStateChange:e=>this.tokensController.subscribe(e),onCurrencyRateStateChange:e=>this.controllerMessenger.subscribe(`${this.currencyRateController.name}:stateChange`,e),onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r=_e(_e({},t),{},{provider:_e(_e({},t.provider),{},{chainId:(0,L.hexToDecimal)(t.provider.chainId)})});return e(r)}))}),this.ensController=new Z.default({provider:this.provider,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),onNetworkDidChange:this.networkController.on.bind(this.networkController,X.NETWORK_EVENTS.NETWORK_DID_CHANGE)}),this.incomingTransactionsController=new oe.default({blockTracker:this.blockTracker,onNetworkDidChange:this.networkController.on.bind(this.networkController,X.NETWORK_EVENTS.NETWORK_DID_CHANGE),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),preferencesController:this.preferencesController,initState:s.IncomingTransactionsController}),this.accountTracker=new V.default({provider:this.provider,blockTracker:this.blockTracker,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController)}),this.on("controllerConnectionChanged",(e=>{e>0?(this.accountTracker.start(),this.incomingTransactionsController.start(),this.currencyRateController.start(),this.tokenListController.start()):(this.accountTracker.stop(),this.incomingTransactionsController.stop(),this.currencyRateController.stop(),this.tokenListController.stop())})),this.cachedBalancesController=new re.default({accountTracker:this.accountTracker,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),initState:s.CachedBalancesController}),this.onboardingController=new ne.default({initState:s.OnboardingController}),this.tokensController.hub.on("pendingSuggestedAsset",(async()=>{await e.openPopup()})),this.keyringController.memStore.subscribe((e=>this._onKeyringControllerUpdate(e))),this.keyringController.on("unlock",(()=>this._onUnlock())),this.keyringController.on("lock",(()=>this._onLock()));const d=()=>this.preferencesController.store.getState().identities;this.permissionController=new M.PermissionController({messenger:this.controllerMessenger.getRestricted({name:"PermissionController",allowedActions:[`${this.approvalController.name}:addRequest`,`${this.approvalController.name}:hasRequest`,`${this.approvalController.name}:acceptRequest`,`${this.approvalController.name}:rejectRequest`]}),state:s.PermissionController,caveatSpecifications:(0,Se.getCaveatSpecifications)({getIdentities:d}),permissionSpecifications:_e({},(0,Se.getPermissionSpecifications)({getIdentities:d,getAllAccounts:this.keyringController.getAccounts.bind(this.keyringController),captureKeyringTypesWithMissingIdentities:(e={},t=[])=>{const r=t.filter((t=>!e[t])).map((e=>{var t;return null===(t=this.keyringController.getKeyringForAccount(e))||void 0===t?void 0:t.type})),s=Object.keys(e||{}).length,n=Object.keys(this.accountTracker.store.getState().accounts||{}).length;(0,_.captureException)(new Error(`Attempt to get permission specifications failed because their were ${t.length} accounts, but ${s} identities, and the ${r} keyrings included accounts with missing identities. Meanwhile, there are ${n} accounts in the account tracker.`))}})),unrestrictedMethods:Se.unrestrictedMethods}),this.permissionLogController=new Se.PermissionLogController({restrictedMethods:new Set(Object.keys(D.RestrictedMethods)),initState:s.PermissionLogController}),this.subjectMetadataController=new M.SubjectMetadataController({messenger:this.controllerMessenger.getRestricted({name:"SubjectMetadataController",allowedActions:[`${this.permissionController.name}:hasPermissions`]}),state:s.SubjectMetadataController,subjectCacheLimit:100}),this.detectTokensController=new pe.default({preferences:this.preferencesController,tokensController:this.tokensController,network:this.networkController,keyringMemStore:this.keyringController.memStore,tokenList:this.tokenListController}),this.addressBookController=new M.AddressBookController(undefined,s.AddressBookController),this.alertController=new se.default({initState:s.AlertController,preferencesStore:this.preferencesController.store}),this.threeBoxController=new ae.default({preferencesController:this.preferencesController,addressBookController:this.addressBookController,keyringController:this.keyringController,initState:s.ThreeBoxController,getKeyringControllerState:this.keyringController.memStore.getState.bind(this.keyringController.memStore),version:n,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.txController=new he.default({initState:s.TransactionController||s.TransactionManager,getPermittedAccounts:this.getPermittedAccounts.bind(this),getProviderConfig:this.networkController.getProviderConfig.bind(this.networkController),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),networkStore:this.networkController.networkStore,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),preferencesStore:this.preferencesController.store,txHistoryLimit:60,signTransaction:this.keyringController.signTransaction.bind(this.keyringController),provider:this.provider,blockTracker:this.blockTracker,createEventFragment:this.metaMetricsController.createEventFragment.bind(this.metaMetricsController),updateEventFragment:this.metaMetricsController.updateEventFragment.bind(this.metaMetricsController),finalizeEventFragment:this.metaMetricsController.finalizeEventFragment.bind(this.metaMetricsController),getEventFragmentById:this.metaMetricsController.getEventFragmentById.bind(this.metaMetricsController),trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getParticipateInMetrics:()=>this.metaMetricsController.state.participateInMetaMetrics,getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController),getExternalPendingTransactions:this.getExternalPendingTransactions.bind(this),getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this),getTokenStandardAndDetails:this.assetsContractController.getTokenStandardAndDetails.bind(this.assetsContractController)}),this.txController.on("newUnapprovedTx",(()=>e.showUserConfirmation())),this.txController.on("tx:status-update",(async(e,t)=>{if(t===A.TRANSACTION_STATUSES.CONFIRMED||t===A.TRANSACTION_STATUSES.FAILED){const t=this.txController.txStateManager.getTransaction(e),a=this.preferencesController.getFrequentRpcListDetail();let o={};if(t.chainId){var r;const e=a.find((e=>t.chainId===e.chainId));o=null!==(r=null==e?void 0:e.rpcPrefs)&&void 0!==r?r:{}}this.platform.showTransactionNotification(t,o);const{txReceipt:i}=t;if(t.type===A.TRANSACTION_TYPES.TOKEN_METHOD_TRANSFER_FROM&&t.txParams!==undefined){var s;const{data:e,to:r,from:n}=t.txParams,{chainId:a}=t,o=(0,K.parseStandardTokenTransactionData)(e),i=(0,G.getTokenValueParam)(o),{allCollectibles:c}=this.collectiblesController.state,l=null==c||null===(s=c[n])||void 0===s?void 0:s[a].find((({address:e,tokenId:t})=>(0,q.isEqualCaseInsensitive)(e,r)&&t===i));l&&this.collectiblesController.checkAndUpdateSingleCollectibleOwnershipStatus(l,!1,{userAddress:n,chainId:a})}const c=await this.getState();var n;if(i&&"0x0"===i.status)this.metaMetricsController.trackEvent({event:"Tx Status Update: On-Chain Failure",category:"Background",properties:{action:"Transactions",errorMessage:null===(n=t.simulationFails)||void 0===n?void 0:n.reason,numberOfTokens:c.tokens.length,numberOfAccounts:Object.keys(c.accounts).length}},{matomoEvent:!0})}})),this.networkController.on(X.NETWORK_EVENTS.NETWORK_DID_CHANGE,(async()=>{const{ticker:e}=this.networkController.getProviderConfig();try{console.log(e),await this.currencyRateController.setNativeCurrency(e)}catch(e){console.error(e)}})),this.networkController.lookupNetwork(),this.messageManager=new ie.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.personalMessageManager=new de.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.decryptMessageManager=new ce.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.encryptionPublicKeyManager=new le.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.typedMessageManager=new ue.default({getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.swapsController=new me.default({getBufferedGasLimit:this.txController.txGasUtil.getBufferedGasLimit.bind(this.txController.txGasUtil),networkController:this.networkController,provider:this.provider,getProviderConfig:this.networkController.getProviderConfig.bind(this.networkController),getTokenRatesState:()=>this.tokenRatesController.state,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController)}),this.smartTransactionsController=new O.default({onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),getNetwork:this.networkController.getNetworkState.bind(this.networkController),getNonceLock:this.txController.nonceTracker.getNonceLock.bind(this.txController.nonceTracker),confirmExternalTransaction:this.txController.confirmExternalTransaction.bind(this.txController),provider:this.provider,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)},undefined,s.SmartTransactionsController),this.networkController.on(X.NETWORK_EVENTS.NETWORK_DID_CHANGE,(()=>{this.accountTracker._updateAccounts()})),this.networkController.on(X.NETWORK_EVENTS.NETWORK_WILL_CHANGE,(()=>{this.txController.txStateManager.clearUnapprovedTxs(),this.encryptionPublicKeyManager.clearUnapproved(),this.personalMessageManager.clearUnapproved(),this.typedMessageManager.clearUnapproved(),this.decryptMessageManager.clearUnapproved(),this.messageManager.clearUnapproved()})),this.on("update",(e=>this._onStateUpdate(e))),this.store.updateStructure({AppStateController:this.appStateController.store,TransactionController:this.txController.store,KeyringController:this.keyringController.store,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,NetworkController:this.networkController.store,CachedBalancesController:this.cachedBalancesController.store,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,IncomingTransactionsController:this.incomingTransactionsController.store,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController.store,SubjectMetadataController:this.subjectMetadataController,ThreeBoxController:this.threeBoxController.store,NotificationController:this.notificationController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,MisesController:this.misesController.store,SmartTransactionsController:this.smartTransactionsController,CollectiblesController:this.collectiblesController}),this.memStore=new H.default({config:{AppStateController:this.appStateController.store,NetworkController:this.networkController.store,AccountTracker:this.accountTracker.store,TxController:this.txController.memStore,CachedBalancesController:this.cachedBalancesController.store,TokenRatesController:this.tokenRatesController,MessageManager:this.messageManager.memStore,PersonalMessageManager:this.personalMessageManager.memStore,DecryptMessageManager:this.decryptMessageManager.memStore,EncryptionPublicKeyManager:this.encryptionPublicKeyManager.memStore,TypesMessageManager:this.typedMessageManager.memStore,KeyringController:this.keyringController.memStore,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,IncomingTransactionsController:this.incomingTransactionsController.store,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController.store,SubjectMetadataController:this.subjectMetadataController,ThreeBoxController:this.threeBoxController.store,SwapsController:this.swapsController.store,MisesController:this.misesController.store,EnsController:this.ensController.store,ApprovalController:this.approvalController,NotificationController:this.notificationController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,SmartTransactionsController:this.smartTransactionsController,CollectiblesController:this.collectiblesController},controllerMessenger:this.controllerMessenger}),this.memStore.subscribe(this.sendUpdate.bind(this));const h=null===(r={})||void 0===r?void 0:r.PASSWORD;h&&!this.isUnlocked()&&this.onboardingController.store.getState().completedOnboarding&&this.submitPassword(h),this.extension.runtime.getPlatformInfo().then((e=>{e&&e.os&&this.appStateController.setBrowserEnvironment(e.os,"chrome")})),this.setupControllerEventSubscriptions(),this.publicConfigStore=this.createPublicConfigStore()}setupControllerEventSubscriptions(){const e=async(e,t)=>{this.isUnlocked()&&this.notifyConnections(e,{method:Se.NOTIFICATION_NAMES.accountsChanged,params:t.length<2?t:await this.getPermittedAccounts(e)}),this.permissionLogController.updateAccountsHistory(e,t)};let t;this.preferencesController.store.subscribe((async({selectedAddress:r})=>{if(r&&r!==t){t=r;const s=(0,Se.getPermittedAccountsByOrigin)(this.permissionController.state);for(const[t,n]of s.entries())n.includes(r)&&e(t,n)}})),this.controllerMessenger.subscribe(`${this.permissionController.name}:stateChange`,(async(t,r)=>{const s=(0,Se.getChangedAccounts)(t,r);for(const[t,r]of s.entries())e(t,r)}),Se.getPermittedAccountsByOrigin)}initializeProvider(){const e=this.platform.getVersion(),t={static:{eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`},version:e,getAccounts:async({origin:e})=>{if("metamask"===e){const e=this.preferencesController.getSelectedAddress();return e?[e]:[]}return this.isUnlocked()?await this.getPermittedAccounts(e):[]},processTransaction:this.newUnapprovedTransaction.bind(this),processEthSignMessage:this.newUnsignedMessage.bind(this),processTypedMessage:this.newUnsignedTypedMessage.bind(this),processTypedMessageV3:this.newUnsignedTypedMessage.bind(this),processTypedMessageV4:this.newUnsignedTypedMessage.bind(this),processPersonalMessage:this.newUnsignedPersonalMessage.bind(this),processDecryptMessage:this.newRequestDecryptMessage.bind(this),processEncryptionPublicKey:this.newRequestEncryptionPublicKey.bind(this),getPendingNonce:this.getPendingNonce.bind(this),getPendingTransactionByHash:e=>this.txController.getTransactions({searchCriteria:{hash:e,status:A.TRANSACTION_STATUSES.SUBMITTED}})[0]};return this.networkController.initializeProvider(t)}createPublicConfigStore(){const e=new c.ObservableStore,{networkController:t}=this;function r(r){const s=t.getCurrentChainId();"loading"!==r.network&&e.putState(function(e,{isUnlocked:t,network:r}){return{isUnlocked:t,chainId:e,networkVersion:r}}(s,r))}return this.on("update",r),r(this.getState()),e}async getProviderState(e){return _e(_e({isUnlocked:this.isUnlocked()},this.getProviderNetworkState()),{},{accounts:await this.getPermittedAccounts(e)})}getProviderNetworkState(e){const{network:t}=e||this.getState();return{chainId:this.networkController.getCurrentChainId(),networkVersion:t}}getState(){const{vault:e}=this.keyringController.store.getState(),{seedPhraseBackedUp:t}=this.onboardingController.store.getState();return _e({isInitialized:Boolean(e)&&Boolean(t)},this.memStore.getFlatState())}getApi(){const{addressBookController:e,alertController:t,approvalController:r,appStateController:s,collectiblesController:n,collectibleDetectionController:a,currencyRateController:o,detectTokensController:i,ensController:c,gasFeeController:l,keyringController:d,metaMetricsController:u,networkController:h,notificationController:p,onboardingController:m,permissionController:f,preferencesController:g,qrHardwareKeyring:v,swapsController:y,threeBoxController:T,tokensController:S,smartTransactionsController:k,txController:w,assetsContractController:C}=this;return _e(_e({getState:this.getState.bind(this),setCurrentCurrency:o.setCurrentCurrency.bind(o),setUseBlockie:g.setUseBlockie.bind(g),setUseNonceField:g.setUseNonceField.bind(g),setUsePhishDetect:g.setUsePhishDetect.bind(g),setUseTokenDetection:g.setUseTokenDetection.bind(g),setUseCollectibleDetection:g.setUseCollectibleDetection.bind(g),setOpenSeaEnabled:g.setOpenSeaEnabled.bind(g),setIpfsGateway:g.setIpfsGateway.bind(g),setParticipateInMetaMetrics:u.setParticipateInMetaMetrics.bind(u),setCurrentLocale:g.setCurrentLocale.bind(g),markPasswordForgotten:this.markPasswordForgotten.bind(this),unMarkPasswordForgotten:this.unMarkPasswordForgotten.bind(this),safelistPhishingDomain:this.safelistPhishingDomain.bind(this),getRequestAccountTabIds:this.getRequestAccountTabIds,getOpenMetamaskTabsIds:this.getOpenMetamaskTabsIds,markNotificationPopupAsAutomaticallyClosed:()=>this.notificationManager.markAsAutomaticallyClosed(),addNewAccount:this.addNewAccount.bind(this),verifySeedPhrase:this.verifySeedPhrase.bind(this),resetAccount:this.resetAccount.bind(this),removeAccount:this.removeAccount.bind(this),importAccountWithStrategy:this.importAccountWithStrategy.bind(this),connectHardware:this.connectHardware.bind(this),forgetDevice:this.forgetDevice.bind(this),checkHardwareStatus:this.checkHardwareStatus.bind(this),unlockHardwareWalletAccount:this.unlockHardwareWalletAccount.bind(this),setLedgerTransportPreference:this.setLedgerTransportPreference.bind(this),attemptLedgerTransportCreation:this.attemptLedgerTransportCreation.bind(this),establishLedgerTransportPreference:this.establishLedgerTransportPreference.bind(this),submitQRHardwareCryptoHDKey:v.submitCryptoHDKey.bind(v),submitQRHardwareCryptoAccount:v.submitCryptoAccount.bind(v),cancelSyncQRHardware:v.cancelSync.bind(v),submitQRHardwareSignature:v.submitSignature.bind(v),cancelQRHardwareSignRequest:v.cancelSignRequest.bind(v),fetchInfoToSync:this.fetchInfoToSync.bind(this),submitPassword:this.submitPassword.bind(this),verifyPassword:this.verifyPassword.bind(this),setProviderType:h.setProviderType.bind(h),rollbackToPreviousProvider:h.rollbackToPreviousProvider.bind(h),setCustomRpc:this.setCustomRpc.bind(this),updateAndSetCustomRpc:this.updateAndSetCustomRpc.bind(this),delCustomRpc:this.delCustomRpc.bind(this),addToken:S.addToken.bind(S),rejectWatchAsset:S.rejectWatchAsset.bind(S),acceptWatchAsset:S.acceptWatchAsset.bind(S),updateTokenType:S.updateTokenType.bind(S),removeToken:S.removeAndIgnoreToken.bind(S),setAccountLabel:g.setAccountLabel.bind(g),setFeatureFlag:g.setFeatureFlag.bind(g),setPreference:g.setPreference.bind(g),addKnownMethodData:g.addKnownMethodData.bind(g),setDismissSeedBackUpReminder:g.setDismissSeedBackUpReminder.bind(g),setAdvancedGasFee:g.setAdvancedGasFee.bind(g),setEIP1559V2Enabled:g.setEIP1559V2Enabled.bind(g),setTheme:g.setTheme.bind(g),getTokenStandardAndDetails:this.getTokenStandardAndDetails.bind(this),addCollectible:n.addCollectible.bind(n),addCollectibleVerifyOwnership:n.addCollectibleVerifyOwnership.bind(n),removeAndIgnoreCollectible:n.removeAndIgnoreCollectible.bind(n),removeCollectible:n.removeCollectible.bind(n),checkAndUpdateAllCollectiblesOwnershipStatus:n.checkAndUpdateAllCollectiblesOwnershipStatus.bind(n),checkAndUpdateSingleCollectibleOwnershipStatus:n.checkAndUpdateSingleCollectibleOwnershipStatus.bind(n),isCollectibleOwner:n.isCollectibleOwner.bind(n),setAddressBook:e.set.bind(e),removeFromAddressBook:e.delete.bind(e),setLastActiveTime:s.setLastActiveTime.bind(s),setDefaultHomeActiveTabName:s.setDefaultHomeActiveTabName.bind(s),setConnectedStatusPopoverHasBeenShown:s.setConnectedStatusPopoverHasBeenShown.bind(s),setRecoveryPhraseReminderHasBeenShown:s.setRecoveryPhraseReminderHasBeenShown.bind(s),setRecoveryPhraseReminderLastShown:s.setRecoveryPhraseReminderLastShown.bind(s),setShowTestnetMessageInDropdown:s.setShowTestnetMessageInDropdown.bind(s),setCollectiblesDetectionNoticeDismissed:s.setCollectiblesDetectionNoticeDismissed.bind(s),setEnableEIP1559V2NoticeDismissed:s.setEnableEIP1559V2NoticeDismissed.bind(s),updateCollectibleDropDownState:s.updateCollectibleDropDownState.bind(s),tryReverseResolveAddress:c.reverseResolveAddress.bind(c),clearKeyrings:this.clearKeyrings.bind(this),exportAccount:d.exportAccount.bind(d),setSelectedAddress:this.setSelectedAddress.bind(this),setMisesUser:this.setMisesUser.bind(this),lockAll:this.lockAll.bind(this),initMisesBalance:this.initMisesBalance.bind(this),setMisesBook:this.setMisesBook.bind(this),postTx:this.postTx.bind(this),getReader:this.getReader.bind(this),recentTransactions:this.recentTransactions.bind(this),updataBalance:this.updataBalance.bind(this),resetMisesAccount:this.resetMisesAccount.bind(this),closePopUp:this.closePopUp.bind(this),getPopupId:this.getPopupId.bind(this),getMisesUser:this.getMisesUser.bind(this),addressToMisesId:this.addressToMisesId.bind(this),resetTranstionFlag:this.resetTranstionFlag.bind(this),setLocked:this.setLocked.bind(this),createNewVaultAndKeychain:this.createNewVaultAndKeychain.bind(this),createNewVaultAndRestore:this.createNewVaultAndRestore.bind(this),cancelTransaction:w.cancelTransaction.bind(w),updateTransaction:w.updateTransaction.bind(w),updateAndApproveTransaction:w.updateAndApproveTransaction.bind(w),approveTransactionsWithSameNonce:w.approveTransactionsWithSameNonce.bind(w),createCancelTransaction:this.createCancelTransaction.bind(this),createSpeedUpTransaction:this.createSpeedUpTransaction.bind(this),estimateGas:this.estimateGas.bind(this),getNextNonce:this.getNextNonce.bind(this),addUnapprovedTransaction:w.addUnapprovedTransaction.bind(w),createTransactionEventFragment:w.createTransactionEventFragment.bind(w),getTransactions:w.getTransactions.bind(w),updateEditableParams:w.updateEditableParams.bind(w),updateTransactionGasFees:w.updateTransactionGasFees.bind(w),updateSwapApprovalTransaction:w.updateSwapApprovalTransaction.bind(w),updateSwapTransaction:w.updateSwapTransaction.bind(w),updatePreviousGasParams:w.updatePreviousGasParams.bind(w),signMessage:this.signMessage.bind(this),cancelMessage:this.cancelMessage.bind(this),signPersonalMessage:this.signPersonalMessage.bind(this),cancelPersonalMessage:this.cancelPersonalMessage.bind(this),signTypedMessage:this.signTypedMessage.bind(this),cancelTypedMessage:this.cancelTypedMessage.bind(this),decryptMessage:this.decryptMessage.bind(this),decryptMessageInline:this.decryptMessageInline.bind(this),cancelDecryptMessage:this.cancelDecryptMessage.bind(this),encryptionPublicKey:this.encryptionPublicKey.bind(this),cancelEncryptionPublicKey:this.cancelEncryptionPublicKey.bind(this),setSeedPhraseBackedUp:m.setSeedPhraseBackedUp.bind(m),completeOnboarding:m.completeOnboarding.bind(m),setFirstTimeFlowType:m.setFirstTimeFlowType.bind(m),setAlertEnabledness:t.setAlertEnabledness.bind(t),setUnconnectedAccountAlertShown:t.setUnconnectedAccountAlertShown.bind(t),setWeb3ShimUsageAlertDismissed:t.setWeb3ShimUsageAlertDismissed.bind(t),setThreeBoxSyncingPermission:T.setThreeBoxSyncingPermission.bind(T),restoreFromThreeBox:T.restoreFromThreeBox.bind(T),setShowRestorePromptToFalse:T.setShowRestorePromptToFalse.bind(T),getThreeBoxLastUpdated:T.getLastUpdated.bind(T),turnThreeBoxSyncingOn:T.turnThreeBoxSyncingOn.bind(T),initializeThreeBox:this.initializeThreeBox.bind(this),removePermissionsFor:f.revokePermissions.bind(f),approvePermissionsRequest:f.acceptPermissionsRequest.bind(f),rejectPermissionsRequest:f.rejectPermissionsRequest.bind(f)},(0,Se.getPermissionBackgroundApiMethods)(f)),{},{fetchAndSetQuotes:y.fetchAndSetQuotes.bind(y),setSelectedQuoteAggId:y.setSelectedQuoteAggId.bind(y),resetSwapsState:y.resetSwapsState.bind(y),setSwapsTokens:y.setSwapsTokens.bind(y),clearSwapsQuotes:y.clearSwapsQuotes.bind(y),setApproveTxId:y.setApproveTxId.bind(y),setTradeTxId:y.setTradeTxId.bind(y),setSwapsTxGasPrice:y.setSwapsTxGasPrice.bind(y),setSwapsTxGasLimit:y.setSwapsTxGasLimit.bind(y),setSwapsTxMaxFeePerGas:y.setSwapsTxMaxFeePerGas.bind(y),setSwapsTxMaxFeePriorityPerGas:y.setSwapsTxMaxFeePriorityPerGas.bind(y),safeRefetchQuotes:y.safeRefetchQuotes.bind(y),stopPollingForQuotes:y.stopPollingForQuotes.bind(y),setBackgroundSwapRouteState:y.setBackgroundSwapRouteState.bind(y),resetPostFetchState:y.resetPostFetchState.bind(y),setSwapsErrorKey:y.setSwapsErrorKey.bind(y),setInitialGasEstimate:y.setInitialGasEstimate.bind(y),setCustomApproveTxData:y.setCustomApproveTxData.bind(y),setSwapsLiveness:y.setSwapsLiveness.bind(y),setSwapsFeatureFlags:y.setSwapsFeatureFlags.bind(y),setSwapsUserFeeLevel:y.setSwapsUserFeeLevel.bind(y),setSwapsQuotesPollingLimitEnabled:y.setSwapsQuotesPollingLimitEnabled.bind(y),setSmartTransactionsOptInStatus:k.setOptInState.bind(k),fetchSmartTransactionFees:k.getFees.bind(k),estimateSmartTransactionsGas:k.estimateGas.bind(k),submitSignedTransactions:k.submitSignedTransactions.bind(k),cancelSmartTransaction:k.cancelSmartTransaction.bind(k),fetchSmartTransactionsLiveness:k.fetchLiveness.bind(k),updateSmartTransaction:k.updateSmartTransaction.bind(k),setStatusRefreshInterval:k.setStatusRefreshInterval.bind(k),trackMetaMetricsEvent:u.trackEvent.bind(u),trackMetaMetricsPage:u.trackPage.bind(u),createEventFragment:u.createEventFragment.bind(u),updateEventFragment:u.updateEventFragment.bind(u),finalizeEventFragment:u.finalizeEventFragment.bind(u),resolvePendingApproval:r.accept.bind(r),rejectPendingApproval:async(e,t)=>{r.reject(e,new b.EthereumRpcError(t.code,t.message,t.data))},updateViewedNotifications:p.updateViewed.bind(p),getGasFeeEstimatesAndStartPolling:l.getGasFeeEstimatesAndStartPolling.bind(l),disconnectGasFeeEstimatePoller:l.disconnectPoller.bind(l),getGasFeeTimeEstimate:l.getTimeEstimate.bind(l),addPollingTokenToAppState:s.addPollingToken.bind(s),removePollingTokenFromAppState:s.removePollingToken.bind(s),detectNewTokens:i.detectNewTokens.bind(i),detectCollectibles:a.detectCollectibles.bind(a),addDetectedTokens:null,importTokens:null,ignoreTokens:null,getBalancesInSingleCall:null})}async getTokenStandardAndDetails(e,t,r){var s,n;const a=await this.assetsContractController.getTokenStandardAndDetails(e,t,r);return _e(_e({},a),{},{decimals:null==a||null===(s=a.decimals)||void 0===s?void 0:s.toString(10),balance:null==a||null===(n=a.balance)||void 0===n?void 0:n.toString(10)})}async createNewVaultAndKeychain(e){const t=await this.createVaultMutex.acquire();try{let r;if((await this.keyringController.getAccounts()).length>0)r=await this.keyringController.fullUpdate();else{r=await this.keyringController.createNewVaultAndKeychain(e);const t=await this.keyringController.getAccounts();this.preferencesController.setAddresses(t),this.selectFirstIdentity("first")}return this.lockAll(),r}finally{t()}}async createNewVaultAndRestore(e,t){const r=await this.createVaultMutex.acquire();try{let n,a;const o=s.from(t),{keyringController:i}=this;this.preferencesController.setAddresses([]),this.permissionController.clearState(),this.accountTracker.clearAccounts(),this.cachedBalancesController.clearCachedBalances(),this.txController.txStateManager.clearUnapprovedTxs(),this.lockAll();const c=await i.createNewVaultAndRestore(e,o),l=new P.default(this.provider);n=await i.getAccounts(),a=await this.getBalance(n[n.length-1],l);const d=i.getKeyringsByType("HD Key Tree")[0];if(!d)throw new Error("MetamaskController - No HD Key Tree found");for(;"0x0"!==a;)await i.addNewAccount(d),n=await i.getAccounts(),a=await this.getBalance(n[n.length-1],l);n.length>1&&"0x0"===a&&(await this.removeAccount(n[n.length-1]),n=await i.getAccounts());const u=this.preferencesController.getLedgerTransportPreference();return this.setLedgerTransportPreference(u),this.preferencesController.setAddresses(n),this.selectFirstIdentity(),c}finally{r()}}getBalance(e,t){return new Promise(((r,s)=>{const n=this.accountTracker.store.getState().accounts[e];n&&n.balance?r(n.balance):t.getBalance(e,((e,t)=>{e?(s(e),T.default.error(e)):r(t||"0x0")}))}))}async fetchInfoToSync(){const{currentLocale:e,frequentRpcList:t,identities:r,selectedAddress:s,useTokenDetection:n}=this.preferencesController.store.getState(),{tokenList:a}=this.tokenListController.state,o={currentLocale:e,frequentRpcList:t,identities:r,selectedAddress:s},{allTokens:i,allIgnoredTokens:c}=this.tokensController.state,l={};Object.keys(i).forEach((e=>{l[e]={},Object.keys(i[e]).forEach((t=>{const r=(0,R.toChecksumHexAddress)(t);l[e][r]=i[e][r].filter((e=>{if(e.isERC721===undefined){const t=n?e.address.toLowerCase():e.address;if(a[t]!==undefined)return!0}else if(!1===e.isERC721)return!0;return!1}))}))}));const d=this.keyringController.getKeyringsByType("HD Key Tree")[0],u=this.keyringController.getKeyringsByType("Simple Key Pair"),h=await d.getAccounts(),p=(await Promise.all(u.map((e=>e.getAccounts())))).reduce(((e,t)=>[...e,...t]),[]),m={hd:h.filter(((e,t)=>h.indexOf(e)===t)).map((e=>(0,R.toChecksumHexAddress)(e))),simpleKeyPair:p.filter(((e,t)=>p.indexOf(e)===t)).map((e=>(0,R.toChecksumHexAddress)(e))),ledger:[],trezor:[],lattice:[]};let{transactions:f}=this.txController.store.getState();return f=Object.values(f).filter((e=>{const t=(0,R.toChecksumHexAddress)(e.txParams.from);return m.hd.includes(t)})),{accounts:m,preferences:o,transactions:f,tokens:{allTokens:l,allIgnoredTokens:c},network:this.networkController.store.getState()}}async submitPassword(e){await this.keyringController.submitPassword(e);try{await this.blockTracker.checkForLatestBlock()}catch(e){T.default.error("Error while unlocking extension.",e)}try{const e=this.threeBoxController.getThreeBoxSyncingState();e&&!this.threeBoxController.box?(this.threeBoxController.init(),this.threeBoxController.turnThreeBoxSyncingOn()):e&&this.threeBoxController.box&&this.threeBoxController.turnThreeBoxSyncingOn()}catch(e){T.default.error("Error while unlocking extension.",e)}const t=this.preferencesController.getLedgerTransportPreference();return this.setLedgerTransportPreference(t),this.keyringController.fullUpdate()}async verifyPassword(e){await this.keyringController.verifyPassword(e)}selectFirstIdentity(e){const{identities:t}=this.preferencesController.store.getState(),r=Object.keys(t)[0];this.setSelectedAddress(r,e)}getFirstIdentity(){const{identities:e}=this.preferencesController.store.getState();return Object.keys(e)[0]}getPrimaryKeyringMnemonic(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e.mnemonic)throw new Error("Primary keyring mnemonic unavailable.");return e.mnemonic}async getKeyringForDevice(e,t=null){let r=null;switch(e){case N.DEVICE_NAMES.TREZOR:r=S.default.type;break;case N.DEVICE_NAMES.LEDGER:r=k.default.type;break;case N.DEVICE_NAMES.QR:r=C.MetaMaskKeyring.type;break;case N.DEVICE_NAMES.LATTICE:r=w.default.type;break;default:throw new Error("MetamaskController:getKeyringForDevice - Unknown device")}let s=await this.keyringController.getKeyringsByType(r)[0];if(s||(s=await this.keyringController.addNewKeyring(r)),t&&s.setHdPath&&s.setHdPath(t),e===N.DEVICE_NAMES.LATTICE&&(s.appName="MetaMask"),e===N.DEVICE_NAMES.TREZOR){const e=s.getModel();this.appStateController.setTrezorModel(e)}return s.network=this.networkController.getProviderConfig().type,s}async attemptLedgerTransportCreation(){const e=await this.getKeyringForDevice(N.DEVICE_NAMES.LEDGER);return await e.attemptMakeApp()}async establishLedgerTransportPreference(){const e=this.preferencesController.getLedgerTransportPreference();return await this.setLedgerTransportPreference(e)}async connectHardware(e,t,r){const s=await this.getKeyringForDevice(e,r);let n=[];switch(t){case-1:n=await s.getPreviousPage();break;case 1:n=await s.getNextPage();break;default:n=await s.getFirstPage()}const a=await this.keyringController.getAccounts(),o=[...new Set(a.concat(n.map((e=>e.address.toLowerCase()))))];return this.accountTracker.syncWithAddresses(o),n}async checkHardwareStatus(e,t){return(await this.getKeyringForDevice(e,t)).isUnlocked()}async forgetDevice(e){return(await this.getKeyringForDevice(e)).forgetDevice(),!0}async getAccountType(e){switch((await this.keyringController.getKeyringForAccount(e)).type){case N.KEYRING_TYPES.TREZOR:case N.KEYRING_TYPES.LATTICE:case N.KEYRING_TYPES.QR:case N.KEYRING_TYPES.LEDGER:return"hardware";case N.KEYRING_TYPES.IMPORTED:return"imported";default:return"MetaMask"}}async getDeviceModel(e){const t=await this.keyringController.getKeyringForAccount(e);switch(t.type){case N.KEYRING_TYPES.TREZOR:return t.getModel();case N.KEYRING_TYPES.QR:return t.getName();case N.KEYRING_TYPES.LEDGER:return N.DEVICE_NAMES.LEDGER;case N.KEYRING_TYPES.LATTICE:return N.DEVICE_NAMES.LATTICE;default:return"N/A"}}getAccountLabel(e,t,r){return`${e[0].toUpperCase()}${e.slice(1)} ${parseInt(t,10)+1} ${r||""}`.trim()}async unlockHardwareWalletAccount(e,t,r,s){const n=await this.getKeyringForDevice(t,r);n.setAccountToUnlock(e);const a=await this.keyringController.getAccounts(),o=await this.keyringController.addNewAccount(n),i=await this.keyringController.getAccounts();this.preferencesController.setAddresses(i),i.forEach((r=>{if(!a.includes(r)){const a=this.getAccountLabel(t===N.DEVICE_NAMES.QR?n.getName():t,e,s);this.preferencesController.setAccountLabel(r,a),this.setSelectedAddress(r)}}));const{identities:c}=this.preferencesController.store.getState();return _e(_e({},o),{},{identities:c})}async addNewAccount(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e)throw new Error("MetamaskController - No HD Key Tree found");const{keyringController:t}=this,r=await t.addNewAccount(e),s=await t.getAccounts();await this.verifySeedPhrase(),this.preferencesController.setAddresses(s);const{identities:n}=this.preferencesController.store.getState();return _e(_e({},r),{},{identities:n})}async verifySeedPhrase(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e)throw new Error("MetamaskController - No HD Key Tree found");const t=await e.serialize(),r=s.from(t.mnemonic),n=await e.getAccounts();if(n.length<1)throw new Error("MetamaskController - No accounts found");try{return await ge.default.verifyAccounts(n,r),Array.from(r.values())}catch(e){throw T.default.error(e.message),e}}async resetAccount(){const e=this.preferencesController.getSelectedAddress();return this.txController.wipeTransactions(e),this.networkController.resetConnection(),e}async getPermittedAccounts(e){try{return await this.permissionController.executeRestrictedMethod(e,D.RestrictedMethods.eth_accounts)}catch(e){if(e.code===b.errorCodes.provider.unauthorized)return[];throw e}}removeAllAccountPermissions(e){this.permissionController.updatePermissionsByCaveat(D.CaveatTypes.restrictReturnedAccounts,(t=>Se.CaveatMutatorFactories[D.CaveatTypes.restrictReturnedAccounts].removeAccount(e,t)))}async removeAccount(e){return this.removeAllAccountPermissions(e),this.preferencesController.removeAddress(e),this.accountTracker.removeAccount([e]),await this.keyringController.removeAccount(e),e}async importAccountWithStrategy(e,t){const r=await fe.default.importAccount(e,t),s=await this.keyringController.addNewKeyring("Simple Key Pair",[r]),n=await s.getAccounts(),a=await this.keyringController.getAccounts();this.preferencesController.setAddresses(a),await this.setSelectedAddress(n[0])}async newUnapprovedTransaction(e,t){return await this.txController.newUnapprovedTransaction(e,t)}async newUnsignedMessage(e,t){const r=(0,ie.normalizeMsgData)(e.data);let s;if(66!==r.length&&67!==r.length)throw b.ethErrors.rpc.invalidParams("eth_sign requires 32 byte message hash");return s=this.messageManager.addUnapprovedMessageAsync(e,t),this.sendUpdate(),this.opts.showUserConfirmation(),await s}async signMessage(e){T.default.info("MetaMaskController - signMessage");const t=e.metamaskId;try{const r=await this.messageManager.approveMessage(e),s=await this.keyringController.signMessage(r);return this.messageManager.setMsgStatusSigned(t,s),this.getState()}catch(e){throw T.default.info("MetaMaskController - eth_sign failed",e),this.messageManager.errorMessage(t,e),e}}cancelMessage(e){const{messageManager:t}=this;return t.rejectMsg(e),this.getState()}async newUnsignedPersonalMessage(e,t){const r=this.personalMessageManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}async signPersonalMessage(e){T.default.info("MetaMaskController - signPersonalMessage");const t=e.metamaskId;try{const r=await this.personalMessageManager.approveMessage(e),s=await this.keyringController.signPersonalMessage(r);return this.personalMessageManager.setMsgStatusSigned(t,s),this.getState()}catch(e){throw T.default.info("MetaMaskController - eth_personalSign failed",e),this.personalMessageManager.errorMessage(t,e),e}}cancelPersonalMessage(e){return this.personalMessageManager.rejectMsg(e),this.getState()}async newRequestDecryptMessage(e,t){const r=this.decryptMessageManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}async decryptMessageInline(e){T.default.info("MetaMaskController - decryptMessageInline");const t=e.metamaskId,r=this.decryptMessageManager.getMsg(t);try{const t=(0,y.stripHexPrefix)(e.data),n=s.from(t,"hex");e.data=JSON.parse(n.toString("utf8")),r.rawData=await this.keyringController.decryptMessage(e)}catch(e){r.error=e.message}return this.decryptMessageManager._updateMsg(r),this.getState()}async decryptMessage(e){T.default.info("MetaMaskController - decryptMessage");const t=e.metamaskId;try{const r=await this.decryptMessageManager.approveMessage(e),n=(0,y.stripHexPrefix)(r.data),a=s.from(n,"hex");r.data=JSON.parse(a.toString("utf8"));const o=await this.keyringController.decryptMessage(r);this.decryptMessageManager.setMsgStatusDecrypted(t,o)}catch(e){T.default.info("MetaMaskController - eth_decrypt failed.",e),this.decryptMessageManager.errorMessage(t,e)}return this.getState()}cancelDecryptMessage(e){return this.decryptMessageManager.rejectMsg(e),this.getState()}async newRequestEncryptionPublicKey(e,t){const r=e;switch((await this.keyringController.getKeyringForAccount(r)).type){case N.KEYRING_TYPES.LEDGER:return new Promise(((e,t)=>{t(new Error("Ledger does not support eth_getEncryptionPublicKey."))}));case N.KEYRING_TYPES.TREZOR:return new Promise(((e,t)=>{t(new Error("Trezor does not support eth_getEncryptionPublicKey."))}));case N.KEYRING_TYPES.LATTICE:return new Promise(((e,t)=>{t(new Error("Lattice does not support eth_getEncryptionPublicKey."))}));case N.KEYRING_TYPES.QR:return Promise.reject(new Error("QR hardware does not support eth_getEncryptionPublicKey."));default:{const r=this.encryptionPublicKeyManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}}}async tryUnlockMetamask(e){T.default.info("MetaMaskController - encryptionPublicKey");const t=e.metamaskId;try{const r=await this.encryptionPublicKeyManager.approveMessage(e),s=await this.keyringController.getEncryptionPublicKey(r.data);this.encryptionPublicKeyManager.setMsgStatusReceived(t,s)}catch(e){T.default.info("MetaMaskController - eth_getEncryptionPublicKey failed.",e),this.encryptionPublicKeyManager.errorMessage(t,e)}return this.getState()}async encryptionPublicKey(e){T.default.info("MetaMaskController - encryptionPublicKey");const t=e.metamaskId;try{const r=await this.encryptionPublicKeyManager.approveMessage(e),s=await this.keyringController.getEncryptionPublicKey(r.data);this.encryptionPublicKeyManager.setMsgStatusReceived(t,s)}catch(e){T.default.info("MetaMaskController - eth_getEncryptionPublicKey failed.",e),this.encryptionPublicKeyManager.errorMessage(t,e)}return this.getState()}cancelEncryptionPublicKey(e){return this.encryptionPublicKeyManager.rejectMsg(e),this.getState()}newUnsignedTypedMessage(e,t,r){const s=this.typedMessageManager.addUnapprovedMessageAsync(e,t,r);return this.sendUpdate(),this.opts.showUserConfirmation(),s}async signTypedMessage(e){T.default.info("MetaMaskController - eth_signTypedData");const t=e.metamaskId,{version:r}=e;try{const s=await this.typedMessageManager.approveMessage(e);"V1"!==r&&"string"==typeof s.data&&(s.data=JSON.parse(s.data));const n=await this.keyringController.signTypedMessage(s,{version:r});return this.typedMessageManager.setMsgStatusSigned(t,n),this.getState()}catch(e){throw T.default.info("MetaMaskController - eth_signTypedData failed.",e),this.typedMessageManager.errorMessage(t,e),e}}cancelTypedMessage(e){return this.typedMessageManager.rejectMsg(e),this.getState()}async getCurrentAccountEIP1559Compatibility(){return!0}async createCancelTransaction(e,t,r){await this.txController.createCancelTransaction(e,t,r);return await this.getState()}async createSpeedUpTransaction(e,t,r){await this.txController.createSpeedUpTransaction(e,t,r);return await this.getState()}estimateGas(e){return new Promise(((t,r)=>this.txController.txGasUtil.query.estimateGas(e,((e,s)=>e?r(e):t(s.toString(16))))))}markPasswordForgotten(){this.preferencesController.setPasswordForgotten(!0),this.sendUpdate()}unMarkPasswordForgotten(){this.preferencesController.setPasswordForgotten(!1),this.sendUpdate()}setupUntrustedCommunication({connectionStream:e,sender:t,subjectType:r}){const{usePhishDetect:s}=this.preferencesController.store.getState();let n;if(n=r||(t.id&&t.id!==this.extension.runtime.id?F.SUBJECT_TYPES.EXTENSION:F.SUBJECT_TYPES.WEBSITE),t.url){const{hostname:r}=new URL(t.url);if(s&&this.phishingController.test(r))return T.default.debug("MetaMask - sending phishing warning for",r),void this.sendPhishingWarning(e,r)}const a=(0,J.setupMultiplex)(e);this.setupProviderConnection(a.createStream("metamask-provider"),t,n),t.url&&this.setupPublicConfig(a.createStream("publicConfig"))}setupTrustedCommunication(e,t){const r=(0,J.setupMultiplex)(e);this.setupControllerConnection(r.createStream("controller")),this.setupProviderConnection(r.createStream("provider"),t,F.SUBJECT_TYPES.INTERNAL)}sendPhishingWarning(e,t){(0,J.setupMultiplex)(e).createStream("phishing").write({hostname:t})}setupControllerConnection(e){const t=this.getApi();this.activeControllerConnections+=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),e.on("data",(0,ye.default)(t,e));const r=t=>{e._writableState.ended||e.write({jsonrpc:"2.0",method:"sendUpdate",params:[t]})};this.on("update",r),e.on("end",(()=>{this.activeControllerConnections-=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),this.removeListener("update",r)}))}setupProviderConnection(e,t,r){let s,n;s=r===F.SUBJECT_TYPES.INTERNAL?"metamask":new URL(t.url).origin,t.id&&t.id!==this.extension.runtime.id&&this.subjectMetadataController.addSubjectMetadata({origin:s,extensionId:t.id,subjectType:F.SUBJECT_TYPES.EXTENSION}),t.tab&&t.tab.id&&(n=t.tab.id);const a=this.setupProviderEngine({origin:s,sender:t,subjectType:r,tabId:n}),o=(0,h.default)({engine:a}),c=this.addConnection(s,{engine:a});(0,i.default)(e,o,e,(e=>{a._middleware.forEach((e=>{e.destroy&&"function"==typeof e.destroy&&e.destroy()})),c&&this.removeConnection(s,c),e&&T.default.error(e)}))}setupProviderEngine({origin:e,subjectType:t,sender:r,tabId:s}){const n=new d.JsonRpcEngine,{blockTracker:a,provider:o}=this,i=(0,p.default)({provider:o,blockTracker:a}),c=(0,m.default)({provider:o,blockTracker:a});return c.events.on("notification",(e=>n.emit("notification",e))),n.push((0,Y.default)({origin:e})),s&&n.push((0,Q.default)({tabId:s})),n.push((0,$.default)({origin:e})),n.push(this.permissionLogController.createMiddleware()),n.push((0,ke.default)({trackEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getMetricsState:this.metaMetricsController.store.getState.bind(this.metaMetricsController.store)})),t===F.SUBJECT_TYPES.WEBSITE&&n.push((0,z.default)({location:r.url,registerOnboarding:this.onboardingController.registerOnboarding})),n.push((0,W.createMethodMiddleware)({origin:e,subjectType:t,addSubjectMetadata:this.subjectMetadataController.addSubjectMetadata.bind(this.subjectMetadataController),getProviderState:this.getProviderState.bind(this),getUnlockPromise:this.appStateController.getUnlockPromise.bind(this.appStateController),handleWatchAssetRequest:this.tokensController.watchAsset.bind(this.tokensController),requestUserApproval:this.approvalController.addAndShowApprovalRequest.bind(this.approvalController),sendMetrics:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getAccounts:this.getPermittedAccounts.bind(this,e),getPermissionsForOrigin:this.permissionController.getPermissions.bind(this.permissionController,e),hasPermission:this.permissionController.hasPermission.bind(this.permissionController,e),requestAccountsPermission:this.permissionController.requestPermissions.bind(this.permissionController,{origin:e},{eth_accounts:{}}),requestPermissionsForOrigin:this.permissionController.requestPermissions.bind(this.permissionController,{origin:e}),addCustomRpc:async({chainId:e,blockExplorerUrl:t,ticker:r,chainName:s,rpcUrl:n}={})=>{await this.preferencesController.addToFrequentRpcList(n,e,r,s,{blockExplorerUrl:t})},findCustomRpcBy:this.findCustomRpcBy.bind(this),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),setProviderType:this.networkController.setProviderType.bind(this.networkController),updateRpcTarget:({rpcUrl:e,chainId:t,ticker:r,nickname:s})=>{this.networkController.setRpcTarget(e,t,r,s)},getWeb3ShimUsageState:this.alertController.getWeb3ShimUsageState.bind(this.alertController),setWeb3ShimUsageRecorded:this.alertController.setWeb3ShimUsageRecorded.bind(this.alertController),setInfo:this.misesController.setUserInfo.bind(this.misesController),setUnFollow:this.misesController.setUnFollow.bind(this.misesController),setFollow:this.misesController.setFollow.bind(this.misesController),getActive:this.misesController.getActive.bind(this.misesController),generateAuth:this.misesController.generateAuth.bind(this.misesController),exportAccount:this.keyringController.exportAccount.bind(this.keyringController),restorePage:this.restorePage.bind(this),NFTPage:this.NFTPage.bind(this),connect:this.misesController.connect.bind(this.misesController),disconnect:this.misesController.disconnect.bind(this.misesController),addressToMisesId:this.misesController.addressToMisesId.bind(this.misesController),getAccountFlag:this.misesController.getAccountFlag.bind(this.misesController),getCollectibles:this.getCollectibles.bind(this)})),n.push(i),n.push(c.middleware),t!==F.SUBJECT_TYPES.INTERNAL&&n.push(this.permissionController.createPermissionMiddleware({origin:e})),n.push((0,f.providerAsMiddleware)(o)),n}setupPublicConfig(e){const t=(0,l.storeAsStream)(this.publicConfigStore);(0,i.default)(t,e,(e=>{t.destroy(),e&&T.default.error(e)}))}addConnection(e,{engine:t}){if("metamask"===e)return null;this.connections[e]||(this.connections[e]={});const r=(0,E.default)();return this.connections[e][r]={engine:t},r}removeConnection(e,t){const r=this.connections[e];r&&(delete r[t],0===Object.keys(r).length&&delete this.connections[e])}removeAllConnections(e){const t=this.connections[e];t&&Object.keys(t).forEach((t=>{this.removeConnection(e,t)}))}notifyConnections(e,t){const r=this.connections[e];r&&Object.values(r).forEach((e=>{e.engine&&e.engine.emit("notification",t)}))}notifyAllConnections(e){const t="function"==typeof e?t=>e(t):()=>e;Object.keys(this.connections).forEach((e=>{Object.values(this.connections[e]).forEach((async r=>{r.engine&&r.engine.emit("notification",await t(e))}))}))}async _onKeyringControllerUpdate(e){const{keyrings:t}=e,r=t.reduce(((e,{accounts:t})=>e.concat(t)),[]);r.length&&(this.preferencesController.syncAddresses(r),this.accountTracker.syncWithAddresses(r))}_onUnlock(){this.notifyAllConnections((async e=>({method:Se.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!0,accounts:await this.getPermittedAccounts(e)}}))),this.emit("unlock")}_onLock(){this.notifyAllConnections({method:Se.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!1}}),this.emit("lock")}_onStateUpdate(e){this.isClientOpenAndUnlocked=e.isUnlocked&&this._isClientOpen,this.notifyAllConnections({method:Se.NOTIFICATION_NAMES.chainChanged,params:this.getProviderNetworkState(e)})}privateSendUpdate(){this.emit("update",this.getState())}isUnlocked(){return this.keyringController.memStore.getState().isUnlocked}getExternalPendingTransactions(e){return this.smartTransactionsController.getTransactions({addressFrom:e,status:"pending"})}async getPendingNonce(e){const{nonceDetails:t,releaseLock:r}=await this.txController.nonceTracker.getNonceLock(e),s=t.params.highestSuggested;return r(),s}async getNextNonce(e){const t=await this.txController.nonceTracker.getNonceLock(e);return t.releaseLock(),t.nextNonce}async migrateAddressBookState(e,t,r=!1){const{addressBook:s}=this.addressBookController.state;if(s[e])for(const n of Object.keys(s[e])){const a=s[e][n];this.addressBookController.set(n,a.name,t,a.memo),r||this.addressBookController.delete(e,n)}}async updateAndSetCustomRpc(e,t,r="ETH",s,n){return this.networkController.setRpcTarget(e,t,r,s,n),await this.preferencesController.updateRpc({rpcUrl:e,chainId:t,ticker:r,nickname:s,rpcPrefs:n}),e}async setCustomRpc(e,t,r="ETH",s="",n={}){const a=this.preferencesController.getFrequentRpcListDetail().find((t=>e===t.rpcUrl));return a?this.networkController.setRpcTarget(a.rpcUrl,a.chainId,a.ticker,a.nickname,n):(this.networkController.setRpcTarget(e,t,r,s,n),await this.preferencesController.addToFrequentRpcList(e,t,r,s,n)),e}async delCustomRpc(e){await this.preferencesController.removeFromFrequentRpcList(e)}findCustomRpcBy(e){const t=this.preferencesController.getFrequentRpcListDetail();for(const r of t)for(const t of Object.keys(e))if(r[t]===e[t])return r;return null}async initializeThreeBox(){await this.threeBoxController.init()}async setLedgerTransportPreference(e){const t=this.preferencesController.getLedgerTransportPreference(),r=this.preferencesController.setLedgerTransportPreference(e),s=await this.getKeyringForDevice(N.DEVICE_NAMES.LEDGER);return null!=s&&s.updateTransportMethod?s.updateTransportMethod(r).catch((e=>{throw this.preferencesController.setLedgerTransportPreference(t),e})):undefined}recordFirstTimeInfo(e){if(!("firstTimeInfo"in e)){const t=this.platform.getVersion();e.firstTimeInfo={version:t,date:Date.now()}}}set isClientOpen(e){this._isClientOpen=e,this.detectTokensController.isOpen=e}onClientClosed(){try{this.gasFeeController.stopPolling(),this.appStateController.clearPollingTokens()}catch(e){console.error(e)}}onEnvironmentTypeClosed(e){const t=F.POLLING_TOKEN_ENVIRONMENT_TYPES[e];this.appStateController.store.getState()[t].forEach((e=>{this.gasFeeController.disconnectPoller(e),this.appStateController.removePollingToken(e,t)}))}safelistPhishingDomain(e){return this.phishingController.bypass(e)}setLocked(){const[e]=this.keyringController.getKeyringsByType(N.KEYRING_TYPES.TREZOR);return e&&e.dispose(),this.keyringController.setLocked()}async importAccount(e){return this.misesController.importAccount(e)}async setSelectedAddress(e,t){await this.preferencesController.setSelectedAddress(e),"first"!==t&&(console.log("Switching users"),this.setMisesUser(e))}async setMisesUser(e){console.log("Set user");try{const t=await this.keyringController.exportAccount(e);await this.misesController.activate(t);const r=await this.misesController.getMisesUserInfo(e);return await this.misesController.setToMisesPrivate(r),Promise.resolve()}catch(e){return console.log(e,"Failed to set user information"),Promise.reject(e)}}lockAll(){this.misesController.lockAll()}restorePage(){this.opts.restoreAccount()}NFTPage(){this.opts.openNFTPage(),this.appStateController.setDefaultHomeActiveTabName("NFTs")}initMisesBalance(){return this.misesController.initMisesBalance()}setMisesBook(e,t,r,s){return this.misesController.setMisesBook(e,t,r,s)}getMisesUser(e){return this.misesController.getMisesUser(e)}addressToMisesId(e){return this.misesController.addressToMisesId(e)}resetTranstionFlag(){return this.misesController.resetTranstionFlag()}async recentTransactions(e){const t=await this.preferencesController.getSelectedAddress();return this.misesController.recentTransactions(e,t)}updataBalance(e){return this.misesController.updataBalance(e)}clearKeyrings(){return console.log("clearKeyrings"),this.keyringController.clearKeyrings()}async resetMisesAccount(){const e=await this.preferencesController.getSelectedAddress();return this.misesController.setAccountTransactionsHeight(e)}closePopUp(e){console.log("this.opts.notificationManager",e),this.opts.notificationManager.closePopup()}getPopupId(){return this.opts.notificationManager.setExtensionTab}async getCollectibles(){const e=this.preferencesController.getSelectedAddress(),{allCollectibles:t}=this.collectiblesController.state;if(e&&t[e]){const r=this.preferencesController.getFrequentRpcListDetail().filter((e=>e.rpcUrl!==x.LOCALHOST_RPC_URL));return Object.keys(t[e]).map((s=>{const n=r.find((e=>e.chainId===s));return{chainId:s,chainName:x.NETWORK_TO_NAME_MAP[s]||n.nickname||"",list:t[e][s]||[]}})).filter((e=>e.list.length>0))}return[]}postTx(e){return this.misesController.postTx(e)}getReader(e){return this.misesController.getReader(e)}}r.default=Me}).call(this)}).call(this,e("_process"),e("buffer").Buffer)}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/metamask-controller.js"}],[2925,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var s,n,a,o,i;function c(){var l=Date.now()-o;l<t&&l>=0?s=setTimeout(c,t-l):(s=null,r||(i=e.apply(a,n),a=n=null))}null==t&&(t=100);var l=function(){a=this,n=arguments,o=Date.now();var l=r&&!s;return s||(s=setTimeout(c,t)),l&&(i=e.apply(a,n),a=n=null),i};return l.clear=function(){s&&(clearTimeout(s),s=null)},l.flush=function(){s&&(i=e.apply(a,n),a=n=null,clearTimeout(s),s=null)},l}}}},{package:"debounce",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/debounce/index.js"}],[6645,{_process:6127,stream:2481},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var s=e("stream");function n(e,t,n){e=e||function(e){this.queue(e)},t=t||function(){this.queue(null)};var a=!1,o=!1,i=[],c=!1,l=new s;function d(){for(;i.length&&!l.paused;){var e=i.shift();if(null===e)return l.emit("end");l.emit("data",e)}}function u(){l.writable=!1,t.call(l),!l.readable&&l.autoDestroy&&l.destroy()}return l.readable=l.writable=!0,l.paused=!1,l.autoDestroy=!(n&&!1===n.autoDestroy),l.write=function(t){return e.call(this,t),!l.paused},l.queue=l.push=function(e){return c||(null===e&&(c=!0),i.push(e),d()),l},l.on("end",(function(){l.readable=!1,!l.writable&&l.autoDestroy&&r.nextTick((function(){l.destroy()}))})),l.end=function(e){if(!a)return a=!0,arguments.length&&l.write(e),u(),l},l.destroy=function(){if(!o)return o=!0,a=!0,i.length=0,l.writable=l.readable=!1,l.emit("close"),l},l.pause=function(){if(!l.paused)return l.paused=!0,l},l.resume=function(){return l.paused&&(l.paused=!1,l.emit("resume")),d(),l.paused||l.emit("drain"),l},l}t.exports=n,n.through=n}).call(this)}).call(this,e("_process"))}}},{package:"through",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/through/index.js"}],[2988,{stream:2481},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("stream"),n=["write","end","destroy"],a=["resume","pause"],o=["data","close"],i=Array.prototype.slice;function c(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r)}t.exports=function(e,t){var r=new s,l=!1;return c(n,(function(t){function s(){return e[t].apply(e,arguments)}r[t]=s})),c(a,(function(e){function s(){r.emit(e);var s=t[e];if(s)return s.apply(t,arguments);t.emit(e)}r[e]=s})),c(o,(function(e){function s(){var t=i.call(arguments);t.unshift(e),r.emit.apply(r,t)}t.on(e,s)})),t.on("end",(function(){if(l)return;l=!0;var e=i.call(arguments);e.unshift("end"),r.emit.apply(r,e)})),e.on("drain",(function(){r.emit("drain")})),e.on("error",d),t.on("error",d),r.writable=e.writable,r.readable=t.readable,r;function d(e){r.emit("error",e)}}}}},{package:"duplexer",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/duplexer/index.js"}],[1236,{stream:2481},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeAsStream=void 0;const s=e("stream");class n extends s.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const r=super.pipe(e,t);return e.write(this.obsStore.getState()),r}_write(e,t,r){this.obsStore.putState(e),r()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}r.storeAsStream=function(e){return new n(e)}}}},{package:"@metamask/obs-store",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/@metamask/obs-store/dist/asStream.js"}],[1232,{"./ObservableStore":1235},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ComposedStore=void 0;const s=e("./ObservableStore");class n extends s.ObservableStore{constructor(e){super();this.getState()||this.putState({}),this._children=e||{},Object.keys(this._children).forEach((e=>{const t=this._children[e];this._addChild(e,t)}))}_addChild(e,t){const r=t=>{const r=this.getState();r[e]=t,this.putState(r)};t.subscribe(r),r(t.getState())}}r.ComposedStore=n}}},{package:"@metamask/obs-store",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/@metamask/obs-store/dist/ComposedStore.js"}],[1233,{"./ObservableStore":1235},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LocalStorageStore=void 0;const s=e("./ObservableStore");class n extends s.ObservableStore{constructor(e={}){if(!global.localStorage)throw new Error("LocalStorageStore - can't find localStorage.");if(super(),!e.storageKey)throw new Error("LocalStorageStore - no storageKey specified.");this._storageKey=e.storageKey}_getState(){const e=global.localStorage.getItem(this._storageKey);return e?JSON.parse(e):undefined}_putState(e){const t=JSON.stringify(e);return global.localStorage.setItem(this._storageKey,t)}}r.LocalStorageStore=n}}},{package:"@metamask/obs-store",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/@metamask/obs-store/dist/LocalStorageStore.js"}],[1234,{"./ObservableStore":1235},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MergedStore=void 0;const s=e("./ObservableStore");class n extends s.ObservableStore{constructor(e=[]){super();this.getState()||this.putState({}),this._children=e,e.forEach((e=>this._addChild(e))),this._updateWholeState()}_addChild(e){e.subscribe((()=>this._updateWholeState()))}_updateWholeState(){const e=this._children.map((e=>e.getState())),t=Object.assign({},...e);this.putState(t)}}r.MergedStore=n}}},{package:"@metamask/obs-store",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/@metamask/obs-store/dist/MergedStore.js"}],[1235,{"@metamask/safe-event-emitter":1359},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ObservableStore=void 0;const n=s(e("@metamask/safe-event-emitter"));class a extends n.default{constructor(e={}){super(),this._state=e}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState(),r=Object.assign({},t,e);this.putState(r)}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}r.ObservableStore=a}}},{package:"@metamask/obs-store",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/@metamask/obs-store/dist/ObservableStore.js"}],[1238,{through2:1239},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeTransformStream=void 0;const s=e("through2");r.storeTransformStream=function(e){return s.obj(((t,r,s)=>{try{return s(null,e(t)),undefined}catch(e){return s(e),undefined}}))}}}},{package:"@metamask/obs-store",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/@metamask/obs-store/dist/transform.js"}],[112,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:13,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=13;try{const e=function(e){const t=e,{config:r}=t;r&&r.provider&&"testnet"===r.provider.type&&(t.config.provider.type="ropsten");return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #13${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/013.js"}],[103,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:4,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=4;try{if("rpc"!==t.data.config.provider.type)return Promise.resolve(t);switch(t.data.config.provider.rpcTarget){case"https://testrpc.metamask.io/":t.data.config.provider={type:"testnet"};break;case"https://rpc.metamask.io/":t.data.config.provider={type:"mainnet"}}}catch(e){}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/004.js"}],[101,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:2,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=2;try{"etherscan"===t.data.config.provider.type&&(t.data.config.provider.type="rpc",t.data.config.provider.rpcTarget="https://rpc.metamask.io/")}catch(e){}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/002.js"}],[109,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:10,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=10;try{const e=function(e){const t=(0,s.merge)({},e,{ShapeShiftController:{shapeShiftTxList:e.shapeShiftTxList||[]}});return delete t.shapeShiftTxList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #10${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/010.js"}],[116,{"../../../shared/constants/transaction":6908,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:17,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=17;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(!e.status===n.TRANSACTION_STATUSES.FAILED||e.retryCount>0&&e.retryCount<2&&(e.status=n.TRANSACTION_STATUSES.SUBMITTED,delete e.err),e)))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #17${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/017.js"}],[118,{"../../../shared/constants/transaction":6908,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:19,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=19;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map(((e,t,r)=>{if(e.status!==n.TRANSACTION_STATUSES.SUBMITTED)return e;const s=function(e){const t=e.map((e=>{const{nonce:t}=e.txParams;return parseInt(t||"0x0",16)}));return Math.max.apply(null,t)}(r.filter((e=>e.status===n.TRANSACTION_STATUSES.CONFIRMED)).filter((t=>t.txParams.from===e.txParams.from)).filter((t=>t.metamaskNetworkId.from===e.metamaskNetworkId.from))),a=function(e,t){const r=e.map((e=>{const{nonce:t}=e.txParams;return parseInt(t,16)}));let s=t;for(;r.includes(s);)s+=1;return s}(r.filter((e=>e.status===n.TRANSACTION_STATUSES.SUBMITTED)).filter((t=>t.txParams.from===e.txParams.from)).filter((t=>t.metamaskNetworkId.from===e.metamaskNetworkId.from)),s),o=Math.max(a,s);return parseInt(e.txParams.nonce,16)>o+1&&(e.status=n.TRANSACTION_STATUSES.FAILED,e.err={message:"nonce too high",note:"migration 019 custom error"}),e}))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #19${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/019.js"}],[114,{"../../../shared/constants/transaction":6908,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:15,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=15;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=r;t.TransactionController.transactions=e.map((e=>e.err?("Gave up submitting tx."===e.err.message&&(e.status=n.TRANSACTION_STATUSES.FAILED),e):e))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #15${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/015.js"}],[120,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:21,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=21;try{const e=function(e){const t=e;return delete t.BlacklistController,delete t.RecentBlocks,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #21${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/021.js"}],[111,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:12,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=12;try{const e=function(e){const t=e;return t.NoticeController.noticesList.forEach((e=>{e.read&&(e.body="")})),t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #12${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/012.js"}],[119,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:20,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=20;try{const e=function(e){const t=e;"metamask"in t&&!("firstTimeInfo"in t.metamask)&&(t.metamask.firstTimeInfo={version:"3.12.0",date:Date.now()});return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #20${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/020.js"}],[110,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:11,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=11;try{const e=function(e){const t=e;return delete t.TOSHash,delete t.isDisclaimerConfirmed,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #11${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/011.js"}],[125,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:26,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=26;try{const e=t.data;t.data=function(e){if(!e.KeyringController||!e.PreferencesController)return e;if(!e.KeyringController.walletNicknames)return e;return e.PreferencesController.identities=Object.keys(e.KeyringController.walletNicknames).reduce(((t,r)=>(t[r]={name:e.KeyringController.walletNicknames[r],address:r},t)),{}),delete e.KeyringController.walletNicknames,e}(e)}catch(e){return console.warn(`MetaMask Migration #26${e.stack}`),Promise.reject(e)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/026.js"}],[129,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:30,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=30;const r=function(e){const t=e;if(e.PreferencesController){const{frequentRpcListDetail:e}=t.PreferencesController;e&&(e.forEach(((t,r)=>{Boolean(t.chainId)&&Number.isNaN(parseInt(t.chainId))&&delete e[r].chainId})),t.PreferencesController.frequentRpcListDetail=e)}e.NetworkController&&(t.NetworkController.network&&Number.isNaN(parseInt(t.NetworkController.network))&&delete t.NetworkController.network,t.NetworkController.provider&&t.NetworkController.provider.chainId&&Number.isNaN(parseInt(t.NetworkController.provider.chainId))&&delete t.NetworkController.provider.chainId);return t}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/030.js"}],[126,{"../../../shared/constants/transaction":6908,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:27,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=27;const r=function(e){const t=e;if(t.TransactionController&&t.TransactionController.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.filter((e=>e.status!==n.TRANSACTION_STATUSES.REJECTED))}return t}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/027.js"}],[130,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:31,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=31;const r=function(e){const{KeyringController:t,PreferencesController:r}=e;if(t&&r){const{vault:e}=t;r.completedOnboarding=Boolean(e)}return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/031.js"}],[124,{"../../../shared/constants/transaction":6908,"../lib/util":99,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../lib/util"),a=e("../../../shared/constants/transaction");var o={version:25,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=25;const r=function(e){const t=e;if(t.TransactionController&&t.TransactionController.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(e.status!==a.TRANSACTION_STATUSES.UNAPPROVED||(e.txParams=function(e){const t={from:e=>(0,n.addHexPrefix)(e).toLowerCase(),to:()=>(0,n.addHexPrefix)(e.to).toLowerCase(),nonce:e=>(0,n.addHexPrefix)(e),value:e=>(0,n.addHexPrefix)(e),data:e=>(0,n.addHexPrefix)(e),gas:e=>(0,n.addHexPrefix)(e),gasPrice:e=>(0,n.addHexPrefix)(e)},r={};return Object.keys(t).forEach((s=>{e[s]&&(r[s]=t[s](e[s]))})),r}(e.txParams)),e)))}return t}(t.data);return t.data=r,t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/025.js"}],[122,{"../../../shared/constants/transaction":6908,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:23,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=23;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;if(e.length<=40)return t;const r=e.reverse();let s=!0;for(;r.length>40&&s;){const e=r.findIndex((e=>e.status===n.TRANSACTION_STATUSES.FAILED||e.status===n.TRANSACTION_STATUSES.REJECTED||e.status===n.TRANSACTION_STATUSES.CONFIRMED||e.status===n.TRANSACTION_STATUSES.DROPPED));e<0?s=!1:r.splice(e,1)}t.TransactionController.transactions=r.reverse()}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #23${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/023.js"}],[131,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:32,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=32;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const{betaUI:e}=t.featureFlags||{};t.completedUiMigration=e}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/032.js"}],[138,{"../../../shared/modules/hexstring-utils":6914,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/modules/hexstring-utils");const a="SAI";function o(e={}){return e&&"object"==typeof e&&"DAI"===e.symbol&&"0x89d24A6b4CcB1B6fAA2625fE562bDD9a23260359"===(0,n.toChecksumHexAddress)(e.address)}var i={version:39,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=39;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.tokens||[];if(Array.isArray(e))for(const t of e)o(t)&&(t.symbol=a);const r=t.accountTokens||{};if(r&&"object"==typeof r)for(const e of Object.keys(r)){const t=r[e];if(t&&"object"==typeof t)for(const e of Object.keys(t)){const r=t[e];if(Array.isArray(r))for(const e of r)o(e)&&(e.symbol=a)}}}return e}(r),t}};r.default=i}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/039.js"}],[133,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:34,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=34;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.featureFlags||{};e.privacyMode||void 0!==t.migratedPrivacyMode||(t.migratedPrivacyMode=!0,e.privacyMode=!0)}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/034.js"}],[144,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:45,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=45;const r=t.data;return t.data=function(e){var t;a.includes(null==e||null===(t=e.PreferencesController)||void 0===t?void 0:t.ipfsGateway)&&(e.PreferencesController.ipfsGateway="dweb.link");return e}(r),t}};r.default=n;const a=["ipfs.io","ipfs.dweb.link"]}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/045.js"}],[146,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:47,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=47;const r=t.data;return t.data=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;Array.isArray(r)&&r.forEach((e=>{"number"==typeof e.metamaskNetworkId&&(e.metamaskNetworkId=e.metamaskNetworkId.toString())}));return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/047.js"}],[134,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:35,async migrate(e){const t=(0,s.cloneDeep)(e);return t.meta.version=35,t.data=function(e){e.PreferencesController&&e.PreferencesController.seedWords!==undefined&&delete e.PreferencesController.seedWords;return e}(t.data),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/035.js"}],[108,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:9,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=9;try{const e=function(e){const t=(0,s.merge)({},e,{CurrencyController:{currentCurrency:e.currentFiat||e.fiatCurrency||"USD",conversionRate:e.conversionRate,conversionDate:e.conversionDate}});return delete t.currentFiat,delete t.fiatCurrency,delete t.conversionRate,delete t.conversionDate,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #9${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/009.js"}],[132,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:33,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=33;const r=function(e){const t=e;e.NoticeController&&delete t.NoticeController;return t}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/033.js"}],[142,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:43,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=43;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.PreferencesController)&&void 0!==t&&t.currentAccountTab&&delete e.PreferencesController.currentAccountTab;return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/043.js"}],[148,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:49,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=49;const r=t.data;return t.data=function(e={}){if(e.PreferencesController){var t;const{metaMetricsId:r,participateInMetaMetrics:s,metaMetricsSendCount:n}=e.PreferencesController;e.MetaMetricsController=null!==(t=e.MetaMetricsController)&&void 0!==t?t:{},r!==undefined&&(e.MetaMetricsController.metaMetricsId=r,delete e.PreferencesController.metaMetricsId),s!==undefined&&(e.MetaMetricsController.participateInMetaMetrics=s,delete e.PreferencesController.participateInMetaMetrics),n!==undefined&&(e.MetaMetricsController.metaMetricsSendCount=n,delete e.PreferencesController.metaMetricsSendCount)}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/049.js"}],[127,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:28,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=28;const r=function(e){const t=e;if(t.PreferencesController&&t.PreferencesController.tokens&&t.PreferencesController.identities){const{identities:e,tokens:r}=t.PreferencesController;t.PreferencesController.accountTokens={},Object.keys(e).forEach((e=>{t.PreferencesController.accountTokens[e]={mainnet:r}})),t.PreferencesController.tokens=[]}return t}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/028.js"}],[135,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:36,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=36;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.featureFlags||{};void 0!==e.privacyMode&&delete e.privacyMode}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/036.js"}],[149,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");const n=["METASWAP_GAS_PRICE_ESTIMATES_LAST_RETRIEVED","METASWAP_GAS_PRICE_ESTIMATES","cachedFetch","BASIC_PRICE_ESTIMATES_LAST_RETRIEVED","BASIC_PRICE_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES"];var a={version:50,async migrate(e){const t=(0,s.cloneDeep)(e);return t.meta.version=50,n.forEach((e=>{var t;return null===(t=window.localStorage)||void 0===t?void 0:t.removeItem(e)})),t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/050.js"}],[151,{"../../../shared/constants/network":6904,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/network");var a={version:52,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=52;const r=t.data;return t.data=function(e={}){if(e.PreferencesController){const{accountTokens:t,accountHiddenTokens:r,frequentRpcListDetail:s}=e.PreferencesController,a={},o={};if(t&&Object.keys(t).length>0){for(const e of Object.keys(t)){a[e]={},t[e][n.NETWORK_TYPE_RPC]&&s.forEach((r=>{a[e][r.chainId]=t[e][n.NETWORK_TYPE_RPC]}));for(const r of Object.keys(t[e]))switch(r){case n.MAINNET:a[e][n.MAINNET_CHAIN_ID]=t[e][n.MAINNET];break;case n.ROPSTEN:a[e][n.ROPSTEN_CHAIN_ID]=t[e][n.ROPSTEN];break;case n.RINKEBY:a[e][n.RINKEBY_CHAIN_ID]=t[e][n.RINKEBY];break;case n.GOERLI:a[e][n.GOERLI_CHAIN_ID]=t[e][n.GOERLI];break;case n.KOVAN:a[e][n.KOVAN_CHAIN_ID]=t[e][n.KOVAN]}}e.PreferencesController.accountTokens=a}if(r&&Object.keys(r).length>0){for(const e of Object.keys(r)){o[e]={},r[e][n.NETWORK_TYPE_RPC]&&s.forEach((t=>{o[e][t.chainId]=r[e][n.NETWORK_TYPE_RPC]}));for(const t of Object.keys(r[e]))switch(t){case n.MAINNET:o[e][n.MAINNET_CHAIN_ID]=r[e][n.MAINNET];break;case n.ROPSTEN:o[e][n.ROPSTEN_CHAIN_ID]=r[e][n.ROPSTEN];break;case n.RINKEBY:o[e][n.RINKEBY_CHAIN_ID]=r[e][n.RINKEBY];break;case n.GOERLI:o[e][n.GOERLI_CHAIN_ID]=r[e][n.GOERLI];break;case n.KOVAN:o[e][n.KOVAN_CHAIN_ID]=r[e][n.KOVAN]}}e.PreferencesController.accountHiddenTokens=o}}return e}(r),t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/052.js"}],[140,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:41,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=41;const r=t.data;return t.data=function(e){e.PreferencesController&&e.PreferencesController.preferences&&(e.PreferencesController.preferences.autoLockTimeLimit=e.PreferencesController.preferences.autoLogoutTimeLimit,delete e.PreferencesController.preferences.autoLogoutTimeLimit);return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/041.js"}],[141,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:42,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=42;const r=t.data;return t.data=function(e){e.AppStateController?e.AppStateController.connectedStatusPopoverHasBeenShown=!1:e.AppStateController={connectedStatusPopoverHasBeenShown:!1};return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/042.js"}],[154,{"../../../shared/constants/network":6904,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/network");var a={version:55,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=55;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.IncomingTransactionsController)&&void 0!==t&&t.incomingTxLastFetchedBlocksByNetwork&&(e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId=(0,s.mapKeys)(e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork,((e,t)=>{var r,s;return null!==(r=null===(s=n.NETWORK_TYPE_TO_ID_MAP[t])||void 0===s?void 0:s.chainId)&&void 0!==r?r:o})),delete e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId.UNKNOWN,delete e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork);return e}(r),t}};r.default=a;const o="UNKNOWN"}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/055.js"}],[139,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:40,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=40;const r=t.data;return t.data=function(e){return delete e.ProviderApprovalController,e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/040.js"}],[161,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:62,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=62;const r=function(e){if(e.MetaMetricsController){const{metaMetricsSendCount:t}=e.MetaMetricsController;t!==undefined&&delete e.MetaMetricsController.metaMetricsSendCount}return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/062.js"}],[145,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:46,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=46;const r=t.data;return t.data=function(e){void 0!==(null==e?void 0:e.ABTestController)&&delete e.ABTestController;return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/046.js"}],[153,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");function n(e){return"number"==typeof e||"string"==typeof e&&e.match(/^(0x)?\d+$/u)}var a={version:54,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=54;const r=function(e){const t=e;if(!t.PreferencesController)return t;const r=(t.PreferencesController.tokens||[]).filter((({decimals:e})=>n(e)));for(const e of r)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t.PreferencesController.tokens=r;const{accountTokens:s}=t.PreferencesController;if(s&&"object"==typeof s)for(const e of Object.keys(s)){const t=s[e];if(t&&"object"==typeof t)for(const e of Object.keys(t)){const r=(t[e]||[]).filter((({decimals:e})=>n(e)));for(const e of r)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t[e]=r}}return t.PreferencesController.accountTokens=s,t}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/054.js"}],[163,{"../../../shared/constants/transaction":6908,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");const a="sentEther";var o={version:64,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=64;const r=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,s.isPlainObject)(r))for(const e of Object.values(r))e.type===a&&(e.type=n.TRANSACTION_TYPES.SIMPLE_SEND),e.history&&e.history.map((e=>(e.type&&e.type===a&&(e.type=n.TRANSACTION_TYPES.SIMPLE_SEND),e)));return e}(t.data);return t.data=r,t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/064.js"}],[168,{"../../../shared/constants/app":6899,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/app");var a={version:69,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=69;const r=function(e){var t;if("object"==typeof(null==e||null===(t=e.SubjectMetadataController)||void 0===t?void 0:t.subjectMetadata)){const{SubjectMetadataController:{subjectMetadata:t}}=e;Object.values(t).forEach((e=>{e&&"object"==typeof e&&!Array.isArray(e)&&(e.subjectType=e.extensionId?n.SUBJECT_TYPES.EXTENSION:n.SUBJECT_TYPES.WEBSITE)}))}return e}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/069.js"}],[121,{"../../../shared/constants/transaction":6908,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:22,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=22;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(e.status!==n.TRANSACTION_STATUSES.SUBMITTED||e.submittedTime||(e.submittedTime=(new Date).getTime()),e)))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #22${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/022.js"}],[143,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:44,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=44;const r=t.data;return t.data=function(e){var t;void 0!==(null==e||null===(t=e.AppStateController)||void 0===t?void 0:t.mkrMigrationReminderTimestamp)&&delete e.AppStateController.mkrMigrationReminderTimestamp;return e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/044.js"}],[155,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:56,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=56;const{PreferencesController:r}=t.data;return Array.isArray(null==r?void 0:r.tokens)&&(r.tokens=r.tokens.filter((({address:e})=>e))),null!=r&&r.accountTokens&&"object"==typeof r.accountTokens&&Object.keys(r.accountTokens).forEach((e=>{Object.keys(r.accountTokens[e]).forEach((t=>{r.accountTokens[e][t]=r.accountTokens[e][t].filter((({address:e})=>e))}))})),null!=r&&r.assetImages&&"undefined"in r.assetImages&&delete r.assetImages.undefined,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/056.js"}],[157,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:58,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=58;const r=t.data;return t.data=function(e){var t;return null===(t=e.AppStateController)||void 0===t||delete t.swapsWelcomeMessageHasBeenShown,e}(r),t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/058.js"}],[123,{"../../../shared/constants/transaction":6908,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:24,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=24;const r=function(e){const t=e;if(!t.TransactionController)return t;const{transactions:r}=t.TransactionController;return t.TransactionController.transactions=r.map(((e,t)=>(e.status===n.TRANSACTION_STATUSES.UNAPPROVED&&e.txParams&&e.txParams.from&&(e.txParams.from=e.txParams.from.toLowerCase()),e))),t}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/024.js"}],[158,{"../../../shared/constants/transaction":6908,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:59,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=59;const r=t.data;return t.data=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,s.isPlainObject)(r)){const t=(0,s.groupBy)(Object.values(r),(e=>{var t,r;return`${null===(t=e.txParams)||void 0===t?void 0:t.nonce}-${null!==(r=e.chainId)&&void 0!==r?r:e.metamaskNetworkId}`})),a=(0,s.pickBy)(t,(e=>e.some((e=>e.type!==n.TRANSACTION_TYPES.CANCEL&&e.type!==n.TRANSACTION_TYPES.RETRY))));e.TransactionController.transactions=(0,s.keyBy)((0,s.concat)(...Object.values(a)),(e=>e.id))}return e}(r),t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/059.js"}],[113,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:14,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=14;try{const e=function(e){const t=e;return t.NetworkController={},t.NetworkController.provider=t.config.provider,delete t.config.provider,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #14${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/014.js"}],[159,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");const n="2020-08-31";var a={version:60,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=60;const r=function(e){var t;const r=null==e||null===(t=e.NotificationController)||void 0===t?void 0:t.notifications;var a;(0,s.isPlainObject)(r)&&(null===(a=r[2])||void 0===a?void 0:a.date)===n&&delete e.NotificationController.notifications[2];return e}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/060.js"}],[150,{"../../../shared/constants/network":6904,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/network");var a={version:51,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=51;const r=t.data;return t.data=function(e){var t,r;const{chainId:s,type:a}=(null==e||null===(t=e.NetworkController)||void 0===t?void 0:t.provider)||{},o=null===(r=n.NETWORK_TYPE_TO_ID_MAP[a])||void 0===r?void 0:r.chainId;o&&s!==o&&(e.NetworkController.provider.chainId=o);return e}(r),t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/051.js"}],[164,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:65,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=65;const r=function(e){if(e.PreferencesController){var t;const{completedOnboarding:r,firstTimeFlowType:s}=e.PreferencesController;e.OnboardingController=null!==(t=e.OnboardingController)&&void 0!==t?t:{},r!==undefined&&(e.OnboardingController.completedOnboarding=r,delete e.PreferencesController.completedOnboarding),s!==undefined&&(e.OnboardingController.firstTimeFlowType=s,delete e.PreferencesController.firstTimeFlowType)}return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/065.js"}],[160,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:61,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=61;const r=function(e){const t=(new Date).getTime();e.AppStateController?(e.AppStateController.recoveryPhraseReminderHasBeenShown=!1,e.AppStateController.recoveryPhraseReminderLastShown=t):e.AppStateController={recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:t};return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/061.js"}],[102,{lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:3,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=3;try{"https://rawtestrpc.metamask.io/"===t.data.config.provider.rpcTarget&&(t.data.config.provider.rpcTarget="https://testrpc.metamask.io/")}catch(e){}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/003.js"}],[115,{"../../../shared/constants/transaction":6908,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:16,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=16;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>e.err?("transaction with the same hash was already imported."===e.err&&(e.status=n.TRANSACTION_STATUSES.SUBMITTED,delete e.err),e):e))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #16${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/016.js"}],[136,{"@metamask/controllers":1080,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("@metamask/controllers");var a={version:37,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=37;const r=t.data;return t.data=function(e){if(e.AddressBookController){const t=e.AddressBookController.addressBook,r=new Set,s={};Object.values(t).forEach((e=>{r.add(e.chainId)}));for(const e of r.values()){s[e]={};for(const r in t)t[r].chainId===e&&(t[r].isEns=!1,n.util.normalizeEnsName(t[r].name)&&(t[r].isEns=!0),s[e][r]=t[r])}e.AddressBookController.addressBook=s}return e}(r),t}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/037.js"}],[105,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:6,migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=6;try{const e=function(e){const t=e.KeyringController,r=i(i({},e),{},{PreferencesController:{selectedAddress:t.selectedAccount}});return delete r.KeyringController.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #6${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/006.js"}],[107,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:8,migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=8;try{const e=function(e){const t=i(i({},e),{},{NoticeController:{noticesList:e.noticesList||[]}});return delete t.noticesList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #8${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/008.js"}],[128,{"../../../shared/constants/transaction":6908,"./fail-tx":169,"@babel/runtime/helpers/interopRequireDefault":213},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("../../../shared/constants/transaction"),a=s(e("./fail-tx"));var o={version:29,migrate:(0,a.default)(29,"Stuck in approved state for too long.",(e=>{const t=e.status===n.TRANSACTION_STATUSES.APPROVED,r=e.submittedTime,s=Date.now();return t&&s-r>432e5}))};r.default=o}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/029.js"}],[152,{"../../../shared/constants/transaction":6908,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),o=e("../../../shared/constants/transaction");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={version:53,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=53;const r=t.data;return t.data=function(e){var t,r;const s=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions,n=null==e||null===(r=e.IncomingTransactionsController)||void 0===r?void 0:r.incomingTransactions;Array.isArray(s)&&s.forEach((e=>{e&&(e.type!==o.TRANSACTION_TYPES.RETRY&&e.type!==o.TRANSACTION_TYPES.CANCEL&&(e.type=e.transactionCategory),delete e.transactionCategory)}));if(n){Object.entries(n).forEach((([t,r])=>{r&&(delete r.transactionCategory,e.IncomingTransactionsController.incomingTransactions[t]=c(c({},r),{},{type:o.TRANSACTION_TYPES.INCOMING}))}))}return e}(r),t}};r.default=l}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/053.js"}],[156,{"../../../shared/modules/random-id":6916,"@babel/runtime/helpers/interopRequireDefault":213,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),a=s(e("../../../shared/modules/random-id"));var o={version:57,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=57;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.TransactionController)&&void 0!==t&&t.transactions&&Array.isArray(e.TransactionController.transactions)&&!e.TransactionController.transactions.some((e=>"object"!=typeof e||void 0===e.txParams))&&(e.TransactionController.transactions=(0,n.keyBy)(e.TransactionController.transactions,(e=>(void 0!==e.id&&null!==e.id||(e.id=(0,a.default)()),e.id))));return e}(r),t}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/057.js"}],[167,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@babel/runtime/helpers/objectWithoutProperties":222,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("@babel/runtime/helpers/objectWithoutProperties")),o=e("lodash");const i=["PermissionsController","PermissionsMetadata"],c=["name","icon","extensionId"];function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={version:68,async migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=68;const r=function(e){const{PermissionsController:t={},PermissionsMetadata:r={}}=e,s=(0,a.default)(e,i),{domainMetadata:n={},permissionsHistory:o={},permissionsLog:c=[]}=r;return d(d({},s),{},{PermissionController:h(t),PermissionLogController:{permissionActivityLog:c,permissionHistory:o},SubjectMetadataController:p(n)})}(t.data);return t.data=r,t}};function h(e){const{domains:t={}}=e;return{subjects:Object.entries(t).reduce(((e,[t,r])=>{const{permissions:[s]}=r,n=s.caveats.find((e=>"exposedAccounts"===e.name)),a=d(d({},s),{},{caveats:[{type:"restrictReturnedAccounts",value:n.value}]});return delete a["@context"],e[t]={origin:t,permissions:{eth_accounts:a}},e}),{})}}function p(e){return{subjectMetadata:Object.entries(e).reduce(((e,[t,r])=>{const{name:s=null,icon:n=null,extensionId:o=null}=r,i=(0,a.default)(r,c);return delete i.lastUpdated,delete i.host,t&&(e[t]=d(d({name:s,iconUrl:n,extensionId:o},i),{},{origin:t})),e}),{})}}r.default=u}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/068.js"}],[165,{"../../../shared/constants/hardware-wallets":6901,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),o=e("../../../shared/constants/hardware-wallets");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={version:66,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=66;const r=function(e){var t;const r=window.navigator.hid?o.LEDGER_TRANSPORT_TYPES.WEBHID:o.LEDGER_TRANSPORT_TYPES.U2F,s=Boolean(null===(t=e.PreferencesController)||void 0===t?void 0:t.useLedgerLive),n=c(c({},e),{},{PreferencesController:c(c({},null==e?void 0:e.PreferencesController),{},{ledgerTransportType:s?o.LEDGER_TRANSPORT_TYPES.LIVE:r})});return delete n.PreferencesController.useLedgerLive,n}(t.data);return t.data=r,t}};r.default=l}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/066.js"}],[147,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:48,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=48;const r=t.data;return t.data=function(e={}){var t,r,s,n,a,o,c,u,h;null===(t=e.NetworkController)||void 0===t||delete t.settings;const p=(null===(r=e.NetworkController)||void 0===r?void 0:r.provider)||{};if(("rpc"!==p.type||"string"==typeof p.chainId&&d.test(p.chainId))&&"localhost"!==p.type){if(null!==(s=e.NetworkController)&&void 0!==s&&s.provider){var m,f;if("rpcTarget"in e.NetworkController.provider){const t=e.NetworkController.provider.rpcTarget;e.NetworkController.provider.rpcUrl=t}null===(m=e.NetworkController)||void 0===m||(null===(f=m.provider)||void 0===f||delete f.rpcTarget)}}else e.NetworkController.provider={type:"rinkeby",rpcUrl:"",chainId:"0x4",nickname:"",rpcPrefs:{},ticker:"ETH"};e.PreferencesController||(e.PreferencesController={});e.PreferencesController.frequentRpcListDetail||(e.PreferencesController.frequentRpcListDetail=[]);e.PreferencesController.frequentRpcListDetail.unshift({rpcUrl:"http://localhost:8545",chainId:"0x539",ticker:"ETH",nickname:"Localhost 8545",rpcPrefs:{}}),null===(n=e.CachedBalancesController)||void 0===n||delete n.cachedBalances;const g=null===(a=e.TransactionController)||void 0===a?void 0:a.transactions;Array.isArray(g)&&g.forEach((e=>{const t=null==e?void 0:e.metamaskNetworkId;"string"==typeof t&&l.test(t)&&(e.metamaskNetworkId=parseInt(t,16).toString(10))}));const b=(null===(o=e.AddressBookController)||void 0===o?void 0:o.addressBook)||{};Object.keys(b).forEach((e=>{if(/^\d+$/iu.test(e)){const t=`0x${parseInt(e,10).toString(16)}`;!function(e,t){Object.values(e).forEach((e=>{e&&"object"==typeof e&&(e.chainId=t)}))}(b[e],t),b[t]?function(e,t,r){const s=e[t]||{},n=i({},e[r]);Object.keys(s).forEach((e=>{if(n[e]&&"object"==typeof n[e]){const t={};new Set([...Object.keys(n[e]),...Object.keys(s[e]||{})]).forEach((r=>{var a;t[r]=n[e][r]||(null===(a=s[e])||void 0===a?void 0:a[r])||""})),n[e]=t}else s[e]&&"object"==typeof s[e]&&(n[e]=s[e])})),e[r]=n}(b,e,t):b[t]=b[e],delete b[e]}})),null===(c=e.IncomingTransactionsController)||void 0===c||null===(u=c.incomingTxLastFetchedBlocksByNetwork)||void 0===u||delete u.localhost;const v=null===(h=e.PreferencesController)||void 0===h?void 0:h.accountTokens;v&&Object.keys(v).forEach((e=>{var t,r;const s=(null===(t=v[e])||void 0===t?void 0:t.localhost)||[];if(s.length>0){const t=v[e].rpc||[];t.length>0?v[e].rpc=function(e,t){const r=a(e),s=a(t),n=[];return new Set([...Object.keys(r),...Object.keys(s)]).forEach((e=>{n.push(i(i({},r[e]),s[e]))})),n;function a(e){return e.reduce(((e,t)=>(null!=t&&t.address&&"string"==typeof(null==t?void 0:t.address)&&(e[t.address]=t),e)),{})}}(s,t):v[e].rpc=s}null===(r=v[e])||void 0===r||delete r.localhost}));return e}(r),t}};r.default=c;const l=/^0x[0-9a-f]+$/iu,d=/^0x[1-9a-f]+[0-9a-f]*$/iu}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/048.js"}],[104,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:5,migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=5;try{const e=function(e){const{config:t}=e,r=i(i({},e),{},{KeyringController:{vault:e.vault,selectedAccount:t.selectedAccount,walletNicknames:e.walletNicknames}});return delete r.vault,delete r.walletNicknames,delete r.config.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #5${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/005.js"}],[166,{"../../../shared/constants/network":6904,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"bignumber.js":2348,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),o=s(e("bignumber.js")),i=e("../../../shared/constants/network");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const d=e=>new o.default(e||"0x0",16).gt(0);var u={version:67,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=67;const r=function(e){var t,r,s;const n=(null==e?void 0:e.PreferencesController)||{},a=n.preferences||{};if(a.showTestNetworks)return e;const o=(null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions)||{},c=(null===(r=e.NetworkController)||void 0===r?void 0:r.provider)||{},u=(null===(s=e.CachedBalancesController)||void 0===s?void 0:s.cachedBalances)||{},h=i.TEST_CHAINS.includes(null==c?void 0:c.chainId),p=Object.values(o).some((({chainId:e})=>i.TEST_CHAINS.includes(e))),m=i.TEST_CHAINS.some((e=>Object.values(u[e]||{}).some(d))),f=h||p||m;return l(l({},e),{},{PreferencesController:l(l({},n),{},{preferences:l(l({},a),{},{showTestNetworks:f})})})}(t.data);return t.data=r,t}};r.default=u}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/067.js"}],[106,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:7,migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=7;try{const e=function(e){const t=i(i({},e),{},{TransactionManager:{transactions:e.transactions||[],gasMultiplier:e.gasMultiplier||1}});return delete t.transactions,delete t.gasMultiplier,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #7${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/007.js"}],[137,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:38,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=38;const r=t.data;return t.data=function(e){const{ABTestController:t={}}=e,{abTests:r={}}=t;if(r.fullScreenVsPopup)return e;return i(i({},e),{},{ABTestController:i(i({},t),{},{abTests:i(i({},r),{},{fullScreenVsPopup:"control"})})})}(r),t}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/038.js"}],[162,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:63,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=63;const r=function(e){var t,r,s,n,a,o,c,l;const d=null==e||null===(t=e.PreferencesController)||void 0===t?void 0:t.accountTokens,u=null==e||null===(r=e.PreferencesController)||void 0===r?void 0:r.accountHiddenTokens,h={};d&&Object.keys(d).forEach((e=>{Object.keys(d[e]).forEach((t=>{const r=d[e][t];h[t]===undefined?h[t]={[e]:r}:h[t]=i(i({},h[t]),{},{[e]:r})}))}));const p={};u&&Object.keys(u).forEach((e=>{Object.keys(u[e]).forEach((t=>{const r=u[e][t];p[t]===undefined?p[t]={[e]:r}:p[t]=i(i({},p[t]),{},{[e]:r})}))}));e.TokensController?(e.TokensController.allTokens=h,e.TokensController.allIgnoredTokens=p):e.TokensController={allTokens:h,allIgnoredTokens:p};return null==e||(null===(s=e.PreferencesController)||void 0===s||delete s.accountHiddenTokens),null==e||null===(n=e.PreferencesController)||void 0===n||delete n.accountTokens,null==e||null===(a=e.PreferencesController)||void 0===a||delete a.assetImages,null==e||null===(o=e.PreferencesController)||void 0===o||delete o.hiddenTokens,null==e||null===(c=e.PreferencesController)||void 0===c||delete c.tokens,null==e||null===(l=e.PreferencesController)||void 0===l||delete l.suggestedTokens,e}(t.data);return t.data=r,t}};r.default=c}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/063.js"}],[117,{"../controllers/transactions/lib/tx-state-history-helpers":37,lodash:5866},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../controllers/transactions/lib/tx-state-history-helpers");var a={version:18,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=18;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>{if(!e.history||0===e.history.length){const t=(0,n.snapshotFromTxMeta)(e);return e.history=[t],e}const t=(0,n.migrateFromSnapshotsToDiffs)(e.history).filter((e=>!Array.isArray(e)||e.length>0));return e.history=t,e}))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #18${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/migrations/018.js"}],[2339,{"to-data-view":6653},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("to-data-view");t.exports=function(e,t,r){var n,a;switch(r=r||{},t){case"RFC3548":case"RFC4648":n="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",a=!0;break;case"RFC4648-HEX":n="0123456789ABCDEFGHIJKLMNOPQRSTUV",a=!0;break;case"Crockford":n="0123456789ABCDEFGHJKMNPQRSTVWXYZ",a=!1;break;default:throw new Error("Unknown base32 variant: "+t)}for(var o=r.padding!==undefined?r.padding:a,i=s(e),c=0,l=0,d="",u=0;u<i.byteLength;u++)for(l=l<<8|i.getUint8(u),c+=8;c>=5;)d+=n[l>>>c-5&31],c-=5;if(c>0&&(d+=n[l<<5-c&31]),o)for(;d.length%8!=0;)d+="=";return d}}}},{package:"base32-encode",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/base32-encode/index.js"}],[58,{"./contracts/registry":56,"./contracts/resolver":57,"@babel/runtime/helpers/interopRequireDefault":213,"@ensdomains/content-hash":302,"eth-ens-namehash":3042,"ethjs-contract":3227,"ethjs-query":3244},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=async function({provider:e,name:t}){const r=new a.default(e),s=n.default.hash(t),u=new o.default(r),h=Number.parseInt(await r.net_version(),10),p=function(e){switch(e){case 1:case 3:case 4:case 5:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(h);if(!p)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${h}"`);const m=u(c.default).at(p),f=(await m.resolver(s))[0];if(d(f))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const g=u(l.default).at(f),b=await g.supportsInterface("0xbc1c58d1"),v=await g.supportsInterface("0xd8389dc5");if(b[0]){const e=(await g.contenthash(s))[0];let t=i.default.decode(e);const r=i.default.getCodec(e);return"ipfs-ns"!==r&&"ipns-ns"!==r||(t=i.default.helpers.cidV0ToV1Base32(t)),{type:r,hash:t}}if(v[0]){const e=(await g.content(s))[0];if(d(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var n=s(e("eth-ens-namehash")),a=s(e("ethjs-query")),o=s(e("ethjs-contract")),i=s(e("@ensdomains/content-hash")),c=s(e("./contracts/registry")),l=s(e("./contracts/resolver"));function d(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/ens-ipfs/resolver.js"}],[50,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,s){t.origin=e.origin,s()}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/createOriginMiddleware.js"}],[53,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,s){t.tabId=e.tabId,s()}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/createTabIdMiddleware.js"}],[51,{"../../../shared/constants/metametrics":6903,"../../../shared/constants/time":6907},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({trackEvent:e,getMetricsState:t}){return function(r,s,i){const c=Date.now(),{origin:l}=r;i((i=>{const d=Date.now();if(!t().participateInMetaMetrics)return i();if(a[r.method]){var u,h,p;const t=4001===(null===(u=s.error)||void 0===u?void 0:u.code);e({event:a[r.method],category:"inpage_provider",referrer:{url:l},properties:{method:r.method,status:t?"rejected":"approved",error_code:null===(h=s.error)||void 0===h?void 0:h.code,error_message:null===(p=s.error)||void 0===p?void 0:p.message,has_result:void 0!==s.result,duration:d-c}})}else if(void 0===o[r.method]){var m,f;e({event:"Provider Method Called",category:"inpage_provider",referrer:{url:l},properties:{method:r.method,error_code:null===(m=s.error)||void 0===m?void 0:m.code,error_message:null===(f=s.error)||void 0===f?void 0:f.message,has_result:void 0!==s.result,duration:d-c}}),o[r.method]=setTimeout((()=>{delete o[r.method]}),10*n.SECOND)}return i()}))}};var s=e("../../../shared/constants/metametrics"),n=e("../../../shared/constants/time");const a={eth_signTypedData_v4:s.EVENT_NAMES.SIGNATURE_REQUESTED,eth_signTypedData_v3:s.EVENT_NAMES.SIGNATURE_REQUESTED,eth_signTypedData:s.EVENT_NAMES.SIGNATURE_REQUESTED,eth_personal_sign:s.EVENT_NAMES.SIGNATURE_REQUESTED,eth_sign:s.EVENT_NAMES.SIGNATURE_REQUESTED,eth_getEncryptionPublicKey:s.EVENT_NAMES.ENCRYPTION_PUBLIC_KEY_REQUESTED,eth_decrypt:s.EVENT_NAMES.DECRYPTION_REQUESTED,wallet_requestPermissions:s.EVENT_NAMES.PERMISSIONS_REQUESTED,eth_requestAccounts:s.EVENT_NAMES.PERMISSIONS_REQUESTED},o={}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/createRPCMethodTrackingMiddleware.js"}],[5952,{},function(){with(this)return function(){"use strict";return function(e,t,r){for(var s=self.crypto||self.msCrypto,n="-_",a=36;a--;)n+=a.toString(36);for(a=36;a---10;)n+=a.toString(36).toUpperCase();t.exports=function(e){var t="",r=s.getRandomValues(new Uint8Array(e||21));for(a=e||21;a--;)t+=n[63&r[a]];return t}}}},{package:"nanoid",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/nanoid/index.browser.js"}],[48,{"eth-rpc-errors":3129},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("eth-rpc-errors");var n=(e,t)=>async r=>{if(t._writableState.ended)return;if(!e[r.method])return void t.write({jsonrpc:"2.0",error:s.ethErrors.rpc.methodNotFound({message:`${r.method} not found`}),id:r.id});let n,a;try{n=await e[r.method](...r.params)}catch(e){a=e}t._writableState.ended?a&&console.error(a):a?t.write({jsonrpc:"2.0",error:(0,s.serializeError)(a,{shouldIncludeStack:!0}),id:r.id}):t.write({jsonrpc:"2.0",result:n,id:r.id})};r.default=n}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/createMetaRPCHandler.js"}],[5421,{"readable-stream":6410},function(){with(this)return function(){"use strict";return function(e,t,r){const s=e("readable-stream").Duplex;t.exports=function({engine:e}){if(!e)throw new Error("Missing engine parameter!");const t=new s({objectMode:!0,read:function(){return!1},write:function(t,r,s){e.handle(t,((e,t)=>{this.push(t)})),s()}});e.on&&e.on("notification",(e=>{t.push(e)}));return t}}}},{package:"json-rpc-middleware-stream",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/json-rpc-middleware-stream/engineStream.js"}],[8,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor(e={}){const{accountTracker:t,getCurrentChainId:r}=e;this.accountTracker=t,this.getCurrentChainId=r;const s=i({cachedBalances:{}},e.initState);this.store=new a.ObservableStore(s),this._registerUpdates()}async updateCachedBalances({accounts:e}){const t=this.getCurrentChainId(),r=await this._generateBalancesToCache(e,t);this.store.updateState({cachedBalances:r})}_generateBalancesToCache(e,t){const{cachedBalances:r}=this.store.getState(),s=i({},r[t]);Object.keys(e).forEach((t=>{const r=e[t];r.balance&&(s[t]=r.balance)}));return i(i({},r),{},{[t]:s})}clearCachedBalances(){this.store.updateState({cachedBalances:{}})}_registerUpdates(){const e=this.updateCachedBalances.bind(this);this.accountTracker.store.subscribe(e)}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/cached-balances.js"}],[54,{"../../../shared/constants/app":6899,"../../../shared/modules/random-id":6916,"../metamask-controller":100,"./util":99,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,buffer:2478,"eth-rpc-errors":3129,"ethereumjs-util":3195,events:2479,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),a=e("@metamask/obs-store"),o=e("ethereumjs-util"),i=e("eth-rpc-errors"),c=s(e("loglevel")),l=e("../../../shared/constants/app"),d=e("../metamask-controller"),u=s(e("../../../shared/modules/random-id")),h=e("./util");const p=/^[0-9A-Fa-f]+$/gu;class m extends n.default{constructor(e){super(),this.memStore=new a.ObservableStore({unapprovedDecryptMsgs:{},unapprovedDecryptMsgCount:0}),this.messages=[],this.metricsEvent=e.metricsEvent}get unapprovedDecryptMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,s)=>{if(!e.from)return void s(new Error("MetaMask Decryption: from field is required."));const n=this.addUnapprovedMessage(e,t);this.once(`${n}:finished`,(t=>{switch(t.status){case"decrypted":return void r(t.rawData);case"rejected":return void s(i.ethErrors.provider.userRejectedRequest("MetaMask Decryption: User denied message decryption."));case"errored":return void s(new Error("This message cannot be decrypted"));default:s(new Error(`MetaMask Decryption: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){c.default.debug(`DecryptMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`),t&&(e.origin=t.origin),e.data=this.normalizeMsgData(e.data);const r=(new Date).getTime(),s=(0,u.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:l.MESSAGE_TYPE.ETH_DECRYPT};return this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForDecryption(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusDecrypted(e,t){const r=this.getMsg(e);r.rawData=t,this._updateMsg(r),this._setMsgStatus(e,"decrypted")}prepMsgForDecryption(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){t&&this.metricsEvent({event:t,category:"Messages",properties:{action:"Decrypt Message Request"}}),this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`DecryptMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"decrypted"!==t&&"errored"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedDecryptMsgs:e,unapprovedDecryptMsgCount:t}),this.emit(d.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}normalizeMsgData(e){try{const t=(0,o.stripHexPrefix)(e);if(t.match(p))return(0,h.addHexPrefix)(t)}catch(e){c.default.debug("Message was not hex encoded, interpreting as utf8.")}return(0,o.bufferToHex)(t.from(e,"utf8"))}}r.default=m}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/decrypt-message-manager.js"}],[7,{"../../../shared/constants/time":6907,"../metamask-controller":100,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,events:2479},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("events")),o=e("@metamask/obs-store"),i=e("../metamask-controller"),c=e("../../../shared/constants/time");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class u extends a.default{constructor(e={}){const{addUnlockListener:t,isUnlocked:r,initState:s,onInactiveTimeout:n,showUnlockRequest:a,preferencesStore:i,qrHardwareStore:c}=e;super(),this.onInactiveTimeout=n||(()=>undefined),this.store=new o.ObservableStore(d(d({timeoutMinutes:0,connectedStatusPopoverHasBeenShown:!0,defaultHomeActiveTabName:null,browserEnvironment:{},popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[],recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:(new Date).getTime(),collectiblesDetectionNoticeDismissed:!1,enableEIP1559V2NoticeDismissed:!1,showTestnetMessageInDropdown:!0,trezorModel:null},s),{},{qrHardware:{},collectiblesDropdownState:{}})),this.timer=null,this.isUnlocked=r,this.waitingForUnlock=[],t(this.handleUnlock.bind(this)),this._showUnlockRequest=a,i.subscribe((({preferences:e})=>{this.store.getState().timeoutMinutes!==e.autoLockTimeLimit&&this._setInactiveTimeout(e.autoLockTimeLimit)})),c.subscribe((e=>{this.store.updateState({qrHardware:e})}));const{preferences:l}=i.getState();this._setInactiveTimeout(l.autoLockTimeLimit)}getUnlockPromise(e){return new Promise(((t,r)=>{this.isUnlocked()?t():this.waitForUnlock(t,r,e)}))}waitForUnlock(e,t,r){this.waitingForUnlock.push({resolve:e,reject:t}),this.emit(i.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE),r&&this._showUnlockRequest()}handleUnlock(){if(this.waitingForUnlock.length>0){for(;this.waitingForUnlock.length>0;)this.waitingForUnlock.shift().resolve();this.emit(i.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}setDefaultHomeActiveTabName(e){this.store.updateState({defaultHomeActiveTabName:e})}setConnectedStatusPopoverHasBeenShown(){this.store.updateState({connectedStatusPopoverHasBeenShown:!0})}setRecoveryPhraseReminderHasBeenShown(){this.store.updateState({recoveryPhraseReminderHasBeenShown:!0})}setRecoveryPhraseReminderLastShown(e){this.store.updateState({recoveryPhraseReminderLastShown:e})}setLastActiveTime(){this._resetTimer()}_setInactiveTimeout(e){this.store.updateState({timeoutMinutes:e}),this._resetTimer()}_resetTimer(){const{timeoutMinutes:e}=this.store.getState();this.timer&&clearTimeout(this.timer),e&&(this.timer=setTimeout((()=>this.onInactiveTimeout()),e*c.MINUTE))}setBrowserEnvironment(e,t){this.store.updateState({browserEnvironment:{os:e,browser:t}})}addPollingToken(e,t){const r=this.store.getState()[t];this.store.updateState({[t]:[...r,e]})}removePollingToken(e,t){const r=this.store.getState()[t];this.store.updateState({[t]:r.filter((t=>t!==e))})}clearPollingTokens(){this.store.updateState({popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[]})}setShowTestnetMessageInDropdown(e){this.store.updateState({showTestnetMessageInDropdown:e})}rejectUnlock(){if(this.waitingForUnlock.length>0){for(;this.waitingForUnlock.length>0;)this.waitingForUnlock.shift().reject();this.emit(i.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}setTrezorModel(e){this.store.updateState({trezorModel:e})}setCollectiblesDetectionNoticeDismissed(e){this.store.updateState({collectiblesDetectionNoticeDismissed:e})}setEnableEIP1559V2NoticeDismissed(e){this.store.updateState({enableEIP1559V2NoticeDismissed:e})}updateCollectibleDropDownState(e){this.store.updateState({collectiblesDropdownState:e})}}r.default=u}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/app-state.js"}],[49,{"@babel/runtime/helpers/interopRequireDefault":213,loglevel:5876,"webextension-polyfill":6875},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({location:e,registerOnboarding:t}){return async function(r,s,o,i){try{if("wallet_registerOnboarding"!==r.method)return void o();r.tabId&&r.tabId!==a.default.tabs.TAB_ID_NONE?await t(e,r.tabId):n.default.debug(`'wallet_registerOnboarding' message from ${e} ignored due to missing tabId`),s.result=!0,i()}catch(e){i(e)}}};var n=s(e("loglevel")),a=s(e("webextension-polyfill"))}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/createOnboardingMiddleware.js"}],[33,{"../../../shared/constants/hardware-wallets":6901,"../../../shared/constants/network":6904,"../../../shared/modules/network.utils":6915,"./network":21,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,assert:2088,"eth-sig-util":3131,ethers:3219,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("assert"),o=e("@metamask/obs-store"),i=e("eth-sig-util"),c=e("ethers"),l=s(e("loglevel")),d=e("../../../shared/constants/network"),u=e("../../../shared/modules/network.utils"),h=e("../../../shared/constants/hardware-wallets"),p=e("./network");function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor(e={}){const t=f({frequentRpcListDetail:[],useBlockie:!1,useNonceField:!1,usePhishDetect:!0,dismissSeedBackUpReminder:!1,useTokenDetection:Boolean(!1),useCollectibleDetection:!0,openSeaEnabled:!0,advancedGasFee:null,featureFlags:{showIncomingTransactions:!0},knownMethodData:{},currentLocale:e.initLangCode,identities:{},lostIdentities:{},forgottenPassword:!1,preferences:{autoLockTimeLimit:60,showFiatInTestnets:!1,showTestNetworks:!1,useNativeCurrencyAsPrimaryCurrency:!0,hideZeroBalanceTokens:!1},ipfsGateway:d.IPFS_DEFAULT_GATEWAY_URL,infuraBlocked:null,ledgerTransportType:window.navigator.hid?h.LEDGER_TRANSPORT_TYPES.WEBHID:h.LEDGER_TRANSPORT_TYPES.U2F,theme:"default",accountList:[],transformFlag:"loading"},e.initState);this.network=e.network,this.ethersProvider=new c.ethers.providers.Web3Provider(e.provider),this.store=new o.ObservableStore(t),this.store.setMaxListeners(12),this.openPopup=e.openPopup,this.migrateAddressBookState=e.migrateAddressBookState,this._subscribeToInfuraAvailability(),global.setPreference=(e,t)=>this.setFeatureFlag(e,t)}setPasswordForgotten(e){this.store.updateState({forgottenPassword:e})}setUseBlockie(e){this.store.updateState({useBlockie:e})}setUseNonceField(e){this.store.updateState({useNonceField:e})}setUsePhishDetect(e){this.store.updateState({usePhishDetect:e})}setUseTokenDetection(e){this.store.updateState({useTokenDetection:e})}setUseCollectibleDetection(e){this.store.updateState({useCollectibleDetection:e})}setOpenSeaEnabled(e){this.store.updateState({openSeaEnabled:e})}setAdvancedGasFee(e){this.store.updateState({advancedGasFee:e})}setEIP1559V2Enabled(e){this.store.updateState({eip1559V2Enabled:e})}setTheme(e){this.store.updateState({theme:e})}addKnownMethodData(e,t){const{knownMethodData:r}=this.store.getState();r[e]=t,this.store.updateState({knownMethodData:r})}setCurrentLocale(e){const t=["ar","dv","fa","he","ku"].includes(e)?"rtl":"auto";return this.store.updateState({currentLocale:e,textDirection:t}),t}setAddresses(e){const t=this.store.getState().identities,r=e.reduce(((e,r,s)=>{const n=t[r]||{};return e[r]=f({name:`Account ${s+1}`,address:r},n),e}),{});this.store.updateState({identities:r})}removeAddress(e){const{identities:t}=this.store.getState();if(!t[e])throw new Error(`${e} can't be deleted cause it was not found`);if(delete t[e],this.store.updateState({identities:t}),e===this.getSelectedAddress()){const e=Object.keys(t)[0];this.setSelectedAddress(e)}return e}addAddresses(e){const{identities:t}=this.store.getState();e.forEach((e=>{if(t[e])return;const r=Object.keys(t).length;t[e]={name:`Account ${r+1}`,address:e}})),this.store.updateState({identities:t})}syncAddresses(e){if(!Array.isArray(e)||0===e.length)throw new Error("Expected non-empty array of addresses. Error #11201");const{identities:t,lostIdentities:r}=this.store.getState(),s={};Object.keys(t).forEach((r=>{e.includes(r)||(s[r]=t[r],delete t[r])})),Object.keys(s).length>0&&Object.keys(s).forEach((e=>{r[e]=s[e]})),this.store.updateState({identities:t,lostIdentities:r}),this.addAddresses(e);let n=this.getSelectedAddress();return e.includes(n)||(n=e[0],this.setSelectedAddress(n)),n}setSelectedAddress(e){const t=(0,i.normalize)(e),{identities:r}=this.store.getState(),s=r[t];if(!s)throw new Error(`Identity for '${t} not found`);s.lastSelected=Date.now(),this.store.updateState({identities:r,selectedAddress:t})}getSelectedAddress(){return this.store.getState().selectedAddress}setAccountLabel(e,t){if(!e)throw new Error(`setAccountLabel requires a valid address, got ${String(e)}`);const r=(0,i.normalize)(e),{identities:s}=this.store.getState();return s[r]=s[r]||{},s[r].name=t,this.store.updateState({identities:s}),Promise.resolve(t)}async updateRpc(e){const t=this.getFrequentRpcListDetail(),r=t.findIndex((t=>t.rpcUrl===e.rpcUrl));if(r>-1){const s=t[r],n=f(f({},s),e);if(s.chainId!==n.chainId){let r=s.chainId;if(!r)try{r=await this.ethersProvider.send("net_version"),(0,a.strict)("string"==typeof r)}catch(e){l.default.debug(e),l.default.warn(`Failed to get networkId from ${s.rpcUrl}; skipping address book migration`)}let o=!1;const i=Object.values(d.NETWORK_TYPE_TO_ID_MAP).map((e=>e.networkId)),c=t.filter((t=>t.rpcUrl!==e.rpcUrl));(i.includes(r)||c.some((e=>e.chainId===r)))&&(o=!0),this.migrateAddressBookState(r,n.chainId,o)}t[r]=n,this.store.updateState({frequentRpcListDetail:t})}else{const{rpcUrl:t,chainId:r,ticker:s,nickname:n,rpcPrefs:a={}}=e;this.addToFrequentRpcList(t,r,s,n,a)}}addToFrequentRpcList(e,t,r="ETH",s="",n={}){const a=this.getFrequentRpcListDetail(),o=a.findIndex((t=>t.rpcUrl===e));if(-1!==o&&a.splice(o,1),!(0,u.isPrefixedFormattedHexString)(t))throw new Error(`Invalid chainId: "${t}"`);a.push({rpcUrl:e,chainId:t,ticker:r,nickname:s,rpcPrefs:n}),this.store.updateState({frequentRpcListDetail:a})}removeFromFrequentRpcList(e){const t=this.getFrequentRpcListDetail(),r=t.findIndex((t=>t.rpcUrl===e));return-1!==r&&t.splice(r,1),this.store.updateState({frequentRpcListDetail:t}),Promise.resolve(t)}getFrequentRpcListDetail(){return this.store.getState().frequentRpcListDetail}setFeatureFlag(e,t){const r=f(f({},this.store.getState().featureFlags),{},{[e]:t});return this.store.updateState({featureFlags:r}),Promise.resolve(r)}setPreference(e,t){const r=f(f({},this.getPreferences()),{},{[e]:t});return this.store.updateState({preferences:r}),Promise.resolve(r)}getPreferences(){return this.store.getState().preferences}getIpfsGateway(){return this.store.getState().ipfsGateway}setIpfsGateway(e){return this.store.updateState({ipfsGateway:e}),Promise.resolve(e)}setLedgerTransportPreference(e){return this.store.updateState({ledgerTransportType:e}),e}getLedgerTransportPreference(){return this.store.getState().ledgerTransportType}async setDismissSeedBackUpReminder(e){await this.store.updateState({dismissSeedBackUpReminder:e})}_subscribeToInfuraAvailability(){this.network.on(p.NETWORK_EVENTS.INFURA_IS_BLOCKED,(()=>{this._setInfuraBlocked(!0)})),this.network.on(p.NETWORK_EVENTS.INFURA_IS_UNBLOCKED,(()=>{this._setInfuraBlocked(!1)}))}_setInfuraBlocked(e){const{infuraBlocked:t}=this.store.getState();t!==e&&this.store.updateState({infuraBlocked:e})}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/preferences.js"}],[12,{"../../../shared/constants/network":6904,"../../../shared/constants/time":6907,"../../../shared/constants/transaction":6908,"../../../shared/modules/fetch-with-timeout":6912,"../../../shared/modules/random-id":6916,"../lib/util":99,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,"bn.js":2432,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store"),o=s(e("loglevel")),i=s(e("bn.js")),c=s(e("../../../shared/modules/random-id")),l=e("../lib/util"),d=s(e("../../../shared/modules/fetch-with-timeout")),u=e("../../../shared/constants/transaction"),h=e("../../../shared/constants/network"),p=e("../../../shared/constants/time");function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const g=(0,d.default)(30*p.SECOND),b=[h.GOERLI_CHAIN_ID,h.KOVAN_CHAIN_ID,h.MAINNET_CHAIN_ID,h.RINKEBY_CHAIN_ID,h.ROPSTEN_CHAIN_ID];function v(e,t){let r,s=!0;return n=>{try{return s?(s=!1,e(null!=t?t:n,n)):e(r,n)}finally{r=n}}}r.default=class{constructor(e={}){const{blockTracker:t,onNetworkDidChange:r,getCurrentChainId:s,preferencesController:n}=e;this.blockTracker=t,this.getCurrentChainId=s,this.preferencesController=n,this._onLatestBlock=async e=>{const t=this.preferencesController.getSelectedAddress(),r=parseInt(e,16);await this._update(t,r)};const o=f({incomingTransactions:{},incomingTxLastFetchedBlockByChainId:{[h.GOERLI_CHAIN_ID]:null,[h.KOVAN_CHAIN_ID]:null,[h.MAINNET_CHAIN_ID]:null,[h.RINKEBY_CHAIN_ID]:null,[h.ROPSTEN_CHAIN_ID]:null}},e.initState);this.store=new a.ObservableStore(o),this.preferencesController.store.subscribe(v(((e,t)=>{const{featureFlags:{showIncomingTransactions:r}={}}=e,{featureFlags:{showIncomingTransactions:s}={}}=t;s!==r&&(!r||s?this.start():this.stop())}),this.preferencesController.store.getState())),this.preferencesController.store.subscribe(v((async(e,t)=>{const{selectedAddress:r}=e,{selectedAddress:s}=t;s!==r&&await this._update(s)}),this.preferencesController.store.getState())),r((async()=>{const e=this.preferencesController.getSelectedAddress();await this._update(e)}))}start(){const{featureFlags:e={}}=this.preferencesController.store.getState(),{showIncomingTransactions:t}=e;t&&(this.blockTracker.removeListener("latest",this._onLatestBlock),this.blockTracker.addListener("latest",this._onLatestBlock))}stop(){this.blockTracker.removeListener("latest",this._onLatestBlock)}async _update(e,t){const r=this.getCurrentChainId();if(b.includes(r)&&e)try{var s;const n=this.store.getState(),a=parseInt(this.blockTracker.getCurrentBlock(),16),o=n.incomingTxLastFetchedBlockByChainId[r],i=null!==(s=null!=o?o:t)&&void 0!==s?s:a,c=await this._getNewIncomingTransactions(e,i,r);let l=i;c.forEach((e=>{e.blockNumber&&parseInt(l,10)<parseInt(e.blockNumber,10)&&(l=parseInt(e.blockNumber,10))})),this.store.updateState({incomingTxLastFetchedBlockByChainId:f(f({},n.incomingTxLastFetchedBlockByChainId),{},{[r]:l+1}),incomingTransactions:c.reduce(((e,t)=>(e[t.hash]=t,e)),f({},n.incomingTransactions))})}catch(e){o.default.error(e)}}async _getNewIncomingTransactions(e,t,r){let s=`${`https://${r===h.MAINNET_CHAIN_ID?"api":`api-${h.CHAIN_ID_TO_TYPE_MAP[r]}`}.etherscan.io`}/api?module=account&action=txlist&address=${e}&tag=latest&page=1`;t&&(s+=`&startBlock=${parseInt(t,10)}`);const n=await g(s),{status:a,result:o}=await n.json();let i=[];if("1"===a&&Array.isArray(o)&&o.length>0){const t={},s=[];o.forEach((e=>{t[e.hash]||(s.push(this._normalizeTxFromEtherscan(e,r)),t[e.hash]=1)})),i=s.filter((t=>{var r,s;return(null===(r=t.txParams)||void 0===r||null===(s=r.to)||void 0===s?void 0:s.toLowerCase())===e.toLowerCase()})),i.sort(((e,t)=>e.time<t.time?-1:1))}return i}_normalizeTxFromEtherscan(e,t){const r=1e3*parseInt(e.timeStamp,10),s="0"===e.isError?u.TRANSACTION_STATUSES.CONFIRMED:u.TRANSACTION_STATUSES.FAILED,n={from:e.from,gas:(0,l.bnToHex)(new i.default(e.gas)),nonce:(0,l.bnToHex)(new i.default(e.nonce)),to:e.to,value:(0,l.bnToHex)(new i.default(e.value))};return e.gasPrice?n.gasPrice=(0,l.bnToHex)(new i.default(e.gasPrice)):e.maxFeePerGas&&(n.maxFeePerGas=(0,l.bnToHex)(new i.default(e.maxFeePerGas)),n.maxPriorityFeePerGas=(0,l.bnToHex)(new i.default(e.maxPriorityFeePerGas))),{blockNumber:e.blockNumber,id:(0,c.default)(),chainId:t,metamaskNetworkId:h.CHAIN_ID_TO_NETWORK_ID_MAP[t],status:s,time:r,txParams:n,hash:e.hash,type:u.TRANSACTION_TYPES.INCOMING}}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/incoming-transactions.js"}],[13,{"../../../shared/constants/app":6899,"../../../shared/constants/metametrics":6903,"../../../shared/constants/time":6907,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,buffer:2478,"ethereumjs-util":3195,lodash:5866,pubnub:6155},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),o=e("@metamask/obs-store"),i=e("ethereumjs-util"),c=e("pubnub"),l=e("../../../shared/constants/app"),d=e("../../../shared/constants/metametrics"),u=e("../../../shared/constants/time");function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const m=e=>{setTimeout((()=>{throw e}))},f={'You must pass either an "anonymousId" or a "userId".':!0};r.default=class{constructor({segment:e,preferencesStore:t,onNetworkDidChange:r,getCurrentChainId:s,getNetworkIdentifier:i,version:c,environment:l,initState:d,captureException:h=m}){(0,n.default)(this,"_isValidTraitArray",(e=>Array.isArray(e)&&(e.every((e=>"string"==typeof e))||e.every((e=>"boolean"==typeof e))||e.every((e=>"number"==typeof e))))),(0,n.default)(this,"_isValidTraitDate",(e=>"[object Date]"===Object.prototype.toString.call(e))),this._captureException=e=>{f[e.message]||h(e)};const g=t.getState();this.chainId=s(),this.network=i(),this.locale=g.currentLocale.replace("_","-"),this.version="production"===l?c:`${c}-${l}`;const b=(0,a.omitBy)(null==d?void 0:d.fragments,"persist");this.store=new o.ObservableStore(p(p({participateInMetaMetrics:null,metaMetricsId:null},d),{},{fragments:p({},null==d?void 0:d.fragments)})),t.subscribe((({currentLocale:e})=>{this.locale=e.replace("_","-")})),r((()=>{this.chainId=s(),this.network=i()})),this.segment=e,Object.values(b).forEach((e=>{this.finalizeEventFragment(e.id,{abandoned:!0})})),setInterval((()=>{Object.values(this.store.getState().fragments).forEach((e=>{e.timeout&&Date.now()-e.lastUpdated/1e3>e.timeout&&this.finalizeEventFragment(e.id,{abandoned:!0})}))}),30*u.SECOND)}generateMetaMetricsId(){return(0,i.bufferToHex)((0,i.keccak)(t.from(String(Date.now())+String(Math.round(Math.random()*Number.MAX_SAFE_INTEGER)))))}createEventFragment(e){var t;if(!e.successEvent||!e.category)throw new Error(`Must specify success event and category. Success event was: ${e.event}. Category was: ${e.category}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`);const{fragments:r}=this.store.getState(),s=null!==(t=e.uniqueIdentifier)&&void 0!==t?t:(0,c.generateUUID)(),n=p(p({id:s},e),{},{lastUpdated:Date.now()});return this.store.updateState({fragments:p(p({},r),{},{[s]:n})}),e.initialEvent&&this.trackEvent({event:n.initialEvent,category:n.category,properties:n.properties,sensitiveProperties:n.sensitiveProperties,page:n.page,referrer:n.referrer,revenue:n.revenue,value:n.value,currency:n.currency,environmentType:n.environmentType}),n}getEventFragmentById(e){const{fragments:t}=this.store.getState();return t[e]}updateEventFragment(e,t){const{fragments:r}=this.store.getState();if(!r[e])throw new Error(`Event fragment with id ${e} does not exist.`);this.store.updateState({fragments:p(p({},r),{},{[e]:(0,a.merge)(r[e],p(p({},t),{},{lastUpdated:Date.now()}))})})}finalizeEventFragment(e,{abandoned:t=!1,page:r,referrer:s}={}){var n;const a=this.store.getState().fragments[e];if(!a)throw new Error(`Funnel with id ${e} does not exist.`);const o=t?a.failureEvent:a.successEvent;this.trackEvent({event:o,category:a.category,properties:a.properties,sensitiveProperties:a.sensitiveProperties,page:null!=r?r:a.page,referrer:null!==(n=a.referrer)&&void 0!==n?n:s,revenue:a.revenue,value:a.value,currency:a.currency,environmentType:a.environmentType});const{fragments:i}=this.store.getState();delete i[e],this.store.updateState({fragments:i})}identify(e){const{metaMetricsId:t,participateInMetaMetrics:r}=this.state;if(!r||!t||!e)return;if("object"!=typeof e)return void console.warn("MetaMetricsController#identify: userTraits parameter must be an object. Received type: "+typeof e);const s=this._buildValidTraits(e);this._identify(s)}setParticipateInMetaMetrics(e){let{metaMetricsId:t}=this.state;return e&&!t?t=this.generateMetaMetricsId():!1===e&&(t=null),this.store.updateState({participateInMetaMetrics:e,metaMetricsId:t}),t}get state(){return this.store.getState()}trackPage({name:e,params:t,environmentType:r,page:s,referrer:n},a){try{if(!1===this.state.participateInMetaMetrics)return;if(null===this.state.participateInMetaMetrics&&(null==a||!a.isOptInPath))return;const{metaMetricsId:o}=this.state,i=o?"userId":"anonymousId",c=null!=o?o:d.METAMETRICS_ANONYMOUS_ID;this.segment.page({[i]:c,name:e,properties:{params:t,locale:this.locale,network:this.network,chain_id:this.chainId,environment_type:r},context:this._buildContext(n,s)})}catch(e){this._captureException(e)}}trackEvent(e,t){this.validatePayload(e),this.submitEvent(e,t).catch((e=>this._captureException(e)))}async submitEvent(e,t){if(this.validatePayload(e),!(this.state.participateInMetaMetrics||null!=t&&t.isOptIn))return;const r=[];if(e.sensitiveProperties){if(!0===(null==t?void 0:t.excludeMetaMetricsId))throw new Error("sensitiveProperties was specified in an event payload that also set the excludeMetaMetricsId flag");const s=(0,a.merge)(e.sensitiveProperties,e.properties);r.push(this._track(this._buildEventPayload(p(p({},e),{},{properties:s})),p(p({},t),{},{excludeMetaMetricsId:!0})))}r.push(this._track(this._buildEventPayload(e),t)),await Promise.all(r)}validatePayload(e){if(!e.event||!e.category)throw new Error(`Must specify event and category. Event was: ${e.event}. Category was: ${e.category}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`)}handleMetaMaskStateUpdate(e){const t=this._buildUserTraitsObject(e);t&&this.identify(t)}_buildContext(e,t=d.METAMETRICS_BACKGROUND_PAGE_OBJECT){return{app:{name:"MetaMask Extension",version:this.version},userAgent:window.navigator.userAgent,page:t,referrer:e}}_buildEventPayload(e){var t,r;const{event:s,properties:n,revenue:o,value:i,currency:c,category:d,page:u,referrer:h,environmentType:m=l.ENVIRONMENT_TYPE_BACKGROUND}=e;return{event:s,properties:p(p({},(0,a.omit)(n,["revenue","locale","currency","value"])),{},{revenue:o,value:i,currency:c,category:d,network:null!==(t=null==n?void 0:n.network)&&void 0!==t?t:this.network,locale:this.locale,chain_id:null!==(r=null==n?void 0:n.chain_id)&&void 0!==r?r:this.chainId,environment_type:m}),context:this._buildContext(h,u)}}_buildUserTraitsObject(e){const t={[d.TRAITS.ADDRESS_BOOK_ENTRIES]:(0,a.sum)(Object.values(e.addressBook).map(a.size)),[d.TRAITS.LEDGER_CONNECTION_TYPE]:e.ledgerTransportType,[d.TRAITS.NETWORKS_ADDED]:e.frequentRpcListDetail.map((e=>e.chainId)),[d.TRAITS.NFT_AUTODETECTION_ENABLED]:e.useCollectibleDetection,[d.TRAITS.NUMBER_OF_ACCOUNTS]:Object.values(e.identities).length,[d.TRAITS.NUMBER_OF_NFT_COLLECTIONS]:this._getNumberOfNFtCollection(e),[d.TRAITS.NUMBER_OF_TOKENS]:this._getNumberOfTokens(e),[d.TRAITS.OPENSEA_API_ENABLED]:e.openSeaEnabled,[d.TRAITS.THREE_BOX_ENABLED]:e.threeBoxSyncingAllowed,[d.TRAITS.THEME]:e.theme||"default"};if(!this.previousTraits)return this.previousTraits=t,t;if(this.previousTraits&&!(0,a.isEqual)(this.previousTraits,t)){const e=(0,a.pickBy)(t,((e,t)=>!(0,a.isEqual)(this.previousTraits[t],e)));return this.previousTraits=t,e}return null}_buildValidTraits(e){return Object.entries(e).reduce(((e,[t,r])=>(this._isValidTraitDate(r)?e[t]=r.toISOString():this._isValidTrait(r)?e[t]=r:console.warn(`MetaMetricsController: "${t}" value is not a valid trait type`),e)),{})}_getNumberOfNFtCollection(e){const{allCollectibles:t}=e;if(!t)return 0;const r=Object.values(t).flatMap((e=>Object.values(e))).flat().map((e=>e.address));return[...new Set(r)].length}_getNumberOfTokens(e){return Object.values(e.allTokens).reduce(((e,t)=>e+(0,a.sum)(Object.values(t).map(a.size))),0)}_identify(e){const{metaMetricsId:t}=this.state;if(e&&0!==Object.keys(e).length)try{this.segment.identify({userId:t,traits:e})}catch(e){this._captureException(e)}else console.warn("MetaMetricsController#_identify: No userTraits found")}_isValidTrait(e){const t=typeof e;return"string"===t||"boolean"===t||"number"===t||this._isValidTraitArray(e)||this._isValidTraitDate(e)}_track(e,t){var r;const{isOptIn:s,metaMetricsId:n,matomoEvent:a,flushImmediately:o}=t||{};let i="userId",c=this.state.metaMetricsId,l=null!==(r=null==t?void 0:t.excludeMetaMetricsId)&&void 0!==r&&r;return Boolean(e.event.match(/^send|^confirm/iu))&&(l=!0),l||s&&!n?(i="anonymousId",c=d.METAMETRICS_ANONYMOUS_ID):s&&n&&(c=n),e[i]=c,!0===a&&(e.properties.legacy_event=!0),new Promise(((t,r)=>{this.segment.track(e,(e=>{if(e){const t=new Error(e.message);return t.stack=e.stack,r(t)}return t()})),o&&this.segment.flush()}))}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/metametrics.js"}],[69,{"../../../shared/constants/app":6899,"../../../shared/modules/random-id":6916,"../metamask-controller":100,"./util":99,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,buffer:2478,"eth-rpc-errors":3129,"ethereumjs-util":3195,events:2479,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),a=e("@metamask/obs-store"),o=e("ethereumjs-util"),i=e("eth-rpc-errors"),c=s(e("loglevel")),l=e("../../../shared/constants/app"),d=e("../metamask-controller"),u=s(e("../../../shared/modules/random-id")),h=e("./util");const p=/^[0-9A-Fa-f]+$/gu;class m extends n.default{constructor({metricsEvent:e}){super(),this.memStore=new a.ObservableStore({unapprovedPersonalMsgs:{},unapprovedPersonalMsgCount:0}),this.messages=[],this.metricsEvent=e}get unapprovedPersonalMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,s)=>{if(!e.from)return void s(new Error("MetaMask Message Signature: from field is required."));const n=this.addUnapprovedMessage(e,t);this.once(`${n}:finished`,(t=>{switch(t.status){case"signed":return void r(t.rawSig);case"rejected":return void s(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return void s(new Error(`MetaMask Message Signature: ${t.error}`));default:s(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){c.default.debug(`PersonalMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`),t&&(e.origin=t.origin),e.data=this.normalizeMsgData(e.data);const r=(new Date).getTime(),s=(0,u.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:l.MESSAGE_TYPE.PERSONAL_SIGN};return this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:"Transactions",properties:{action:"Sign Request",type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`PersonalMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedPersonalMsgs:e,unapprovedPersonalMsgCount:t}),this.emit(d.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}normalizeMsgData(e){try{const t=(0,o.stripHexPrefix)(e);if(t.match(p))return(0,h.addHexPrefix)(t)}catch(e){c.default.debug("Message was not hex encoded, interpreting as utf8.")}return(0,o.bufferToHex)(t.from(e,"utf8"))}}r.default=m}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/personal-message-manager.js"}],[25,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store"),o=s(e("loglevel"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor(e={}){(0,n.default)(this,"registerOnboarding",(async(e,t)=>{if(this.store.getState().completedOnboarding)return void o.default.debug("Ignoring registerOnboarding; user already onboarded");const r=c({},this.store.getState().onboardingTabs);r[e]&&r[e]===t||(o.default.debug(`Registering onboarding tab at location '${e}' with tabId '${t}'`),r[e]=t,this.store.updateState({onboardingTabs:r}))}));const t=c(c({seedPhraseBackedUp:null,firstTimeFlowType:null,completedOnboarding:!1},e.initState),{onboardingTabs:{}});this.store=new a.ObservableStore(t)}setSeedPhraseBackedUp(e){this.store.updateState({seedPhraseBackedUp:e})}completeOnboarding(){return this.store.updateState({completedOnboarding:!0}),Promise.resolve(!0)}setFirstTimeFlowType(e){this.store.updateState({firstTimeFlowType:e})}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/onboarding.js"}],[64,{"../../../shared/constants/app":6899,"../../../shared/modules/random-id":6916,"../metamask-controller":100,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,buffer:2478,"eth-rpc-errors":3129,"ethereumjs-util":3195,events:2479},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,r.normalizeMsgData=h;var n=s(e("events")),a=e("@metamask/obs-store"),o=e("ethereumjs-util"),i=e("eth-rpc-errors"),c=e("../../../shared/constants/app"),l=e("../metamask-controller"),d=s(e("../../../shared/modules/random-id"));class u extends n.default{constructor({metricsEvent:e}){super(),this.memStore=new a.ObservableStore({unapprovedMsgs:{},unapprovedMsgCount:0}),this.messages=[],this.metricsEvent=e}get unapprovedMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}async addUnapprovedMessageAsync(e,t){const r=this.addUnapprovedMessage(e,t);return await new Promise(((t,s)=>{this.once(`${r}:finished`,(r=>{switch(r.status){case"signed":return t(r.rawSig);case"rejected":return s(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return s(new Error(`MetaMask Message Signature: ${r.error}`));default:return s(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){t&&(e.origin=t.origin),e.data=h(e.data);const r=(new Date).getTime(),s=(0,d.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:c.MESSAGE_TYPE.ETH_SIGN};return this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:"Transactions",properties:{action:"Sign Request",type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`MessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedMsgs:e,unapprovedMsgCount:t}),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}function h(e){return"0x"===e.slice(0,2)?e:(0,o.bufferToHex)(t.from(e,"utf8"))}r.default=u}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/message-manager.js"}],[55,{"../../../shared/constants/app":6899,"../../../shared/modules/random-id":6916,"../metamask-controller":100,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,"eth-rpc-errors":3129,events:2479,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),a=e("@metamask/obs-store"),o=e("eth-rpc-errors"),i=s(e("loglevel")),c=e("../../../shared/constants/app"),l=e("../metamask-controller"),d=s(e("../../../shared/modules/random-id"));class u extends n.default{constructor(e){super(),this.memStore=new a.ObservableStore({unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0}),this.messages=[],this.metricsEvent=e.metricsEvent}get unapprovedEncryptionPublicKeyMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,s)=>{if(!e)return void s(new Error("MetaMask Message: address field is required."));const n=this.addUnapprovedMessage(e,t);this.once(`${n}:finished`,(t=>{switch(t.status){case"received":return void r(t.rawData);case"rejected":return void s(o.ethErrors.provider.userRejectedRequest("MetaMask EncryptionPublicKey: User denied message EncryptionPublicKey."));default:s(new Error(`MetaMask EncryptionPublicKey: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){i.default.debug("EncryptionPublicKeyManager addUnapprovedMessage: address");const r=(new Date).getTime(),s=(0,d.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:c.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY};return t&&(n.origin=t.origin),this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForEncryptionPublicKey(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusReceived(e,t){const r=this.getMsg(e);r.rawData=t,this._updateMsg(r),this._setMsgStatus(e,"received")}prepMsgForEncryptionPublicKey(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){t&&this.metricsEvent({event:t,category:"Messages",properties:{action:"Encryption public key Request"}}),this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`EncryptionPublicKeyManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"received"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedEncryptionPublicKeyMsgs:e,unapprovedEncryptionPublicKeyMsgCount:t}),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}r.default=u}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/encryption-public-key-manager.js"}],[6,{"../../../shared/constants/alerts":6898,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store"),o=e("../../../shared/constants/alerts");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const l={alertEnabledness:o.TOGGLEABLE_ALERT_TYPES.reduce(((e,t)=>(e[t]=!0,e)),{}),unconnectedAccountAlertShownOrigins:{},web3ShimUsageOrigins:{}};r.default=class{constructor(e={}){const{initState:t={},preferencesStore:r}=e,s=c(c({},l),{},{alertEnabledness:c(c({},l.alertEnabledness),t.alertEnabledness)});this.store=new a.ObservableStore(s),this.selectedAddress=r.getState().selectedAddress,r.subscribe((({selectedAddress:e})=>{this.store.getState().unconnectedAccountAlertShownOrigins&&this.selectedAddress!==e&&(this.selectedAddress=e,this.store.updateState({unconnectedAccountAlertShownOrigins:{}}))}))}setAlertEnabledness(e,t){let{alertEnabledness:r}=this.store.getState();r=c({},r),r[e]=t,this.store.updateState({alertEnabledness:r})}setUnconnectedAccountAlertShown(e){let{unconnectedAccountAlertShownOrigins:t}=this.store.getState();t=c({},t),t[e]=!0,this.store.updateState({unconnectedAccountAlertShownOrigins:t})}getWeb3ShimUsageState(e){return this.store.getState().web3ShimUsageOrigins[e]}setWeb3ShimUsageRecorded(e){this._setWeb3ShimUsageState(e,o.WEB3_SHIM_USAGE_ALERT_STATES.RECORDED)}setWeb3ShimUsageAlertDismissed(e){this._setWeb3ShimUsageState(e,o.WEB3_SHIM_USAGE_ALERT_STATES.DISMISSED)}_setWeb3ShimUsageState(e,t){let{web3ShimUsageOrigins:r}=this.store.getState();r=c({},r),r[e]=t,this.store.updateState({web3ShimUsageOrigins:r})}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/alert.js"}],[98,{"../../../shared/constants/app":6899,"../../../shared/modules/hexstring-utils":6914,"../../../shared/modules/random-id":6916,"../metamask-controller":100,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,assert:2088,"eth-rpc-errors":3129,"eth-sig-util":3131,events:2479,jsonschema:5432,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),a=e("assert"),o=e("@metamask/obs-store"),i=e("eth-rpc-errors"),c=e("eth-sig-util"),l=s(e("loglevel")),d=s(e("jsonschema")),u=e("../../../shared/constants/app"),h=e("../metamask-controller"),p=s(e("../../../shared/modules/random-id")),m=e("../../../shared/modules/hexstring-utils");class f extends n.default{constructor({getCurrentChainId:e,metricsEvent:t}){super(),this._getCurrentChainId=e,this.memStore=new o.ObservableStore({unapprovedTypedMessages:{},unapprovedTypedMessagesCount:0}),this.messages=[],this.metricsEvent=t}get unapprovedTypedMessagesCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t,r){return new Promise(((s,n)=>{const a=this.addUnapprovedMessage(e,t,r);this.once(`${a}:finished`,(t=>{switch(t.status){case"signed":return s(t.rawSig);case"rejected":return n(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return n(new Error(`MetaMask Message Signature: ${t.error}`));default:return n(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t,r){e.version=r,t&&(e.origin=t.origin),this.validateParams(e),l.default.debug(`TypedMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`);const s=(new Date).getTime(),n=(0,p.default)(),a={id:n,msgParams:e,time:s,status:"unapproved",type:u.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA};return this.addMsg(a),this.emit("update"),n}validateParams(e){switch(a.strict.ok(e&&"object"==typeof e,"Params must be an object."),a.strict.ok("data"in e,'Params must include a "data" field.'),a.strict.ok("from"in e,'Params must include a "from" field.'),a.strict.ok("string"==typeof e.from&&(0,m.isValidHexAddress)(e.from,{allowNonPrefixed:!1}),'"from" field must be a valid, lowercase, hexadecimal Ethereum address string.'),e.version){case"V1":a.strict.ok(Array.isArray(e.data),'"params.data" must be an array.'),a.strict.doesNotThrow((()=>{(0,c.typedSignatureHash)(e.data)}),"Signing data must be valid EIP-712 typed data.");break;case"V3":case"V4":{let t;a.strict.equal(typeof e.data,"string",'"params.data" must be a string.'),a.strict.doesNotThrow((()=>{t=JSON.parse(e.data)}),'"data" must be a valid JSON string.');const r=d.default.validate(t,c.TYPED_MESSAGE_SCHEMA);if(a.strict.ok(t.primaryType in t.types,`Primary type of "${t.primaryType}" has no type definition.`),0!==r.errors.length)throw i.ethErrors.rpc.invalidParams({message:"Signing data must conform to EIP-712 schema. See https://git.io/fNtcx.",data:r.errors.map((e=>e.message.toString()))});let{chainId:s}=t.domain;if(s){const e=parseInt(this._getCurrentChainId(),16);a.strict.ok(!Number.isNaN(e),`Cannot sign messages for chainId "${s}", because MetaMask is switching networks.`),"string"==typeof s&&(s=parseInt(s,s.startsWith("0x")?16:10)),a.strict.equal(s,e,`Provided chainId "${s}" must match the active chainId "${e}"`)}break}default:a.strict.fail(`Unknown typed data version "${e.version}"`)}}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,delete e.version,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:"Transactions",properties:{action:"Sign Request",version:r.msgParams.version,type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`TypedMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t&&"errored"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedTypedMessages:e,unapprovedTypedMessagesCount:t}),this.emit(h.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}r.default=f}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/typed-message-manager.js"}],[9,{"../../../shared/constants/network":6904,"../../../shared/constants/time":6907,"../../../shared/modules/network.utils":6915,"../../../shared/modules/string-utils":6918,"../constants/contracts":4,"@babel/runtime/helpers/interopRequireDefault":213,loglevel:5876,"single-call-balance-checker-abi":6547,web3:6823},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("web3")),a=e("loglevel"),o=s(e("single-call-balance-checker-abi")),i=e("../constants/contracts"),c=e("../../../shared/constants/time"),l=e("../../../shared/constants/network"),d=(e("../../../shared/modules/network.utils"),e("../../../shared/modules/string-utils"));const u=3*c.MINUTE;r.default=class{constructor({interval:e=u,preferences:t,network:r,keyringMemStore:s,tokenList:n,tokensController:a,assetsContractController:o=null}={}){var i,c,l;this.assetsContractController=o,this.tokensController=a,this.preferences=t,this.interval=e,this.network=r,this.keyringMemStore=s,this.tokenList=n,this.selectedAddress=null===(i=this.preferences)||void 0===i?void 0:i.store.getState().selectedAddress,this.tokenAddresses=null===(c=this.tokensController)||void 0===c?void 0:c.state.tokens.map((e=>e.address)),this.hiddenTokens=null===(l=this.tokensController)||void 0===l?void 0:l.state.ignoredTokens,this.detectedTokens=[],null==t||t.store.subscribe((({selectedAddress:e,useTokenDetection:t})=>{this.selectedAddress===e&&this.useTokenDetection===t||(this.selectedAddress=e,this.useTokenDetection=t,this.restartTokenDetection())})),null==a||a.subscribe((({tokens:e=[],ignoredTokens:t=[],detectedTokens:r=[]})=>{this.tokenAddresses=e.map((e=>e.address)),this.hiddenTokens=t,this.detectedTokens=[]}))}async _getTokenBalances(e){const t=this.web3.eth.contract(o.default).at(i.SINGLE_CALL_BALANCES_ADDRESS);return new Promise(((r,s)=>{t.balances([this.selectedAddress],e,((e,t)=>e?s(e):r(t)))}))}async detectNewTokens(){if(!this.isActive)return;const{tokenList:e}=this._tokenList.state;if(this._network.store.getState().provider.chainId!==l.MAINNET_CHAIN_ID||0===Object.keys(e).length)return;const t=[];this.web3.setProvider(this._network._provider);for(const r in e)this.tokenAddresses.find((e=>(0,d.isEqualCaseInsensitive)(e,r)))||this.hiddenTokens.find((e=>(0,d.isEqualCaseInsensitive)(e,r)))||this.detectedTokens.find((({address:e})=>(0,d.isEqualCaseInsensitive)(e,r)))||t.push(r);const r=[t.slice(0,1e3),t.slice(1e3,t.length-1)];for(const t of r){let r;try{r=await this._getTokenBalances(t)}catch(e){return void(0,a.warn)("MetaMask - DetectTokensController single call balance fetch failed",e)}let s=[];s=t.filter(((e,t)=>{const s=r[t];return s&&!s.isZero()})),await Promise.all(s.map((t=>this.tokensController.addToken(t,e[t].symbol,e[t].decimals))))}}restartTokenDetection(){this.isActive&&this.selectedAddress&&(this.detectNewTokens(),this.interval=u)}set interval(e){this._handle&&clearInterval(this._handle),e&&(this._handle=setInterval((()=>{this.detectNewTokens()}),e))}set network(e){e&&(this._network=e,this.web3=new n.default(e._provider))}set keyringMemStore(e){e&&(this._keyringMemStore=e,this._keyringMemStore.subscribe((({isUnlocked:e})=>{this.isUnlocked!==e&&(this.isUnlocked=e,e&&this.restartTokenDetection())})))}set tokenList(e){e&&(this._tokenList=e)}get isActive(){return this.isOpen&&this.isUnlocked}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/detect-tokens.js"}],[94,{"@babel/runtime/helpers/interopRequireDefault":213,"eth-keyring-controller":3116,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("eth-keyring-controller")),a=s(e("loglevel"));var o={async verifyAccounts(e,t){if(!e||e.length<1)throw new Error("No created accounts defined.");const r=new(new n.default({}).getKeyringClassForType("HD Key Tree"))({mnemonic:t,numberOfAccounts:e.length}),s=await r.getAccounts();if(a.default.debug(`Created accounts: ${JSON.stringify(e)}`),a.default.debug(`Restored accounts: ${JSON.stringify(s)}`),s.length!==e.length)throw new Error("Wrong number of accounts");for(let t=0;t<s.length;t++)if(s[t].toLowerCase()!==e[t].toLowerCase())throw new Error(`Not identical accounts! Original: ${e[t]}, Restored: ${s[t]}`)}};r.default=o}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/seed-phrase-verifier.js"}],[43,{"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/controllers":1080,"@metamask/obs-store":1237},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store"),o=e("@metamask/controllers");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class l extends a.ObservableStore{constructor({config:e,controllerMessenger:t,state:r,persist:s}){super(r),(0,n.default)(this,"config",{}),this.persist=s,this.controllerMessenger=t,e&&this.updateStructure(e)}updateStructure(e){this.config=e,this.removeAllListeners();for(const t of Object.keys(e)){if(!e[t])throw new Error(`Undefined '${t}'`);const r=e[t];r.subscribe?e[t].subscribe((e=>{this.updateState({[t]:e})})):this.controllerMessenger.subscribe(`${r.name}:stateChange`,(r=>{let s=r;this.persist&&(s=(0,o.getPersistentState)(r,e[t].metadata)),this.updateState({[t]:s})}))}}getFlatState(){if(!this.config)return{};let e={};for(const t of Object.keys(this.config)){const r=this.config[t],s=r.getState?r.getState():r.state;e=c(c({},e),s)}return e}}r.default=l}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/ComposableObservableStore.js"}],[47,{"@babel/runtime/helpers/interopRequireDefault":213,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,s){s((s=>{r.error&&n.default.error("Error in RPC response:\n",r),t.isMetamaskInternal||(n.default.info(`RPC (${e.origin}):`,t,"->",r),s())}))}};var n=s(e("loglevel"))}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/createLoggerMiddleware.js"}],[95,{"../../../shared/constants/time":6907,"@babel/runtime/helpers/interopRequireDefault":213,_process:6127,"analytics-node":2065},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.segment=r.createSegmentMock=void 0;var n,a,o=s(e("analytics-node")),i=e("../../../shared/constants/time");const c=null!==(n="NXLxrQVTKrWL23nm57fBQycLAcETRw9a")?n:null,l=null!==(a=t.env.SEGMENT_HOST)&&void 0!==a?a:null,d=5*i.SECOND,u=(e=1)=>{const t={queue:[],flush(){t.queue.forEach((([e,t])=>{t()})),t.queue=[]},track(r,s=(()=>undefined)){t.queue.push([r,s]),t.queue.length>=e&&t.flush()},page(){},identify(){}};return t};r.createSegmentMock=u;const h=c?new o.default(c,{host:l,flushAt:1,flushInterval:d}):u(1);r.segment=h}).call(this)}).call(this,e("_process"))}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/segment.js"}],[11,{"../../../../shared/constants/network":6904,"../../../../shared/modules/hexstring-utils":6914,"./ens":10,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,loglevel:5876,"punycode/punycode":6227},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("punycode/punycode")),o=e("@metamask/obs-store"),i=s(e("loglevel")),c=e("../../../../shared/constants/network"),l=e("../../../../shared/modules/hexstring-utils"),d=s(e("./ens"));function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor({ens:e,provider:t,onNetworkDidChange:r,getCurrentChainId:s}={}){const n={ensResolutionsByAddress:{}};if(this._ens=e,!this._ens){const e=s(),r=c.CHAIN_ID_TO_NETWORK_ID_MAP[e];d.default.getNetworkEnsSupport(r)&&(this._ens=new d.default({network:r,provider:t}))}this.store=new o.ObservableStore(n),r((()=>{this.store.putState(n);const e=s(),r=c.CHAIN_ID_TO_NETWORK_ID_MAP[e];d.default.getNetworkEnsSupport(r)?this._ens=new d.default({network:r,provider:t}):delete this._ens}))}reverseResolveAddress(e){return this._reverseResolveAddress((0,l.toChecksumHexAddress)(e))}async _reverseResolveAddress(e){if(!this._ens)return undefined;const t=this.store.getState();if(t.ensResolutionsByAddress[e])return t.ensResolutionsByAddress[e];let r,s;try{r=await this._ens.reverse(e)}catch(e){return i.default.debug(e),undefined}try{s=await this._ens.lookup(r)}catch(e){return i.default.debug(e),undefined}return"0x0000000000000000000000000000000000000000"===s||"0x"===s||(0,l.toChecksumHexAddress)(s)!==e?undefined:(this._updateResolutionsByAddress(e,a.default.toASCII(r)),r)}_updateResolutionsByAddress(e,t){const r=this.store.getState();this.store.putState({ensResolutionsByAddress:h(h({},r.ensResolutionsByAddress),{},{[e]:t})})}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/ens/index.js"}],[29,{"./background-api":26,"./caveat-mutators":27,"./enums":28,"./permission-log":30,"./selectors":31,"./specifications":32},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var s=e("./caveat-mutators");Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===s[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}}))}));var n=e("./background-api");Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}}))}));var a=e("./enums");Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}}))}));var o=e("./permission-log");Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===o[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}}))}));var i=e("./specifications");Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===i[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}}))}));var c=e("./selectors");Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===c[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return c[e]}}))}))}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/permissions/index.js"}],[17,{"./CollectibleDetectionController":15,"./CollectiblesController":16,"@babel/runtime/helpers/interopRequireDefault":213},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"MisesCollectibleDetectionController",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(r,"MisesCollectiblesController",{enumerable:!0,get:function(){return n.default}});var n=s(e("./CollectiblesController")),a=s(e("./CollectibleDetectionController"))}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/misesCollectibles/index.js"}],[36,{"../../../../shared/constants/gas":6900,"../../../../shared/constants/network":6904,"../../../../shared/constants/transaction":6908,"../../../../shared/modules/conversion.utils":6911,"../../../../shared/modules/transaction.utils":6920,"../../../../ui/helpers/constants/error-keys":7440,"../../../../ui/helpers/constants/transactions":7445,"../../../../ui/helpers/utils/conversions.util":7459,"../../../../ui/pages/swaps/swaps.util":7830,"../../lib/cleanErrorStack":46,"../../lib/util":99,"../../metamask-controller":100,"./lib/util":38,"./pending-tx-tracker":39,"./tx-gas-utils":40,"./tx-state-manager":41,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@ethereumjs/common":439,"@ethereumjs/tx":443,"@metamask/obs-store":1237,"bignumber.js":2348,"eth-rpc-errors":3129,"ethereumjs-util":3195,"ethjs-query":3244,lodash:5866,loglevel:5876,"nonce-tracker":5992,"safe-event-emitter":6451},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("safe-event-emitter")),o=e("@metamask/obs-store"),i=e("ethereumjs-util"),c=s(e("ethjs-query")),l=e("eth-rpc-errors"),d=s(e("@ethereumjs/common")),u=e("@ethereumjs/tx"),h=s(e("nonce-tracker")),p=s(e("loglevel")),m=s(e("bignumber.js")),f=e("lodash"),g=s(e("../../lib/cleanErrorStack")),b=e("../../lib/util"),v=e("../../../../ui/helpers/constants/error-keys"),y=e("../../../../ui/pages/swaps/swaps.util"),T=e("../../../../ui/helpers/utils/conversions.util"),S=e("../../../../shared/constants/transaction"),k=e("../../../../ui/helpers/constants/transactions"),w=e("../../metamask-controller"),C=e("../../../../shared/constants/gas"),P=e("../../../../shared/modules/conversion.utils"),E=e("../../../../shared/constants/network"),_=e("../../../../shared/modules/transaction.utils"),M=s(e("./tx-state-manager")),O=s(e("./tx-gas-utils")),A=s(e("./pending-tx-tracker")),I=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=x(t);if(r&&r.has(e))return r.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(s,a,o):s[a]=e[a]}s.default=e,r&&r.set(e,s);return s}(e("./lib/util"));function x(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(x=function(e){return e?r:t})(e)}function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const j=[S.TRANSACTION_TYPES.SWAP,S.TRANSACTION_TYPES.SWAP_APPROVAL],R="failed on-chain";class U extends a.default{constructor(e){super(),this.networkStore=e.networkStore||new o.ObservableStore({}),this._getCurrentChainId=e.getCurrentChainId,this.getProviderConfig=e.getProviderConfig,this._getCurrentNetworkEIP1559Compatibility=e.getCurrentNetworkEIP1559Compatibility,this._getCurrentAccountEIP1559Compatibility=e.getCurrentAccountEIP1559Compatibility,this.preferencesStore=e.preferencesStore||new o.ObservableStore({}),this.provider=e.provider,this.getPermittedAccounts=e.getPermittedAccounts,this.blockTracker=e.blockTracker,this.signEthTx=e.signTransaction,this.inProcessOfSigning=new Set,this._trackMetaMetricsEvent=e.trackMetaMetricsEvent,this._getParticipateInMetrics=e.getParticipateInMetrics,this._getEIP1559GasFeeEstimates=e.getEIP1559GasFeeEstimates,this.createEventFragment=e.createEventFragment,this.updateEventFragment=e.updateEventFragment,this.finalizeEventFragment=e.finalizeEventFragment,this.getEventFragmentById=e.getEventFragmentById,this.getDeviceModel=e.getDeviceModel,this.getAccountType=e.getAccountType,this.getTokenStandardAndDetails=e.getTokenStandardAndDetails,this.memStore=new o.ObservableStore({}),this.query=new c.default(this.provider),this.txGasUtil=new O.default(this.provider),this._mapMethods(),this.txStateManager=new M.default({initState:e.initState,txHistoryLimit:e.txHistoryLimit,getNetwork:this.getNetwork.bind(this),getCurrentChainId:e.getCurrentChainId}),this._onBootCleanUp(),this.store=this.txStateManager.store,this.nonceTracker=new h.default({provider:this.provider,blockTracker:this.blockTracker,getPendingTransactions:(...t)=>[...this.txStateManager.getPendingTransactions(...t),...e.getExternalPendingTransactions(...t)],getConfirmedTransactions:this.txStateManager.getConfirmedTransactions.bind(this.txStateManager)}),this.pendingTxTracker=new A.default({provider:this.provider,nonceTracker:this.nonceTracker,publishTransaction:e=>this.query.sendRawTransaction(e),getPendingTransactions:()=>[...this.txStateManager.getPendingTransactions(),...this.txStateManager.getApprovedTransactions()],approveTransaction:this.approveTransaction.bind(this),getCompletedTransactions:this.txStateManager.getConfirmedTransactions.bind(this.txStateManager)}),this.txStateManager.store.subscribe((()=>this.emit(w.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE))),this._setupListeners(),this._updateMemstore(),this.txStateManager.store.subscribe((()=>this._updateMemstore())),this.networkStore.subscribe((()=>{this._onBootCleanUp(),this._updateMemstore()})),this._updatePendingTxsAfterFirstBlock()}getChainId(){const e=this.networkStore.getState(),t=this._getCurrentChainId(),r=parseInt(t,16);return"loading"===e||Number.isNaN(r)?0:r}async getEIP1559Compatibility(e){const t=await this._getCurrentNetworkEIP1559Compatibility(),r=await this._getCurrentAccountEIP1559Compatibility(e);return t&&r}async getCommonConfiguration(e){const{type:t,nickname:r}=this.getProviderConfig(),s=await this.getEIP1559Compatibility(e)?E.HARDFORKS.LONDON:E.HARDFORKS.BERLIN;if(t!==E.NETWORK_TYPE_RPC)return new d.default({chain:t,hardfork:s});const n=parseInt(this._getCurrentChainId(),16),a=this.networkStore.getState(),o={name:r,chainId:n,networkId:"loading"===a?0:parseInt(a,10)};return d.default.forCustomChain(E.MAINNET,o,s)}addTransaction(e){this.txStateManager.addTransaction(e),this.emit(`${e.id}:unapproved`,e),this._trackTransactionMetricsEvent(e,S.TRANSACTION_EVENTS.ADDED)}wipeTransactions(e){this.txStateManager.wipeTransactions(e)}async newUnapprovedTransaction(e,t={}){p.default.debug(`MetaMaskController newUnapprovedTransaction ${JSON.stringify(e)}`);const r=await this.addUnapprovedTransaction(e,t.origin);return new Promise(((e,t)=>{this.txStateManager.once(`${r.id}:finished`,(r=>{switch(r.status){case S.TRANSACTION_STATUSES.SUBMITTED:return e(r.hash);case S.TRANSACTION_STATUSES.REJECTED:return t((0,g.default)(l.ethErrors.provider.userRejectedRequest("MetaMask Tx Signature: User denied transaction signature.")));case S.TRANSACTION_STATUSES.FAILED:return t((0,g.default)(l.ethErrors.rpc.internal(r.err.message)));default:return t((0,g.default)(l.ethErrors.rpc.internal(`MetaMask Tx Signature: Unknown problem: ${JSON.stringify(r.txParams)}`)))}}))}))}_getTransaction(e){const{transactions:t}=this.store.getState();return t[e]}_isUnapprovedTransaction(e){return this.txStateManager.getTransaction(e).status===S.TRANSACTION_STATUSES.UNAPPROVED}_throwErrorIfNotUnapprovedTx(e,t){if(!this._isUnapprovedTransaction(e))throw new Error(`TransactionsController: Can only call ${t} on an unapproved transaction.\n         Current tx status: ${this.txStateManager.getTransaction(e).status}`)}_updateTransaction(e,t,r){const s=this.txStateManager.getTransaction(e),n=(0,f.merge)(s,t);this.txStateManager.updateTransaction(n,r)}updatePreviousGasParams(e,{maxFeePerGas:t,maxPriorityFeePerGas:r,gasLimit:s}){const n={previousGas:{maxFeePerGas:t,maxPriorityFeePerGas:r,gasLimit:s}};n.previousGas=(0,f.pickBy)(n.previousGas);const a=`Update Previous Gas for ${e}`;return this._updateTransaction(e,n,a),this._getTransaction(e)}updateEditableParams(e,{data:t,from:r,to:s,value:n,gas:a,gasPrice:o}){this._throwErrorIfNotUnapprovedTx(e,"updateEditableParams");const i={txParams:{data:t,from:r,to:s,value:n,gas:a,gasPrice:o}};i.txParams=(0,f.pickBy)(i.txParams);const c=`Update Editable Params for ${e}`;return this._updateTransaction(e,i,c),this._getTransaction(e)}updateTransactionGasFees(e,{gas:t,gasLimit:r,gasPrice:s,maxPriorityFeePerGas:n,maxFeePerGas:a,estimateUsed:o,estimateSuggested:i,defaultGasEstimates:c,originalGasEstimate:l,userEditedGasLimit:d,userFeeLevel:u}){this._throwErrorIfNotUnapprovedTx(e,"updateTransactionGasFees");let h={txParams:{gas:t,gasLimit:r,gasPrice:s,maxPriorityFeePerGas:n,maxFeePerGas:a},estimateUsed:o,estimateSuggested:i,defaultGasEstimates:c,originalGasEstimate:l,userEditedGasLimit:d,userFeeLevel:u};h.txParams=(0,f.pickBy)(h.txParams),h=(0,f.pickBy)(h);const p=`Update Transaction Gas Fees for ${e}`;return this._updateTransaction(e,h,p),this._getTransaction(e)}updateTransactionEstimatedBaseFee(e,{estimatedBaseFee:t,decEstimatedBaseFee:r}){this._throwErrorIfNotUnapprovedTx(e,"updateTransactionEstimatedBaseFee");let s={estimatedBaseFee:t,decEstimatedBaseFee:r};s=(0,f.pickBy)(s);const n=`Update Transaction Estimated Base Fees for ${e}`;return this._updateTransaction(e,s,n),this._getTransaction(e)}updateSwapApprovalTransaction(e,{type:t,sourceTokenSymbol:r}){this._throwErrorIfNotUnapprovedTx(e,"updateSwapApprovalTransaction");let s={type:t,sourceTokenSymbol:r};s=(0,f.pickBy)(s);const n=`Update Swap Approval Transaction for ${e}`;return this._updateTransaction(e,s,n),this._getTransaction(e)}updateSwapTransaction(e,{sourceTokenSymbol:t,destinationTokenSymbol:r,type:s,destinationTokenDecimals:n,destinationTokenAddress:a,swapMetaData:o,swapTokenValue:i,estimatedBaseFee:c,approvalTxId:l}){this._throwErrorIfNotUnapprovedTx(e,"updateSwapTransaction");let d={sourceTokenSymbol:t,destinationTokenSymbol:r,type:s,destinationTokenDecimals:n,destinationTokenAddress:a,swapMetaData:o,swapTokenValue:i,estimatedBaseFee:c,approvalTxId:l};d=(0,f.pickBy)(d);const u=`Update Swap Transaction for ${e}`;return this._updateTransaction(e,d,u),this._getTransaction(e)}updateTransactionUserSettings(e,{userEditedGasLimit:t,userFeeLevel:r}){this._throwErrorIfNotUnapprovedTx(e,"updateTransactionUserSettings");let s={userEditedGasLimit:t,userFeeLevel:r};s=(0,f.pickBy)(s);const n=`Update User Settings for ${e}`;return this._updateTransaction(e,s,n),this._getTransaction(e)}async addUnapprovedTransaction(e,t,r){if(r!==undefined&&!j.includes(r))throw new Error(`TransactionController - invalid transactionType value: ${r}`);const s=I.normalizeTxParams(e),n=await this.getEIP1559Compatibility();I.validateTxParams(s,n);let a=this.txStateManager.generateTxMeta({txParams:s,origin:t});if("metamask"===t){if(s.from!==this.getSelectedAddress())throw l.ethErrors.rpc.internal({message:"Internally initiated transaction is using invalid account.",data:{origin:t,fromAddress:s.from,selectedAddress:this.getSelectedAddress()}})}else{if(!(await this.getPermittedAccounts(t)).includes(s.from))throw l.ethErrors.provider.unauthorized({data:{origin:t}})}const{type:o,getCodeResponse:i}=await(0,_.determineTransactionType)(e,this.query);a.type=r||o,a.txParams.value=a.txParams.value?(0,b.addHexPrefix)(a.txParams.value):"0x0",this.addTransaction(a),this.emit("newUnapprovedTx",a);try{a=await this.addTxGasDefaults(a,i)}catch(e){throw p.default.warn(e),a=this.txStateManager.getTransaction(a.id),a.loadingDefaults=!1,this.txStateManager.updateTransaction(a,"Failed to calculate gas defaults."),e}return a.loadingDefaults=!1,this.txStateManager.updateTransaction(a,"Added new unapproved transaction."),a}async addTxGasDefaults(e,t){const r=e.txParams.type!==S.TRANSACTION_ENVELOPE_TYPES.LEGACY&&await this.getEIP1559Compatibility(),{gasPrice:s,maxFeePerGas:n,maxPriorityFeePerGas:a}=await this._getDefaultGasFees(e,r),{gasLimit:o,simulationFails:i}=await this._getDefaultGasLimit(e,t);if(e=this.txStateManager.getTransaction(e.id),i&&(e.simulationFails=i),r){const{eip1559V2Enabled:t}=this.preferencesStore.getState(),r=this.getAdvancedGasFee();t&&Boolean(r)&&!j.includes(e.type)?(e.userFeeLevel=C.CUSTOM_GAS_ESTIMATE,e.txParams.maxFeePerGas=(0,P.decGWEIToHexWEI)(r.maxBaseFee),e.txParams.maxPriorityFeePerGas=(0,P.decGWEIToHexWEI)(r.priorityFee)):!e.txParams.gasPrice||e.txParams.maxFeePerGas||e.txParams.maxPriorityFeePerGas?(n&&a&&!e.txParams.maxFeePerGas&&!e.txParams.maxPriorityFeePerGas||"metamask"===e.origin?e.userFeeLevel=C.GAS_RECOMMENDATIONS.MEDIUM:e.userFeeLevel=t?C.PRIORITY_LEVELS.DAPP_SUGGESTED:C.CUSTOM_GAS_ESTIMATE,n&&!e.txParams.maxFeePerGas&&(e.txParams.maxFeePerGas=n),a&&!e.txParams.maxPriorityFeePerGas&&(e.txParams.maxPriorityFeePerGas=a),s&&!e.txParams.maxFeePerGas&&(e.txParams.maxFeePerGas=s),e.txParams.maxFeePerGas&&!e.txParams.maxPriorityFeePerGas&&(e.txParams.maxPriorityFeePerGas=e.txParams.maxFeePerGas)):(e.txParams.maxFeePerGas=e.txParams.gasPrice,e.txParams.maxPriorityFeePerGas=e.txParams.gasPrice,t&&"metamask"!==e.origin?e.userFeeLevel=C.PRIORITY_LEVELS.DAPP_SUGGESTED:e.userFeeLevel=C.CUSTOM_GAS_ESTIMATE),delete e.txParams.gasPrice}else delete e.txParams.maxPriorityFeePerGas,delete e.txParams.maxFeePerGas;return!s||e.txParams.gasPrice||e.txParams.maxPriorityFeePerGas||e.txParams.maxFeePerGas||(e.txParams.gasPrice=s),o&&!e.txParams.gas&&(e.txParams.gas=o,e.originalGasEstimate=o),e.defaultGasEstimates={estimateType:e.userFeeLevel,gas:e.txParams.gas,gasPrice:e.txParams.gasPrice,maxFeePerGas:e.txParams.maxFeePerGas,maxPriorityFeePerGas:e.txParams.maxPriorityFeePerGas},e}async _getDefaultGasFees(e,t){if(!t&&e.txParams.gasPrice||t&&e.txParams.maxFeePerGas&&e.txParams.maxPriorityFeePerGas)return{};try{const{gasFeeEstimates:e,gasEstimateType:r}=await this._getEIP1559GasFeeEstimates();if(t&&r===C.GAS_ESTIMATE_TYPES.FEE_MARKET){const{medium:{suggestedMaxPriorityFeePerGas:t,suggestedMaxFeePerGas:r}={}}=e;if(t&&r)return{maxFeePerGas:(0,P.decGWEIToHexWEI)(r),maxPriorityFeePerGas:(0,P.decGWEIToHexWEI)(t)}}else{if(r===C.GAS_ESTIMATE_TYPES.LEGACY)return{gasPrice:(0,P.decGWEIToHexWEI)(e.medium)};if(r===C.GAS_ESTIMATE_TYPES.ETH_GASPRICE)return{gasPrice:(0,P.decGWEIToHexWEI)(e.gasPrice)}}}catch(e){console.error(e)}const r=await this.query.gasPrice();return{gasPrice:r&&(0,b.addHexPrefix)(r.toString(16))}}async _getDefaultGasLimit(e,t){const r=this._getCurrentChainId(),s=E.CHAIN_ID_TO_GAS_LIMIT_BUFFER_MAP[r],n=(0,b.getChainType)(r);if(e.txParams.gas)return{};if(e.txParams.to&&e.type===S.TRANSACTION_TYPES.SIMPLE_SEND&&"custom"!==n){if(e.txParams.data){const e=new Error("TxGasUtil - Trying to call a function on a non-contract address");throw e.errorKey=v.TRANSACTION_NO_CONTRACT_ERROR_KEY,e.getCodeResponse=t,e}return{gasLimit:C.GAS_LIMITS.SIMPLE}}const{blockGasLimit:a,estimatedGasHex:o,simulationFails:i}=await this.txGasUtil.analyzeGasUsage(e);return{gasLimit:this.txGasUtil.addGasBuffer((0,b.addHexPrefix)(o),a,s),simulationFails:i}}generateNewGasParams(e,t={},r=11){const{txParams:s}=e,n={},a={};var o;t.gasLimit&&(a.gas=null!==(o=null==t?void 0:t.gas)&&void 0!==o?o:C.GAS_LIMITS.SIMPLE);return t.estimateSuggested&&(a.estimateSuggested=t.estimateSuggested),t.estimateUsed&&(a.estimateUsed=t.estimateUsed),(0,_.isEIP1559Transaction)(e)?(n.maxFeePerGas=s.maxFeePerGas,n.maxPriorityFeePerGas=s.maxPriorityFeePerGas,a.maxFeePerGas=(null==t?void 0:t.maxFeePerGas)||(0,b.bnToHex)((0,b.BnMultiplyByFraction)((0,b.hexToBn)(s.maxFeePerGas),r,10)),a.maxPriorityFeePerGas=(null==t?void 0:t.maxPriorityFeePerGas)||(0,b.bnToHex)((0,b.BnMultiplyByFraction)((0,b.hexToBn)(s.maxPriorityFeePerGas),r,10))):(n.gasPrice=s.gasPrice,a.gasPrice=(null==t?void 0:t.gasPrice)||(0,b.bnToHex)((0,b.BnMultiplyByFraction)((0,b.hexToBn)(s.gasPrice),r,10))),{previousGasParams:n,newGasParams:a}}async createCancelTransaction(e,t,{estimatedBaseFee:r}={}){const s=this.txStateManager.getTransaction(e),{txParams:n}=s,{from:a,nonce:o}=n,{previousGasParams:i,newGasParams:c}=this.generateNewGasParams(s,D(D({},t),{},{gasLimit:t.gasLimit||C.GAS_LIMITS.SIMPLE})),l=this.txStateManager.generateTxMeta({txParams:D({from:a,to:a,nonce:o,value:"0x0"},c),previousGasParams:i,loadingDefaults:!1,status:S.TRANSACTION_STATUSES.APPROVED,type:S.TRANSACTION_TYPES.CANCEL});return r&&(l.estimatedBaseFee=r),this.addTransaction(l),await this.approveTransaction(l.id),l}async createSpeedUpTransaction(e,t,{estimatedBaseFee:r}={}){const s=this.txStateManager.getTransaction(e),{txParams:n}=s,{previousGasParams:a,newGasParams:o}=this.generateNewGasParams(s,t),i=this.txStateManager.generateTxMeta({txParams:D(D({},n),o),previousGasParams:a,loadingDefaults:!1,status:S.TRANSACTION_STATUSES.APPROVED,type:S.TRANSACTION_TYPES.RETRY});return r&&(i.estimatedBaseFee=r),this.addTransaction(i),await this.approveTransaction(i.id),i}async updateTransaction(e){this.txStateManager.updateTransaction(e,"confTx: user updated transaction")}async updateAndApproveTransaction(e){this.txStateManager.updateTransaction(e,"confTx: user approved transaction"),await this.approveTransaction(e.id)}async approveTransaction(e){if(this.inProcessOfSigning.has(e))return;let t;this.inProcessOfSigning.add(e);try{this.txStateManager.setTxStatusApproved(e);const r=this.txStateManager.getTransaction(e),s=r.txParams.from;let{customNonceValue:n}=r;n=Number(n),t=await this.nonceTracker.getNonceLock(s);const a=r.previousGasParams?r.txParams.nonce:t.nextNonce,o=0===n?n:n||a;r.txParams.nonce=(0,b.addHexPrefix)(o.toString(16)),r.nonceDetails=t.nonceDetails,n&&(r.nonceDetails.customNonceValue=n),this.txStateManager.updateTransaction(r,"transactions#approveTransaction");const i=await this.signTransaction(e);await this.publishTransaction(e,i),this._trackTransactionMetricsEvent(r,S.TRANSACTION_EVENTS.APPROVED),t.releaseLock()}catch(r){try{this._failTransaction(e,r)}catch(e){p.default.error(e)}throw t&&t.releaseLock(),r}finally{this.inProcessOfSigning.delete(e)}}async approveTransactionsWithSameNonce(e=[]){if(0===e.length)return"";const t=e[0],r=await this.getCommonConfiguration(t.from),s=u.TransactionFactory.fromTxData(t,{common:r}),n=(0,i.bufferToHex)(s.serialize());if(this.inProcessOfSigning.has(n))return"";let a,o;this.inProcessOfSigning.add(n);try{const r=t.from;o=await this.nonceTracker.getNonceLock(r);const s=o.nextNonce;a=await Promise.all(e.map((e=>(e.nonce=(0,b.addHexPrefix)(s.toString(16)),this.signExternalTransaction(e)))))}catch(e){throw p.default.error(e),e}finally{o&&o.releaseLock(),this.inProcessOfSigning.delete(n)}return a}async signExternalTransaction(e){const t=I.normalizeTxParams(e),r=this.getChainId(),s=(0,_.isEIP1559Transaction)({txParams:t})?S.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET:S.TRANSACTION_ENVELOPE_TYPES.LEGACY,n=D(D({},t),{},{type:s,gasLimit:t.gas,chainId:(0,b.addHexPrefix)((0,T.decimalToHex)(r))}),a=n.from,o=await this.getCommonConfiguration(a),c=u.TransactionFactory.fromTxData(n,{common:o}),l=await this.signEthTx(c,a);return(0,i.bufferToHex)(l.serialize())}async signTransaction(e){const t=this.txStateManager.getTransaction(e),r=this.getChainId(),s=(0,_.isEIP1559Transaction)(t)?S.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET:S.TRANSACTION_ENVELOPE_TYPES.LEGACY,n=D(D({},t.txParams),{},{type:s,chainId:r,gasLimit:t.txParams.gas}),a=n.from,o=await this.getCommonConfiguration(n.from),c=u.TransactionFactory.fromTxData(n,{common:o}),l=await this.signEthTx(c,a);t.r=(0,i.bufferToHex)(l.r),t.s=(0,i.bufferToHex)(l.s),t.v=(0,i.bufferToHex)(l.v),this.txStateManager.updateTransaction(t,"transactions#signTransaction: add r, s, v values"),this.txStateManager.setTxStatusSigned(t.id);return(0,i.bufferToHex)(l.serialize())}async publishTransaction(e,t){const r=this.txStateManager.getTransaction(e);if(r.rawTx=t,r.type===S.TRANSACTION_TYPES.SWAP){const e=await this.query.getBalance(r.txParams.from);r.preTxBalance=e.toString(16)}let s;this.txStateManager.updateTransaction(r,"transactions#publishTransaction");try{s=await this.query.sendRawTransaction(t)}catch(e){if(!e.message.toLowerCase().includes("known transaction"))throw e;s=(0,i.keccak)((0,i.toBuffer)((0,b.addHexPrefix)(t),"hex")).toString("hex"),s=(0,b.addHexPrefix)(s)}this.setTxHash(e,s),this.txStateManager.setTxStatusSubmitted(e),this._trackTransactionMetricsEvent(r,S.TRANSACTION_EVENTS.SUBMITTED)}async confirmTransaction(e,t,r,s){const n=this.txStateManager.getTransaction(e);if(n)try{const a=I.normalizeTxReceiptGasUsed(t.gasUsed);n.txReceipt=D(D({},t),{},{gasUsed:a}),r&&(n.baseFeePerGas=r),s&&(n.blockTimestamp=s),this.txStateManager.setTxStatusConfirmed(e),this._markNonceDuplicatesDropped(e);const{submittedTime:o}=n,i={gas_used:a};if(o&&(i.completion_time=this._getTransactionCompletionTime(o)),"0x0"===t.status&&(i.status=R),this._trackTransactionMetricsEvent(n,S.TRANSACTION_EVENTS.FINALIZED,i),this.txStateManager.updateTransaction(n,"transactions#confirmTransaction - add txReceipt"),n.type===S.TRANSACTION_TYPES.SWAP){const t=await this.query.getBalance(n.txParams.from),r=this.txStateManager.getTransaction(e),s=r.approvalTxId?this.txStateManager.getTransaction(r.approvalTxId):null;r.postTxBalance=t.toString(16),this.txStateManager.updateTransaction(r,"transactions#confirmTransaction - add postTxBalance"),this._trackSwapsMetrics(r,s)}}catch(e){p.default.error(e)}}async confirmExternalTransaction(e,t,r){if(await this.txStateManager.addExternalTransaction(e),!e)return;const s=e.id;try{const n=I.normalizeTxReceiptGasUsed(t.gasUsed);e.txReceipt=D(D({},t),{},{gasUsed:n}),r&&(e.baseFeePerGas=r),this.txStateManager.setTxStatusConfirmed(s),this._markNonceDuplicatesDropped(s);const{submittedTime:a}=e,o={gas_used:n};if(a&&(o.completion_time=this._getTransactionCompletionTime(a)),"0x0"===t.status&&(o.status=R),this._trackTransactionMetricsEvent(e,S.TRANSACTION_EVENTS.FINALIZED,o),this.txStateManager.updateTransaction(e,"transactions#confirmTransaction - add txReceipt"),e.type===S.TRANSACTION_TYPES.SWAP){const t=await this.query.getBalance(e.txParams.from),r=this.txStateManager.getTransaction(s),n=r.approvalTxId?this.txStateManager.getTransaction(r.approvalTxId):null;r.postTxBalance=t.toString(16),this.txStateManager.updateTransaction(r,"transactions#confirmTransaction - add postTxBalance"),this._trackSwapsMetrics(r,n)}}catch(e){p.default.error(e)}}async cancelTransaction(e){const t=this.txStateManager.getTransaction(e);this.txStateManager.setTxStatusRejected(e),this._trackTransactionMetricsEvent(t,S.TRANSACTION_EVENTS.REJECTED)}setTxHash(e,t){const r=this.txStateManager.getTransaction(e);r.hash=t,this.txStateManager.updateTransaction(r,"transactions#setTxHash")}async createTransactionEventFragment(e,t){const r=this.txStateManager.getTransaction(e),{properties:s,sensitiveProperties:n}=await this._buildEventFragmentProperties(r);this._createTransactionEventFragment(r,t,s,n)}_mapMethods(){this.getState=()=>this.memStore.getState(),this.getNetwork=()=>this.networkStore.getState(),this.getSelectedAddress=()=>this.preferencesStore.getState().selectedAddress,this.getUnapprovedTxCount=()=>Object.keys(this.txStateManager.getUnapprovedTxList()).length,this.getPendingTxCount=e=>this.txStateManager.getPendingTransactions(e).length,this.getTransactions=e=>this.txStateManager.getTransactions(e),this.getAdvancedGasFee=()=>this.preferencesStore.getState().advancedGasFee}async _updatePendingTxsAfterFirstBlock(){await this.blockTracker.getLatestBlock(),await this.pendingTxTracker.updatePendingTxs()}_onBootCleanUp(){this.txStateManager.getTransactions({searchCriteria:{status:S.TRANSACTION_STATUSES.UNAPPROVED,loadingDefaults:!0}}).forEach((e=>{this.addTxGasDefaults(e).then((e=>{e.loadingDefaults=!1,this.txStateManager.updateTransaction(e,"transactions: gas estimation for tx on boot")})).catch((t=>{const r=this.txStateManager.getTransaction(e.id);r.loadingDefaults=!1,this.txStateManager.updateTransaction(r,"failed to estimate gas during boot cleanup."),this._failTransaction(r.id,t)}))})),this.txStateManager.getTransactions({searchCriteria:{status:S.TRANSACTION_STATUSES.APPROVED}}).forEach((e=>{const t=new Error('Transaction found as "approved" during boot - possibly stuck during signing');this._failTransaction(e.id,t)}))}_setupListeners(){this.txStateManager.on("tx:status-update",this.emit.bind(this,"tx:status-update")),this._setupBlockTrackerListener(),this.pendingTxTracker.on("tx:warning",(e=>{this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:warning")})),this.pendingTxTracker.on("tx:failed",((e,t)=>{this._failTransaction(e,t)})),this.pendingTxTracker.on("tx:confirmed",((e,t,r,s)=>this.confirmTransaction(e,t,r,s))),this.pendingTxTracker.on("tx:dropped",(e=>{this._dropTransaction(e)})),this.pendingTxTracker.on("tx:block-update",((e,t)=>{e.firstRetryBlockNumber||(e.firstRetryBlockNumber=t,this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:block-update"))})),this.pendingTxTracker.on("tx:retry",(e=>{"retryCount"in e||(e.retryCount=0),e.retryCount+=1,this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:retry")}))}_markNonceDuplicatesDropped(e){const t=this.txStateManager.getTransaction(e),{nonce:r,from:s}=t.txParams,n=this.txStateManager.getTransactions({searchCriteria:{nonce:r,from:s}});n.length&&n.forEach((r=>{r.id!==e&&(r.replacedBy=t.hash,this.txStateManager.updateTransaction(t,"transactions/pending-tx-tracker#event: tx:confirmed reference to confirmed txHash with same nonce"),this._dropTransaction(r.id))}))}_setupBlockTrackerListener(){let e=!1;const t=this._onLatestBlock.bind(this),{blockTracker:r,txStateManager:s}=this;function n(){const n=s.getPendingTransactions();!e&&n.length>0?(r.on("latest",t),e=!0):e&&!n.length&&(r.removeListener("latest",t),e=!1)}s.on("tx:status-update",n),n()}async _onLatestBlock(e){try{await this.pendingTxTracker.updatePendingTxs()}catch(e){p.default.error(e)}try{await this.pendingTxTracker.resubmitPendingTxs(e)}catch(e){p.default.error(e)}}_updateMemstore(){const e=this.txStateManager.getUnapprovedTxList(),t=this.txStateManager.getTransactions({limit:100});this.memStore.updateState({unapprovedTxs:e,currentNetworkTxList:t})}_trackSwapsMetrics(e,t){if(this._getParticipateInMetrics()&&e.swapMetaData)if("0x0"===e.txReceipt.status)this._trackMetaMetricsEvent({event:"Swap Failed",sensitiveProperties:D({},e.swapMetaData),category:"swaps"});else{const r=(0,y.getSwapsTokensReceivedFromTxMeta)(e.destinationTokenSymbol,e,e.destinationTokenAddress,e.txParams.from,e.destinationTokenDecimals,t,e.chainId),s=r?`${new m.default(r,10).div(e.swapMetaData.token_to_amount,10).times(100).round(2)}%`:null,n=e.txReceipt.gasUsed&&e.swapMetaData.estimated_gas?`${new m.default(e.txReceipt.gasUsed,16).div(e.swapMetaData.estimated_gas,10).times(100).round(2)}%`:null;this._trackMetaMetricsEvent({event:"Swap Completed",category:"swaps",sensitiveProperties:D(D({},e.swapMetaData),{},{token_to_amount_received:r,quote_vs_executionRatio:s,estimated_vs_used_gasRatio:n})})}}async _buildEventFragmentProperties(e,t){const{type:r,time:s,status:n,chainId:a,origin:o,txParams:{gasPrice:i,gas:c,maxFeePerGas:l,maxPriorityFeePerGas:d,estimateSuggested:u,estimateUsed:h},defaultGasEstimates:p,metamaskNetworkId:m}=e,f="metamask"===o?"user":"dapp",{assetType:g,tokenStandard:b}=await(0,_.determineTransactionAssetType)(e,this.query,this.getTokenStandardAndDetails),v={};if((0,_.isEIP1559Transaction)(e)?(v.max_fee_per_gas=l,v.max_priority_fee_per_gas=d):v.gas_price=i,p){const{estimateType:t}=p;if(t){v.default_estimate=t;let r=e.defaultGasEstimates.maxFeePerGas,s=e.defaultGasEstimates.maxPriorityFeePerGas;if([C.GAS_RECOMMENDATIONS.LOW,C.GAS_RECOMMENDATIONS.MEDIUM,C.GAS_RECOMMENDATIONS.MEDIUM.HIGH].includes(t)){var y,T;const{gasFeeEstimates:e}=await this._getEIP1559GasFeeEstimates();var S,w;if(null!=e&&null!==(y=e[t])&&void 0!==y&&y.suggestedMaxFeePerGas)r=null===(S=e[t])||void 0===S?void 0:S.suggestedMaxFeePerGas,v.default_max_fee_per_gas=r;if(null!=e&&null!==(T=e[t])&&void 0!==T&&T.suggestedMaxPriorityFeePerGas)s=null===(w=e[t])||void 0===w?void 0:w.suggestedMaxPriorityFeePerGas,v.default_max_priority_fee_per_gas=s}}e.defaultGasEstimates.gas&&(v.default_gas=e.defaultGasEstimates.gas),e.defaultGasEstimates.gasPrice&&(v.default_gas_price=e.defaultGasEstimates.gasPrice)}u&&(v.estimate_suggested=u),h&&(v.estimate_used=h);const P=this._getGasValuesInGWEI(v);let E="0";if(e.txParams.maxFeePerGas){const{eip1559V2Enabled:e}=this.preferencesStore.getState();E=e?"2":"1"}return{properties:{chain_id:a,referrer:o,source:f,network:m,type:r,eip_1559_version:E,gas_edit_type:"none",gas_edit_attempted:"none",account_type:await this.getAccountType(this.getSelectedAddress()),device_model:await this.getDeviceModel(this.getSelectedAddress()),asset_type:g,token_standard:b},sensitiveProperties:D(D({status:n,transaction_envelope_type:(0,_.isEIP1559Transaction)(e)?k.TRANSACTION_ENVELOPE_TYPE_NAMES.FEE_MARKET:k.TRANSACTION_ENVELOPE_TYPE_NAMES.LEGACY,first_seen:s,gas_limit:c},P),t)}}_createTransactionEventFragment(e,t,r,s){const n=`transaction-${[S.TRANSACTION_EVENTS.FINALIZED,S.TRANSACTION_EVENTS.SUBMITTED].includes(t)?"submitted":"added"}-${e.id}`;if(void 0===this.getEventFragmentById(n))switch(t){case S.TRANSACTION_EVENTS.ADDED:this.createEventFragment({category:"Transactions",initialEvent:S.TRANSACTION_EVENTS.ADDED,successEvent:S.TRANSACTION_EVENTS.APPROVED,failureEvent:S.TRANSACTION_EVENTS.REJECTED,properties:r,sensitiveProperties:s,persist:!0,uniqueIdentifier:n});break;case S.TRANSACTION_EVENTS.APPROVED:case S.TRANSACTION_EVENTS.REJECTED:this.createEventFragment({category:"Transactions",successEvent:S.TRANSACTION_EVENTS.APPROVED,failureEvent:S.TRANSACTION_EVENTS.REJECTED,properties:r,sensitiveProperties:s,persist:!0,uniqueIdentifier:n});break;case S.TRANSACTION_EVENTS.SUBMITTED:this.createEventFragment({category:"Transactions",initialEvent:S.TRANSACTION_EVENTS.SUBMITTED,successEvent:S.TRANSACTION_EVENTS.FINALIZED,properties:r,sensitiveProperties:s,persist:!0,uniqueIdentifier:n});break;case S.TRANSACTION_EVENTS.FINALIZED:this.createEventFragment({category:"Transactions",successEvent:S.TRANSACTION_EVENTS.FINALIZED,properties:r,sensitiveProperties:s,persist:!0,uniqueIdentifier:n})}}async _trackTransactionMetricsEvent(e,t,r={}){if(!e)return;const{properties:s,sensitiveProperties:n}=await this._buildEventFragmentProperties(e,r);let a;switch(this._createTransactionEventFragment(e,t,s,n),t){case S.TRANSACTION_EVENTS.APPROVED:a=`transaction-added-${e.id}`,this.updateEventFragment(a,{properties:s,sensitiveProperties:n}),this.finalizeEventFragment(a);break;case S.TRANSACTION_EVENTS.REJECTED:a=`transaction-added-${e.id}`,this.updateEventFragment(a,{properties:s,sensitiveProperties:n}),this.finalizeEventFragment(a,{abandoned:!0});break;case S.TRANSACTION_EVENTS.FINALIZED:a=`transaction-submitted-${e.id}`,this.updateEventFragment(a,{properties:s,sensitiveProperties:n}),this.finalizeEventFragment(`transaction-submitted-${e.id}`)}}_getTransactionCompletionTime(e){return Math.round((Date.now()-e)/1e3).toString()}_getGasValuesInGWEI(e){const t={};for(const r in e)(0,i.isHexString)(e[r])?t[r]=(0,T.hexWEIToDecGWEI)(e[r]):t[r]=e[r];return t}_failTransaction(e,t){this.txStateManager.setTxStatusFailed(e,t);const r=this.txStateManager.getTransaction(e);this._trackTransactionMetricsEvent(r,S.TRANSACTION_EVENTS.FINALIZED,{error:t.message})}_dropTransaction(e){this.txStateManager.setTxStatusDropped(e);const t=this.txStateManager.getTransaction(e);this._trackTransactionMetricsEvent(t,S.TRANSACTION_EVENTS.FINALIZED)}}r.default=U}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/transactions/index.js"}],[44,{"../../../shared/constants/network":6904,"../constants/contracts":4,"./util":99,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,"eth-query":3125,loglevel:5876,pify:6121,"single-call-balance-checker-abi":6547,web3:6823},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("eth-query")),a=e("@metamask/obs-store"),o=s(e("loglevel")),i=s(e("pify")),c=s(e("web3")),l=s(e("single-call-balance-checker-abi")),d=e("../../../shared/constants/network"),u=e("../constants/contracts"),h=e("./util");r.default=class{constructor(e={}){this.store=new a.ObservableStore({accounts:{},currentBlockGasLimit:""}),this._provider=e.provider,this._query=(0,i.default)(new n.default(this._provider)),this._blockTracker=e.blockTracker,this._currentBlockNumber=this._blockTracker.getCurrentBlock(),this._blockTracker.once("latest",(e=>{this._currentBlockNumber=e})),this._updateForBlock=this._updateForBlock.bind(this),this.getCurrentChainId=e.getCurrentChainId,this.web3=new c.default(this._provider)}start(){this._blockTracker.removeListener("latest",this._updateForBlock),this._blockTracker.addListener("latest",this._updateForBlock),this._updateAccounts()}stop(){this._blockTracker.removeListener("latest",this._updateForBlock)}syncWithAddresses(e){const{accounts:t}=this.store.getState(),r=Object.keys(t),s=[];e.forEach((e=>{r.includes(e)||s.push(e)}));const n=[];r.forEach((t=>{e.includes(t)||n.push(t)})),this.addAccounts(s),this.removeAccount(n)}addAccounts(e){const{accounts:t}=this.store.getState();e.forEach((e=>{t[e]={}})),this.store.updateState({accounts:t}),this._currentBlockNumber&&this._updateAccounts()}removeAccount(e){const{accounts:t}=this.store.getState();e.forEach((e=>{delete t[e]})),this.store.updateState({accounts:t})}clearAccounts(){this.store.updateState({accounts:{}})}async _updateForBlock(e){this._currentBlockNumber=e;const t=await this._query.getBlockByNumber(e,!1);if(!t)return;const r=t.gasLimit;this.store.updateState({currentBlockGasLimit:r});try{await this._updateAccounts()}catch(e){o.default.error(e)}}async _updateAccounts(){const{accounts:e}=this.store.getState(),t=Object.keys(e);switch(this.getCurrentChainId()){case d.MAINNET_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,u.SINGLE_CALL_BALANCES_ADDRESS);break;case d.RINKEBY_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,u.SINGLE_CALL_BALANCES_ADDRESS_RINKEBY);break;case d.ROPSTEN_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,u.SINGLE_CALL_BALANCES_ADDRESS_ROPSTEN);break;case d.KOVAN_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,u.SINGLE_CALL_BALANCES_ADDRESS_KOVAN);break;default:await Promise.all(t.map(this._updateAccount.bind(this)))}}async _updateAccount(e){const t={address:e,balance:await this._query.getBalance(e)},{accounts:r}=this.store.getState();r[e]&&(r[e]=t,this.store.updateState({accounts:r}))}async _updateAccountsViaBalanceChecker(e,t){const{accounts:r}=this.store.getState();this.web3.setProvider(this._provider);this.web3.eth.contract(l.default).at(t).balances(e,["0x0"],((t,s)=>{if(t)return o.default.warn("MetaMask - Account Tracker single call balance fetch failed",t),void Promise.all(e.map(this._updateAccount.bind(this)));e.forEach(((e,t)=>{const n=s[t]?(0,h.bnToHex)(s[t]):"0x0";r[e]={address:e,balance:n}})),this.store.updateState({accounts:r})}))}}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/lib/account-tracker.js"}],[2,{"../lib/util":99,"@babel/runtime/helpers/interopRequireDefault":213,"ethereumjs-util":3195,"ethereumjs-wallet":3201,"ethereumjs-wallet/thirdparty":3216,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("loglevel")),a=s(e("ethereumjs-wallet")),o=s(e("ethereumjs-wallet/thirdparty")),i=e("ethereumjs-util"),c=e("../lib/util");var l={importAccount(e,t){try{const r=(0,this.strategies[e])(...t);return Promise.resolve(r)}catch(e){return Promise.reject(e)}},strategies:{"Private Key":e=>{if(!e)throw new Error("Cannot import an empty key.");const t=(0,c.addHexPrefix)(e),r=(0,i.toBuffer)(t);if(!(0,i.isValidPrivate)(r))throw new Error("Cannot import invalid private key.");return(0,i.stripHexPrefix)(t)},"JSON File":(e,t)=>{let r;try{r=o.default.fromEtherWallet(e,t)}catch(s){n.default.debug("Attempt to import as EtherWallet format failed, trying V3"),r=a.default.fromV3(e,t,!0)}return function(e){const t=e.getPrivateKey();return(0,i.bufferToHex)(t)}(r)}}};r.default=l}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/account-import-strategies/index.js"}],[21,{"./network":23},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"NETWORK_EVENTS",{enumerable:!0,get:function(){return s.NETWORK_EVENTS}}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s.default}});var s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=a?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(s,o,i):s[o]=e[o]}s.default=e,r&&r.set(e,s);return s}(e("./network"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/network/index.js"}],[34,{"../../../shared/constants/gas":6900,"../../../shared/constants/swaps":6906,"../../../shared/constants/time":6907,"../../../shared/modules/conversion.utils":6911,"../../../shared/modules/string-utils":6918,"../../../shared/modules/swaps.utils":6919,"../../../ui/helpers/utils/fetch-with-cache":7460,"../../../ui/helpers/utils/token-util":7475,"../../../ui/pages/send/send.utils":7719,"../../../ui/pages/swaps/swaps.util":7830,"./network":21,"@babel/runtime/helpers/defineProperty":207,"@babel/runtime/helpers/interopRequireDefault":213,"@metamask/obs-store":1237,"bignumber.js":2348,ethers:3219,"human-standard-token-abi":5075,lodash:5866,loglevel:5876},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.utils=r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("ethers"),o=s(e("loglevel")),i=s(e("bignumber.js")),c=e("@metamask/obs-store"),l=e("lodash"),d=s(e("human-standard-token-abi")),u=e("../../../ui/helpers/utils/token-util"),h=e("../../../ui/pages/send/send.utils"),p=e("../../../shared/modules/conversion.utils"),m=e("../../../shared/constants/swaps"),f=e("../../../shared/constants/gas"),g=e("../../../shared/modules/swaps.utils"),b=e("../../../ui/pages/swaps/swaps.util"),v=s(e("../../../ui/helpers/utils/fetch-with-cache")),y=e("../../../shared/constants/time"),T=e("../../../shared/modules/string-utils"),S=e("./network");function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const C=25e5,P=y.MINUTE,E=10*y.SECOND;function _(e=25e5,t=0,r=0){const s=new i.default(e,10).minus(t,10);return!s.lt(0)&&s.lt(r,16)?`0x${s.toString(16)}`:r}const M={swapsState:{quotes:{},quotesPollingLimitEnabled:!1,fetchParams:null,tokens:null,tradeTxId:null,approveTxId:null,quotesLastFetched:null,customMaxGas:"",customGasPrice:null,customMaxFeePerGas:null,customMaxPriorityFeePerGas:null,swapsUserFeeLevel:"",selectedAggId:null,customApproveTxData:"",errorKey:"",topAggId:null,routeState:"",swapsFeatureIsLive:!0,saveFetchedQuotes:!1,swapsQuoteRefreshTime:P,swapsQuotePrefetchingRefreshTime:P,swapsStxBatchStatusRefreshTime:E,swapsStxGetTransactionsRefreshTime:E,swapsFeatureFlags:{}}};function O(e){if(!Array.isArray(e)||0===e.length)throw new Error("Expected non-empty array param.");const t=[...e];if(t.sort(((e,t)=>{const r=new i.default(e.overallValueOfQuote,10),s=new i.default(t.overallValueOfQuote,10);return r.equals(s)?0:r.lessThan(s)?-1:1})),t.length%2==1){const e=t[(t.length-1)/2].overallValueOfQuote;return A(t.filter((t=>e===t.overallValueOfQuote)))}const r=t.length/2,s=r-1,n=t[r].overallValueOfQuote,a=t[s].overallValueOfQuote,o=t.filter((e=>n===e.overallValueOfQuote)),c=t.filter((e=>a===e.overallValueOfQuote)),l=A(o),d=A(c);return{ethFee:new i.default(l.ethFee,10).plus(d.ethFee,10).dividedBy(2).toString(10),metaMaskFeeInEth:new i.default(l.metaMaskFeeInEth,10).plus(d.metaMaskFeeInEth,10).dividedBy(2).toString(10),ethValueOfTokens:new i.default(l.ethValueOfTokens,10).plus(d.ethValueOfTokens,10).dividedBy(2).toString(10)}}function A(e){const t=e.reduce(((e,t)=>({ethFee:e.ethFee.plus(t.ethFee,10),metaMaskFeeInEth:e.metaMaskFeeInEth.plus(t.metaMaskFeeInEth,10),ethValueOfTokens:e.ethValueOfTokens.plus(t.ethValueOfTokens,10)})),{ethFee:new i.default(0,10),metaMaskFeeInEth:new i.default(0,10),ethValueOfTokens:new i.default(0,10)});return{ethFee:t.ethFee.div(e.length,10).toString(10),metaMaskFeeInEth:t.metaMaskFeeInEth.div(e.length,10).toString(10),ethValueOfTokens:t.ethValueOfTokens.div(e.length,10).toString(10)}}r.default=class{constructor({getBufferedGasLimit:e,networkController:t,provider:r,getProviderConfig:s,getTokenRatesState:n,fetchTradesInfo:o=b.fetchTradesInfo,getCurrentChainId:i,getEIP1559GasFeeEstimates:l}){this.store=new c.ObservableStore({swapsState:w({},M.swapsState)}),this._fetchTradesInfo=o,this._getCurrentChainId=i,this._getEIP1559GasFeeEstimates=l,this.getBufferedGasLimit=e,this.getTokenRatesState=n,this.pollCount=0,this.getProviderConfig=s,this.indexOfNewestCallInFlight=0,this.ethersProvider=new a.ethers.providers.Web3Provider(r),this._currentNetwork=t.store.getState().network,t.on(S.NETWORK_EVENTS.NETWORK_DID_CHANGE,(e=>{"loading"!==e&&e!==this._currentNetwork&&(this._currentNetwork=e,this.ethersProvider=new a.ethers.providers.Web3Provider(r))}))}async fetchSwapsRefreshRates(e){const t=await(0,v.default)((0,b.getBaseApi)("network",e),{method:"GET"},{cacheRefreshTime:6e5}),{refreshRates:r}=t||{};if(!r||"number"!=typeof r.quotes||"number"!=typeof r.quotesPrefetching)throw new Error(`MetaMask - invalid response for refreshRates: ${t}`);return{quotes:1e3*r.quotes,quotesPrefetching:1e3*r.quotesPrefetching,stxGetTransactions:1e3*r.stxGetTransactions,stxBatchStatus:1e3*r.stxBatchStatus,stxStatusDeadline:r.stxStatusDeadline}}async _setSwapsRefreshRates(){var e,t,r,s,n;const a=this._getCurrentChainId();let o;try{o=await this.fetchSwapsRefreshRates(a)}catch(e){console.error("Request for swaps quote refresh time failed: ",e)}const{swapsState:i}=this.store.getState();this.store.updateState({swapsState:w(w({},i),{},{swapsQuoteRefreshTime:(null===(e=o)||void 0===e?void 0:e.quotes)||P,swapsQuotePrefetchingRefreshTime:(null===(t=o)||void 0===t?void 0:t.quotesPrefetching)||P,swapsStxGetTransactionsRefreshTime:(null===(r=o)||void 0===r?void 0:r.stxGetTransactions)||E,swapsStxBatchStatusRefreshTime:(null===(s=o)||void 0===s?void 0:s.stxBatchStatus)||E,swapsStxStatusDeadline:(null===(n=o)||void 0===n?void 0:n.stxStatusDeadline)||180})})}pollForNewQuotes(){const{swapsState:{swapsQuoteRefreshTime:e,swapsQuotePrefetchingRefreshTime:t,quotesPollingLimitEnabled:r}}=this.store.getState(),s=r?e:t;this.pollingTimeout=setTimeout((()=>{var e;const{swapsState:t}=this.store.getState();this.fetchAndSetQuotes(t.fetchParams,null===(e=t.fetchParams)||void 0===e?void 0:e.metaData,!0)}),s)}stopPollingForQuotes(){this.pollingTimeout&&clearTimeout(this.pollingTimeout)}async fetchAndSetQuotes(e,t={},r){const{chainId:s}=t,{swapsState:{quotesPollingLimitEnabled:n,saveFetchedQuotes:a}}=this.store.getState();if(!e)return null;r||(this.pollCount=0),clearTimeout(this.pollingTimeout),r||this.setSwapsErrorKey("");const o=this.indexOfNewestCallInFlight+1;this.indexOfNewestCallInFlight=o,a||this.setSaveFetchedQuotes(!0);let[i]=await Promise.all([this._fetchTradesInfo(e,w({},t)),this._setSwapsRefreshRates()]);const{swapsState:{saveFetchedQuotes:c}}=this.store.getState();if(!c)return[{},null];i=(0,l.mapValues)(i,(e=>w(w({},e),{},{sourceTokenInfo:t.sourceTokenInfo,destinationTokenInfo:t.destinationTokenInfo})));const d=Date.now();let u=!1;if(!(0,g.isSwapsDefaultTokenAddress)(e.sourceToken,s)&&Object.values(i).length){const t=await this._getERC20Allowance(e.sourceToken,e.fromAddress,s),[n]=Object.values(i);if(u=n.approvalNeeded&&t.eq(0)&&"wrappedNative"!==n.aggregator,u){if(!r){const{gasLimit:e}=await this.timedoutGasReturn(n.approvalNeeded);i=(0,l.mapValues)(i,(t=>w(w({},t),{},{approvalNeeded:w(w({},t.approvalNeeded),{},{gas:e||m.DEFAULT_ERC20_APPROVE_GAS})})))}}else i=(0,l.mapValues)(i,(e=>w(w({},e),{},{approvalNeeded:null})))}let h=null;if(u||null!=e&&e.balanceError||(i=await this.getAllQuotesWithGasEstimates(i)),0===Object.values(i).length)this.setSwapsErrorKey(m.QUOTES_NOT_AVAILABLE_ERROR);else{const[e,t]=await this._findTopQuoteAndCalculateSavings(i);h=e,i=t}if(this.indexOfNewestCallInFlight!==o)throw new Error(m.SWAPS_FETCH_ORDER_CONFLICT);const{swapsState:p}=this.store.getState();let{selectedAggId:f}=p;return i[f]||(f=null),this.store.updateState({swapsState:w(w({},p),{},{quotes:i,fetchParams:w(w({},e),{},{metaData:t}),quotesLastFetched:d,selectedAggId:f,topAggId:h})}),n&&(this.pollCount+=1),!n||this.pollCount<4?(this.pollForNewQuotes(),[i,h]):(this.resetPostFetchState(),this.setSwapsErrorKey(m.QUOTES_EXPIRED_ERROR),null)}safeRefetchQuotes(){const{swapsState:e}=this.store.getState();!this.pollingTimeout&&e.fetchParams&&this.fetchAndSetQuotes(e.fetchParams)}setSelectedQuoteAggId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{selectedAggId:e})})}setSwapsTokens(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{tokens:e})})}clearSwapsQuotes(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:w(w({},e),{},{quotes:{}})})}setSwapsErrorKey(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{errorKey:e})})}async getAllQuotesWithGasEstimates(e){const t=await Promise.all(Object.values(e).map((async e=>{const{gasLimit:t,simulationFails:r}=await this.timedoutGasReturn(e.trade);return[t,r,e.aggregator]}))),r={};return t.forEach((([t,s,n])=>{if(t&&!s){const s=_(e[n].maxGas,e[n].estimatedRefund,t);r[n]=w(w({},e[n]),{},{gasEstimate:t,gasEstimateWithRefund:s})}else e[n].approvalNeeded&&(r[n]=e[n])})),r}timedoutGasReturn(e){return new Promise((t=>{let r=!1;const s=setTimeout((()=>{r=!0,t({gasLimit:null,simulationFails:!0})}),5*y.SECOND),n={data:e.data,from:e.from,to:e.to,value:e.value};this.getBufferedGasLimit({txParams:n},1).then((({gasLimit:e,simulationFails:n})=>{r||(clearTimeout(s),t({gasLimit:e,simulationFails:n}))})).catch((e=>{o.default.error(e),r||(clearTimeout(s),t({gasLimit:null,simulationFails:!0}))}))}))}async setInitialGasEstimate(e){const{swapsState:t}=this.store.getState(),r=w({},t.quotes[e]),{gasLimit:s,simulationFails:n}=await this.timedoutGasReturn(r.trade);if(s&&!n){const e=_(r.maxGas,r.estimatedRefund,s);r.gasEstimate=s,r.gasEstimateWithRefund=e}this.store.updateState({swapsState:w(w({},t),{},{quotes:w(w({},t.quotes),{},{[e]:r})})})}setApproveTxId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{approveTxId:e})})}setTradeTxId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{tradeTxId:e})})}setQuotesLastFetched(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{quotesLastFetched:e})})}setSwapsTxGasPrice(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{customGasPrice:e})})}setSwapsTxMaxFeePerGas(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{customMaxFeePerGas:e})})}setSwapsUserFeeLevel(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{swapsUserFeeLevel:e})})}setSwapsQuotesPollingLimitEnabled(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{quotesPollingLimitEnabled:e})})}setSwapsTxMaxFeePriorityPerGas(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{customMaxPriorityFeePerGas:e})})}setSwapsTxGasLimit(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{customMaxGas:e})})}setCustomApproveTxData(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{customApproveTxData:e})})}setBackgroundSwapRouteState(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{routeState:e})})}setSaveFetchedQuotes(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{saveFetchedQuotes:e})})}setSwapsLiveness(e){const{swapsState:t}=this.store.getState(),{swapsFeatureIsLive:r}=e;this.store.updateState({swapsState:w(w({},t),{},{swapsFeatureIsLive:r})})}setSwapsFeatureFlags(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:w(w({},t),{},{swapsFeatureFlags:e})})}resetPostFetchState(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:w(w({},M.swapsState),{},{tokens:e.tokens,fetchParams:e.fetchParams,swapsFeatureIsLive:e.swapsFeatureIsLive,swapsQuoteRefreshTime:e.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsQuotePrefetchingRefreshTime,swapsFeatureFlags:e.swapsFeatureFlags})}),clearTimeout(this.pollingTimeout)}resetSwapsState(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:w(w({},M.swapsState),{},{swapsQuoteRefreshTime:e.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsQuotePrefetchingRefreshTime})}),clearTimeout(this.pollingTimeout)}async _findTopQuoteAndCalculateSavings(e={}){const{contractExchangeRates:t}=this.getTokenRatesState(),{swapsState:{customGasPrice:r,customMaxPriorityFeePerGas:s}}=this.store.getState(),n=this._getCurrentChainId();if(!Object.keys(e).length)return{};const a=(0,l.cloneDeep)(e),{gasFeeEstimates:o,gasEstimateType:c}=await this._getEIP1559GasFeeEstimates();let d="0x0";if(c===f.GAS_ESTIMATE_TYPES.FEE_MARKET){const{high:{suggestedMaxPriorityFeePerGas:e},estimatedBaseFee:t}=o;d=(0,p.addCurrencies)(s||(0,p.decGWEIToHexWEI)(e),(0,p.decGWEIToHexWEI)(t),{aBase:16,bBase:16,toNumericBase:"hex",numberOfDecimals:6})}else c===f.GAS_ESTIMATE_TYPES.LEGACY?d=r||(0,p.decGWEIToHexWEI)(o.high):c===f.GAS_ESTIMATE_TYPES.ETH_GASPRICE&&(d=r||(0,p.decGWEIToHexWEI)(o.gasPrice));let m=null,b=null;Object.values(a).forEach((e=>{const{aggregator:r,approvalNeeded:s,averageGas:a,destinationAmount:o=0,destinationToken:c,destinationTokenInfo:l,gasEstimate:f,sourceAmount:v,sourceToken:y,trade:S,fee:k}=e,w=(f?new i.default(f,16):new i.default(a||C,10)).plus((null==s?void 0:s.gas)||"0x0",16).toString(16),P=(0,h.calcGasTotal)(w,d),E=new i.default(P,16).plus(S.value,16),_=(0,p.conversionUtil)(E,{fromCurrency:"ETH",fromDenomination:"WEI",toDenomination:"ETH",fromNumericBase:"BN",numberOfDecimals:6}),M=(0,g.isSwapsDefaultTokenAddress)(y,n)?(0,p.conversionUtil)(E.minus(v,10),{fromCurrency:"ETH",fromDenomination:"WEI",toDenomination:"ETH",fromNumericBase:"BN",numberOfDecimals:6}):_,O=(0,u.calcTokenAmount)(o,l.decimals),A=new i.default(100,10).minus(k,10).div(100),I=O.div(A).minus(O),x=t[Object.keys(t).find((e=>(0,T.isEqualCaseInsensitive)(e,c)))],N=x||1,D=O.times(N.toString(10),10),j=(0,g.isSwapsDefaultTokenAddress)(c,n)?1:x,R=j===undefined?D:D.minus(M,10);e.ethFee=M.toString(10),j!==undefined&&(e.ethValueOfTokens=D.toString(10),e.overallValueOfQuote=R.toString(10),e.metaMaskFeeInEth=I.times(j.toString(10)).toString(10)),(null===b||R.gt(b))&&(m=r,b=R)}));let v=null;if((0,g.isSwapsDefaultTokenAddress)(a[m].destinationToken,n)||Boolean(t[Object.keys(t).find((e=>{var t;return(0,T.isEqualCaseInsensitive)(e,null===(t=a[m])||void 0===t?void 0:t.destinationToken)}))])){const e=a[m];v={};const{ethFee:t,metaMaskFeeInEth:r,ethValueOfTokens:s}=O(Object.values(a));v.performance=new i.default(e.ethValueOfTokens,10).minus(s,10),v.fee=new i.default(t).minus(e.ethFee,10),v.metaMaskFee=e.metaMaskFeeInEth,v.total=v.performance.plus(v.fee).minus(v.metaMaskFee).toString(10),v.performance=v.performance.toString(10),v.fee=v.fee.toString(10),v.medianMetaMaskFee=r,a[m].isBestQuote=!0,a[m].savings=v}return[m,a]}async _getERC20Allowance(e,t,r){const s=new a.ethers.Contract(e,d.default,this.ethersProvider);return await s.allowance(t,m.SWAPS_CHAINID_CONTRACT_ADDRESS_MAP[r])}};const I={getMedianEthValueQuote:O,meansOfQuotesFeesAndValue:A};r.utils=I}}},{package:"<root>",file:"/Users/mac/code/a-mises/metamask-extension/app/scripts/controllers/swaps.js"}],[1363,{"./SmartTransactionsController":1361,"isomorphic-fetch":5406},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),e("isomorphic-fetch");const n=s(e("./SmartTransactionsController"));r.default=n.default}}},{package:"@metamask/smart-transactions-controller",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/@metamask/smart-transactions-controller/dist/index.js"}],[1131,{"@ethereumjs/tx":443,buffer:2478,"eth-sig-util":1132,"ethereumjs-util":3195,events:2479,hdkey:1135},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const{EventEmitter:s}=e("events"),n=e("hdkey"),a=e("ethereumjs-util"),o=e("eth-sig-util"),{TransactionFactory:i}=e("@ethereumjs/tx"),c="m",l="Ledger Hardware",d={ropsten:"http://api-ropsten.etherscan.io",kovan:"http://api-kovan.etherscan.io",rinkeby:"https://api-rinkeby.etherscan.io",mainnet:"https://api.etherscan.io"};class u extends s{constructor(e={}){super(),this.accountDetails={},this.bridgeUrl=null,this.type=l,this.page=0,this.perPage=5,this.unlockedAccount=0,this.hdk=new n,this.paths={},this.iframe=null,this.network="mainnet",this.implementFullBIP44=!1,this.deserialize(e),this.iframeLoaded=!1,this._setupIframe(),this.currentMessageId=0,this.messageCallbacks={},this._setupListener()}serialize(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts,accountDetails:this.accountDetails,bridgeUrl:this.bridgeUrl,implementFullBIP44:!1})}deserialize(e={}){return this.hdPath=e.hdPath||"m/44'/60'/0'",this.bridgeUrl=e.bridgeUrl||"https://metamask.github.io/eth-ledger-bridge-keyring",this.accounts=e.accounts||[],this.accountDetails=e.accountDetails||{},e.accountDetails||this._migrateAccountDetails(e),this.implementFullBIP44=e.implementFullBIP44||!1,this.accounts=this.accounts.filter((e=>Object.keys(this.accountDetails).includes(a.toChecksumAddress(e)))),Promise.resolve()}_migrateAccountDetails(e){if(this._isLedgerLiveHdPath()&&e.accountIndexes)for(const t of Object.keys(e.accountIndexes))this.accountDetails[t]={bip44:!0,hdPath:this._getPathForIndex(e.accountIndexes[t])};this._isLedgerLiveHdPath()||this.accounts.filter((e=>!Object.keys(this.accountDetails).includes(a.toChecksumAddress(e)))).forEach((e=>{try{this.accountDetails[a.toChecksumAddress(e)]={bip44:!1,hdPath:this._pathFromAddress(e)}}catch(t){console.log(`failed to migrate account ${e}`)}}))}isUnlocked(){return Boolean(this.hdk&&this.hdk.publicKey)}isConnected(){return this.isDeviceConnected}setAccountToUnlock(e){this.unlockedAccount=parseInt(e,10)}setHdPath(e){this.hdPath!==e&&(this.hdk=new n),this.hdPath=e}unlock(e){if(this.isUnlocked()&&!e)return Promise.resolve("already unlocked");const t=e?this._toLedgerPath(e):this.hdPath;return new Promise(((e,s)=>{this._sendMessage({action:"ledger-unlock",params:{hdPath:t}},(({success:t,payload:n})=>{t?(this.hdk.publicKey=r.from(n.publicKey,"hex"),this.hdk.chainCode=r.from(n.chainCode,"hex"),e(n.address)):s(n.error||new Error("Unknown error"))}))}))}addAccounts(e=1){return new Promise(((t,r)=>{this.unlock().then((async r=>{const s=this.unlockedAccount,n=s+e;for(let e=s;e<n;e++){const t=this._getPathForIndex(e);let r;r=this._isLedgerLiveHdPath()?await this.unlock(t):this._addressFromIndex(c,e),this.accountDetails[a.toChecksumAddress(r)]={bip44:this._isLedgerLiveHdPath(),hdPath:t},this.accounts.includes(r)||this.accounts.push(r),this.page=0}t(this.accounts)})).catch(r)}))}getFirstPage(){return this.page=0,this.__getPage(1)}getNextPage(){return this.__getPage(1)}getPreviousPage(){return this.__getPage(-1)}getAccounts(){return Promise.resolve(this.accounts.slice())}removeAccount(e){if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase())),delete this.accountDetails[a.toChecksumAddress(e)]}attemptMakeApp(){return new Promise(((e,t)=>{this._sendMessage({action:"ledger-make-app"},(({success:r,error:s})=>{r?e(!0):t(s)}))}))}updateTransportMethod(e){return new Promise(((t,r)=>{this.iframeLoaded?this._sendMessage({action:"ledger-update-transport",params:{transportType:e}},(({success:e})=>{e?t(!0):r(new Error("Ledger transport could not be updated"))})):this.delayedPromise={resolve:t,reject:r,transportType:e}}))}signTransaction(e,t){let s;if("function"==typeof t.getChainId)return t.v=a.bufferToHex(t.getChainId()),t.r="0x00",t.s="0x00",s=t.serialize().toString("hex"),this._signTransaction(e,s,(e=>(t.v=r.from(e.v,"hex"),t.r=r.from(e.r,"hex"),t.s=r.from(e.s,"hex"),t)));const n=t.getMessageToSign(!1);return s=r.isBuffer(n)?n.toString("hex"):a.rlp.encode(n).toString("hex"),this._signTransaction(e,s,(e=>{const r=t.toJSON();return r.type=t.type,r.v=a.addHexPrefix(e.v),r.r=a.addHexPrefix(e.r),r.s=a.addHexPrefix(e.s),i.fromTxData(r,{common:t.common,freeze:Object.isFrozen(t)})}))}_signTransaction(e,t,r){return new Promise(((s,n)=>{this.unlockAccountByAddress(e).then((e=>{this._sendMessage({action:"ledger-sign-transaction",params:{tx:t,hdPath:e}},(({success:e,payload:t})=>{if(e){const e=r(t);e.verifySignature()?s(e):n(new Error("Ledger: The transaction signature is not valid"))}else n(t.error||new Error("Ledger: Unknown error while signing transaction"))}))})).catch(n)}))}signMessage(e,t){return this.signPersonalMessage(e,t)}signPersonalMessage(e,t){return new Promise(((r,s)=>{this.unlockAccountByAddress(e).then((n=>{this._sendMessage({action:"ledger-sign-personal-message",params:{hdPath:n,message:a.stripHexPrefix(t)}},(({success:n,payload:i})=>{if(n){let n=i.v-27;n=n.toString(16),n.length<2&&(n=`0${n}`);const c=`0x${i.r}${i.s}${n}`,l=o.recoverPersonalSignature({data:t,sig:c});a.toChecksumAddress(l)!==a.toChecksumAddress(e)&&s(new Error("Ledger: The signature doesnt match the right address")),r(c)}else s(i.error||new Error("Ledger: Unknown error while signing message"))}))})).catch(s)}))}async unlockAccountByAddress(e){const t=a.toChecksumAddress(e);if(!Object.keys(this.accountDetails).includes(t))throw new Error(`Ledger: Account for address '${t}' not found`);const{hdPath:r}=this.accountDetails[t];if((await this.unlock(r)).toLowerCase()!==e.toLowerCase())throw new Error(`Ledger: Account ${e} does not belong to the connected device`);return r}async signTypedData(e,t,r={}){const s="V4"===r.version;if(!s)throw new Error("Ledger: Only version 4 of typed data signing is supported");const{domain:n,types:i,primaryType:c,message:l}=o.TypedDataUtils.sanitizeData(t),d=o.TypedDataUtils.hashStruct("EIP712Domain",n,i,s).toString("hex"),u=o.TypedDataUtils.hashStruct(c,l,i,s).toString("hex"),h=await this.unlockAccountByAddress(e),{success:p,payload:m}=await new Promise((e=>{this._sendMessage({action:"ledger-sign-typed-data",params:{hdPath:h,domainSeparatorHex:d,hashStructMessageHex:u}},(t=>e(t)))}));if(p){let r=m.v-27;r=r.toString(16),r.length<2&&(r=`0${r}`);const s=`0x${m.r}${m.s}${r}`,n=o.recoverTypedSignature_v4({data:t,sig:s});if(a.toChecksumAddress(n)!==a.toChecksumAddress(e))throw new Error("Ledger: The signature doesnt match the right address");return s}throw m.error||new Error("Ledger: Unknown error while signing message")}exportAccount(){throw new Error("Not supported on this device")}forgetDevice(){this.accounts=[],this.page=0,this.unlockedAccount=0,this.paths={},this.accountDetails={},this.hdk=new n}_setupIframe(){this.iframe=document.createElement("iframe"),this.iframe.src=this.bridgeUrl,this.iframe.allow="hid 'src'",this.iframe.onload=async()=>{if(this.iframeLoaded=!0,this.delayedPromise)try{const e=await this.updateTransportMethod(this.delayedPromise.transportType);this.delayedPromise.resolve(e)}catch(e){this.delayedPromise.reject(e)}finally{delete this.delayedPromise}},document.head.appendChild(this.iframe)}_getOrigin(){const e=this.bridgeUrl.split("/");return e.splice(-1,1),e.join("/")}_sendMessage(e,t){e.target="LEDGER-IFRAME",this.currentMessageId+=1,e.messageId=this.currentMessageId,this.messageCallbacks[this.currentMessageId]=t,this.iframe.contentWindow.postMessage(e,"*")}_setupListener(){window.addEventListener("message",(({origin:e,data:t})=>e===this._getOrigin()&&(t&&(this.messageCallbacks[t.messageId]?this.messageCallbacks[t.messageId](t):"ledger-connection-change"===t.action&&(this.isDeviceConnected=t.payload.connected)),undefined)))}async __getPage(e){this.page+=e,this.page<=0&&(this.page=1);const t=(this.page-1)*this.perPage,r=t+this.perPage;let s;return await this.unlock(),s=this._isLedgerLiveHdPath()?await this._getAccountsBIP44(t,r):this._getAccountsLegacy(t,r),s}async _getAccountsBIP44(e,t){const r=[];for(let s=e;s<t;s++){const e=this._getPathForIndex(s),t=await this.unlock(e),n=!this.implementFullBIP44||await this._hasPreviousTransactions(t);if(r.push({address:t,balance:null,index:s}),!n)break}return r}_getAccountsLegacy(e,t){const r=[];for(let s=e;s<t;s++){const e=this._addressFromIndex(c,s);r.push({address:e,balance:null,index:s}),this.paths[a.toChecksumAddress(e)]=s}return r}_padLeftEven(e){return e.length%2==0?e:`0${e}`}_normalize(e){return this._padLeftEven(a.bufferToHex(e).toLowerCase())}_addressFromIndex(e,t){const r=this.hdk.derive(`${e}/${t}`),s=a.publicToAddress(r.publicKey,!0).toString("hex");return a.toChecksumAddress(`0x${s}`)}_pathFromAddress(e){const t=a.toChecksumAddress(e);let r=this.paths[t];if(void 0===r)for(let e=0;e<1e3;e++)if(t===this._addressFromIndex(c,e)){r=e;break}if(void 0===r)throw new Error("Unknown address");return this._getPathForIndex(r)}_toAscii(e){let t="",r=0;const s=e.length;for("0x"===e.substring(0,2)&&(r=2);r<s;r+=2){const s=parseInt(e.substr(r,2),16);t+=String.fromCharCode(s)}return t}_getPathForIndex(e){return this._isLedgerLiveHdPath()?`m/44'/60'/${e}'/0/0`:`${this.hdPath}/${e}`}_isLedgerLiveHdPath(){return"m/44'/60'/0'/0/0"===this.hdPath}_toLedgerPath(e){return e.toString().replace("m/","")}async _hasPreviousTransactions(e){const t=this._getApiUrl(),r=await window.fetch(`${t}/api?module=account&action=txlist&address=${e}&tag=latest&page=1&offset=1`),s=await r.json();return"0"!==s.status&&s.result.length>0}_getApiUrl(){return d[this.network]||d.mainnet}}u.type=l,t.exports=u}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/@metamask/eth-ledger-bridge-keyring/index.js"}],[3080,{"./block-cache":3075,"./block-ref":3077,"./block-ref-rewrite":3076,"./block-tracker-inspector":3078,"./fetch":3079,"./inflight-cache":3081,"./providerAsMiddleware":3082,"./providerFromEngine":3083,"./providerFromMiddleware":3084,"./retryOnEmpty":3085,"./wallet":3087},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){s===undefined&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){s===undefined&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),n(e("./block-cache"),r),n(e("./block-ref-rewrite"),r),n(e("./block-ref"),r),n(e("./block-tracker-inspector"),r),n(e("./fetch"),r),n(e("./inflight-cache"),r),n(e("./providerAsMiddleware"),r),n(e("./providerFromEngine"),r),n(e("./providerFromMiddleware"),r),n(e("./retryOnEmpty"),r),n(e("./wallet"),r)}}},{package:"eth-json-rpc-middleware",file:"/Users/mac/code/a-mises/metamask-extension/node_modules/eth-json-rpc-middleware/dist/index.js"}]],[],{});